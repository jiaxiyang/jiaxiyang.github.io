<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiaxiyang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiyang">
<meta property="og:url" content="https://jiaxiyang.github.io/page/17/index.html">
<meta property="og:site_name" content="Xiyang">
<meta property="og:description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="贾夕阳">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jiaxiyang.github.io/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiyang</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGS6S6YFJ6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WGS6S6YFJ6');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiyang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Think twice, code once!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">197</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">44</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiaxiyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/08/22/Programming-Paradigm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/22/Programming-Paradigm/" class="post-title-link" itemprop="url">Programming-Paradigm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-22 08:23:46" itemprop="dateCreated datePublished" datetime="2021-08-22T08:23:46+08:00">2021-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/PLT/" itemprop="url" rel="index"><span itemprop="name">PLT</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/22/Programming-Paradigm/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/22/Programming-Paradigm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ol>
<li>编程范式的实际含义：限制和规范程序员的能力。</li>
<li>每个编程范式的目的都是设置限制，这些编程范式主要告诉我们不能做什么，而不是可以做什么。</li>
<li>语法，features和范式的关系？语言的语义和句法决定了语言的features? features决定了语言的编程范式？</li>
<li>限制：<ul>
<li>结构化编程：对程序控制权的直接转移进行了限制和规范， 限制goto语句， 因为if, while等包装了goto</li>
<li>面向对象编程：对程序控制权的间接访问进行了限制和规范， 限制函数指针, 因为多态包装了函数指针。</li>
<li>函数式编程：对程序中的赋值进行了限制和规范， 限制赋值语句，因为包装了变量</li>
</ul>
</li>
<li><code>关系： 多态是跨越架构边界的手段，函数式编程时我们规范和限制数据存放位置和访问权限的手段，结构化编程则是个模块的算法实现基础。这和软件架构的三大关注重点不谋而合：功能性，组件独立性，数据管理</code></li>
<li>多态归根结底不过就是函数指针的一种应用。</li>
</ol>
<h2 id="Procedural-Structured-programming-面向过程-结构化编程"><a href="#Procedural-Structured-programming-面向过程-结构化编程" class="headerlink" title="Procedural&#x2F;Structured programming 面向过程&#x2F;结构化编程"></a>Procedural&#x2F;Structured programming 面向过程&#x2F;结构化编程</h2><ol>
<li>结构化程序设计方法SP(Structured Programming)的着眼点是“面向过程”。　　</li>
<li>它采用子程序、块结构、for循环以及while循环等结构，来取代传统的 goto。goto语句的某些用法会导致某个模块无法被递归拆分成更小的，可证明的单元，会导致无法采用分解法来将大型问题进一步拆分成更小的，可证明的部分。</li>
<li>可以用<code>顺序结构</code>，<code>分支结构</code>和<code>循环结构</code>这三种结构构造出任何程序。</li>
<li>科学和数学： 数学是要将可证明的结论证明，科学则是要将可证明的结论证伪。科学理论和定律特点：它们可以被证伪，但没有办法证明。</li>
<li>软件开发像是一门科学研究学科：可通过无法证伪来证明软件的正确性。测试的作用。</li>
<li>结构化编程最有价值的地方在于它赋予我们创造可证伪程序单元的能力。</li>
<li>无论在哪一个层面上，从最小的函数到最大的组件，软件开发过程都和科学研究非常类似，他们都是由证伪驱动的。软件架构师选哟定义可以方便地进行证伪的模块,组件以及服务。</li>
<li></li>
</ol>
<h2 id="Object-Oriented-Programming-面向对象编程"><a href="#Object-Oriented-Programming-面向对象编程" class="headerlink" title="Object Oriented Programming 面向对象编程"></a>Object Oriented Programming 面向对象编程</h2><p>1.面向对象编程就是以多态为手段来对源代码中的依赖关系进行控制的能力，这种能力让软件架构师可以构建出某种插件式架构，让高层策略性组件与底层是线性组件相分离，底层组件可以编译成插件，实现独立于高层组件的开发和部署。<br>2.<code>依赖反转</code>： 通过接口，多态来使<code>源代码上的依赖关系方向</code>与<code>控制流方向</code>相反。 中间加了接口，只有被控制端的源代码依赖关系方向反转。 面向接口编程就是利用了依赖反转来使得模块分离。<br>3.依赖反转可用来打破组件间循环依赖。</p>
<h2 id="Functional-Programming-函数式编程"><a href="#Functional-Programming-函数式编程" class="headerlink" title="Functional Programming 函数式编程"></a>Functional Programming 函数式编程</h2><ol>
<li>最大特点是不可变性——某个符号所对应的值永远不变，从理论上讲，函数式编程语言应该是没有赋值语句的。</li>
<li>如果由足够大的存储量和处理能力，应用程序就可以用完全不可变的，纯函数式的方式来编程。</li>
<li>一个架构设计良好的应用程序应该将状态可修改的部分和不需要修改的部分隔离成单独的组件，然后用合适的机制来保护可变量。可变状态组件的逻辑越少越好。</li>
<li>好处：<ul>
<li>没有可变状态，函数就是引用透明(referential transparency)的和没有有副作用(no side effect)</li>
<li>可以解决并发竞争，死锁等问题</li>
<li>代码容易进行推理，不容易出错。</li>
<li>由于函数式语言是面向数学的抽象，更接近人的语言，而不是机器语言，代码会比较简洁，也更容被理解。</li>
</ul>
</li>
<li>面向数学的抽象，将计算描述为一种表达式求值，一句话，函数式程序就是一个表达式。</li>
<li>函数式编程中的函数不是指计算机中的函数，而是指数学中的函数，即自变量的映射。也就是说一个函数的值仅仅取决于函数参数的值。</li>
<li>函数式编程语言中的变量不是命令式编程语言中的变量（存储状态的单元），而是代数中的变量，即一个值的名称。变量的值是不可变的。命令式编程中的”x &#x3D; x + 1”（赋值运算），拿给程序员看说是对的，拿给数学家看，却被认为这个等式为假。</li>
</ol>
<h2 id="Imperative-programming-指令式编程"><a href="#Imperative-programming-指令式编程" class="headerlink" title="Imperative programming 指令式编程"></a>Imperative programming 指令式编程</h2><ol>
<li>面向计算机硬件的抽象<ul>
<li>变量： 存储单元</li>
<li>赋值语句： 获取，存储指令</li>
<li>表达式： 内存引用和算数运算</li>
<li>控制语句： 跳转指令</li>
</ul>
</li>
<li>冯诺依曼机的指令序列。</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li>&lt;&lt;架构整洁之道&gt;&gt;</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/08/16/Awesome-Books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/16/Awesome-Books/" class="post-title-link" itemprop="url">Awesome Books</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-16 22:39:38" itemprop="dateCreated datePublished" datetime="2021-08-16T22:39:38+08:00">2021-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/16/Awesome-Books/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/16/Awesome-Books/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>358</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Awesome-Books"><a href="#Awesome-Books" class="headerlink" title="Awesome Books"></a>Awesome Books</h2><ol>
<li><a target="_blank" rel="noopener" href="https://hansimov.gitbook.io/csapp/publish-info/publisher-words">深入理解计算机系统 Computer Systems:A Programmer’s Perspective Computer Systems:A Programmer’s Perspective CSAPP</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sarabander/sicp-pdf">计算机程序的构造和解释 Structure and Interpretation of Computer Programs SICP</a></li>
<li>计算机体系结构 量化研究方法</li>
<li>计算机组成与设计 硬件软件接口</li>
<li>重构</li>
<li>架构整洁之道</li>
<li>代码整洁之道</li>
<li>设计模式</li>
<li>编译原理</li>
<li>软件建模与设计</li>
<li>C++ Primer</li>
<li><a target="_blank" rel="noopener" href="https://github.com/qiangmzsx/Software-Engineering-at-Google">Software-Engineering-at-Google 中文版本</a></li>
<li><a target="_blank" rel="noopener" href="https://abseil.io/resources/swe-book">Software Engineering at Google</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hmemcpy/milewski-ctfp-pdf">Category Theory for Programmers</a></li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cs-books/influential-cs-books">cs-books&#x2F;influential-cs-books</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/07/28/Cmake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/28/Cmake/" class="post-title-link" itemprop="url">Modern Cmake</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-28 08:56:09" itemprop="dateCreated datePublished" datetime="2021-07-28T08:56:09+08:00">2021-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-13 20:08:40" itemprop="dateModified" datetime="2025-04-13T20:08:40+08:00">2025-04-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/Cmake/" itemprop="url" rel="index"><span itemprop="name">Cmake</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/07/28/Cmake/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/07/28/Cmake/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>18 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cmake-base"><a href="#cmake-base" class="headerlink" title="cmake base"></a>cmake base</h2><ol>
<li><code>g++ -o test test.cpp -Iglog/include -lglog -Lglog/lib</code><ul>
<li><code>-I</code> 表示从后面路径找头文件</li>
<li><code>-l</code> 表示链接库，glog -&gt; libglog.so&#x2F;libglog.a, 只需要指定glog，libglog.so会自动补全</li>
<li><code>-L</code> 表示从后面路径找链接库</li>
<li><code>-l</code> 和 <code>-L</code> 配合找到要链接的库</li>
</ul>
</li>
<li>常见的两个问题：<ul>
<li><code>No such file or directory</code> 找不到头文件或共享库，需要指定-I或-L</li>
<li><code>undefined reference to xxx</code> 未定义符号xxx, 需要-l链接xxx定义所在的共享库</li>
</ul>
</li>
<li><code>cmake .. -DCMAKE_VERBOSE_MAKEFILE=ON</code> 加参数显示详细编译链接信息<ul>
<li>出问题可以把编译或者链接信息单独拿出来执行或修改，方便定位和修复问题</li>
</ul>
</li>
<li>cmake基础命令<ul>
<li><code>target_include_directories</code> 相当于加<code>-I</code></li>
<li><code>target_link_directories</code> 相当于加<code>-L</code></li>
<li><code>target_link_libraries</code> 相当于加<code>-l</code></li>
</ul>
</li>
</ol>
<h2 id="code-generate"><a href="#code-generate" class="headerlink" title="code generate"></a>code generate</h2><ol>
<li>vitis ai library overview generate test_performance…. <a target="_blank" rel="noopener" href="https://github.com/Xilinx/Vitis-AI/blob/v2.5/src/Vitis-AI-Library/overview/cmake/XilinxTest.cmake#L346">link</a></li>
</ol>
<h2 id="FetchContent"><a href="#FetchContent" class="headerlink" title="FetchContent"></a>FetchContent</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line">FetchContent_Declare(backward</span><br><span class="line">    GIT_REPOSITORY https://github.com/bombela/backward-cpp</span><br><span class="line">    GIT_TAG master  <span class="comment"># or a version tag, such as v1.6</span></span><br><span class="line">    SYSTEM          <span class="comment"># optional, the Backward include directory will be treated as system directory</span></span><br><span class="line">)</span><br><span class="line">FetchContent_MakeAvailable(backward)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(mytarget PUBLIC Backward::Interface)</span><br></pre></td></tr></table></figure>

<h2 id="版本升级"><a href="#版本升级" class="headerlink" title="版本升级"></a>版本升级</h2><ol>
<li>下载 sh 脚本，本地升级。<a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/releases">link</a></li>
<li><code>wget -c https://cmake.org/files/v3.28/cmake-3.28.1-linux-x86_64.sh &amp;&amp; chmod +x cmake-3.28.1-linux-x86_64.sh &amp;&amp; ./cmake-3.28.1-linux-x86_64.sh</code></li>
<li><code>wget -c https://cmake.org/files/v3.28/cmake-3.28.1-linux-aarch64.sh &amp;&amp; chmod +x cmake-3.28.1-linux-aarch64.sh &amp;&amp; ./cmake-3.28.1-linux-aarch64.sh</code></li>
</ol>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ol>
<li><code>CMAKE_SOURCE_DIR</code>: project</li>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code> 当前 CMakeLists.txt 所在目录</li>
<li><code>CMAKE_BINARY_DIR</code>: 编译目录</li>
<li><code>CMAKE_CURRENT_BINARY_DIR</code>: 指向当前正在处理的 CMakeLists.txt 文件对应的构建目录。</li>
</ol>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><ol>
<li>cmake 和 make的区别<ul>
<li>工程设计师	CMake	设计蓝图（生成构建脚本，比如 Makefile）</li>
<li>工地工人	Make	根据蓝图（Makefile）来干活（编译）</li>
</ul>
</li>
<li>(good)编译 log 太多可以把 error 重定向到文件 <code>command 2&gt; error_log.txt</code></li>
<li>include_directories 加 SYSTEM 防止第三方库报 warning <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/include_directories.html">link</a></li>
<li>makefile 传参</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SRC_DIR ?= /src</span><br><span class="line">BUILD_DIR ?= /build</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make SRC_DIR=/tmp/src BUILD_DIR=/tmp/build</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>target_compile_definitions</code> 导出定义，供下游使用，<code>add_definitions</code>不会被导出</li>
<li><code>-DCMAKE_TOOLCHAIN_FILE=path/to/toolchain-clang.cmake</code> 设置 toolchain</li>
<li><code>-DCMAKE_BUILD_TYPE=RelWithDebInfo</code> release 模式编译，带 debug info</li>
<li><code>-DCMAKE_VERBOSE_MAKEFILE=ON</code> 显示详细信息</li>
<li><code>-DCMAKE_FIND_DEBUG_MODE=ON</code></li>
<li><code>cmake -S . -B build --trace-source=CMakeLists.txt</code> trace CMakeLists.txt</li>
<li><code>cmake -S . -B build --debug-find</code> trace find</li>
<li>osqp</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Debug&quot;</span>)                                                                                                                                                                                                                             <span class="keyword">set</span>(OSQP_ENABLE_DEBUG <span class="keyword">ON</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_VERBOSE_MAKEFILE <span class="keyword">ON</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li>(good)打印所有变量</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_cmake_property</span>(_variableNames VARIABLES)</span><br><span class="line"><span class="keyword">foreach</span> (_variableName <span class="variable">$&#123;_variableNames&#125;</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li><code>-DCMAKE_CXX_FLAGS=&quot;-g&quot;</code> cmake 编译选项添加 debug info； release 模式也适用</li>
<li>参考官方写 CMakeLists.txt: <a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/cmake">cmake</a> <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv">opencv</a></li>
<li><code>Call stack</code>: 看出问题的顺序</li>
<li>CMake 3.13 now allows the target_link_libraries() command to be called from any directory to add link dependencies and link interface libraries to targets created in other directories.</li>
<li>cmake 2.8 3.1 对 string(REGEX MATCH “lib.*.so$” LIB ${LIB}) 处理是不同的， 2.8 需要加<code>\\.</code></li>
<li>get_filename_component(LIB ${LIB} NAME_WE) 获取文件名，无后缀</li>
<li>参考 opencv 等库的 CMakeLists.txt</li>
<li>对外 include 里如果包含，需要 PUBLIC 传递出去，如果只在实现里用则用 PRIVATE</li>
<li><code>RUNTIME_DEPENDENCIES</code> 3.21 之后可以安装依赖库</li>
<li><code>#cmakedefine USE_MYMATH</code> 条件编译能看到定义的配置</li>
<li>增量编译：是在源程序已经完成第一次编译的基础上再次编译时采取的一种增量性编译技术。只重新编译必须的部分，即通过依赖分析，只编译修改过的部分及其影响的路径。</li>
<li>debug CMakeLists.txt <code>cmake -S . -B build --trace-source=CMakeLists.txt</code></li>
<li>处理依赖关系时区别名，例如导入 gflags.so <code>add_library(gflags SHARED IMPORTED GLOBAL) add_library(gflags::gflags ALIAS gflags)</code>来区别 libgflags.so</li>
<li>注意区分<code>add_library(gflags SHARED IMPORTED GLOBAL)</code>和<code>libgflags.so</code>的区别，前者是 target, 后者是 so。为了区分两者， 可以使用<code>add_library(gflags SHARED IMPORTED GLOBAL) add_library(gflags::gflags ALIAS gflags)</code> target::target 来区分。</li>
<li><code>cmake</code> + <code>ninja</code> + <code>clang</code> 组合加速编译</li>
<li>bazel、GYP、CMake 和 Meson 是文件生成器(build system generator)， make, ninja 是构建系统。</li>
<li><code>cmake ..</code>: configure the project and generate a native build system</li>
<li>cmake 修改编译选项时需要删除 build 目录下的 <code>CMakeCache.txt</code> 否则编译选项不 work, 或者重新<code>cmake ..</code> or run script <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/42922588">link</a></li>
<li><strong>加速编译</strong>： <code>configure the project and generate a native build system</code>后直接执行<code>make -C $BUILD_DIR -j4</code> or <code>cmake --build $&#123;BUILD_DIR&#125;</code>，不用每次都重新构建编译系统</li>
<li>[CMake] Debug build compiles and links, but Release build fails to link?</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (CMAKE_BUILD_TYPE <span class="keyword">MATCHES</span> Release)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_SHARED_LINKER_FLAGS <span class="string">&quot;-s -Wl,--version-script=$&#123;PROJECT_SOURCE_DIR&#125;/symbol.lst&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li>-DCMAKE_BUILD_TYPE&#x3D;Debug: <code>-fPIC -O2 -Wall</code></li>
<li>-DCMAKE_BUILD_TYPE&#x3D;Release: <code>-fPIC -O2 -DNDEBUG</code></li>
<li><code>enable_testing()</code> 需要在第一级 CMakeLists.txt 里，否则<code>make test</code>不生效</li>
<li>make test 中程序 pwd 路径为 build 目录程序所在路径。</li>
<li><code>Testing/Temporary/LastTest.log</code> 为<code>make test</code>结果</li>
<li><code>set(CMAKE_VERBOSE_MAKEFILE on)</code> make 时显示详细信息，等效为<code>make VERBOSE=1</code></li>
<li>set(CMAKE_C_COMPILER &#x2F;opt&#x2F;gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu&#x2F;bin&#x2F;aarch64-linux-gnu-gcc)， set(CMAKE_CXX_COMPILER &#x2F;opt&#x2F;gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu&#x2F;bin&#x2F;aarch64-linux-gnu-g++) 要在 project 前， 会根据编译器选择环境， 无这条则会选择宿主机， 地平线 demo 问题。</li>
<li>option 和 c++里的 definition 是不一样的 definition 需要 add_definitions()来添加</li>
</ol>
<h2 id="functions"><a href="#functions" class="headerlink" title="functions"></a>functions</h2><h3 id="add-test"><a href="#add-test" class="headerlink" title="add test"></a>add test</h3><h3 id="cpm-add-lib"><a href="#cpm-add-lib" class="headerlink" title="cpm add lib"></a>cpm add lib</h3><h2 id="cmake-变量"><a href="#cmake-变量" class="headerlink" title="cmake 变量"></a>cmake 变量</h2><h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><h2 id="cmake-component"><a href="#cmake-component" class="headerlink" title="cmake component"></a>cmake component</h2><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cpm-cmake/CPM.cmake">CPM.cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">FetchContent</a></li>
<li>CPM.cmake 封装了 FetchContent</li>
<li>导入已经编译好的库</li>
<li>导入三方库参考 cmake export 出的 cmake file。参见 cpp_sandbox&#x2F;cmake&#x2F;export; 查看生成的 cmake 文件，主要两个步骤<ul>
<li>add_library(xxx::xxx STATIC IMPORTED) 导入库</li>
<li>set_target_properties 设置 include 和 link 依赖</li>
</ul>
</li>
<li>参考 vitis ai 导入 xrt</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(gflags_ADDED)</span><br><span class="line">  <span class="keyword">add_library</span>(gflags INTERFACE IMPORTED GLOBAL) <span class="comment">## global导入， 解决cpm local scope include_directories不工作问题</span></span><br><span class="line">  <span class="keyword">add_library</span>(gflags::gflags ALIAS gflags)</span><br><span class="line">  <span class="keyword">set_target_properties</span>(</span><br><span class="line">    gflags PROPERTIES IMPORTED_LOCATION <span class="string">&quot;$&#123;gflags_SOURCE_DIR&#125;/lib/libgflags.so&quot;</span>)</span><br><span class="line">  <span class="keyword">target_include_directories</span>(gflags INTERFACE <span class="string">&quot;$&#123;gflags_SOURCE_DIR&#125;/include&quot;</span>)</span><br><span class="line">  <span class="comment"># target_link_directories(gflags INTERFACE &quot;$&#123;gflags_SOURCE_DIR&#125;/lib&quot;)</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h2 id="cpack"><a href="#cpack" class="headerlink" title="cpack"></a>cpack</h2><h3 id="build-完之后-make-package"><a href="#build-完之后-make-package" class="headerlink" title="build 完之后 make package"></a>build 完之后 make package</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CPACK_GENERATOR <span class="string">&quot;TGZ&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_FILE_NAME <span class="string">&quot;cpack-test&quot;</span>)                                                                                                                                                                           <span class="keyword">include</span>(CPack)</span><br></pre></td></tr></table></figure>

<h2 id="color"><a href="#color" class="headerlink" title="color"></a>color</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/36233927">cmake 自带打印颜色</a> <code>cmake -E cmake_echo_color --green &quot;&gt;&gt;&gt;&gt;&gt; Download doxygen&quot;</code></li>
<li>put make function in .bashrc</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">make</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">  pathpat=<span class="string">&quot;(/[^/]*)+:[0-9]+&quot;</span></span><br><span class="line">  ccred=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;31m&quot;</span>)</span><br><span class="line">  ccyellow=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;33m&quot;</span>)</span><br><span class="line">  ccend=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">  make <span class="string">&quot;<span class="variable">$@</span>&quot;</span> 2&gt;&amp;1 | sed -E -e <span class="string">&quot;/[Ee]rror[: ]/ s%<span class="variable">$pathpat</span>%<span class="variable">$ccred</span>&amp;<span class="variable">$ccend</span>%g&quot;</span> -e <span class="string">&quot;/[Ww]arning[: ]/ s%<span class="variable">$pathpat</span>%<span class="variable">$ccyellow</span>&amp;<span class="variable">$ccend</span>%g&quot;</span></span><br><span class="line">  <span class="built_in">return</span> <span class="variable">$&#123;PIPESTATUS[0]&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ol>
<li>内置函数获取名字</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span>(REGEX MATCH <span class="string">&quot;lib.*\.so$&quot;</span> LIB <span class="variable">$&#123;LIB&#125;</span>)</span><br><span class="line"><span class="keyword">if</span>(LIB)</span><br><span class="line">    <span class="keyword">get_filename_component</span>(LIB <span class="variable">$&#123;LIB&#125;</span> NAME_WE)</span><br><span class="line">    <span class="keyword">string</span>(REPLACE <span class="string">&quot;lib&quot;</span> <span class="string">&quot;&quot;</span> LIB <span class="string">&quot;$&#123;LIB&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.  获取库列表名字</span><br><span class="line"></span><br><span class="line">```cmake</span><br><span class="line"><span class="keyword">execute_process</span>(</span><br><span class="line">  <span class="keyword">COMMAND</span> ls</span><br><span class="line">  <span class="keyword">COMMAND</span> sh -c <span class="string">&quot;awk &#x27;/.so\$|.a\$/&#123;print \$0&#125;&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">COMMAND</span> sh -c <span class="string">&quot;awk -F &#x27;.&#x27; &#x27;&#123;print substr($1,4)&#125;&#x27;&quot;</span></span><br><span class="line">  WORKING_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span></span><br><span class="line">  OUTPUT_VARIABLE LIBS</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE)</span><br><span class="line"><span class="keyword">message</span>(STATUS, <span class="string">&quot;LIBS=$&#123;LIBS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot;\n&quot;</span> <span class="string">&quot;;&quot;</span> LIBS <span class="string">&quot;$&#123;LIBS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">list</span>(LENGTH LIBS len)</span><br><span class="line"><span class="keyword">message</span>(STATUS, <span class="string">&quot;len=\&quot;$&#123;len&#125;\&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot; &quot;</span> <span class="string">&quot;;&quot;</span> SEXY_LIST <span class="variable">$&#123;LIBS&#125;</span>)</span><br><span class="line"><span class="keyword">foreach</span>(LIB <span class="variable">$&#123;LIBS&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS, <span class="string">&quot;LIB=\&quot;$&#123;LIB&#125;\&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>&#96;include(CMakePrintHelpers) cmake_print_variables(MY_VARIABLE)” 打印信息</p>
</li>
<li><p><code>-DCMAKE_EXPORT_COMPILE_COMMANDS=ON</code> 代码补全使用</p>
</li>
<li><p><code>cmake -LA</code> after build in build dir:list a set of available options in the cmake</p>
</li>
<li><p>如果 CMAKE_BUILD_TYPE 的值为”Debug”就采用 debug 模式编译；如果 CMAKE_BUILD_TYPE 的值为”Release”就采用 release 模式编译；如果 CMAKE_BUILD_TYPE 的值为空，默认采用 release 模式</p>
</li>
<li><p>debug release set</p>
</li>
<li><p>CMakeLists.txt</p>
</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword">SET</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Release&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>build script</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> Release</span><br><span class="line"><span class="built_in">cd</span> Release</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<ol>
<li><code>set(CMAKE_CXX_COMPILER &quot;g++&quot;)</code> 选择编译器</li>
<li>查看 target properties</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get all propreties that cmake supports</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_PROPERTY_LIST)</span><br><span class="line">    <span class="keyword">execute_process</span>(<span class="keyword">COMMAND</span> cmake --help-property-<span class="keyword">list</span> OUTPUT_VARIABLE CMAKE_PROPERTY_LIST)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert command output into a CMake list</span></span><br><span class="line">    <span class="keyword">string</span>(REGEX REPLACE <span class="string">&quot;;&quot;</span> <span class="string">&quot;\\\\;&quot;</span> CMAKE_PROPERTY_LIST <span class="string">&quot;$&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">string</span>(REGEX REPLACE <span class="string">&quot;\n&quot;</span> <span class="string">&quot;;&quot;</span> CMAKE_PROPERTY_LIST <span class="string">&quot;$&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(print_properties)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;CMAKE_PROPERTY_LIST = $&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(print_target_properties <span class="keyword">target</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">TARGET</span> <span class="variable">$&#123;target&#125;</span>)</span><br><span class="line">      <span class="keyword">message</span>(STATUS <span class="string">&quot;There is no target named &#x27;$&#123;target&#125;&#x27;&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span>()</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(property <span class="variable">$&#123;CMAKE_PROPERTY_LIST&#125;</span>)</span><br><span class="line">        <span class="keyword">string</span>(REPLACE <span class="string">&quot;&lt;CONFIG&gt;&quot;</span> <span class="string">&quot;$&#123;CMAKE_BUILD_TYPE&#125;&quot;</span> property <span class="variable">$&#123;property&#125;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Fix https://stackoverflow.com/questions/32197663/how-can-i-remove-the-the-location-property-may-not-be-read-from-target-error-i</span></span><br><span class="line">        <span class="keyword">if</span>(property <span class="keyword">STREQUAL</span> <span class="string">&quot;LOCATION&quot;</span> <span class="keyword">OR</span> property <span class="keyword">MATCHES</span> <span class="string">&quot;^LOCATION_&quot;</span> <span class="keyword">OR</span> property <span class="keyword">MATCHES</span> <span class="string">&quot;_LOCATION$&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span>()</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">get_property</span>(was_set <span class="keyword">TARGET</span> <span class="variable">$&#123;target&#125;</span> PROPERTY <span class="variable">$&#123;property&#125;</span> <span class="keyword">SET</span>)</span><br><span class="line">        <span class="keyword">if</span>(was_set)</span><br><span class="line">            <span class="keyword">get_target_property</span>(value <span class="variable">$&#123;target&#125;</span> <span class="variable">$&#123;property&#125;</span>)</span><br><span class="line">            <span class="keyword">message</span>(<span class="string">&quot;$&#123;target&#125; $&#123;property&#125; = $&#123;value&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">endforeach</span>()</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">print_target_properties(xxx)</span><br></pre></td></tr></table></figure>

<ol>
<li>查看 cmake property</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get_cmake_property</span><span class="params">(_variableNames VARIABLES)</span></span></span><br><span class="line">foreach (_variableName $&#123;_variableNames&#125;)</span><br><span class="line">    <span class="built_in">message</span>(STATUS <span class="string">&quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li>查看 include_director</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(dirs DIRECTORY $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; PROPERTY INCLUDE_DIRECTORIES)</span></span></span><br><span class="line"><span class="function"><span class="title">foreach</span><span class="params">(dir $&#123;dirs&#125;)</span></span></span><br><span class="line">  <span class="built_in">message</span>(STATUS <span class="string">&quot;include dir=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(dirs DIRECTORY $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; PROPERTY LINK_DIRECTORIES)</span></span></span><br><span class="line"><span class="function"><span class="title">foreach</span><span class="params">(dir $&#123;dirs&#125;)</span></span></span><br><span class="line">  <span class="built_in">message</span>(STATUS <span class="string">&quot;link dir=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>ctest -N</code> 查看 test 列表</li>
<li>target_compile_definitions(full_flow PRIVATE “-DGIT_INFO&#x3D;&quot;${GIT_BRANCH}-${GIT_COMMIT_HASH}&quot;“) 代替 add_definitions(-DGIT_INFO)</li>
<li>add_subdirectory(protobuf) 添加子文件夹，子文件夹下 CmakeLists.txt 管理相应文件夹。</li>
<li>cmake_minimum_required(VERSION 3.8） 版本要求</li>
<li>project(HELLO) 定义工程名</li>
<li>message(STATUS, ““） 打印消息</li>
<li>aux_source_directory(. DIR_SRCS) 查找指定目录下的所有源文件并将结果存入变量名</li>
<li>add_excutable(hello, ${DIR_SRCS}) 定义了工程生成的可执行程序文件名，源文件为 DIR_SRCS 变量中定义的源文件列表</li>
<li>add_library(libname [SHARED | STATIC | MODULE] source_files) 定义了库文件名 静态库，动态库不能重名</li>
<li>add_library(hello_static STATIC ${LIBHELLO_SRC}) set_target_properties(hello_static PROPERTIES OUTPUT_NAME “hello”) 有 libhello.so 的情况下生成 libhello.a</li>
<li><code>CMAKE_INSTALL_PREFIX</code> 变量类似于 configure 脚本的 – prefix,常见的使用方法看 <code>cmake -DCMAKE_INSTALL_PREFIX=/usr .</code></li>
<li><code>make install PREFIX=your_installation_directory</code></li>
<li>install(TARGETS name [ARCHIVE|LIBRARY|RUNTIME] [DESTINATION <dir>] …) 安装库和可执行程序</li>
<li>install(FILES include&#x2F;quicksort.hpp DESTINATION include) 安装头文件</li>
<li>include_directories(&#x2F;usr&#x2F;include&#x2F;hello) 添加头文件搜索路径</li>
<li>link_directories(dir1 dir2…) 添加链接库路径</li>
<li>官网不推荐使用 link_directoris，而是推荐使用 find_package 和 find_library 寻找共享库的绝对路径，再传给 target_link_libraries 使用</li>
<li>find_library(LIBQUICKSORT_PATH quicksort .&#x2F;lib)</li>
<li>find_path(GLOG_INCLUDE_DIR glog&#x2F;logging.h PATHS ${GLOG_ROOT_DIR}) 先查找路径再查找库 find_library(GLOG_LIBRARY glog PATHS ${GLOG_ROOT_DIR} PATH_SUFFIXES lib lib64)</li>
<li>target_link_libraries(main hello) 为可执行程序添加 libhello.so 链接库</li>
<li>add_definitions(“-DNDEBUG” “-O3”) 向编译器添加编译选项</li>
<li>set(CMAKE_CXX_FLAGS “$(CMAKE_CXX_FLAGS) -std&#x3D;c++11”) 设置 C++编译选项 等价于 add_definitons(“-std&#x3D;c++11)</li>
<li>option 选项，让你可以根据选项值进行条件编译 option(DEBUG “Debug mode.” OFF)</li>
<li>cmake –help-module FindProtobuf ；cmake –help-module FindThreads 查看模块的 cmake 用法</li>
<li>list</li>
<li>file</li>
<li>string</li>
<li>foreach</li>
<li>if 用法</li>
</ol>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">option</span>(<span class="variable">DEBUG</span> <span class="string">&quot;Debug mode.&quot;</span> <span class="variable">OFF</span>)</span></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="variable">DEBUG</span>)</span></span><br><span class="line">    <span class="function"><span class="title">message</span>(<span class="variable">STATUS</span> <span class="string">&quot;Use Debug mode&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="title">else</span>()</span></span><br><span class="line">    <span class="function"><span class="title">message</span>(<span class="variable">STATUS</span> <span class="string">&quot;Don&#x27;t use Debug mode&quot;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><ol>
<li>CMake is not a build system. It’s the build system generator.</li>
<li>add_subdirectory 最好只有一层，避免嵌套，只添加顶层文件夹</li>
</ol>
<h2 id="Target-and-Property"><a href="#Target-and-Property" class="headerlink" title="Target and Property"></a>Target and Property</h2><ol>
<li>现代化的 CMake 是围绕 Target 和 Property 来定义的，并且竭力避免出现变量 variable 的定义。Variable 横行是典型 CMake2.8 时期的风格。现代版的 CMake 更像是在遵循 OOP 的规则，通过 target 来约束 link、compile 等相关属性的作用域。</li>
</ol>
<h3 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h3><ol>
<li>如果把一个 Target 想象成一个对象（Object），会发现两者的组织方式非常相似：</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">构造函数：</span><br><span class="line">add_executable</span><br><span class="line">add_library</span><br><span class="line">成员函数：</span><br><span class="line"><span class="function"><span class="title">get_target_property</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">set_target_properties</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(TARGET)</span></span></span><br><span class="line"><span class="function"><span class="title">set_property</span><span class="params">(TARGET)</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_definitions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_features</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_options</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_include_directories</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_link_libraries</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_sources</span><span class="params">()</span></span></span><br><span class="line">成员变量</span><br><span class="line">Target properties（太多）</span><br></pre></td></tr></table></figure>

<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><ol>
<li>target_xxx 命令 PRIVATE&#x2F;PUBLIC…后为 property，例如</li>
</ol>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target_source(MyEXE PRIVATE <span class="string">&quot;main.cpp&quot;</span>)  ## main.cpp为source属性</span><br><span class="line">target_link_library(MyEXE PRIVATE Poco::Net Poco::Util) ## Poco:Net Poco::Util为link属性</span><br><span class="line">target_compile_definition(MyEXE PRIVATE std_cxx_14) ## std_cxx_14为编译属性</span><br></pre></td></tr></table></figure>

<h2 id="Build-Requirements-and-Usage-Requirements"><a href="#Build-Requirements-and-Usage-Requirements" class="headerlink" title="Build-Requirements and Usage-Requirements"></a>Build-Requirements and Usage-Requirements</h2><ol>
<li><code>Build-Requirements</code>： 包含了所有构建 Target 必须的材料。如源代码，include 路径，预编译命令，链接依赖，编译&#x2F;链接选项，编译&#x2F;链接特性等。</li>
<li><code>Usage-Requirements</code>：包含了所有使用 Target 必须的材料。如源代码，include 路径，预编译命令，链接依赖，编译&#x2F;链接选项，编译&#x2F;链接特性等。这些往往是当另一个 Target 需要使用当前 target 时，必须包含的依赖</li>
</ol>
<h2 id="PRIVATE-INTERFACE-PUBLIC"><a href="#PRIVATE-INTERFACE-PUBLIC" class="headerlink" title="PRIVATE&#x2F;INTERFACE&#x2F;PUBLIC"></a>PRIVATE&#x2F;INTERFACE&#x2F;PUBLIC</h2><ol>
<li>没有指定 PUBLIC 或 PRIVATE 关键字时,CMake 会把这个链接库的属性默认设置为 PRIVATE。</li>
<li>定义了<code>Target属性</code>的传递范围。</li>
<li><code>PRIVATE</code>: 表示 Target 的属性只定义在当前 Target 中，任何依赖当前 Target 的 Target 不共享 PRIVATE 关键字下定义的属性。Build-Requirements</li>
<li><code>INTERFACE</code>：表示 Target 的属性不适用于其自身，而只适用于依赖其的 Target。 Usage-Requirements</li>
<li><code>PUBLIC</code>：表示 Target 的属性既是 build-requirements 也是 usage-requirements。凡是依赖。凡是依赖于当前 Target 的 Target 都会共享本属性。</li>
</ol>
<h2 id="Modern-Cmake-Using-Steps"><a href="#Modern-Cmake-Using-Steps" class="headerlink" title="Modern Cmake Using Steps"></a>Modern Cmake Using Steps</h2><ol>
<li>Always create targets with no sources first.</li>
<li>Use <code>target...</code> commands to add build-&#x2F;usage-requirements</li>
<li>Use <code>IMPORTED</code> targets for external libraires. But, prefer <code>find_package</code> or <code>EXPORTED</code> targets ro creating them yourself.</li>
</ol>
<h2 id="3-13-之默认生成绝对路径"><a href="#3-13-之默认生成绝对路径" class="headerlink" title="3.13 之默认生成绝对路径"></a>3.13 之默认生成绝对路径</h2><ol>
<li>3.13 之前</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_library( MyTarget SHARED )</span><br><span class="line">target_sources ( MyTarget</span><br><span class="line">    <span class="keyword">PRIVATE</span>    src/A.cpp</span><br><span class="line">               src/B.cpp</span><br><span class="line">               headers/B.hpp</span><br><span class="line">    <span class="keyword">PUBLIC</span>     $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;<span class="regexp">/headers/</span>A.hpp</span><br><span class="line">    <span class="keyword">INTERFACE</span>  $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;<span class="regexp">/headers/</span>C.hpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>3.13 之后生成绝对路径</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_library( MyTarget SHARED )</span><br><span class="line">target_sources ( MyTarget</span><br><span class="line">    PRIVATE    <span class="attribute">src</span>/<span class="selector-tag">A</span><span class="selector-class">.cpp</span></span><br><span class="line">               <span class="attribute">src</span>/<span class="selector-tag">B</span><span class="selector-class">.cpp</span></span><br><span class="line">               headers/<span class="selector-tag">B</span><span class="selector-class">.hpp</span></span><br><span class="line">    PUBLIC     headers/<span class="selector-tag">A</span><span class="selector-class">.hpp</span></span><br><span class="line">    INTERFACE  headers/C<span class="selector-class">.hpp</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h2><ol>
<li>top level CMakeLists.txt begining:</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>( VERSION <span class="number">3.15</span>...<span class="number">3.17</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>( CMAKE_PROJECT_INCLUDE_BEFORE</span><br><span class="line">     <span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/common-project-info.in&quot;</span> )</span><br><span class="line"><span class="comment"># include( &quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/common-project-include.in&quot; )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span> (MyRootProject</span><br><span class="line">    VERSION <span class="variable">$&#123;project_version&#125;</span></span><br><span class="line">    DESCRIPTION <span class="variable">$&#123;project_description&#125;</span></span><br><span class="line">    HOMEPAGE_URL <span class="variable">$&#123;project_homepage&#125;</span></span><br><span class="line">    LANGUAGES C CXX )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># common-project-info.in</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> ( project_version 1.2.3 )</span><br><span class="line"><span class="built_in">set</span> ( project_description <span class="string">&quot;test....&quot;</span> )</span><br><span class="line"><span class="built_in">set</span> ( project_homepage <span class="string">&quot;https://www....&quot;</span> )</span><br></pre></td></tr></table></figure>

<h2 id="find-package"><a href="#find-package" class="headerlink" title="find_package"></a><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/658727351">find_package</a></h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lidabo/p/16635310.html">path 问题</a></p>
</li>
<li><p><code>set(xxx_DIR $&#123;&#125;/lib/cmake)</code>需要指定 cmake 位置</p>
</li>
<li><p><code>find_package(xxx REQUIRED HINTS /usr/local/lib)</code></p>
</li>
<li><p><code>export CMAKE_PREFIX_PATH=/usr/lib/x86_64-linux-gnu:/usr/local/lib/x86_64-linux-gnu</code> or <code>set(CMAKE_FIND_ROOT_PATH /usr/lib/x86_64-linux-gnu /usr/local/lib/x86_64-linux-gnu)</code>设置查找路径</p>
</li>
<li><p>find_package 采用两种模式搜索库：The “better” way(Config 模式) to do things is to have an installed package provide its own details to CMake; <a target="_blank" rel="noopener" href="https://hsf-training.github.io/hsf-training-cmake-webpage/09-findingpackages/index.html#findpackage">link</a></p>
<ul>
<li><code>Module模式</code>：搜索 CMAKE_MODULE_PATH 指定路径下的 FindXXX.cmake 文件，执行该文件从而找到 XXX 库。其中，具体查找库并给 XXX_INCLUDE_DIRS 和 XXX_LIBRARIES 两个变量赋值的操作由 FindXXX.cmake 模块完成。</li>
<li><code>Config模式</code>：搜索 XXX_DIR 指定路径下的 XXXConfig.cmake 文件，执行该文件从而找到 XXX 库。其中具体查找库并给 XXX_INCLUDE_DIRS 和 XXX_LIBRARIES 两个变量赋值的操作由 XXXConfig.cmake 模块完成</li>
</ul>
</li>
<li><p>两种模式看起来似乎差不多，不过 cmake 默认采取 Module 模式，如果 Module 模式未找到库，才会采取 Config 模式。如果 XXX_DIR 路径下找不到 XXXConfig.cmake 文件，则会找&#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;XXX&#x2F;中的 XXXConfig.cmake 文件。总之，Config 模式是一个备选策略。通常，库安装时会拷贝一份 XXXConfig.cmake 到系统目录中，因此在没有显式指定搜索路径时也可以顺利找到。</p>
</li>
</ol>
<h2 id="find-path-and-include"><a href="#find-path-and-include" class="headerlink" title="find_path and include"></a>find_path and include</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find_path</span>(XRT_INCLUDE_DIRS</span><br><span class="line">    NAMES xrt<span class="selector-class">.h</span></span><br><span class="line">    PATH_SUFFIXES xrt</span><br><span class="line">    )</span><br><span class="line"><span class="function"><span class="title">message</span><span class="params">(<span class="string">&quot;config types: $&#123;XRT_INCLUDE_DIRS&#125;&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<h2 id="pkg-config"><a href="#pkg-config" class="headerlink" title="pkg-config"></a>pkg-config</h2><ol>
<li>如果 find_package 找不到库，如果系统中有库的.pc 配置文件，可以使用 pkg-config 替代。</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(glog QUIET)</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">NOT</span> glog_FOUND)</span><br><span class="line">    <span class="keyword">find_package</span>(PkgConfig)</span><br><span class="line">    pkg_search_module(PKG_GLOG REQUIRED IMPORTED_TARGET GLOBAL libglog)</span><br><span class="line">    <span class="keyword">add_library</span>(glog::glog ALIAS PkgConfig::PKG_GLOG)</span><br><span class="line"><span class="keyword">endif</span>(<span class="keyword">NOT</span> glog_found)</span><br></pre></td></tr></table></figure>

<h2 id="组件变量"><a href="#组件变量" class="headerlink" title="组件变量"></a>组件变量</h2><h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li>例子 1：最基础例子</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">cmake_minimum_required</span><span class="params">(VERSION <span class="number">3.8</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">project</span><span class="params">(QUICKSORT)</span></span></span><br><span class="line"><span class="function"><span class="title">aux_source_directory</span><span class="params">(. DIR_SRCS)</span></span></span><br><span class="line"><span class="function"><span class="title">add_definitions</span><span class="params">(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">set</span><span class="params">(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(quicksort $&#123;DIR_SRCS&#125;)</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>例子 2： 使用静态库并安装</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort DESTINATION lib)  <span class="comment">#安装静态库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort)</span><br><span class="line"></span><br><span class="line"><span class="comment">#install program</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS main RUNTIME DESTINATION bin)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 3 只使用动态库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add shared liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort SHARED</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="keyword">include</span>/quicksort.hpp DESTINATION <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 4 安装静态库和动态库</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="built_in">project</span>(QUICKSORT)</span><br><span class="line"><span class="selector-id">#aux_source_directory</span>( DIR_SRCS)</span><br><span class="line"><span class="selector-id">#add</span> shared liabrary</span><br><span class="line"><span class="built_in">add_library</span>(quicksort SHARED</span><br><span class="line">    include/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="selector-id">#add</span> static liabrary</span><br><span class="line"><span class="built_in">add_library</span>(quicksort_static STATIC</span><br><span class="line">    include/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="built_in">set_target_properties</span>(quicksort_static PROPERTIES OUTPUT_NAME &quot;quicksort&quot;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">SET_TARGET_PROPERTIES</span>(quicksort PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="built_in">SET_TARGET_PROPERTIES</span>(quicksort_static PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="built_in">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="built_in">install</span>(TARGETS quicksort_static ARCHIVE DESTINATION lib)</span><br><span class="line"><span class="built_in">install</span>(FILES include/quicksort.hpp DESTINATION include)</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#add</span> target</span><br><span class="line"><span class="built_in">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="built_in">add_definitions</span>(&quot;-DNDEBUG&quot; &quot;-O3&quot; &quot;-std=c++<span class="number">11</span>&quot;)</span><br><span class="line"><span class="selector-id">#set</span>(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++<span class="number">11</span>&quot;)</span><br><span class="line"><span class="built_in">add_executable</span>(main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#link</span> library</span><br><span class="line"><span class="built_in">include_directories</span>(include)</span><br><span class="line"><span class="built_in">target_link_libraries</span>(main quicksort)</span><br><span class="line"></span><br><span class="line"># 参考 https://www.cnblogs.com/zhoug2020/p/<span class="number">5904206</span>.html</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 5 添加 glog 库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add shared liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort SHARED</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="comment">#add static liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort_static STATIC</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">set_target_properties</span>(quicksort_static PROPERTIES OUTPUT_NAME <span class="string">&quot;quicksort&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(quicksort PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(quicksort_static PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="comment">#install(TARGETS quicksort_static ARCHIVE DESTINATION lib)</span></span><br><span class="line"><span class="keyword">install</span>(FILES <span class="keyword">include</span>/quicksort.hpp DESTINATION <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span> /home/jiaxiyang/workspace/glog/lib/<span class="keyword">include</span>) <span class="comment">#添加glog include目录</span></span><br><span class="line"><span class="keyword">link_directories</span>(/home/jiaxiyang/workspace/glog/lib/lib) <span class="comment">#添加glog库安装路径</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort glog)</span><br><span class="line"><span class="keyword">install</span>(TARGETS main RUNTIME DESTINATION bin)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 6 链接自己编译的库</li>
</ol>
<figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.8)</span><br><span class="line">project(QUICKSORT)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">SET_TARGET_PROPERTIES</span><span class="params">(<span class="variable">quicksort</span> <span class="variable">PROPERTIES</span> <span class="variable">CLEAN_DIRECT_OUTPUT</span> 1)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">SET_TARGET_PROPERTIES</span><span class="params">(<span class="variable">quicksort_static</span> <span class="variable">PROPERTIES</span> <span class="variable">CLEAN_DIRECT_OUTPUT</span> 1)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">TARGETS</span> <span class="variable">quicksort</span> <span class="variable">LIBRARY</span> <span class="variable">DESTINATION</span> <span class="variable">lib</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">TARGETS</span> <span class="variable">quicksort_static</span> <span class="variable">ARCHIVE</span> <span class="variable">DESTINATION</span> <span class="variable">lib</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">FILES</span> <span class="variable">include</span>/<span class="variable">quicksort</span>.<span class="variable">hpp</span> <span class="variable">DESTINATION</span> <span class="variable">include</span>)</span></span></span><br><span class="line"></span><br><span class="line">#add target</span><br><span class="line">set(SRC_LIST src/main.cpp)</span><br><span class="line">add_definitions(&quot;-DNDEBUG&quot; &quot;-O3&quot; &quot;-std=c++11&quot;)</span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">set</span><span class="params">(<span class="variable">CMAKE_CXX_FLAGS</span> <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;</span>)</span></span></span><br><span class="line">add_executable(main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line">#link library</span><br><span class="line">include_directories(/home/jiaxiyang/workspace/algorithm/quicksort1/include /home/jiaxiyang/workspace/glog/lib/include) #添加glog include目录</span><br><span class="line">link_directories(/home/jiaxiyang/workspace/glog/lib/lib) #添加glog库安装路径</span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">link_directories</span><span class="params">(/<span class="variable">home</span>/<span class="variable">jiaxiyang</span>/<span class="variable">workspace</span>/<span class="variable">algorithm</span>/<span class="variable">quicksort1</span>/<span class="variable">lib</span>)</span></span> #添加glog库安装路径   如果没有find_library，出现在add_executable后面会出错 建议用find_library</span><br><span class="line">find_library(LIBQUICKSORT_PATH quicksort ./lib)</span><br><span class="line">MESSAGE(STATUS $&#123;LIBQUICKSORT_PATH&#125; &quot; found&quot;)</span><br><span class="line"></span><br><span class="line">target_link_libraries(main $&#123;LIBQUICKSORT_PATH&#125; glog)</span><br><span class="line">install(TARGETS main RUNTIME DESTINATION bin)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://hsf-training.github.io/hsf-training-cmake-webpage/">More Modern CMake</a></li>
<li><a target="_blank" rel="noopener" href="https://bazel.build/reference?hl=zh-cn">参考文档: 构建百科全书， 测试百科全书，命令行参考文档，查询参考文档</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">Cmake Tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://discourse.cmake.org/">Cmake Forum</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jiaxiyang/documents/blob/master/pcmake.pdf">Professional CMake pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html">Cmake Buildsystem</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1">Effective Modern Cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">Effective Modern Cmake video</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=y9kSr5enrSk">Deniz Bahadir 2019</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=y7ndUhdQuU8">Deniz Bahadir 2018 traditional and modern camke</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Bagira80/More-Modern-CMake">Beniz Bahadir PPT</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/76975231">OO Cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://ukabuer.me/blog/more-modern-cmake">Cmake Concept</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/07/20/Cpp-concurrency-in-action/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/20/Cpp-concurrency-in-action/" class="post-title-link" itemprop="url">Cpp-concurrency-in-action</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-20 09:05:48" itemprop="dateCreated datePublished" datetime="2021-07-20T09:05:48+08:00">2021-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-11-24 20:49:26" itemprop="dateModified" datetime="2024-11-24T20:49:26+08:00">2024-11-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/07/20/Cpp-concurrency-in-action/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/07/20/Cpp-concurrency-in-action/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><ol>
<li><a target="_blank" rel="noopener" href="https://b-ok.lat/book/3688262/d57395?dsource=recommend&regionChanged=&redirect=4729105">C++ Concurrency in action 2</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xiaoweiChen/CPP-Concurrency-In-Action-2ed-2019">C++ Concurrency in action Chinese</a></li>
<li>多线程写共享数据时，需要加锁<code>const std::lock_guard&lt;std::mutex&gt; lock(results_len_mutex_);</code></li>
<li>异步程序并行度跟有几个耗时的模块相关，例如：yolox 推理和后处理最耗时，异步并行度设为 2，做当前帧的后处理同时做下一帧的模型推理。</li>
<li>异步需要考虑 timeout 问题， 可以使用 <code>condition_variable</code></li>
<li>. 流控：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="keyword">auto</span> time_start = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="type">const</span> <span class="keyword">auto</span> time_end = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="keyword">auto</span> cost_ms =</span><br><span class="line">    std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(time_end - time_start);</span><br><span class="line">std::this_thread::<span class="built_in">sleep_for</span>(</span><br><span class="line">    std::chrono::<span class="built_in">milliseconds</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">1000.0</span> / fps)) - cost_ms);</span><br></pre></td></tr></table></figure>

<h2 id="1-Hello-world-of-concurrency-in-C"><a href="#1-Hello-world-of-concurrency-in-C" class="headerlink" title="1. Hello, world of concurrency in C++"></a>1. Hello, world of concurrency in C++</h2><h3 id="1-1-并发是什么"><a href="#1-1-并发是什么" class="headerlink" title="1.1 并发是什么"></a>1.1 并发是什么</h3><ol>
<li>多进程并发优点： 操作系统在进程间提供的保护操作和更高级别的通信机制，可以更容易编写安全的并发代码。还有一个优势，可以使用远程连接的方式，在不同的机器上运行独立的进程。</li>
</ol>
<h3 id="1-2-为什么使用并发"><a href="#1-2-为什么使用并发" class="headerlink" title="1.2 为什么使用并发"></a>1.2 为什么使用并发</h3><ol>
<li><code>分离程序</code>： 将相互独立的部分分开就行操作。如 DVD 用户界面和播放功能应分离。</li>
<li><code>性能</code>：两种方式：任务并行（将单一任务分成几部分并行）和数据并行（每个线程在不同的数据块上执行相同的操作）</li>
</ol>
<h4 id="1-2-1-什么时候不使用并发"><a href="#1-2-1-什么时候不使用并发" class="headerlink" title="1.2.1 什么时候不使用并发"></a>1.2.1 什么时候不使用并发</h4><ol>
<li>收益比不上成本，除非潜在性能足够大，否则不使用并发，需要脑力成本和维护成本，代码更复杂，难以理解。</li>
<li>资源有限： 太多线程的会耗尽资源。可以使用线程池进行优化。太多的线程上下文切换导致的性能损耗可能比增加线程的收益更多。</li>
</ol>
<h3 id="1-3-并发和多线程"><a href="#1-3-并发和多线程" class="headerlink" title="1.3 并发和多线程"></a>1.3 并发和多线程</h3><h4 id="1-3-1-C-多线程历史"><a href="#1-3-1-C-多线程历史" class="headerlink" title="1.3.1 C++多线程历史"></a>1.3.1 C++多线程历史</h4><ol>
<li>C++98 标准不支持多线程，没有内存模型。</li>
<li>各种非标准多线程库：MFC，Boost，大部分使用的是 RAII</li>
</ol>
<h4 id="1-3-2-支持并发"><a href="#1-3-2-支持并发" class="headerlink" title="1.3.2 支持并发"></a>1.3.2 支持并发</h4><ol>
<li>C++11: <code>线程管理，共享数据保护，线程间同步操作，原子操作</code></li>
<li>C++11 之后，C++标准支持多线程，也就是说可以跨平台编写高效，可移植的代码。编译器可以搞定具体平台，用户无需担心。</li>
</ol>
<h4 id="1-3-4-C-线程库的效率"><a href="#1-3-4-C-线程库的效率" class="headerlink" title="1.3.4 C++线程库的效率"></a>1.3.4 C++线程库的效率</h4><ol>
<li>高级工具（使用高级 API, 抽象高）和低级工具（使用低级 API，抽象低)有开销差，即抽象代价（abstraction penalty)。C++标准库设计时尽量使得高级 API 和低级 API 具有相同的性能。</li>
<li>低级工具：为了达到终极性能，需要提供给硬件打交道的低级 API。为了这个目的，形成了原子操作库。</li>
<li>高级工具：为了使得编写多线程代码更简单。因为有额外的代码需要执行，这些工具会带来性能开销。</li>
<li>如果很看重性能或者高级工具开销过高，可以通过低层工具来实现。绝大多数情况，有过高的复杂度和过大的出错率，来交换小幅度的性能收益是不划算的。</li>
</ol>
<h2 id="2-Managing-threads"><a href="#2-Managing-threads" class="headerlink" title="2. Managing threads"></a>2. Managing threads</h2><ol>
<li>文件锁用在进程之间，线程之间锁不住，文件锁是应用于进程中的一种锁，由于多线程是通过修改文件描述符指向的文件结构体中的成员变量实现，所以文件锁不能用于线程之间。 见<a target="_blank" rel="noopener" href="https://docs.rs/fslock/0.1.6/fslock/struct.LockFile.html">fslock</a></li>
</ol>
<h3 id="2-5-线程标识"><a href="#2-5-线程标识" class="headerlink" title="2.5 线程标识"></a>2.5 线程标识</h3><ol>
<li><code>std::this_thread::get_id()</code>获取当前线程的 ID.</li>
</ol>
<h2 id="3-Sharing-data-between-threads"><a href="#3-Sharing-data-between-threads" class="headerlink" title="3. Sharing data between threads"></a>3. Sharing data between threads</h2><ol>
<li>错误的数据共享是多线程产生 bug 的主要原因。</li>
<li><code>data race</code>: the specific type of race condition that arises because of concurrent modification to a single object</li>
<li>数据竞争时间敏感，Bug 可能很难复现，很难查找。</li>
</ol>
<h3 id="3-2-使用互斥量"><a href="#3-2-使用互斥量" class="headerlink" title="3.2 使用互斥量"></a>3.2 使用互斥量</h3><ol>
<li>访问共享数据前将数据锁住，访问结束将数据解锁。</li>
<li>互斥量是 C++保护数据最通用的机制。</li>
<li>互斥量问题： 死锁，对数据保护太多。</li>
<li>一个互斥量只能用于一个资源的互斥访问。</li>
<li>互斥量(互斥锁)本质上是一把锁。</li>
</ol>
<h4 id="3-2-1-互斥量"><a href="#3-2-1-互斥量" class="headerlink" title="3.2.1 互斥量"></a>3.2.1 互斥量</h4><ol>
<li><code>std::mutex</code>创建互斥量，<code>lock</code>对互斥量上锁，unlock 为解锁。</li>
<li>RAII 管理互斥量：C++标准库为互斥量提供了 RAII 模板类<code>std::lock_guard</code>，在构造时提供已锁的互斥量（lock_guard 对象在构造时对传进来的 mutex 上锁），并在析构时解锁，从而保证互斥量被正确的解锁。</li>
<li>大多数情况下，互斥量通常会与需要保护的数据放在同一类中，而不是定义成全局变量。</li>
<li>C++17 提供<code>std::scoped_lock</code>加强版的<code>std::lock_guard</code>, 可以接受多个参数。</li>
</ol>
<h4 id="3-2-4-死锁"><a href="#3-2-4-死锁" class="headerlink" title="3.2.4 死锁"></a>3.2.4 死锁</h4><ol>
<li>死锁一般解决方法：按顺序上锁。要么将两个都锁住，要么一个都不锁。</li>
<li><code>std::lock</code>能同时锁住多个互斥量。</li>
<li>C++17 中的<code>std::scoped_lock&lt;&gt;</code>是一种新的 RAII 模板类型。能接受不定数量的互斥量类型作为模板参数。在构造 scoped_lock 对象时对传入的 mutex 上锁，析构时解锁。</li>
<li><code>std::lock</code>锁上 mutex 之后不负责释放，还需要配合 lock_guard 或者手动释放 mutex。<code>std::scoped_lock</code>生命周期结束后会自动释放锁。</li>
<li>C++17 特性：<code>自动推导模板参数</code>。可以简写为<code>std::scoped_lock lk(m1, m2);</code> 而不用写为<code>std::scoped_lock&lt;std::mutex, std::mutex&gt; lk(m1, m2);</code></li>
</ol>
<h3 id="atomic"><a href="#atomic" class="headerlink" title="atomic"></a>atomic</h3><ol>
<li>从效率上来说，原子操作要比互斥量的方式效率要高。</li>
<li>互斥量的加锁一般是针对一个代码段，而原子操作针对的一般都是一个变量。</li>
<li>store 和 load 来赋值和读取， 除了初始化不要使用赋值</li>
<li><a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/cpp/atomic/atomic/is_lock_free">atomic 不一定免锁</a></li>
<li>对结构体需要链接 <code>-latomic</code></li>
<li><code>-fsanitize=thread</code>可以检测数据竞争</li>
</ol>
<h2 id="4-Synchronizing-concurrent-operations-on-atomic-types"><a href="#4-Synchronizing-concurrent-operations-on-atomic-types" class="headerlink" title="4. Synchronizing concurrent operations on atomic types"></a>4. Synchronizing concurrent operations on atomic types</h2><h3 id="4-1-等待时间或条件"><a href="#4-1-等待时间或条件" class="headerlink" title="4.1 等待时间或条件"></a>4.1 等待时间或条件</h3><ol>
<li>当一个线程等待另一个线程完成时，有几种选择：<ul>
<li>持续检查共享数据标志，浪费资源查询</li>
<li>在等待线程时，使用<code>std::this_thread::sleep_for()</code>进行周期性间歇，节省执行时间，问题：很难确定休眠时间</li>
<li>通过标准库提供的工具。例如：<code>condition variable</code></li>
</ul>
</li>
</ol>
<h4 id="condition-variable"><a href="#condition-variable" class="headerlink" title="condition_variable"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/wxj1992/article/details/116888582">condition_variable</a></h4><ol>
<li>condition<em>variable 是一个类，搭配互斥量 mutex 来用，这个类有它自己的一些函数，这里就主要讲 wait 函数和 notify</em>*函数，故名思意，wait 就是有一个等待的作用，notify 就是有一个通知的作用。主要用法这里就不再赘述了，简而言之就是程序运行到 wait 函数的时候会先在此阻塞，然后自动 unlock，那么其他线程在拿到锁以后就会往下运行，当运行到 notify_one()函数的时候，就会唤醒 wait 函数，然后自动 lock 并继续下运行。</li>
<li>wait 线程：当 condition 不满足的时候需要等待，直到条件满足了才做自己的事情。</li>
<li>notify 线程：做完自己的事情后修改 condition 变量并唤醒等待线程。</li>
<li>wait 时未持有锁，wait 之后占有锁</li>
<li>wait 会先判断条件，如果满足，直接返回。</li>
<li>wait_for() 解阻塞时获得 lock， 无论是 notify_all() 或 notify_one() 还是超时都会解阻塞。</li>
<li><code>wait_for() 若经过 rel_time 时限后谓词 pred 仍求值为 false 则为 false ，否则为 true</code> 中途被通知后 pred 为 true 则直接返回 true，如果为 false，继续等待。</li>
<li>先获得锁，再检测条件？</li>
<li>解锁之后再 notify， 否则可能出现当前线程还未释放锁，被接收的线程被唤醒后拿不到锁立即就又休眠。</li>
</ol>
<h3 id="4-2-future"><a href="#4-2-future" class="headerlink" title="4.2 future"></a>4.2 future</h3><ol>
<li>async（sender)函数是一种 promise,负责发送数据， future（receiver)负责接收数据。<code>future fut = async([]&#123;return 3+4;&#125;); cout &lt;&lt; fut.get() &lt;&lt; endl;</code></li>
</ol>
<h2 id="5-The-C-memory-model-and-operations-on-atomic-types"><a href="#5-The-C-memory-model-and-operations-on-atomic-types" class="headerlink" title="5. The C++ memory model and operations on atomic types"></a>5. The C++ memory model and operations on atomic types</h2><h3 id="5-1-内存模型"><a href="#5-1-内存模型" class="headerlink" title="5.1 内存模型"></a>5.1 内存模型</h3><h4 id="5-1-1-对象和内存模型"><a href="#5-1-1-对象和内存模型" class="headerlink" title="5.1.1 对象和内存模型"></a>5.1.1 对象和内存模型</h4><ol>
<li>C++程序中数据都是由对象构成。</li>
<li>每个变量都是对象</li>
<li>每个对象至少占有一个内存位置。</li>
</ol>
<h4 id="5-1-2-对象，内存位置和并发"><a href="#5-1-2-对象，内存位置和并发" class="headerlink" title="5.1.2 对象，内存位置和并发"></a>5.1.2 对象，内存位置和并发</h4><ol>
<li>当多个线程访问同一内存位置时，如果只读数据，不需要保护，如果有线程对数据进行修改，就可能会产生条件竞争。</li>
<li>为了避免条件竞争，两个线程就要以一定的<code>顺序执行</code>。有两种方式：<code>互斥量</code>和<code>原子操作</code></li>
</ol>
<h3 id="5-2-原子操作和原子类型"><a href="#5-2-原子操作和原子类型" class="headerlink" title="5.2 原子操作和原子类型"></a>5.2 原子操作和原子类型</h3><ol>
<li><code>原子操作</code>是不可分割的操作。系统的所有线程中，不可能观察到原子操作完成了一半，要么是做了，要么是没做，只有两种可能。非原子操作可能会被另一线程观察到只完成一半，如果是一个存储操作，那么其他线程看到的值，可能既不是存储前的值，也不是存储后的值。</li>
<li>原子操作是一种操作（函数），互斥量（一种锁）是实现这种操作的一种方式。</li>
</ol>
<h4 id="5-2-1-标准的原子类型"><a href="#5-2-1-标准的原子类型" class="headerlink" title="5.2.1 标准的原子类型"></a>5.2.1 标准的原子类型</h4><ol>
<li>标准的原子类型定义在头文件<code>&lt;atomic&gt;</code>中，这些类型操作都是原子的。</li>
<li>可以使用互斥量来模拟原子操作。</li>
<li>原子操作可以替代互斥量来完成同步操作。如果操作内部使用互斥量实现，那么不可能有性能提升，可以使用无锁数据结构来实现。</li>
<li>通常标准的原子类型是不能进行拷贝和赋值的，他们没有拷贝构造函数和拷贝赋值函数。但是可以隐式的转化为内置类型进行赋值。</li>
</ol>
<h2 id="6-Designing-lock-based-concurrent-data-structures"><a href="#6-Designing-lock-based-concurrent-data-structures" class="headerlink" title="6. Designing lock-based concurrent data structures."></a>6. Designing lock-based concurrent data structures.</h2><h2 id="7-Designing-lock-free-concurrent-data-structures"><a href="#7-Designing-lock-free-concurrent-data-structures" class="headerlink" title="7. Designing lock-free concurrent data structures"></a>7. Designing lock-free concurrent data structures</h2><h2 id="8-Designing-concurrent-code"><a href="#8-Designing-concurrent-code" class="headerlink" title="8. Designing concurrent code"></a>8. Designing concurrent code</h2><h2 id="9-Advanced-thread-managment"><a href="#9-Advanced-thread-managment" class="headerlink" title="9. Advanced thread managment"></a>9. Advanced thread managment</h2><h2 id="10-Parallel-algorithms"><a href="#10-Parallel-algorithms" class="headerlink" title="10. Parallel algorithms"></a>10. Parallel algorithms</h2><h2 id="11-Testing-and-debugging-multithreaded-applications"><a href="#11-Testing-and-debugging-multithreaded-applications" class="headerlink" title="11. Testing and debugging multithreaded applications"></a>11. Testing and debugging multithreaded applications</h2><h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><h3 id="什么是临界区"><a href="#什么是临界区" class="headerlink" title="什么是临界区"></a>什么是临界区</h3><ol>
<li>临界区(critical section)是指包含有共享资源的一段代码，这些代码可能被多个线程访问 或修改。 临界区的存在就是为了保证当有一个线程在临界区内执行的时候，不能有其他任何 线程被允许在临界区执行。</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/06/27/Elisp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/27/Elisp/" class="post-title-link" itemprop="url">Elisp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-27 22:37:13" itemprop="dateCreated datePublished" datetime="2021-06-27T22:37:13+08:00">2021-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-12 19:22:48" itemprop="dateModified" datetime="2023-10-12T19:22:48+08:00">2023-10-12</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/27/Elisp/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/27/Elisp/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Useful-Command"><a href="#Useful-Command" class="headerlink" title="Useful Command"></a>Useful Command</h2><ol>
<li>C-u before command to insert the result into the current buffer.</li>
<li>crux-eval-and-replace 将表达式替换为结果， 例如(+ 1 1) -&gt; 2</li>
<li>创建新 buffer: switch-to-buffer</li>
<li>需要到命令行工作时，不用关闭 emacs, 使用 suspend-frame(C-z) 回到命令行，使用 fg 命令返回 emacs</li>
</ol>
<h2 id="grammer"><a href="#grammer" class="headerlink" title="grammer"></a>grammer</h2><ol>
<li>(car list) first element</li>
<li>(nth n list) nth element</li>
<li>(car (last list)) last element</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(car (list &quot;a&quot; &quot;b&quot; &quot;c&quot;) )   ; &quot;a&quot;</span><br><span class="line">(nth 1 (list &quot;a&quot; &quot;b&quot; &quot;c&quot;) ) ; &quot;b&quot;</span><br><span class="line">(car (last (list &quot;a&quot; &quot;b&quot; &quot;c&quot;)) )   ; &quot;c&quot;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>(setq temp (append temp (list 1)))</code> addpend to list temp</li>
<li>loop list</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(dolist (element (extract-rectangle start end)) ;; extract-rectangle to lists</span><br><span class="line">  (setq LIST (append LIST (split-string element)))) ;; apend to list</span><br></pre></td></tr></table></figure>

<h2 id="functions"><a href="#functions" class="headerlink" title="functions"></a>functions</h2><ol>
<li><code>(message &quot;%s=%d&quot; &quot;test&quot; 1)</code> minibuf 打印</li>
<li><code> (split-string &quot;1 2 3 4&quot;)</code> &#x3D;&gt; (“1” “2” “3” “4”)</li>
<li><code> (seq-map &#39;string-to-number (split-string &quot;1 2 3 4&quot;))</code> &#x3D;&gt; (1 2 3 4)</li>
<li><code>(vconcat [] (split-string &quot;1.2.3&quot; &quot;\\.&quot;))</code> &#x3D;&gt; [“1” “2” “3”]</li>
<li>max, min, sum and mean</li>
<li><code>(extract-rectangle start end)</code> extract-rectangle to lists</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(defun count-of-nums (xs)</span><br><span class="line">  (length xs))</span><br><span class="line"></span><br><span class="line">(defun min-of-nums (xs)</span><br><span class="line">  (apply #&#x27;min xs))</span><br><span class="line"></span><br><span class="line">(defun max-of-nums (xs)</span><br><span class="line">  (apply #&#x27;max xs))</span><br><span class="line"></span><br><span class="line">(defun sum-of-nums (xs)</span><br><span class="line">  (apply #&#x27;+ xs))</span><br><span class="line"></span><br><span class="line">(defun mean-of-nums (xs)</span><br><span class="line">  (float (/ (float (sum-of-nums xs))</span><br><span class="line">            (count-of-nums xs))))</span><br></pre></td></tr></table></figure>

<ol>
<li>对 region 进行统计，注意不能是 rectangle <a href="link">http://sugano-nu.github.io/emacs-lisp-stat-attitude/</a></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(defun statistics-in-region (start end)</span><br><span class="line">  (interactive &quot;r&quot;)</span><br><span class="line">  (setq LIST (split-string (buffer-substring start end)))</span><br><span class="line">  (setq LIST (mapcar* #&#x27;(lambda (X) (math-read-number X)) LIST))</span><br><span class="line">  (message &quot;length:%s, mean:%s, variance:%s, standard deviation:%s, meidan:%s, max:%s, min:%s&quot;</span><br><span class="line">           (length LIST)</span><br><span class="line">           (math-format-number (calcFunc-vmean (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vvar (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vsdev (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmedian (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmax (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmin (cons &#x27;vec LIST)))))</span><br><span class="line"></span><br><span class="line">;; not chose a string with character, it will be as 0</span><br><span class="line">(defun statistics-in-rectangle (start end)</span><br><span class="line">  &quot;statistics-in-rectangle.&quot;</span><br><span class="line">  (interactive &quot;r&quot;)</span><br><span class="line">  (setq LIST nil)</span><br><span class="line">  (dolist (element (extract-rectangle start end)) ;; extract-rectangle to lists</span><br><span class="line">    (setq LIST (append LIST (split-string element)))) ;; apend to list</span><br><span class="line">  ;; (setq LIST (seq-map &#x27;string-to-number LIST)) ;;  convert to num</span><br><span class="line">  (setq LIST (mapcar* #&#x27;(lambda (X) (math-read-number X)) LIST))</span><br><span class="line">  (message &quot;length:%s, mean:%s, variance:%s, standard deviation:%s, meidan:%s, max:%s, min:%s&quot;</span><br><span class="line">           (length LIST)</span><br><span class="line">           (math-format-number (calcFunc-vmean (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vvar (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vsdev (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmedian (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmax (cons &#x27;vec LIST)))</span><br><span class="line">           (math-format-number (calcFunc-vmin (cons &#x27;vec LIST)))))</span><br></pre></td></tr></table></figure>

<ol>
<li>toggle function: cycle status</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">;; http://xahlee.info/emacs/emacs/elisp_toggle_command.html</span><br><span class="line">(defun company-toggle-delay (@n)</span><br><span class="line">  &quot;Company toggle idle delay.&quot;</span><br><span class="line">  (interactive &quot;p&quot;)</span><br><span class="line">  (let* (</span><br><span class="line">         ($values [0.2 nil])</span><br><span class="line">         ($index-before</span><br><span class="line">          (if (get &#x27;company-toggle-delay &#x27;state)</span><br><span class="line">              (get &#x27;company-toggle-delay &#x27;state)</span><br><span class="line">            0))</span><br><span class="line">         ($index-after (% (+ $index-before (length $values) @n) (length $values)))</span><br><span class="line">         ($next-value (aref $values $index-after)))</span><br><span class="line"></span><br><span class="line">    (put &#x27;company-toggle-delay &#x27;state $index-after)</span><br><span class="line">    (setq company-idle-delay  $next-value)</span><br><span class="line">    (message &quot;company idle delay to %s&quot; $next-value)))</span><br></pre></td></tr></table></figure>

<ol>
<li>if mode then</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(if (derived-mode-p &#x27;c++-mode)</span><br><span class="line">    (message &quot;The mode is on&quot;)</span><br><span class="line">    (message &quot;The mode is off&quot;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>yes or no</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(if (yes-or-no-p &quot;Do you really want to remove everything?&quot;)</span><br><span class="line">    (message &quot;yes&quot;)</span><br><span class="line">    (message &quot;no&quot;))</span><br></pre></td></tr></table></figure>

<ol>
<li>auto add, commit and push</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(defun aborn/simple-git-commit-push ()</span><br><span class="line">  &quot;Simple commit current git project and push to its upstream.&quot;</span><br><span class="line">  ;; (interactive &quot;sCommit Message: &quot;)</span><br><span class="line">  (interactive)</span><br><span class="line">  (when (and buffer-file-name</span><br><span class="line">             (buffer-modified-p))</span><br><span class="line">    (save-buffer))                   ;; save it first if modified.</span><br><span class="line">  (magit-diff-unstaged)</span><br><span class="line">  (when (yes-or-no-p &quot;Do you really want to commit everything?&quot;)</span><br><span class="line">    (magit-stage-modified)</span><br><span class="line">    ;; (magit-mode-bury-buffer)</span><br><span class="line">    (magit-diff-staged)</span><br><span class="line">    (setq msg (read-string &quot;Commit Message: &quot;))</span><br><span class="line">    (when (= 0 (length msg))</span><br><span class="line">      (setq msg (format-time-string &quot;commit by magit in emacs@%Y-%m-%d %H:%M:%S&quot;</span><br><span class="line">                                    (current-time))))</span><br><span class="line">    (message &quot;commit message is %s&quot; msg)</span><br><span class="line">    ;;(magit-commit (list &quot;-m&quot; msg))</span><br><span class="line">    (magit-call-git &quot;commit&quot; &quot;-m&quot; msg)</span><br><span class="line">    (magit-push-current-to-upstream nil)</span><br><span class="line">    (message &quot;now do async push to %s&quot; (magit-get &quot;remote&quot; &quot;origin&quot; &quot;url&quot;)))</span><br><span class="line">  (magit-mode-bury-buffer))</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a target="_blank" rel="noopener" href="http://ergoemacs.org/emacs/elisp_basics.html">Xah 教程</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ksco/BuildYourOwnLispCn">BuildYourOwnLispCn</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/06/22/Haskell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/22/Haskell/" class="post-title-link" itemprop="url">Haskell</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-22 10:47:46" itemprop="dateCreated datePublished" datetime="2021-06-22T10:47:46+08:00">2021-06-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/06/22/Haskell/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/06/22/Haskell/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Higher-Order-Functions"><a href="#Higher-Order-Functions" class="headerlink" title="Higher Order Functions"></a>Higher Order Functions</h2><ol>
<li>Haskell functions can take functions as parameters and return functions as return values. A function that does either of those is called a higher order function.</li>
<li>Every function in Haskell officially only takes one parameter.</li>
<li><code>map</code> takes a function and a list and applies that function to every element in the list, producing a new list.</li>
<li><code>filter</code> is a function that takes a predicate (a predicate is a function that tells whether something is true or not, so in our case, a function that returns a boolean value) and a list and then returns the list of elements that satisfy the predicate.</li>
<li><code>folds</code> They’re sort of like the map function, only they reduce the list to some <code>single value</code>.<br>1.<a target="_blank" rel="noopener" href="https://excalidraw.com/#json=5033777575231488,ixM2dP13DMyzxCvIDEpzqg">map, filter, fold 示意图</a></li>
<li>map是一种抽象，屏蔽了对list操作的具体实现，不用关心是迭代或是递归实现的，只能感受到list每个元素都经过了转化，不用考虑控制结构，只需要考虑策略。(link: SICP)</li>
</ol>
<h2 id="Functors-Applicatives-And-Monads"><a href="#Functors-Applicatives-And-Monads" class="headerlink" title="Functors, Applicatives And Monads"></a>Functors, Applicatives And Monads</h2><ol>
<li>defination</li>
</ol>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Functor f <span class="keyword">where</span></span><br><span class="line">    <span class="function"><span class="title">fmap</span> :: (a -&gt;</span> <span class="function"><span class="title">b</span>) -&gt;</span> <span class="function"><span class="title">f</span> a -&gt;</span> f b</span><br><span class="line"></span><br><span class="line">class (Functor f) =&gt; Applicative f <span class="keyword">where</span></span><br><span class="line">    <span class="function"><span class="title">pure</span> :: a -&gt;</span> f a</span><br><span class="line">    (&lt;*&gt;) :: <span class="function"><span class="title">f</span> (a -&gt;</span> <span class="function"><span class="title">b</span>) -&gt;</span> <span class="function"><span class="title">f</span> a -&gt;</span> f b</span><br><span class="line"></span><br><span class="line">class (Applicative m) =&gt; Monad m <span class="keyword">where</span></span><br><span class="line">    <span class="function"><span class="title">return</span> :: a -&gt;</span> m a</span><br><span class="line">    (&gt;&gt;=) :: <span class="function"><span class="title">m</span> a -&gt;</span> (<span class="function"><span class="title">a</span> -&gt;</span> <span class="function"><span class="title">m</span> b) -&gt;</span> m b</span><br><span class="line">    (&gt;&gt;) :: <span class="function"><span class="title">m</span> a -&gt;</span> <span class="function"><span class="title">m</span> b -&gt;</span> m b</span><br><span class="line">    <span class="function"><span class="title">x</span> &gt;&gt; y = x &gt;&gt;= \_ -&gt;</span> y</span><br><span class="line">    <span class="function"><span class="title">fail</span> :: String -&gt;</span> m a</span><br><span class="line">    fail msg = error msg</span><br><span class="line"></span><br><span class="line">class Monoid m <span class="keyword">where</span>  -- 注意是Monoid不是Monad</span><br><span class="line">    mempty :: m</span><br><span class="line">    <span class="function"><span class="title">mappend</span> :: m -&gt;</span> <span class="function"><span class="title">m</span> -&gt;</span> m</span><br><span class="line">    <span class="function"><span class="title">mconcat</span> :: [m] -&gt;</span> m</span><br><span class="line">    mconcat = foldr mappend mempty</span><br></pre></td></tr></table></figure>
<ol>
<li>type of fmap, (&lt;*&gt;) and (&gt;&gt;&#x3D;)</li>
</ol>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fmap :: <span class="function"><span class="params">(Functor f)</span> =&gt; <span class="params">(a -&gt; b)</span> -&gt;</span> f a -&gt; f b           -- 先解f a封装到a, a -&gt; b, b再封装到f b; 操作<span class="number">2</span>次封装</span><br><span class="line"><span class="function"><span class="params">(&lt;*&gt;)</span> :: <span class="params">(Applicative f)</span> =&gt; <span class="title">f</span> <span class="params">(a -&gt; b)</span> -&gt;</span> f a -&gt; f b    -- 先解f a封装到a, 解f(a -&gt; b)封装， a -&gt; b, b再封装到f b; 操作<span class="number">3</span>次封装</span><br><span class="line"><span class="function"><span class="params">(&gt;&gt;=)</span> :: <span class="params">(Monad m)</span> =&gt; <span class="title">m</span> <span class="title">a</span> -&gt;</span> <span class="function"><span class="params">(a -&gt; m b)</span> -&gt;</span> m b          -- 先解m a封装到a, a -&gt; mb; 操作<span class="number">1</span>次封装</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Functor, Applicative and Monad都是封装，可以封装原始类型。</li>
<li>&lt;$&gt; 是 fmap 的中缀表达式版本</li>
<li>functors: you apply a function to a wrapped value using fmap or &lt;$&gt;</li>
<li>applicatives: you apply a wrapped function to a wrapped value using &lt;*&gt; or liftA</li>
<li>monads: you apply a function that returns a wrapped value, to a wrapped value using &gt;&gt;&#x3D; or liftM</li>
<li>conclusion</li>
</ol>
<ul>
<li>A functor is a data type that implements the Functor typeclass.</li>
<li>An applicative is a data type that implements the Applicative typeclass.</li>
<li>A monad is a data type that implements the Monad typeclass.</li>
<li>A Maybe implements all three, so it is a functor, an applicative, and a monad.</li>
</ul>
<ol start="9">
<li>区别</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a target="_blank" rel="noopener" href="http://learnyouahaskell.com/chapters">Learn you haskell book</a></li>
<li><a target="_blank" rel="noopener" href="https://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Functors, Applicatives, And Monads In Pictures</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/05/21/Chrome-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/21/Chrome-config/" class="post-title-link" itemprop="url">Chrome shortcuts</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-21 15:56:05" itemprop="dateCreated datePublished" datetime="2021-05-21T15:56:05+08:00">2021-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-20 14:22:10" itemprop="dateModified" datetime="2025-03-20T14:22:10+08:00">2025-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/Chrome/" itemprop="url" rel="index"><span itemprop="name">Chrome</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/21/Chrome-config/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/21/Chrome-config/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li>对视频右键两次，选择画中画模式，方便记笔记</li>
<li><a target="_blank" rel="noopener" href="https://lazy-guy.github.io/tomodoro/index.html">番茄时钟画中画</a></li>
<li>选择右击<code>复制指向突出显示的内容的链接</code></li>
</ol>
<h2 id="shortcuts"><a href="#shortcuts" class="headerlink" title="shortcuts"></a><a target="_blank" rel="noopener" href="https://support.google.com/chrome/answer/157179?hl=zh-Hans&co=GENIE.Platform=Desktop">shortcuts</a></h2><ol>
<li><code>C-l</code>或<code>M-d</code>: 地址栏</li>
<li><code>M-Enter</code>: open another tab when search: it’s very usefull</li>
<li><code>C-k</code> 或 <code>C-e</code>: 搜索</li>
<li><code>Tab</code>: 下一个可点击项</li>
<li><code>M-left</code>: 后退浏览历史</li>
<li><code>M-right</code>: 前进浏览历史</li>
<li><code>C-r</code>: 刷新网页</li>
<li><code>Space</code>: pgDn</li>
<li><code>S-Space</code>: pgUp</li>
<li><code>C-t</code>: 新标签</li>
<li><code>C-n</code>: 新窗口</li>
<li><code>C-w</code>: 关闭当前标签</li>
<li><code>C-Tab</code>: 切换标签</li>
<li><code>C-S-t</code>: 恢复关闭的标签</li>
<li><code>C-h</code>: history</li>
<li><code>C-j</code>: download</li>
<li><code>C-1</code>: 跳转到第一个标签</li>
<li><code>C-9</code>: 跳转到第一个标签</li>
<li><code>C-Backspace</code>: 删除一个单词</li>
<li><code>S-Esc</code>: 任务管理器</li>
<li><code>C-S-b</code>: 显示或隐藏书签栏</li>
<li><code>C-f</code> + <code>C-g</code>: 查找与跳转</li>
</ol>
<h2 id="自定义-shortcuts"><a href="#自定义-shortcuts" class="headerlink" title="自定义 shortcuts"></a><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/shortkeys-custom-keyboard/logpjaacgmcbpdkdchjiaagddngobkck?hl=zh-CN">自定义 shortcuts</a></h2><ol>
<li><code>M-h</code>：Select previous tab</li>
<li><code>M-l</code>：Select next tab</li>
<li><code>M-k</code>：Select last tab</li>
<li><code>M-b</code>: 后退浏览历史</li>
<li><code>M-f</code>: 前进浏览历史</li>
<li><code>M-s</code>: fullscreen</li>
<li><code>M-3</code>：new tab</li>
<li><code>M-8</code>：close tab</li>
<li><code>M-w</code>：Duplicate current tab</li>
</ol>
<h2 id="vimium-快捷键"><a href="#vimium-快捷键" class="headerlink" title="vimium 快捷键"></a><a target="_blank" rel="noopener" href="https://vimium.github.io/">vimium 快捷键</a></h2><ol>
<li><code>yy</code>: copy URL to clipboard</li>
<li><code>/</code>: find</li>
<li><code>j</code>: Scroll down</li>
<li><code>k</code>: Scroll up</li>
<li><code>h</code>: Scroll left</li>
<li><code>l</code>: Scroll right</li>
<li><code>gg</code>: Scroll to the top of the page</li>
<li><code>G</code>: Scroll to the bottom of the page</li>
</ol>
<h2 id="搜索设置"><a href="#搜索设置" class="headerlink" title="搜索设置"></a>搜索设置</h2><ol>
<li>chrome 快捷搜索设置</li>
</ol>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gitlab l https:<span class="regexp">//gi</span>tlab.phigent.io/?sort=name_asc&amp;name=%s&amp;sort=name_asc</span><br><span class="line">github g https:<span class="regexp">//gi</span>thub.com/search?q=%s</span><br><span class="line">cppreference cpp https:<span class="regexp">//</span>duckduckgo.com/?sites=cppreference.com&amp;q=%s&amp;ia=web</span><br><span class="line">translate t https:<span class="regexp">//</span>translate.google.cn/?source=osdd&amp;who=test&amp;sl=en&amp;tl=zh-CN&amp;text=%s&amp;op=translate</span><br><span class="line">blog blog https:<span class="regexp">//gi</span>thub.com<span class="regexp">/jiaxiyang/</span>blog<span class="regexp">/tree/m</span>aster<span class="regexp">/source/</span>_posts</span><br><span class="line">links links https:<span class="regexp">//</span>jiaxiyang.github.io<span class="regexp">/2020/</span><span class="number">06</span><span class="regexp">/29/</span>Links/</span><br><span class="line"><span class="number">100</span>ms <span class="number">100</span>ms https:<span class="regexp">//gi</span>thub.com<span class="regexp">/jiaxiyang/</span><span class="number">100</span>ms_dot_emacs<span class="regexp">/blob/m</span>aster/init.el</span><br><span class="line">lead lead https:<span class="regexp">//gi</span>thub.com<span class="regexp">/jiaxiyang/</span>leader-key-mode<span class="regexp">/blob/m</span>aster/leader-key-mode.el</span><br><span class="line">melpa m https:<span class="regexp">//m</span>elpa.org<span class="regexp">/#/</span>?q=test&amp;sort=downloads&amp;asc=false</span><br><span class="line">excalidraw e https:<span class="regexp">//</span>excalidraw.com/</span><br><span class="line">baidu b https:<span class="regexp">//</span>www.baidu.com/<span class="comment">#ie=&#123;inputEncoding&#125;&amp;wd=%s</span></span><br></pre></td></tr></table></figure>

<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ol>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/onetab/chphlpgkkbolifaimnlloiipkdnihall">onetab 节省内存</a> 快捷键<code>alt+shift+1</code> 改为 <code>alt+1</code>。 <code>alt+2</code>发送当前标签页至 OneTab</li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/adblocker-ultimate/ohahllgiabjaoigichmmfljhkcfikeof/related?hl=zh-CN">广告屏蔽</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/sourcegraph/dgjhfomjieaadpoljlnidmbgkdffpack">sourcegraph 插件</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/octotree-github-code-tree/bkhaagjahfmjljalopjnoealnfndnagc?hl=zh-CN">octotree</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/gitzip-for-github/ffabmkklhbepgcgfonabamgnfafbdlkn">gitzip 插件</a></li>
<li><a target="_blank" rel="noopener" href="https://vimium.github.io/">vimiu</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/shortkeys-custom-keyboard/logpjaacgmcbpdkdchjiaagddngobkck/related?hl=zh-CN">shortkeys</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/magical-text-expansion/iibninhmiggehlcdolcilmhacighjamp/related?hl=zh-CN">magical</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/colorzilla/bhlhnicpbhignbdhedgjhgdocnmhomnp?hl=zh-CN">colorzilla</a></li>
<li>（good)<a target="_blank" rel="noopener" href="https://immersivetranslate.com/">沉侵式翻译</a><ul>
<li>arxiv 的文章也可以用</li>
<li>youtube 双语字幕</li>
<li><code>Alt A</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://chromewebstore.google.com/detail/imtranslator-%E7%BF%BB%E8%AF%91%EF%BC%8C%E5%AD%97%E5%85%B8%EF%BC%8C%E5%A3%B0%E9%9F%B3/noaijdpnepcgjemiklgfkcfbkokogabh">ImTranslator: 翻译，字典，声音</a></li>
<li>(good)<a target="_blank" rel="noopener" href="https://chromewebstore.google.com/detail/%E4%BE%A7%E8%BE%B9%E7%BF%BB%E8%AF%91/bocbaocobfecmglnmeaeppambideimao?hl=zh-CN">侧边翻译</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/google-translate/aapbdbdomjkkjkaonfhkkikfgjllcleb/related?hl=en">google translate</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alyssaxuu/omni">omni</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/easy-auto-refresh/aabcgdmkeabbnleenpncegpcngjpnjkc/related">easy-auto-refresh</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/markdown-diagrams/pmoglnmodacnbbofbgcagndelmgaclel">markdown-diagrams</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/svg-export/naeaaedieihlkmdajjefioajbbdbdjgp/related?hl=zh-CN">svg-export</a></li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/whatfont/jabopobgcpjmedljpbcaablpmlmfcogm/related?hl=zh-CN">whatfont</a></li>
<li><a target="_blank" rel="noopener" href="https://chromewebstore.google.com/detail/%E6%8D%95%E6%8D%89%E7%BD%91%E9%A1%B5%E6%88%AA%E5%9B%BE-fireshot%E7%9A%84/mcbpblocgmgfnpjjppndjkmgjaogfceg?hl=zh-CN&utm_source=ext_sidebar">fireshot 截屏工具</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/05/14/Jetson-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/14/Jetson-test/" class="post-title-link" itemprop="url">Jetson test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-14 21:33:07" itemprop="dateCreated datePublished" datetime="2021-05-14T21:33:07+08:00">2021-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer/GPU/" itemprop="url" rel="index"><span itemprop="name">GPU</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/14/Jetson-test/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/14/Jetson-test/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>273</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ol>
<li>使用TensorRT中的trtexec测性能</li>
<li>模型转化为engine后运行</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA-AI-IOT/jetson_benchmarks">https://github.com/NVIDIA-AI-IOT/jetson_benchmarks</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/embedded/jetson-benchmarks">https://developer.nvidia.com/embedded/jetson-benchmarks</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dusty-nv/jetson-inference">https://github.com/dusty-nv/jetson-inference</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/release/7.1/samples/opensource/trtexec">https://github.com/NVIDIA/TensorRT/tree/release/7.1/samples/opensource/trtexec</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/05/10/3d_detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/10/3d_detection/" class="post-title-link" itemprop="url">3d Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-10 12:48:48" itemprop="dateCreated datePublished" datetime="2021-05-10T12:48:48+08:00">2021-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/10/3d_detection/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/10/3d_detection/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>551</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="lidar-data"><a href="#lidar-data" class="headerlink" title="lidar data"></a>lidar data</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.shuangyi-tech.com/news_161.html">format</a></li>
<li>pts、LAS、PCD、.xyz 和.pcap</li>
</ol>
<h2 id="PCL"><a href="#PCL" class="headerlink" title="PCL"></a>PCL</h2><ol>
<li>install pcl and pcl-dev or install from source</li>
<li><a target="_blank" rel="noopener" href="https://pcl.readthedocs.io/projects/tutorials/en/latest/compiling_pcl_posix.html">dependency</a></li>
<li>pcl version &gt; 1.10 否则匹配不上 vtk</li>
<li>notes: update yum source when dependency error</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/a464057216/article/details/54864591">pcd</a></li>
<li>yum search boost; yum infoe boost;</li>
<li>yum install boost169 boost169-devel libusbx-devel</li>
<li><code>cmake -DBOOST_INCLUDEDIR=/usr/include/boost169 -DBOOST_LIBRARYDIR=/usr/lib64/boost169 ..</code></li>
<li>rm find_package(openni) and rm with_openni</li>
<li><a target="_blank" rel="noopener" href="https://pointclouds.org/documentation/tutorials/passthrough.html">passthrough 例子</a></li>
</ol>
<h2 id="ouster-lidar"><a href="#ouster-lidar" class="headerlink" title="ouster lidar"></a>ouster lidar</h2><ol>
<li><a target="_blank" rel="noopener" href="https://forum.ouster.at/">forum</a></li>
<li>不支持 pcd 格式输出，支持 pcap 格式</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=9127813">survey</a></li>
<li><a href="A_Survey_on_3D_Object_Detection_Methods_for_Autonomous_Driving_Applications">A_Survey_on_3D_Object_Detection_Methods_for_Autonomous_Driving_Applications</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/traveller59/second.pytorch">SECOND</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/W1995S/article/details/114498082?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.no_search_link&spm=1001.2101.3001.4242">pointpillars</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/75103748">点云目标检测之 VoxelNet、SECOND、PointPillars、PV-RCNN</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/04/13/TensorRT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/TensorRT/" class="post-title-link" itemprop="url">TensorRT</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-13 21:35:32" itemprop="dateCreated datePublished" datetime="2021-04-13T21:35:32+08:00">2021-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-26 16:16:16" itemprop="dateModified" datetime="2024-09-26T16:16:16+08:00">2024-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/04/13/TensorRT/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/04/13/TensorRT/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE"></a>NOTE</h2><ol>
<li>多看开发文档 <a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#work-with-loops">developer guide</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#data-layout">data layout</a><ul>
<li>While optimizing the network, TensorRT performs transformations internally (including to HWC, but also more complex formats) to use the fastest possible CUDA kernels. In general, formats are chosen to optimize performance, and applications have no control over the choices. However, the underlying data formats are exposed at I&#x2F;O boundaries (network input and output, and passing data to and from plugins) to allow applications to minimize unnecessary format transformations.</li>
<li>模型内部只支持 hwc layout（cuda kernel 效率更高), 如果输入是 chw, tensort 会内部做转换成 hwc</li>
<li>输入输出都是 hwc，会更高效一些</li>
</ul>
</li>
<li>tensorrt log 设置，打印出 warning 和 error: <a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#build-phase-c">link</a>, trt 内部代码会使用 ILogger 的 log 函数，内部有各种级别的 log</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> : <span class="keyword">public</span> ILogger</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(Severity severity, <span class="type">const</span> <span class="type">char</span>* msg)</span> <span class="keyword">noexcept</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// suppress info-level messages</span></span><br><span class="line">        <span class="keyword">if</span> (severity &lt;= Severity::kWARNING)</span><br><span class="line">            std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; logger;</span><br></pre></td></tr></table></figure>

<h2 id="转-trt-engine-方法"><a href="#转-trt-engine-方法" class="headerlink" title="转 trt engine 方法"></a>转 trt engine 方法</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA-AI-IOT/torch2trt">torch2trt</a></li>
<li>TensorRT creates an optimized engine for each profile, choosing CUDA kernels that work for all shapes within the [minimum, maximum] range and are fastest for the optimization point - typically different kernels for each profile. You can then select among profiles at runtime.<ul>
<li>为了优化 dynamic shape 需要提高最大最小 shape</li>
</ul>
</li>
<li>python 用 trt 部署验证模型更有效率</li>
<li>pytorch2.0 之后有了原生的 IR, 可以修改和运行 IR, 也可以直接支持转换成 trt 模型，简化了 torch -&gt; onnx model -&gt; trt engine -&gt; load to torch 的流程</li>
<li><a target="_blank" rel="noopener" href="https://pytorch.org/TensorRT/">Torch-TensorRT</a> <a target="_blank" rel="noopener" href="https://github.com/pytorch/TensorRT">github</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/onnx/onnx-tensorrt?tab=readme-ov-file#executable-usage">官方两种转 trt 工具</a><ul>
<li>trtexec <code>trtexec --onnx=model.onnx</code></li>
<li>polygraph <code>polygraphy run model.onnx --trt</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/onnx/onnx-tensorrt?tab=readme-ov-file#executable-usage">onnx-tensorrt</a> python 接口，直接导出 trt</li>
<li>onnx 转 trt 两种方式：<ul>
<li>onnx –&gt; engine –&gt; c++ inference</li>
<li>onnx –&gt; c++ convert and inference</li>
</ul>
</li>
<li>使用 trtexec 先将 ONNX 转换成 engine<ul>
<li>优点：<ul>
<li>简单性：trtexec 是一个命令行工具，可以很容易地用于转换模型，并且不需要编写任何额外的代码。</li>
<li>灵活性：trtexec 提供了许多命令行选项，用于优化和调试转换过程。</li>
<li>性能测试：您可以使用 trtexec 来测试模型的性能，这在评估优化策略时很有用。</li>
<li>重用：一旦创建了 engine 文件，您可以在不同的应用程序或设备上多次重用它，而不必再次进行优化。</li>
</ul>
</li>
<li>缺点： -两步流程：首先需要使用 trtexec 创建 engine，然后在 C++程序中加载它。这使得整体流程分为两个步骤，可能不如单步流程简洁。</li>
</ul>
</li>
<li>直接使用 C++ 接口转换 ONNX 然后进行推理<ul>
<li>优点：<ul>
<li>集成：整个流程，从加载 ONNX 模型到执行推理，都在一个 C++程序中完成。这对于集成到大型系统或自动化流程中很有用。</li>
<li>动态性：可以根据需要进行动态优化或调整，例如基于不同的输入尺寸或条件。</li>
</ul>
</li>
<li>缺点：<ul>
<li>复杂性：与使用命令行工具相比，需要编写和维护更多的代码。</li>
<li>优化时间：每次运行程序时，如果不保存和重用 engine，都可能需要重新进行模型的优化步骤。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li>使用 cuda graph 加速 trt 模型 trtexec –useCudaGraph</li>
<li>onnx 转 trt 时假如输入部分和输出部分有些不好支持，可以提到模型外面去做</li>
<li>模型转换后输出 tensor 顺序和 onnx 顺序不一定对应 <a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/onnx-model-and-tensorrt-engine-gives-different-output/193061">onnx-model-and-tensorrt-engine-gives-different-output</a></li>
<li>推理是使用训练好的模型进行预测的过程，而部署是将这个模型集成到最终应用环境的过程。</li>
<li><a target="_blank" rel="noopener" href="https://microsoft.github.io/AI-System/SystemforAI-8-Inference.pdf">推理系统优化目标</a><ul>
<li>延迟(Latency): 满足服务等级协议的延迟</li>
<li>吞吐量(Throughputs): 暴增负载的吞吐量需求</li>
<li>效率(Efficiency): 高效率，低功耗使用 GPU，CPU</li>
<li>灵活性(Flexibility): 支持多种框架，提供构建不同应用的灵活</li>
<li>扩展性(Scalability): 扩展支持不断增长的用户或设备</li>
</ul>
</li>
<li>推理考虑延迟、吞吐量和效率，部署考虑灵活性和可扩展性</li>
<li>提高 batch size 用于提高吞吐</li>
<li>等待浪费 GPU, 造成低效率</li>
<li><code>PyTorch-Quantization</code> is a toolkit for training and evaluating PyTorch models with simulated quantization. Quantization can be added to the model automatically, or manually, allowing the model to be tuned for accuracy and performance. The quantized model can be exported to ONNX and imported to an upcoming version of TensorRT. PyTorch-Quantization 是一个用于通过模拟量化来训练和评估 PyTorch 模型的工具包。量化可以自动或手动添加到模型中，从而可以调整模型的准确性和性能。量化模型可以导出到 ONNX 并导入到即将推出的 TensorRT 版本。</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#work-with-loops">work with loop</a></li>
<li>rnn 在 9.0 被移除，使用 loop op 替代</li>
<li>NVIDIA TensorRT is an SDK for optimizing trained deep learning models to enable high-performance inference. TensorRT contains <code>a deep learning inference optimizer for trained deep learning models</code>, and <code>a runtime for execution</code>.</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/archives/tensorrt-861/quick-start-guide/index.html#ecosystem">转换模型步骤</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/archives/tensorrt-861/quick-start-guide/index.html#conv-deploy-opt">多种转换和部署方式</a></li>
<li>all operations in your model must be supported by TensorRT (or you must provide custom plug-ins for unsupported operations)</li>
<li>at inference, we pick a small batch size when we want to prioritize latency and a larger batch size when we want to prioritize throughput.</li>
<li>TensorRT supports TF32, FP32, FP16, and INT8 precisions.</li>
<li>One of the most performant and customizable options for <code>both model conversion and deployment</code> are to use the TensorRT API, which has both C++ and Python bindings.</li>
<li>TensorRT C++ API 中的接口类以前缀 I(interface 的意思) 开头，例如 ILogger 、 IBuilder 等。</li>
<li>同步推理: <code>executeV2</code>方法; 异步推理: <code>enqueueV2</code></li>
<li><code>enqueue</code>异步接口没有很快返回的原因：<ul>
<li>有插件会强制 stream 同步？</li>
<li>nsight system 上看 tensorrt node 调用， 对应 cuda api 里有 cudaStreamSync()函数， 会阻塞 cpu 导致 enqueue 不返回</li>
<li>有多个 stream sync, 每个 stream sync 执行之后之前通过 cuda api 调用的 kernel 都已执行完</li>
<li>为什么要多个 stream？node 不相关可以并行加速, 可以看到 kernel 执行时间有并行， 为什么要 sync? 后面的节点需要前面的节点都执行完，有关联</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/issues/2828#issuecomment-1488371967">控制单模型 stream 个数 –maxAuxStreams</a> Set maximum number of auxiliary(辅助) streams per inference stream.</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#within-inference-multi-streaming">within-inference-multi-streaming</a><ul>
<li>In the context of TensorRT and inference, each layer of the optimized final network will require work on the GPU. However, not all layers will be able to fully use the computation capabilities of the hardware. Scheduling requests in separate streams allows work to be scheduled immediately as the hardware becomes available without unnecessary synchronization. Even if only some layers can be overlapped, overall performance will improve.</li>
<li>如果放在单独流中调度，不能充分利用硬件调度能力，将 request 放在多个流调度时，硬件准备好就能使用，不用额外的 sync, 即使只有少数的 layer 并行，总体结果也会提高</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#trtexec-flags">trtexec-flags 搜–maxAuxStreams</a></li>
<li>enqueue 可能不是真异步，内部有同步</li>
<li>想并行运行多个模型需要使用多线程，net1.enqueueV2(stream1); net2.enqueueV2(stream2);</li>
</ul>
</li>
<li>注意 event sync 和 stream sync 的区别; event sync 在 enqueue 之后执行，enqueue 执行时可能会多次调用 stream sync</li>
<li><img src="https://developer-blogs.nvidia.com/wp-content/uploads/2023/01/nvidia-inference-stack.png" alt="NVIDIA 推理堆栈"></li>
<li>在 TensorRT 8.5 及更高版本中， cuDNN 和 cuBLAS 内核是可选的添加，以减少 TensorRT 库的部署大小。</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/performance/dl-performance-convolutional/index.html#tensor-layout">Tensor Layouts In Memory: NCHW vs NHWC</a></li>
<li>因为为 Tensor Core 实现的卷积需要 NHWC 布局，并且当输入张量以 NHWC 布局时速度最快</li>
<li>NHWC 格式的输入非常适合 NVIDIA 上的 Tensor Core GPU 。由于 ONNX 仅支持 NCHW 格式(?)，因此必须使用技巧启用 NHWC 作为输入张量。将输入维度设置为 NHWC ，并在 CUDA 或 TensorRT EP 删除的输入之后插入 Transpose 操作</li>
<li>tensor core 用 Implicit GEMM 实现的卷积不用生成中间的矩阵，直接原位计算， 不需要 im2col <a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/performance/dl-performance-convolutional/index.html#tc-usage">link</a></li>
<li>The process of identifying the sequences of operations that can be fused is called <code>pattern-matching</code>. TensorRT has a powerful pattern-matching algorithm that can identify a lot of possible fusions.</li>
<li>可以使用 python API 来调用转换后的 engine 来和 torch 结果作比较</li>
<li>workspace<ul>
<li>在 TensorRT 中，工作空间（Workspace）是用于存储临时数据（如中间层输出、优化过程中的临时数据）的内存区域。它主要在模型优化和执行过程中被使用。</li>
<li>较大的工作空间可以允许 TensorRT 执行更复杂的优化，可能带来更高的运行效率。然而，过大的工作空间可能导致内存资源的浪费或者在内存受限的设备上无法运行。</li>
<li>在使用 TensorRT API 时，可以通过编程方式配置工作空间的大小。这通常在<code>构建优化引擎（Optimization Engine）时设置</code></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/archives/tensorrt-722/developer-guide/index.html#troubleshooting">Q: How do I choose the optimal workspace size?</a>。</li>
</ul>
</li>
</ol>
<h2 id="Using-the-TensorRT-Runtime-API"><a href="#Using-the-TensorRT-Runtime-API" class="headerlink" title="Using the TensorRT Runtime API"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/quick-start-guide/index.html#runtime">Using the TensorRT Runtime API</a></h2><h3 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h3><ol>
<li><code>std::unique_ptr&lt;nvinfer1::IRuntime&gt; runtime&#123;nvinfer1::createInferRuntime(sample::gLogger.getTRTLogger())&#125;;</code></li>
</ol>
<h3 id="engine"><a href="#engine" class="headerlink" title="engine"></a>engine</h3><ol>
<li><code>std::unique_ptr&lt;nvinfer1::ICudaEngine&gt; mEngine(runtime-&gt;deserializeCudaEngine(engineData.data(), fsize, nullptr));</code> runtime deserialize 到 engine</li>
<li><code>auto input_idx = mEngine-&gt;getBindingIndex(&quot;input&quot;);</code> 得到 input idx</li>
<li><code>assert(mEngine-&gt;getBindingDataType(input_idx) == nvinfer1::DataType::kFLOAT);</code> 判断输入类型</li>
<li>通过 engine 拿到输入输出信息，申请 host 和 device 内存，host 上处理完输入之后，copy to device， 执行模型，将结果从 device cp to host</li>
</ol>
<h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><ol>
<li><code>IExecutionContext *context = engine-&gt;createExecutionContext();</code></li>
<li>you can have multiple contexts associated with a single engine, and run them in parallel. 多个 context 可以与一个 engine 结合，并行的运行<ul>
<li>A current exception to this is when using dynamic shapes, when each optimization profile can only have one execution context, unless the preview feature, kPROFILE_SHARING_0806, is specified. 动态 shape engine 只能有一个 context</li>
</ul>
</li>
<li>A TensorRT execution context encapsulates execution state such as persistent device memory for holding intermediate activation tensors during inferenc</li>
<li>Inference execution is kicked off using the context’s executeV2 or enqueueV2 methods. After the execution is complete, we copy the results back to a host buffer and release all device memory allocations<ul>
<li>executeV3</li>
<li>enqueueV3 <code>bool status = context-&gt;enqueueV3(bindings, stream, nullptr);</code></li>
</ul>
</li>
<li><code>void* bindings[] = &#123;input_mem, output_mem&#125;;</code> input_mem and output_mem 在 gpu device 上</li>
<li><code>auto output_buffer = std::unique_ptr&lt;int&gt;&#123;new int[output_size]&#125;;</code> on cpu</li>
<li><code>cudaMemcpyAsync(output_buffer.get(), output_mem, output_size, cudaMemcpyDeviceToHost, stream);</code> device to host</li>
<li><code>cudaStreamSynchronize(stream);</code></li>
</ol>
<h2 id="NVIDIA-Multi-Instance-GPU-User-Guide"><a href="#NVIDIA-Multi-Instance-GPU-User-Guide" class="headerlink" title="NVIDIA Multi-Instance GPU User Guide"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/datacenter/tesla/mig-user-guide/index.html">NVIDIA Multi-Instance GPU User Guide</a></h2><ol>
<li>多实例 GPU (MIG) 是采用 NVIDIA Ampere 架构或更高版本架构的 NVIDIA GPU 的一项功能，可实现用户控制的将单个 GPU 划分为多个较小的 GPU。物理分区提供专用计算和内存切片，具有 QoS 以及在部分 GPU 上独立执行并行工作负载。对于 GPU 利用率较低的 TensorRT 应用程序，MIG 可以在对延迟影响很小或没有影响的情况下产生更高的吞吐量。最佳分区方案是特定于应用程序的。</li>
</ol>
<h2 id="ecosystem"><a href="#ecosystem" class="headerlink" title="ecosystem"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/quick-start-guide/index.html#ecosystem">ecosystem</a></h2><ol>
<li>workflow<ul>
<li>导出 onnx 模型</li>
<li>选择 batch size</li>
<li>选择量化精度</li>
<li>转换模型</li>
<li>发布模型</li>
</ul>
</li>
<li>有多种方式可以转换模型</li>
<li>有多种方式可以部署模型</li>
</ol>
<h2 id="fusion"><a href="#fusion" class="headerlink" title="fusion"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#enable-fusion">fusion</a></h2><h2 id="dla"><a href="#dla" class="headerlink" title="dla"></a><a target="_blank" rel="noopener" href="https://developer.nvidia.com/deep-learning-accelerator">dla</a></h2><ol>
<li>TensorRT allows you to execute part of the network on the DLA and the rest on GPU; engine 可以一部分在 dla 上执行，另外的在 cuda 上</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA-AI-IOT/jetson_dla_tutorial">jetson_dla_tutorial</a></li>
<li>只有 edge 平台才有</li>
<li>jtop -&gt; ENG 上方显示有几个 dla core</li>
</ol>
<h2 id="quantization"><a href="#quantization" class="headerlink" title="quantization"></a>quantization</h2><ol>
<li>FP32, FP16, BF16: unquantized floating point types</li>
<li>fp16 不算量化</li>
<li>low precision quantized types (INT8, FP8, INT4)</li>
<li>TensorRT supports quantized floating point, where floating-point values are <code>linearly</code> compressed and rounded to low precision quantized types (INT8, FP8, INT4). 线性量化</li>
<li>TensorRT must know its dynamic range - that is, what range of values is important to represent - values outside this range are clamped when quantizing. 量化时需要知道数据的动态范围，会做截断</li>
<li>Dynamic range information can be calculated by the builder (this is called calibration) based on representative input data (this is currently supported only for INT8). activation 量化时， 校准时会收集 activation 的动态范围</li>
<li>TensorRT supports the use of low precision types to represent quantized floating point values. The quantization scheme is symmetric quantization - quantized values are represented in signed INT8, FP8E4M3 (FP8 for short), or signed INT4, and the transformation from quantized to unquantized values is simply a multiplication. In the reverse direction, dequantization uses the reciprocal scale, followed by rounding and clamping.<ul>
<li>对称量化， 反量化时只是简单相乘，量化时还需要钳位</li>
</ul>
</li>
<li>TensorRT quantizes activations as well as weights to INT8 and FP8. For INT4, weight-only-quantization is supported.<ul>
<li>int4 只支持 weight 量化, 不支持 activation</li>
</ul>
</li>
<li>对称线性量化： Q &#x3D; F&#x2F;s(需要钳位); s &#x3D; (Fmax - Fmin) &#x2F; (Qmax - Qmin); 反量化：F &#x3D; Q x s<ul>
<li>s: scale 即最小刻度，Q 表示 F 有多少个最小刻度</li>
</ul>
</li>
<li>scale 是核心，ptq 和 qat 都是为了得到 scale</li>
<li>Post-training quantization (PTQ) derives scale factors after the network has been trained. TensorRT provides a workflow for PTQ, called calibration, where it measures the <code>distribution of activations</code> within each activation tensor as the network executes on representative input data, and then uses that distribution to estimate scale values for each tensor.</li>
<li>calibration 只是为了得到 activation 的分布来估计量化时 tensor 的 scale，weight 不需要</li>
<li>Quantization-aware training (QAT) computes the scale factors during training, using a technique called fake-quantization which simulates the quantization and quantization process. This allows the training process to compensate for the effects of the quantization and dequantization operations.<ul>
<li>量化感知训练 (QAT) 使用一种称为假量化的技术来模拟量化和量化过程，从而在训练期间计算比例因子。这允许训练过程补偿量化和反量化操作的影响。</li>
</ul>
</li>
<li>Implicit quantization is only supported when quantizing for INT8 只有 int8 支持隐式量化</li>
</ol>
<h2 id="streaming-weights"><a href="#streaming-weights" class="headerlink" title="streaming weights"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#streaming-weights">streaming weights</a></h2><ol>
<li>TensorRT can be configured to stream the network’s weights from host memory to device memory during network execution instead of placing them in device memory at engine load time. This enables models with weights larger than free GPU memory to run, but potentially with significantly increased latency.<ul>
<li>需要 host to device, 这使得权重大于可用 GPU 内存的模型可以运行，但延迟可能会显着增加。</li>
</ul>
</li>
</ol>
<h2 id="plugins-custom-op"><a href="#plugins-custom-op" class="headerlink" title="plugins(custom op)"></a>plugins(custom op)</h2><ol>
<li>注意 shape 区别：固定输出 shape, shape 有输入决定(axie), 动态 shape</li>
<li>nonzero 才是动态 shape，输出 shape 不能由输入决定, nonzero 可以由 padding 来解决</li>
<li>构造函数一般设置为三个。<ul>
<li>第一个用于在 parse 阶段，PluginCreator 用于创建该插件时调用的构造函数，需要传递权重信息以及参数。</li>
<li>第二个用于在 clone 阶段，复制这个 plugin 时会用到的构造函数。</li>
<li>第三个用于在 deserialize 阶段，用于将序列化好的权重和参数传入该 plugin 并创建。</li>
</ul>
</li>
<li>TensorRT 在 fp16 运行模式下，运行到不支持 fp16 的插件 op 时，会自动切换到 fp32 模式，等插件 op 运行完再切换回来。</li>
<li>getWorkspaceSize 这个函数需要返回这个插件 op 需要中间显存变量的实际数据大小(bytesize), 在实际运行的时候就可以直接使用 TensorRT 开辟好的空间而不是自己去申请显存空间。</li>
<li>serialize 将 plugin 实例序列化到文件（包含参数，属性等信息）（在 plugin 里 TRTBEVPoolV2::serialize）， deserialize 通过文件发序列化到 plugin 实例(构造插件，在 creator 里做 TRTBEVPoolV2Creator::deserializePlugin;)</li>
<li>createPlugin 用于 build 阶段，生成 plugin 实例(注意不是序列化，序列化是存文件)， deserializePlugin 用于 runtime，用于从 engine 反序列化 plugin 对象</li>
<li>onnx 转换成 engine 存成文件，需要序列化，加载 engine 需要反序列化</li>
<li>supportsFormatCombination 用于检测格式和类型是否支持</li>
<li>tensorrt 支持的 op， 提供的标准 plugins, 自定义的 plugin</li>
<li>分为 build 期和 runtime 期，两个时期需要插件的功能不一样，build 是构建网络用的，runtime 是运行插件时用的</li>
<li>IPluginV3OneCore (build 和 runtime 都需要的接口), IPluginV3OneBuild (build 需要的接口), and IPluginV3OneRuntime(runtime 需要的接口)</li>
<li>core capability 是 build 和 runtime 都需要的接口</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#add_custom_layer">实现流程</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#register-plugin-create">注册方法</a><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/9db1508f7479b24857d4fb81e33b6b10cede6bd0/plugin/api/inferPlugin.cpp#L180">手动 initLibNvInferPlugins</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/9db1508f7479b24857d4fb81e33b6b10cede6bd0/plugin/geluPlugin/geluPlugin.cpp#L43">自动 REGISTER_TENSORRT_PLUGIN</a> static 变量</li>
<li>trtexec 通过 dlopen 方式加载注册，python 通过 ctypes.CDLL 方式加载注册，pgpredict 通过 link 方式启动时加载注册</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#using-plugin-library">using-plugin-library</a> runtime 可以手动加载， 不用 link<ul>
<li><code>runtime-&gt;getPluginRegistry().loadLibrary(pluginLib.c_str())</code> runtime 加载</li>
<li><code>builder-&gt;getPluginRegistry().loadLibrary(pluginLibs[i]);</code> build 时加载</li>
</ul>
</li>
</ul>
</li>
<li>onnx 和 trt plugin 可以通过属性传递参数，封装自定义算子 symbolic g.op()写入属性，trtplugin 代码可以获取属性</li>
<li>要在应用程序中使用 TensorRT 官方插件，必须加载 libnvinfer_plugin.so （Windows 上为 nvinfer_plugin.dll ）库，并且必须通过在应用程序中调用 initLibNvInferPlugins 来注册所有插件代码。</li>
<li>几个概念：<ul>
<li>plugin: 具体 plugin 实现， 需要继承 IPluginV2DynamicExt</li>
<li>plugin creator: plugin 对象创建方法，相当于抽象工场函数的具体工厂, 改工厂的实例会被注册到全局工厂(注册表)中，用来创建 creator</li>
<li>register: 将 plugin creator 工厂函数注册到, tensorrt sample 中注册位置<a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/main/plugin/api/inferPlugin.cpp">register tensorrt plugin</a>; 单例模式实现<ul>
<li>需要调用 getPluginRegistry()-&gt;registerCreator(*pluginCreator, libNamespace)来注册</li>
<li>REGISTER_TENSORRT_PLUGIN 宏也可以来注册：#define REGISTER_TENSORRT_PLUGIN(name) static nvinfer1::PluginRegistrar<name> pluginRegistrar##name {}; getPluginRegistry()-&gt;registerCreator(instance, “”);</li>
</ul>
</li>
</ul>
</li>
<li>设计模式插件系统; so 加载时 static 变量初始化注册工厂实例到全局工厂；反射 由字符串来创建对象</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/samples/sampleOnnxMnistCoordConvAC">官方 sample</a><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/plugin/coordConvACPlugin">plugin 代码位置</a></li>
<li>enqueue 在 cu 文件中实现</li>
<li>自己写的插件可能用不到 workspace, 见上述代码 enqueue 函数</li>
<li>onnx shape_inference 在模型上显示 shape 信息</li>
<li>修改模型时要照着 net forward 来改 op input(tensor) output name</li>
<li>自定义 op 内可变参数作为输入, 不变数值直接写死, y&#x3D;kx + 2; k 是参数，2 是数值, y &#x3D; x + 2</li>
<li>netron 上不变参数(weights bias div mul 需要的参数)使用 constant tensor 类型，输入是 variable tensor, attributes 是 op <code>初始化</code>用到的数值， 计算不用</li>
<li>参数传递与转换：在插件中，你需要将原始模型中算子的参数传递到你的插件实现中。这通常涉及到参数的序列化和反序列化。确保所有必要的参数都被正确传递，并且在需要时进行适当的数据类型转换。</li>
<li>attention 输入为 q k v 输出 q 维度类似的结果; 参数可能为各种 shape 信息 地址 head num, scale, mask 等。如果是 paged attention 需要处理 q k v 地址不连续的情况, <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/638468472">link</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/master/plugin">官方 plugin</a></li>
<li>ONNX 解析器会自动尝试将无法识别的节点作为插件导入。如果在插件注册表中找到与该节点具有相同 op_type 的插件</li>
<li>python 自定义 op 用了多种内置 op 实现，在图上表现为多个内置 op，需要把 onnx 模型内置 op 转换为自定义 op 再转换模型</li>
<li>适用场景<ul>
<li>python 中算子 trt 不支持可以用 plugin 方式实现</li>
<li>trt 算子性能有问题</li>
<li>手动算子融合(将融合算子的所有输入作为融合算子的输入， 输出同理)</li>
</ul>
</li>
<li>合并之后的 中间 op 的参数也不用管，因为算子等价，中间参数无用</li>
<li>op 没有权重，只是计算方法，处理输入得到输出，不用关心权重问题, 权重在输入接口,<ul>
<li>attention 插件会在接口中传递输入输出地址，kvcache 地址， 长度等信息，插件负责计算</li>
<li>load 模型时权重会从模型 load 到 op，作为参数传递给 op；序列化与反序列化</li>
</ul>
</li>
<li>onnx 模型添加了 plugin 之后 neoton 可能显示不出 shape 信息，原因是 plugin 的存在，妨碍了自动推断;<ul>
<li>如果 plugin 不改变 shape，直接删除掉之后，在图上就能看到 shape 信息</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#extending">Extending TensorRT with Custom Layers</a></li>
<li>即使 TensorRT 拥有强大的模式匹配算法并支持许多可能的融合，但始终存在无法识别不常见和&#x2F;或非常高级模式的风险。为了克服这一不可避免的限制，TensorRT 提供了一种称为插件的强大机制。</li>
<li>The plugins are nodes inserted in the network graph definition that map to user-defined GPU kernels.</li>
</ol>
<h3 id="python-plugin"><a href="#python-plugin" class="headerlink" title="python plugin"></a>python plugin</h3><ol>
<li>python load plugin.so <a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/loading-of-tensorrt-custom-plugin-shared-library/237504/6">links</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/ba696521eed5d8b49a3c6f21ef243ca4b3474d64/samples/python/onnx_custom_plugin/test_custom_hardmax_plugin.py#L40">tensorrt python 使用 trt 内部结构示例</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/ba696521eed5d8b49a3c6f21ef243ca4b3474d64/python/src/infer/pyPlugin.cpp#L2612">python plugin 相关 bindings</a></li>
<li>ctypes.CDLL 是 Python ctypes 库中的一个函数，用于加载动态链接库（.so 文件，DLL 文件等）。它允许你在 Python 中调用这些库中定义的函数和使用其中的资源。</li>
</ol>
<h2 id="修改模型"><a href="#修改模型" class="headerlink" title="修改模型"></a>修改模型</h2><h3 id="拆分"><a href="#拆分" class="headerlink" title="拆分"></a>拆分</h3><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/master/tools/onnx-graphsurgeon">TensorRT&#x2F;tools&#x2F;onnx-graphsurgeon</a></li>
<li><code>polygraph surgeon extract</code>也可以提取子图</li>
<li>一个一个算子累加形成 grpah 可以找出出现问题的 op; 加入 polygrpah 不能用，trtexec 能用；所有 graph 设置同一个输入，和 onnx 比输出</li>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorRT-Custom-Plugin-Example/blob/main/scripts/create_identity_neural_network.py">sample</a></li>
</ol>
<h3 id="op-替换"><a href="#op-替换" class="headerlink" title="op 替换"></a>op 替换</h3><h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main?tab=readme-ov-file#optional---if-not-using-tensorrt-container-specify-the-tensorrt-ga-release-build-path">源码编译</a><ul>
<li><code>export TRT_LIBPATH=</code>pwd<code>/TensorRT-8.6.1.6/lib</code>必须设置</li>
</ul>
</li>
</ol>
<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><ol>
<li>jtop -&gt; INFO</li>
<li>jetson_release</li>
<li>nvidia-smi</li>
<li><code>dpkg-query -W tensorrt</code> tensorrt 版本</li>
<li><code>cat /proc/driver/nvidia/gpus/0000\:02\:00.0/information</code> 查看硬件型号</li>
</ol>
<h2 id="查看模型信息-对数"><a href="#查看模型信息-对数" class="headerlink" title="查看模型信息, 对数"></a>查看模型信息, 对数</h2><ol>
<li>参考 python_sandbox&#x2F;model_convert<ul>
<li>get_onnx_detail_info.py 能够获取算子 doc_string, 可以看堆栈，找到算子所在位置</li>
</ul>
</li>
<li>余弦相似度来衡量两个 tensor 是否对齐</li>
<li>pytorch 模型，onnx 模型，trt 模型都要一致<ul>
<li>pytorch 和 onnxruntime 先对数，然后 onnxruntime 和 trt 对数</li>
<li>有 plugin 时可以直接对 trt 和 pytorch 结果, pytorch 添加 hook 导出所有 tensor 输出，onnx 对应 pytorch 输出，onnx 切分子图，分别转成 tensorrt 模型，每一个都有输入输出，根据 onnx 模型找 pytorch 输出，看哪个算子对不上<ul>
<li>pytorch 模型 dump 数据时需要处理 sequential 和 submodule 问题，重复 layer 使用问题，onnx 模型导出时需要处理将中间层输出，名字要和 pytorch 导出的名字对上; 如果是直接 pytorch 和 trt 对数，不用对 onnx 中间结果</li>
<li>pytorch 中间结果和 trt 中间结果做对比时， 注意 onnx 和 trt 算子可能融合，需要比较 pytorch 前后一些算子</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_intermediate_outputs_pytorch</span>(<span class="params">model, input_tensor</span>):</span><br><span class="line">     intermediate_outputs = &#123;&#125;</span><br><span class="line">     hooks = []</span><br><span class="line"></span><br><span class="line">     <span class="comment"># 处理重复使用情况</span></span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">hook_fn</span>(<span class="params">module, <span class="built_in">input</span>, output, name</span>):</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> intermediate_outputs:</span><br><span class="line">            count = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> name + <span class="string">&quot;_&quot;</span> + conut.to_str() <span class="keyword">in</span> intermediate_outputs：</span><br><span class="line">                count = count + <span class="number">1</span></span><br><span class="line">            intermediate_outputs[name + <span class="string">&quot;_&quot;</span> + conut.to_str()] = [output]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            intermediate_outputs[name] = [output]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 递归注册钩子</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_hooks</span>(<span class="params">module, prefix=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">for</span> name, submodule <span class="keyword">in</span> module.named_children():</span><br><span class="line">            submodule_name = prefix + (<span class="string">&#x27;.&#x27;</span> <span class="keyword">if</span> prefix <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>) + name</span><br><span class="line">            hook_handle = submodule.register_forward_hook(<span class="keyword">lambda</span> m, i, o, name=submodule_name: hook_fn(m, i, o, name))</span><br><span class="line">            hooks.append(hook_handle)</span><br><span class="line">            register_hooks(submodule, submodule_name)</span><br><span class="line"></span><br><span class="line">    register_hooks(model)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        model(input_tensor)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移除钩子</span></span><br><span class="line">    <span class="keyword">for</span> hook_handle <span class="keyword">in</span> hooks:</span><br><span class="line">        hook_handle.remove()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> intermediate_outputs</span><br></pre></td></tr></table></figure>

<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/Polygraphy/polygraphy/tools/">polygraphy</a><ul>
<li>Use Polygraphy to dump layer outputs and verify there are no NaNs or Infs. The –validate option can check for NaNs and Infs. Also, we can compare layer outputs with golden values from, for example, ONNX runtime.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/c5b9de37f7ef9034e2efc621c664145c7c12436e/tools/polygraphy-extension-trtexec">polygraphy-extension-trtexec</a><ul>
<li><a target="_blank" rel="noopener" href="https://www.wheelodex.org/projects/polygraphy-trtexec/">位置</a></li>
</ul>
</li>
<li><code>--mark all</code> is not a good practice, it will break all layer fusions. <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/issues/3592#issuecomment-1888624281">link</a> <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/issues/3596#issuecomment-1896408532">link</a><ul>
<li>I think mark all is becoming increasingly unreliable. A better approach is to manually mark a subset of the intermediate tensors as outputs.</li>
</ul>
</li>
<li><code>polygraphy run   sim_sparsedrive.onnx --fp16   --trt --trt-outputs /deformable_aggregation_output_0   --save-engine test.trt --plugins=/workspace/mmdeploy/mmdeploy/lib/libmmdeploy_tensorrt_ops.so   --save-outputs ./dump.json --save-timing-cache=fp16cache --load-timing-cache=fp16cache</code> 可以 mark 一些 output</li>
<li><code>polygraphy run  model.onnx --trt  --trt-outputs mark all    --save-outputs ./model3.json</code> 转完跑一遍 trt, mark all；<ul>
<li><a target="_blank" rel="noopener" href="https://www.stubbornhuang.com/2432/"> 转换 onnx 模型出现 requires bool or uint8 I&#x2F;O but node can not be handled by Myelin</a></li>
</ul>
</li>
<li><code>polygraphy run  sparsedrive_fp16_3090.trt --model-type=engine  --plugins=/workspace/mmdeploy/mmdeploy/lib/libmmdeploy_tensorrt_ops.so   --trt-outputs mark all --trt  --save-outputs ./dump.json</code> 运行 trt 模型</li>
<li><code>polygraphy run model.onnx --trt</code> 转 trt 模型</li>
<li><code>polygraphy inspect model model.onnx --shape-inference --show layers</code> 查看 onnx 模型信息</li>
<li><code>polygraphy inspect model op16_iter7_refine_filter_fb.trt --model-type=engine --show layers</code> 查看 trt 模型信息</li>
<li><code>polygraphy inspect capability model.onnx -v</code> 查看 onnx 是否被 TensorRT 支持<ul>
<li><code>LD_PRELOAD=/workspace/mmdeploy/mmdeploy/lib/libmmdeploy_tensorrt_ops.so polygraphy inspect  capability sparsedrive_lantu_op13_fd.onnx -v</code> 有插件用 LD_PRELOAD； 还可以看用了什么插件</li>
</ul>
</li>
<li><code>polygraphy run dynamic_identity.onnx --trt --onnxrt --save-engine test.trt</code> Comparing TensorRT And ONNX-Runtime Outputs</li>
<li><code>polygraphy run your.onnx --trt --onnxrt --onnx-outputs mark all --trt-outputs mark all</code> To mark all nodes in onnx as output and compare between onnxruntime and trt<ul>
<li>只有 onnx 才能 run</li>
</ul>
</li>
<li><code> --trt --trt</code> trt 结果与 trt 结果比较, 跑两次比较，查看输出是否异常</li>
<li><code>polygraphy run dynamic_identity.onnx --trt --fp16 --onnxrt --input-shapes X:[1,2,4,4]</code> Comparing TensorRT Precisions</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/Polygraphy/examples/cli/run/05_comparing_with_custom_input_data">(good) run&#x2F;05_comparing_with_custom_input_data</a></li>
<li><code>polygraphy surgeon sanitize model.onnx --fold-constants -o folded.onnx</code> 可以 fold constant, 作为 op 参数, 不用作为 input<ul>
<li>可以看出来有多少个 node</li>
</ul>
</li>
<li><code>polygraphy debug precision net_bs8.onnx --fp16 --tactic-sources cublas --check polygraphy run polygraphy_debug.engine --trt --load-outputs onnx_res.json --abs 1e-1</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/Polygraphy/examples/api/00_inference_with_tensorrt">polygraphy python 接口</a><ul>
<li>比 tensorrt python 接口好用</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/experimental/trt-engine-explorer">trt-engine-explorer</a></li>
</ol>
<h2 id="op-支持"><a href="#op-支持" class="headerlink" title="op 支持"></a>op 支持</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/onnx/onnx-tensorrt/blob/main/docs/operators.md">onnx operators.md</a></li>
<li>tensorrt 支持 rnn, lstm, gru;可能算子内部循环，外部还是 dag</li>
</ol>
<h2 id="TensorRT-CUDA-cuDNN"><a href="#TensorRT-CUDA-cuDNN" class="headerlink" title="TensorRT, CUDA, cuDNN"></a>TensorRT, CUDA, cuDNN</h2><ol>
<li>CUDA 是<code>并行计算框架</code>，提供 API，可以运行在 Nvdia GPU 上</li>
<li>cuDNN 是深度神经网络加速库，cuDNN 可大幅优化标准例程（例如用于前向传播和反向传播的卷积层、池化层、归一化层和激活层）的实施。世界各地的深度学习研究人员和框架开发者都依赖 cuDNN 实现高性能 GPU 加速。借助 cuDNN，研究人员和开发者可以<code>专注于训练神经网络及开发软件应用</code>，而不必花时间进行低层级的 GPU 性能调整。cuDNN 可加速广泛应用的深度学习框架，包括 Caffe2、Chainer、Keras、MATLAB、MxNet、PyTorch 和 TensorFlow。</li>
<li>TensorRT 是用于高性能深度学习<code>推理</code>的 SDK。此 SDK 包含深度学习推理优化器和<code>运行时环境</code>，可为深度学习推理应用提供低延迟和高吞吐量。借助 TensorRT，开发者可专注于创建新颖的 AI 支持应用，无需费力调节性能来部署推理工作。</li>
</ol>
<h2 id="trt-engine-explorer"><a href="#trt-engine-explorer" class="headerlink" title="trt-engine-explorer"></a><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/experimental/trt-engine-explorer">trt-engine-explorer</a></h2><h2 id="trtexec"><a href="#trtexec" class="headerlink" title="trtexec"></a>trtexec</h2><h3 id="转模型"><a href="#转模型" class="headerlink" title="转模型"></a>转模型</h3><ol>
<li>NOTE: <code>--noTF32 Disable tf32 precision (default is to enable tf32, in addition to fp32)</code>转出的模型默认是 tf32<ul>
<li>A100、H100 tf32 算力比 fp32 算力高 8 倍左右</li>
<li>3090 上 tf32 算力跟 fp32 算力相同</li>
</ul>
</li>
<li><code>trtexec --onnx=model.onnx --saveEngine=model.trt</code></li>
<li><code>trtexec --onnx=model.onnx --saveEngine=model_fp16.trt --fp16</code></li>
<li><code>trtexec --onnx=model.onnx --saveEngine=model_int8.trt --int8</code></li>
<li>trtexec –onnx&#x3D;.&#x2F;bisenetv2_310102_1280x1920.onnx –shapes&#x3D;input:1x3x540x960 –saveEngine&#x3D;bisenetv2-xavier-fp16-540x960.engine –allowGPUFallback –fp16 –workspace&#x3D;16024</li>
<li>onnx 模型转化为 engine or trt 后运行</li>
<li>trtexec 在转换模型时做了一些优化，以提高模型的推理性能。这些优化包括：<ul>
<li><code>算子融合：</code>trtexec 会尝试将多个算子融合为一个算子，以减少推理过程中的开销。</li>
<li><code>内存优化：</code>trtexec 会尝试将模型的权重和激活值存储在更高效的内存中，以提高推理速度。</li>
<li><code>模型裁剪：</code>trtexec 会尝试将模型的参数量减少，以减少推理过程中的计算量。</li>
<li><code>图优化?</code> <a target="_blank" rel="noopener" href="https://microsoft.github.io/AI-System/SystemforAI-9-Compilation%20and%20Optimization.pdf">link</a><ul>
<li>等价变化简化图计算; 算术表达式等价替换：a*0 -&gt; 0; 公共子表达式消除, 常量折叠</li>
<li>子图替换，如 flash attention</li>
<li>包括算子融合</li>
<li>剪枝</li>
<li>调度优化，异步， 可以并行的并行做</li>
<li>内存优化</li>
<li>混合精度</li>
</ul>
</li>
</ul>
</li>
<li>trtexec 执行步骤：<ul>
<li>trtexec 会将模型转换为 TensorRT 的内部表示。</li>
<li>trtexec 会对模型进行分析，以确定可以进行优化的算子。</li>
<li>trtexec 会对模型进行优化，以提高推理性能。</li>
</ul>
</li>
</ol>
<h4 id="性能参数"><a href="#性能参数" class="headerlink" title="性能参数"></a>性能参数</h4><pre><code>- `--best               Enable all precisions to achieve the best performance (default = disabled)`
- `--useCudaGraph       Use CUDA graph to capture engine execution and then launch inference (default = disabled).`
- `--useDLACore=N       Select DLA core N for layers that support DLA (default = none)`
- `--useManagedMemory   Use managed memory instead of separate host and device allocations (default = disabled).`
</code></pre>
<h3 id="推理"><a href="#推理" class="headerlink" title="推理"></a>推理</h3><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/tools/Polygraphy/examples/cli/run/01_comparing_frameworks#comparing-tensorrt-and-onnx-runtime-outputs">Comparing TensorRT And ONNX-Runtime Outputs</a></li>
<li>推理时可以看各种信息：<ul>
<li>Build Options：<ul>
<li>输入输出 name</li>
<li>input output 格式(fp32, fp16…)</li>
<li>batch</li>
<li>layout(chw or hwc)</li>
</ul>
</li>
<li>Inference Options<ul>
<li>推理次数</li>
</ul>
</li>
<li>Device Information</li>
<li>Performance summary</li>
</ul>
</li>
<li><code>trtexec --loadEngine=test.trt</code></li>
<li><code>trtexec --loadEngine=model.trt --exportOutput=output.txt</code> dump model output</li>
<li><code>trtexec --loadEngine=model.trt --exportLayerInfo=LayerInfo.txt</code> dump layer info； 如果出现<code>ForeignNode[onnx::MatMul_311</code>表示不支持; 使用<a target="_blank" rel="noopener" href="https://github.com/daquexian/onnx-simplifier">onnx-simplifier</a>试试</li>
<li><code>trtexec --loadEngine=test.trt --plugins=lib/libtrtplugins.so --duration=10</code> 带 plugin</li>
<li><code>trtexec --loadEngine=test.trt --plugins=lib/libtrtplugins.so --iterations=N --verbose=1</code></li>
<li>动态输入 <code>trtexec --onnx=fcn-resnet101.onnx --fp16 --workspace=64 --minShapes=input:1x3x256x256 --optShapes=input:1x3x1026x1282 --maxShapes=input:1x3x1440x2560 --buildOnly --saveEngine=fcn-resnet101.engine &amp;&amp; trtexec --shapes=input:1x3x1026x1282 --loadEngine=fcn-resnet101.engine</code> Where –shapes sets the input sizes for the dynamic shaped inputs to be used for inference.</li>
<li>(good) <code>trtexec --loadEngine=my_model.trt --dumpProfile=1</code>推理时显示每层耗时</li>
<li>(good) <code>trtexec --loadEngine=my_model.trt --dumpProfile=1 --exportProfile=profile.json</code>推理时显示每层耗时</li>
<li>对 profile.json 进行排序</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 JSON 文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;profile.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    data = json.load(file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查文件结构</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(data))  <span class="comment"># 确保数据是一个列表</span></span><br><span class="line"><span class="built_in">print</span>(data[<span class="number">0</span>])     <span class="comment"># 查看第一个元素的结构</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据 &#x27;percentage&#x27; 字段进行排序</span></span><br><span class="line">sorted_data = <span class="built_in">sorted</span>(data, key=<span class="keyword">lambda</span> x: x.get(<span class="string">&#x27;percentage&#x27;</span>, <span class="number">0</span>), reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印排序后的数据</span></span><br><span class="line"><span class="comment"># for entry in sorted_data:</span></span><br><span class="line">    <span class="comment"># print(f&quot;Name: &#123;entry.get(&#x27;name&#x27;)&#125;, Percentage: &#123;entry.get(&#x27;percentage&#x27;)&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选：将排序后的数据写入新的 JSON 文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sorted_profile.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    json.dump(sorted_data, file, indent=<span class="number">4</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="python-推理"><a href="#python-推理" class="headerlink" title="python 推理"></a>python 推理</h4><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/onnx/onnx-tensorrt?tab=readme-ov-file#executable-usage">onnx-tensorrt 来推理 onnx 模型</a><ul>
<li>需要本地先 build 再 install</li>
<li>onnx-tensorrt 与 polygraphy python 接口类似，不需要使用管理显存，但 onnx-tensorrt 需要依赖 pycuda</li>
</ul>
</li>
<li>需要 pycuda</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH&#125;:/usr/local/cuda/lib64</span><br><span class="line">export CPATH=$CPATH:/usr/local/cuda/include/</span><br><span class="line">export PATH=$&#123;PATH&#125;:/usr/local/cuda/bin</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pycuda</span><br></pre></td></tr></table></figure>

<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/container-release-notes/index.html#pullcontainer">官方 docker</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#troubleshooting">troubleshooting</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/index.html">tensorrt docs</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/archives/index.html">各种版本 doc</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/release-notes/index.html">release notes</a> Ensure you are familiar with the NVIDIA TensorRT Release Notes for the latest new features and known issues.</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/blog/tensorrt-c-interface-cn/">官方 c++ sample 讲解</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/blog/search-posts/?q=tensorrt">官方博客</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/developer-guide/index.html#c_topics">c++ api</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/samples">官方 sample</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/wang-xinyu/tensorrtx">samples</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/release/7.1/samples/opensource/trtexec">trtexec</a></li>
<li><a target="_blank" rel="noopener" href="http://www.hpc.iitkgp.ac.in/pdfs/Nvidia-2.pdf">nvidia tensorrt pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/tree/main/plugin">plugins</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/main/quickstart/IntroNotebooks/5.%20Understanding%20TensorRT%20Runtimes.ipynb">Understanding TensorRT Runtimes</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cyrusbehr/tensorrt-cpp-api">c++ api 教程</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/blog/end-to-end-ai-for-nvidia-based-pcs-cuda-and-tensorrt-execution-providers-in-onnx-runtime/">基于 NVIDIA 的 PC 的端到端 AI ： ONNX Runtime 中的 CUDA 和 TensorRT 执行提供程序</a></li>
</ol>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/tensorrt/container-release-notes/index.html#pullcontainer">官方 docker</a><ul>
<li>docker 里有 tensorrt sample</li>
<li><code>docker pull nvcr.io/nvidia/tensorrt:24.02-py3</code></li>
<li><code>docker run -itd -v /home/xiyang.jia:/home/xiyang.jia -p 10086:22 --user root --gpus all --name=xiyang_cuda --shm-size 2g --cap-add=SYS_ADMIN nvcr.io/nvidia/tensorrt:22.07-py3</code> 注意加–cap-add&#x3D;SYS_ADMIN，ncu 收集 gpu metrics</li>
<li><code>docker exec -it xiyang_cuda  bash</code></li>
</ul>
</li>
</ol>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><ol>
<li><p>bevfusion 遇见的问题</p>
</li>
<li><p>onnx 转换使用心得</p>
</li>
</ol>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><ol>
<li>转换出现类型问题，可能需要对模型进行常量折叠 <code>polygraphy surgeon sanitize model.onnx --fold-constants -o folded.onnx</code></li>
<li>出现 trt fuse 问题先找到 python 代码，调试一下; 更改逻辑，去除 fuse 问题</li>
<li>nvrtc_compile.cpp:940: CHECK(false) failed. NVRTC Compilation failure [09&#x2F;07&#x2F;2024-16:07:22] [E] Error[10]: Could not find any implementation for node {ForeignNode[onnx::Where_4341…&#x2F;Div_8]}. Timing Runner: {ForeignNode[onnx::Where_3922…&#x2F;Transpose_9 + &#x2F;Reshape_49]} (Myelin[0x80000023])<ul>
<li>解决方法： 把 where 去掉</li>
<li><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/conversion-pytorch-to-tensorrt-fails-when-using-fp16-works-with-fp32-and-int8/285141">conversion-pytorch-to-tensorrt-fails-when-using-fp16-works-with-fp32-and-int8</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/issues/3154">Could not find any implementation for node Error while converting the instructor-large model from ONNX to TensorRT engine</a></li>
<li>并通过增加工作空间大小来解决 <a target="_blank" rel="noopener" href="https://github.com/onnx/onnx-tensorrt/issues/758#issuecomment-1095330781">link</a></li>
<li>更换 opset 版本</li>
<li>更换 trt 版本</li>
</ul>
</li>
<li><code>--workspace flag has been deprecated by --memPoolSize flag.</code></li>
<li>fp32 无问题，fp16 输出出现 inf; fp16 范围：±65504，判断 fp32 模型的中间结果是否会溢出<ul>
<li>可能是 inverse_sigmoid 问题， <code>1.0 / 1.0014e-05 = 99860.19572598363</code>越界</li>
<li>解决办法，pytorch 用 fp16 finetune 一下，pytorch 会处理？</li>
<li>为了避免 FP16 模型出现溢出问题，可以使用 PyTorch 的 AMP（自动混合精度）工具包，它能够自动选择 FP32 和 FP16 混合精度运算，减少数值溢出风险。</li>
<li>查找问题，pytorch 中 model.half()还需处理输入</li>
<li>使用 torch.cuda.amp.autocast 来进行 fp16 推理，vscode debug 来查找第一次出现 inf 时的地方</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># 使用 autocast 进行 FP16 推理</span></span><br><span class="line"><span class="keyword">with</span> torch.cuda.amp.autocast():</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():  <span class="comment"># 禁用梯度计算</span></span><br><span class="line">        output = model(input_data)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贾夕阳"
      src="/images/coder2.jpg">
  <p class="site-author-name" itemprop="name">贾夕阳</p>
  <div class="site-description" itemprop="description">深度学习/自动驾驶/C++/性能优化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">197</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaxiyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaxiyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2026/01/06/JIRA/" title="2026&#x2F;01&#x2F;06&#x2F;JIRA&#x2F;">JIRA</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/12/29/claude-code/" title="2025&#x2F;12&#x2F;29&#x2F;claude-code&#x2F;">Claude Code</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/08/20/AI-coding/" title="2025&#x2F;08&#x2F;20&#x2F;AI-coding&#x2F;">AI coding</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/04/28/Architecture/" title="2025&#x2F;04&#x2F;28&#x2F;Architecture&#x2F;">Computer Architecture</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/04/18/pytest/" title="2025&#x2F;04&#x2F;18&#x2F;pytest&#x2F;">pytest</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贾夕阳</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">633k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">9:35</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/26/2020 14:52:10");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://jiaxiyang.github.io/page/17/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'g32ipLmEye1u5l6wBGRJt03S-gzGzoHsz',
      appKey     : 'zHgLkAICsZUl9Mf8LfdoVigP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>





 
</body>
</html>

