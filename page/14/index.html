<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiaxiyang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiyang">
<meta property="og:url" content="https://jiaxiyang.github.io/page/14/index.html">
<meta property="og:site_name" content="Xiyang">
<meta property="og:description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="贾夕阳">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jiaxiyang.github.io/page/14/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiyang</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGS6S6YFJ6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WGS6S6YFJ6');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiyang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Think twice, code once!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">174</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">44</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiaxiyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/18/samba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/18/samba/" class="post-title-link" itemprop="url">samba</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-18 01:43:12" itemprop="dateCreated datePublished" datetime="2022-03-18T01:43:12+08:00">2022-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-28 13:13:37" itemprop="dateModified" datetime="2023-09-28T13:13:37+08:00">2023-09-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/18/samba/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/18/samba/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>481</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install samba</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line">[share]</span><br><span class="line">     path = /home/jiaxiyang/share</span><br><span class="line">     available = <span class="built_in">yes</span></span><br><span class="line">     valid <span class="built_in">users</span> = jiaxiyang</span><br><span class="line">     <span class="built_in">read</span> only = no</span><br><span class="line">     browsable = <span class="built_in">yes</span></span><br><span class="line">     public = <span class="built_in">yes</span></span><br><span class="line">     writable = <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h2 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd -<span class="selector-tag">a</span> jiaxiyang</span><br></pre></td></tr></table></figure>

<h2 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h2><h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d/samba restart</span><br><span class="line">sudo <span class="regexp">/etc/i</span>nit.d/smbd restart</span><br></pre></td></tr></table></figure>

<h3 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="params">system</span>ctl start smb.service</span><br><span class="line">sudo <span class="params">system</span>ctl restart smb</span><br></pre></td></tr></table></figure>

<h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><h3 id="ubuntu-1"><a href="#ubuntu-1" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount.cifs <span class="regexp">//</span><span class="number">10.10</span>.<span class="number">0.61</span><span class="regexp">/jiaxiyang/</span> samba_16 -o user=jiaxiyang</span><br></pre></td></tr></table></figure>

<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">映射网络驱动器</span><br><span class="line">\\ipaddr\share</span><br><span class="line"><span class="symbol">NOTE: </span>share is [share] in smb.conf</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/10/Cuda/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/10/Cuda/" class="post-title-link" itemprop="url">Cuda</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-10 02:17:38" itemprop="dateCreated datePublished" datetime="2022-03-10T02:17:38+08:00">2022-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-02-05 19:43:47" itemprop="dateModified" datetime="2024-02-05T19:43:47+08:00">2024-02-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Cuda/" itemprop="url" rel="index"><span itemprop="name">Cuda</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/10/Cuda/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/10/Cuda/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ol>
<li>NVIDIA GPU 的缓存行（cache line）大小一般是 128 字节。</li>
<li>gridDim 划分的是数据，blockDim 划分的是线程：例如: sgemm 分块矩阵乘</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N=M=<span class="number">1024</span>;</span><br><span class="line">BN=BM=<span class="number">128</span>, TN=TB=<span class="number">8</span>;</span><br><span class="line">    <span class="function">dim3 <span class="title">blockDim</span><span class="params">(BN / TN, BM / TM)</span></span>;  <span class="comment">// block 按线程分为 16x16 thread,threadDim=(16, 16) 每个线程处理8x8数据; x维度是列，y维度是行;</span></span><br><span class="line"><span class="function">dim3 <span class="title">gridDim</span><span class="params">((N + BN - <span class="number">1</span>) / BN, (M + BM - <span class="number">1</span>) / BM)</span></span>; <span class="comment">// grid 按数据分为 8x8 block, blockDim=(8, 8)</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>GPU通过计算而不是深度缓存层次结构来隐藏访存延迟</code><ul>
<li>当数据访存的时候，就让 warp stall，而后再选一个 warp 进行计算，通过这种方式交错开计算和访存，让访存单元一直忙碌，带宽打满。计算延迟的时候也会让 warp stall</li>
</ul>
</li>
<li>并发的 warp 切换没有开销，因为每个 warp 都分配了硬件资源<ul>
<li>不需要上下文切换</li>
<li>以空间换时间</li>
</ul>
</li>
<li>gpu sram 带宽为什么比主存大很多：<ul>
<li>并行，多个 SM 访问 shared memory， 如有 80 个 sm，每个 sm4 个 partition， 每个 shared memory 有 32 个 bank， 等效位宽为：<code>80*4*32*8 = 81920</code>, hbm 位宽为 8192， 带宽为 1.5TB&#x2F;s, sram 为 19TB&#x2F;s</li>
<li>shared memory 带宽：<code>2(?) * freq * 32(banks) * 8/8 *4(sm partion) * 80(sm num)</code></li>
</ul>
</li>
<li><code>kernel融合主要是使用sram来减少对显存的访问，注意不是device和host数据搬移</code> 也会减少调度开销</li>
<li>kernel 在编译的时候需要明确 block grid size 吗？不需要， 这些参数通常在运行时通过 CUDA 内核启动语法指定，这提供了更高的灵活性和动态调整的可能性。</li>
<li>nvcc 在翻译单元的顶部隐式包含了 cuda_runtime.h 。</li>
<li>核函数 K（kernel function）就是指 K(x, y) &#x3D; ，其中 x 和 y 是 n 维的输入值，f(·) 是从 n 维到 m 维的映射（通常而言，m&gt;&gt;n）。是 x 和 y 的内积（inner product），严格来说 应该叫欧式空间的标准内积，也就是很多人常说的点积（dot product）。</li>
<li><code>sudo update-alternatives --display cuda</code>显示系统 cuda 版本</li>
<li><code>export PATH=/usr/local/cuda/bin/:$&#123;PATH&#125;</code>找不到 nvcc 可能需要 export PATH</li>
<li><code>sudo apt install -y nvidia-cuda-toolkit</code> 安装 cuda 工具链, 不能乱用，需要和系统 cuda 匹配</li>
<li>在 CUDA 中，你会以类似于 C&#x2F;C++函数的形式来表达想要在 GPU 上运行的计算，这个函数被称为 kernel。</li>
<li>GPU 函数耗时统计不能只记录一次的，GPU 可能做一些准备工作，教训： nppiResize_8u_C3R 不管大小第一次运行耗时都很大 The cuda context is lazily initialized</li>
<li><code>autotuning</code> 搜索 kernel grid 划分参数(结果不变)，找性能最优</li>
<li>L1 和 shared memory 共享一块存储 可动态分配比例; 可用比例见<a target="_blank" rel="noopener" href="https://www.nvidia.com/content/PDF/nvidia-ampere-ga-102-gpu-architecture-whitepaper-v2.pdf">link</a></li>
<li>warp 调度:延时隐藏 只执行 warp 一部分 当 warp 需要等待时 先执行其他 warp</li>
<li>shared memory 和 register 是 SM 中的稀缺资源.</li>
<li>warp 执行类似 simd</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-hw-model">Hardware Model</a><ul>
<li>对 sm 介绍比较好</li>
<li>Each SM is partitioned into four processing blocks, called SM sub partitions.</li>
<li>一个 SM 又可以由若干个 SMP（SM Partition）组成</li>
<li>A warp is allocated to a sub partition and resides on the sub partition from launch to completion. warp 被分配给子分区，并且从启动到完成都驻留在子分区上。</li>
</ul>
</li>
<li><code>FMA (Fused Multiply Add)</code>: z&#x3D;a*x+y …z,x,y are vectors or scalars</li>
<li><code>4FMA (Quad FMA)</code>: z&#x3D;A*x+z …A is a FP32 matrix; x,z are vectors</li>
<li><code>WMMA: Warp-level Matrix Mulitply and Accumulate (Tensor Core)</code>: Z&#x3D;AB+C …A,B are FP16 matrices; Z,C are FP32</li>
<li>global memory -&gt; shared memory 时，计算每个线程需要搬移的数据量。假如每个线程要搬移 A，B 矩阵为 4 个 single float point, 4x4 &#x3D; 16B<ul>
<li>A_tile（128,8): 256 个线程， 每个线程搬移 4 个数，每行由 2 个线程处理， 假如线程一维索引为 tid； 行 m &#x3D; tid &#x2F; 2 &#x3D; tid &gt;&gt; 1; 列 k &#x3D; (tid % 2) x 4 &#x3D; (tid &amp; 1) &lt;&lt; 2</li>
<li>B_tile（8,128): 256 个线程， 每个线程搬移 4 个数，每行由 32 个线程处理， 假如线程一维索引为 tid； 行 k &#x3D; tid &#x2F; 32 &#x3D; tid &gt;&gt; 5; 列 n &#x3D; (tid % 32) x 4 &#x3D; (tid &amp; 31) &lt;&lt; 2</li>
</ul>
</li>
<li>load&#x2F;store 关键点在行列索引(分别计算各 tile 维度的 m, n, k)， 通过行列可以找到起始地址。<code>#define OFFSET(row, col, ld) ((row) * (ld) + (col))</code></li>
<li>load&#x2F;store memory 的时候先通过行列坐标找到 global 起始点，然后再算偏移，用宏定义来访问矩阵，先找最外层的 tile，再找里层的 tile。</li>
<li>sgemm 分块 A 矩阵 global 到 shared load 时，shared memory 需要列优先排列，一次 load 四个数都寄存器，然后再分别赋值给列。</li>
<li>shred memory double buffering: 在 for 循环里只用 sync 一次<ul>
<li>load tile[0] 到 buffer[0]; sync</li>
<li>for: load tile[i]; compute tile[i-1]; sync</li>
<li>comute tile[-1]; sync</li>
</ul>
</li>
<li>wave 的概念：wave 表示 GPU 上同时执行的 thread block。例如一个 kernel 中 thread block 为 256 线程，每个线程使用了 128 个寄存器，那么在 GV100 上每个 SM 可同时执行 2 个 thread block，GV100 共 80 个 SM，一个 wave 就是 160 个 thread block。</li>
<li>cuda 遵循 IEEE 754 standard for binary floating-point representation； 由于融合和乘加， 其结果与分别乘加结果略有不同 <a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-best-practices-guide/index.html#ieee-754-compliance">ieee-754-compliance</a><ul>
<li>One of the key differences is the fused multiply-add (FMA) instruction, which combines multiply-add operations into a single instruction execution. <code>Its result will often differ slightly from results obtained by doing the two operations separately.</code></li>
</ul>
</li>
<li>每个浮点算术运算都涉及一定量的舍入。因此，算术运算的执行顺序很重要。如果 A、B 和 C 是浮点值，则 (A+B)+C 不能保证等于 A+(B+C)</li>
<li>我们可以将 CUDA 内核编写为许多短 <code>__device__</code> 函数的集合，而不是一个大型的整体 <code>__global__</code> 函数；每个设备功能可以在将它们连接在一起之前进行独立测试。</li>
<li>如果大多数函数都定义为 <code>__host__ __device__</code> 而不仅仅是 <code>__device__</code> 函数，那么这些函数就可以在 CPU 和 GPU 上进行测试，</li>
<li><code>local memory</code>之所以如此命名，是因为它的作用域是线程本地的，而不是因为它的物理位置。事实上，本地存储器位于片外。因此，访问本地内存与访问全局内存一样昂贵。换句话说，名称中的“本地”一词并不意味着访问速度更快。本地内存仅用于保存自动变量。当 nvcc 编译器确定没有足够的寄存器空间来保存变量时，就会执行此操作。可能放置在本地内存中的自动变量是大型结构或数组，它们会消耗太多寄存器空间，并且编译器确定可以动态索引的数组。</li>
<li><code>constent memory</code></li>
<li><code>The NVIDIA Management Library (NVML)</code> is a C-based interface that provides direct access to the queries and commands exposed via nvidia-smi intended as a platform for building 3rd-party system management applications.</li>
<li>可以通过 CUDA_VISIBLE_DEVICES 环境变量重新排列已安装的 CUDA 设备的集合; <code>CUDA_VISIBLE_DEVICES=0,2,1,3</code></li>
<li>Starting with CUDA 11.0, devices of compute capability 8.0 and above have the capability to influence persistence of data in the L2 cache, potentially providing higher bandwidth and lower latency accesses to global memory.</li>
<li>从 Hopper 开始，CUTLASS 3.0 将 Warp Specialization 的概念纳入了内核设计的一部分。线程块被划分为两组 warp，生产者 warp 组和消费者 warp 组。生产者 warp 组使用新的张量内存加速器（TMA）将数据从全局内存加载到共享内存缓冲区中。<a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cutlass/blob/main/media/docs/efficient_gemm.md#warp-specialization">link</a></li>
<li>TMA 可以异步一次 load 大块数据到 shared memory， ampere 一次最多只能 load 128 bit 数据(指令限制)</li>
<li>想象 shared memory 和 register 是二维的<ul>
<li>shared memory: <code>smem[n][32]</code></li>
<li>register: <code>re[n][4]</code></li>
</ul>
</li>
<li>虽然 block 可以划分为二维 thread, 单调度时按一维调度，每 32 个一个 warp</li>
</ol>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><ol>
<li>分析计算部件停顿的原因。</li>
<li>主要由下列因素决定：<ul>
<li>算力(peak)</li>
<li>带宽(peak)</li>
<li>指令和访存延迟</li>
</ul>
</li>
<li>性能 roofline bound 是满流水线时分析，一直忙; 指令和访存延迟会使得处理器空闲</li>
<li>一直忙条件：<code>warp 数量 = 延迟 x 吞吐</code>, 如：延迟 20 cycle; SM 吞吐为 64 fma 每 cycle；SM warp 数量为： 20 x 64 &#x2F; 32 &#x3D; 40</li>
<li>Use peak performance metrics to guide optimization</li>
<li>Optimize your algorithm, then unroll loops</li>
<li>Use template parameters to generate optimal code</li>
<li>bandwidth(带宽)和 throughput(吞吐)区别：<ul>
<li>bandwitdh: 理论最大吞吐</li>
<li>throughput: 实际吞吐</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/GTC/PDF/1083_Wang.pdf">Fundamental Optimizations in CUDA</a></li>
</ol>
<h3 id="papers"><a href="#papers" class="headerlink" title="papers"></a>papers</h3><ol>
<li><a target="_blank" rel="noopener" href="http://impact.crhc.illinois.edu/shared/papers/optimization2008.pdf">Optimization Principles and Application Performance Evaluation</a></li>
</ol>
<h3 id="cuda-performance-guidelines"><a href="#cuda-performance-guidelines" class="headerlink" title="cuda performance-guidelines"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#performance-guidelines">cuda performance-guidelines</a></h3><ol>
<li><code>整体优化策略</code> Overall Performance Optimization Strategies；Performance optimization revolves around four basic strategies:<ul>
<li>Maximize parallel execution to achieve maximum utilization; 最大化并行执行以达到最大利用率；</li>
<li>Optimize memory usage to achieve maximum memory throughput; 优化存储使用，实现最大存储吞吐量；</li>
<li>Optimize instruction usage to achieve maximum instruction throughput; 优化指令使用，实现最大指令吞吐量；</li>
<li>Minimize memory thrashing. 最大限度地减少内存抖动。(减少内存申请释放频率)</li>
</ul>
</li>
<li>Which strategies will yield the best performance gain for a particular portion of an application depends on the performance limiters for that portion;根据情况使用哪种策略，比如 reduction 时受 memory bound，因此我们应该争取峰值带宽</li>
<li>compute-bound 需要争取达到最大算力，memory bound 需要争取达到最大带宽</li>
</ol>
<h3 id="优化技术"><a href="#优化技术" class="headerlink" title="优化技术"></a>优化技术</h3><ol>
<li>memory coalescing</li>
<li>swizzle</li>
<li>bank conflict</li>
</ol>
<h3 id="访存优化"><a href="#访存优化" class="headerlink" title="访存优化"></a>访存优化</h3><ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/600489819">漫谈高性能计算与性能优化：访存</a></li>
<li>访存优化是第一性原理</li>
<li>当我们在说访存优化的时候，我们具体需要做些什么。总的来说，就是三板斧。<ul>
<li>减少数据搬运<ul>
<li>如何减少数据搬运，最主要的手段就是分块，或者说 tiling。</li>
<li>要尽可能地保证数据连续访问，其中最主要的一个原因就是提高 cache 命中率，从而避免不必要的数据搬运</li>
</ul>
</li>
<li>减少数据访存延时(数据搬运确定)<ul>
<li>减少 bank 冲突</li>
<li>pipeline (double buffer, 预取)</li>
<li>就是切分更多的块，启动更多的 warp 来掩盖访存延时。</li>
</ul>
</li>
<li>保证负载均衡。<ul>
<li>关于负载均衡的话题，主要是在 sparse 里面谈的比较多</li>
</ul>
</li>
</ul>
</li>
<li>如果发现实际带宽比较差，数据搬运效率比较低，这个时候就要去思考，是不是可以有办法，通过分块的一些技巧来减少数据搬运。如果数据搬运不能够再减少了的话，是否可以通过一些方式来提高数据的搬运效率，比如向量化访存、合并访问来提高对 DRAM 的访存性能、避免 bank 冲突来提高对 shared memory 的访存性能、调整分块大小来让更多的 warp 跑起来从而减少访存的延时，如果不是 SIMT 架构，就需要精细地设计各级访存的 pipeline，让访存操作尽可能地 pingpong 起来，从而让访存流水尽可能地连续起来不要被打断。理论大概是这样，但是每一个问题都有着不同的处理方式，每一个问题可能都是不同的瓶颈。总之就是万变不离其宗，准确地评估每一级存储的访存效率然后尽可能地提高每一级的访存效率，尽可能地把访存流水打满，不要有空跑。</li>
<li>其实所谓“加速”或者“性能优化”的本质就是让软件充分利用计算硬件，提升利用率，从而逼近理论性能上限。从这个角度，“通用方法”就是：<code>分析计算部件停顿的原因-选择合理的计算模型减少数据依赖和对流水线的破坏(能兼顾缓解访存墙更好)-通过专用硬件或者结构优化消除剩下的瓶颈，然后不断迭代上述过程，直至各方面因素达到平衡</code>。</li>
<li>cuda gemm 为什么是三级分块，不是四级或者两级。因为 NV 的 GPU 内存结构是三级的，global mem-&gt;shared mem，shared mem-&gt;register。</li>
</ol>
<h3 id="reduction-优化"><a href="#reduction-优化" class="headerlink" title="reduction 优化"></a>reduction 优化</h3><ol>
<li>(great)<a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/assets/cuda/files/reduction.pdf">Optimizing Parallel Reduction in CUDA</a><ul>
<li>Memory coalescing</li>
<li>Divergent branching</li>
<li>Bank conflicts</li>
<li>Latency hiding</li>
</ul>
</li>
<li><code>What is Our Optimization Goal?</code> 先确定最大目标 We should strive to reach GPU peak performance Choose the right metric:<ul>
<li>GFLOP&#x2F;s: for compute-bound kernels</li>
<li>Bandwidth: for memory-bound kernels</li>
</ul>
</li>
<li>通过不断迭代优化，从而达到硬件最优性能。</li>
<li>Reductions have very low arithmetic intensity; Therefore we should strive for <code>peak bandwidth</code></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/426978026">中文解析</a></li>
</ol>
<h3 id="elementwise-优化"><a href="#elementwise-优化" class="headerlink" title="elementwise 优化"></a>elementwise 优化</h3><ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/488601925">elementwise 优化</a></li>
</ol>
<h2 id="NVCC"><a href="#NVCC" class="headerlink" title="NVCC"></a>NVCC</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html">NVIDIA CUDA Compiler Driver NVCC</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#supported-input-file-suffixes">编译过程中各类型文件作用说明</a></li>
<li><a target="_blank" rel="noopener" href="https://www.linmao.dev/joy/1165/">CUDA 编译过程</a></li>
</ol>
<h2 id="PTX-Parallel-Thread-Execution"><a href="#PTX-Parallel-Thread-Execution" class="headerlink" title="PTX(Parallel Thread Execution)"></a>PTX(Parallel Thread Execution)</h2><ol>
<li>a low-level parallel thread execution virtual machine and instruction set architecture (ISA)</li>
<li>PTX 是上承 GPU 编程语言 CUDA C++，下启 GPU 硬件 SASS 指令，可以借助 NVRTC 实现运行时优化，某些层面上来说可以称之为 GPU 设备无关代码，因此 PTX 可以理解为<code>CUDA IR</code></li>
<li>PTX 独立于特定 GPU 架构,可以重用相同的代码适用于不同的 GPU 架构,相当于前端</li>
<li>使用虚拟架构生成 PTX 中间文件，虚拟框架由<code>compute_</code>开头。虚拟架构通常是从大的 GPU 代上控制的，真实框架必须大于等于虚拟框架，真实框架对应真正运行的 GPU，即编译阶段就确定要运行的 GPU 是什么。真实框架由<code>sm_</code>开头。</li>
<li><code>nvcc -ptx program.cu -o _program.ptx -arch=sm_86</code></li>
<li><code>cat program.ptx | cu++filt &gt; program_demangle.ptx</code> demangle ptx</li>
</ol>
<h2 id="SASS-Shader-Assembly"><a href="#SASS-Shader-Assembly" class="headerlink" title="SASS(Shader-Assembly)"></a>SASS(Shader-Assembly)</h2><ol>
<li>真正的机器汇编，由 cubin 文件经过 cuobjdump 工具转换而来。目前没有官方的 sass to cubin 的工具。</li>
<li>cuobjdump 可以用来分析 cubin 文件和 host 文件。而 nvdisasm 只能用来分析 cubin 文件，但是可以得到更多的输出信息。我用的比较多的是 nvdisasm。用来看代码的控制流图。</li>
<li>只有官方反汇编器，没有官方汇编器</li>
<li>generate</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ptxas -arch=sm_86 mma_gemm_demangle.ptx -o mma_gemm.cubin</span><br><span class="line">cuobjdump -sass mma_gemm.cubin &gt; mma_gemm.sass</span><br></pre></td></tr></table></figure>

<h2 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h2><ol>
<li><code>block level</code>: <code>__syncthreads()</code></li>
<li><code>grid level</code>: <code>__threadfence()</code></li>
<li><code>stream level</code>: <code>cudaStreamSynchronize(cudaStream_t stream)</code><ul>
<li>这个函数会阻塞 CPU 线程，直到特定的 CUDA stream 中的所有操作完成。</li>
</ul>
</li>
<li><code>device level</code>: <code>cudaDeviceSynchronize()</code></li>
</ol>
<h2 id="bank-conflict"><a href="#bank-conflict" class="headerlink" title="bank conflict"></a>bank conflict</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/3842483/23011500">概念</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bank    |      1      |      2      |      3      |     ...     |      16     |</span><br><span class="line">Address |  0  1  2  3 |  4  5  6  7 |  8  9 10 11 |     ...     | 60 61 62 63 |</span><br><span class="line">Address | 64 65 66 67 | 68 69 70 71 | 72 73 74 75 |     ...     |     ...     |</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol>
<li>Each bank has a bandwidth of 32 bits per clock cycle</li>
<li>shared memory 一次不冲突只能读 32x4B， 看一次读取的数据量，多于 32x4B 需要读取多次 n&#x2F;(32x4)，只要在 n&#x2F;(32x4) 次内读完就是最高效的。</li>
<li>使用 float4 类型访存，用向量化的 LDG.128 和 STG.128 指令一次读 4 个元素，以减少访存指令数， 提高计算访存比</li>
<li>thread tile 时如果 TM 是 8，一个 warp 需要读 32*8 个 TM 的数(shared memory 上)，至少需要 8 次(如果有 32 个 bank)<ul>
<li>如果一个线程一次处理 8 个连续的数，一个 warp 一次只有 4 个线程不 bank 冲突，<ul>
<li>如果一个线程 1 次读 1 个数，一个 warp 一次只读 4 个数， 需要 64 次读完，</li>
<li>如果一个线程一次读 4 个数，一个 warp 一次读 16 个数， 需要读 16 次，</li>
<li>如果一个线程一次读 8 个数，一个 warp 一次读 32 个数，需要读 8 次（最优），但不存在一次读 8 个数的指令。</li>
</ul>
</li>
<li>如果一个线程一次操作 4 个连续的数(处理两个在空间上属于同一 bank 的数)， 那么一个 warp 一次有 8 个线程 bank 不冲突， 一次操作 4*8 个数， 需要 8 次能读完。与 bank 不冲突等效。</li>
</ul>
</li>
</ol>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ol>
<li><code>__restrict__</code> 用于限定指针,表示该指针是唯一访问目标内存的途径。可以避免出现不同指针引用同一内存区域的情况,编译器可以更自由地进行优化。这意味着编译器可以假设这个指针没有别名（alias），即没有其他指针指向相同的内存位置。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">myKernel</span><span class="params">(<span class="type">float</span>* __restrict__ ptrA, <span class="type">float</span>* __restrict__ ptrB, <span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 内核代码，假设 ptrA 和 ptrB 指向不重叠的内存区域</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="occupancy-设计"><a href="#occupancy-设计" class="headerlink" title="occupancy 设计"></a>occupancy 设计</h2><ol>
<li>(重要) <code>最理想的情况下为 sm max threads 个 thread 都分配资源，占用率 100%， 但受限于 Max warps or max blocks per SM, registers per SM, shared memory per SM, register, 占用率可能不到 100%</code></li>
<li>想得到令人满意的 GPU 性能<code>关键是找到合适的group size与资源的平衡点</code></li>
<li><code>--ptxas-options=-v</code> or <code>-Xptxas -v</code> or <code>--resource-usage</code> 加上编译选项， 显示 register， shared memory 使用<ul>
<li><code>nvcc  -Xptxas=&quot;-v&quot; --ptxas-options=-v -O3 -o my_sgemm my_sgemm.cu -lcublas  2&gt;&amp;1 | c++filt</code> demangle</li>
</ul>
</li>
<li>nishgt compute 里 occupancy 有详细显示</li>
<li><a target="_blank" rel="noopener" href="https://xmartlabs.github.io/cuda-calculator/">cuda-calculator</a> 填入数值，计算 occupancy</li>
<li>注意 shared memory 是动态配置的，可以尝试改变 shared memory 大小来提升性能</li>
</ol>
<h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><ol>
<li>stream 主要为了隐藏 host device 之间数据搬移的延迟，不是内存和计算</li>
<li>CUDA 流表示一个 GPU 操作队列，该队列中的操作将以添加到流中的先后顺序而依次执行。</li>
<li>stream 作用：在 Stream 的帮助下，CUDA 程序可以有效地将内存读取和数值运算并行，从而提升数据的吞吐量。 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/51402722">link</a><br>由于 GPU 和 CPU 不能直接读取对方的内存，CUDA 程序一般会有一下三个步骤：1）将数据从 CPU 内存转移到 GPU 内存，2）GPU 进行运算并将结果保存在 GPU 内存，3）将结果从 GPU 内存拷贝到 CPU 内存。</li>
<li>cuda7 可以开启每个线程有一个默认 stream, 之前每个设备有一个 stream <a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/blog/gpu-pro-tip-cuda-7-streams-simplify-concurrency/">gpu-pro-tip-cuda-7-streams-simplify-concurrency&#x2F;</a><ul>
<li><code>nvcc --default-stream per-thread ./pthread_test.cu -o pthreads_per_thread</code>需要加编译选项</li>
</ul>
</li>
</ol>
<h2 id="cuda-grammer"><a href="#cuda-grammer" class="headerlink" title="cuda grammer"></a>cuda grammer</h2><ol>
<li>所有的 kernel 函数返回类型都是 void</li>
<li><code>&lt;&lt;&lt; M , T &gt;&gt;&gt;</code> Which indicate that a kernel launches with a grid of M thread blocks. Each thread block has T parallel threads.</li>
<li><code>vectorAdd&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;</code></li>
<li>可以认为 M, T 对应图片的 H, W; 一个 thread 对应一个像素点；一个 block 对应一行，一个 grid 对应一张图片</li>
<li><code>int tid = blockIdx.x * blockDim.x + threadIdx.x; =&gt; int index = h * W + w;</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/blob/master/Common/helper_cuda.h#L595">checkCudaErrors</a> helper_cuda.h</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(T result, <span class="type">char</span> <span class="type">const</span> *<span class="type">const</span> func, <span class="type">const</span> <span class="type">char</span> *<span class="type">const</span> file,</span></span></span><br><span class="line"><span class="params"><span class="function">           <span class="type">int</span> <span class="type">const</span> line)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;CUDA error at %s:%d code=%d(%s) \&quot;%s\&quot; \n&quot;</span>, file, line,</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;(result), _cudaGetErrorEnum(result), func);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will output the proper CUDA error strings in the event</span></span><br><span class="line"><span class="comment">// that a CUDA host call returns an error</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> checkCudaErrors(val) check((val), #val, __FILE__, __LINE__)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>cutil.h NVIDIA 公司在 CUDA5 之后便不再使用 cutil.h <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/blob/master/Samples/2_Concepts_and_Techniques/EGLSync_CUDAEvent_Interop/EGLSync_CUDAEvent_Interop.cu#L83">CUDA_SAFE_CALL </a></li>
<li><a target="_blank" rel="noopener" href="https://bohipat.wordpress.com/2014/07/11/replacing-cutil-in-cuda-5-0/">replacing-cutil-in-cuda-5-0</a></li>
</ol>
<h2 id="tensor-core"><a href="#tensor-core" class="headerlink" title="tensor core"></a>tensor core</h2><ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/620185229">4 种 tensor core 调用方法</a><ul>
<li>WMMA (Warp-level Matrix Multiply Accumulate) API</li>
<li>WMMA PTX (Parallel Thread Execution)</li>
<li>MMA (Matrix Multiply Accumulate) PTX</li>
<li>SASS</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/en-us/data-center/tensor-cores/">tensor-cores</a></li>
<li><code>--set roofline</code>能看到 tensor core roofline; 例如运行<code>cuda-samples/Samples/3_CUDA_Features/cudaTensorCoreGemm</code></li>
<li>cuda-samples&#x2F;Samples&#x2F;3_CUDA_Features 包含多个 tensor core 实例</li>
<li><code>Samples/3_CUDA_Features/cudaTensorCoreGemm</code>比<code>Samples/0_Introduction/matrixMul</code> 计算性能高很多<ul>
<li>cudaTensorCoreGemm 测试的是 fp16 性能</li>
</ul>
</li>
<li>cublas 满足特定条件才会使用 tensor core <a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cublas/index.html#tensor-core-usage">link</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html#requirements-tc">Tensor Core Requirements</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1893665">FP32 vs TF32</a><ul>
<li>tf32 整数部分精度与 fp32 相同，小数部分与 fp16 相同， 只用了 19 位</li>
<li>包含 Amphere 架构性能</li>
</ul>
</li>
</ol>
<h2 id="wmma-vs-mma"><a href="#wmma-vs-mma" class="headerlink" title="wmma vs mma"></a>wmma vs mma</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#warp-level-matrix-multiply-accumulate-instructions">warp-level-matrix-multiply-accumulate-instructions</a></li>
</ol>
<h3 id="tenosr-core-和-cuda-core"><a href="#tenosr-core-和-cuda-core" class="headerlink" title="tenosr core 和 cuda core"></a>tenosr core 和 cuda core</h3><ol>
<li>计算层级：CUDA Core 是线程级别，Tensor Core 是 warp 级别</li>
<li>计算维度：CUDA Core 是一维逐点计算，Tensor Core 是二维逐 tile 计算</li>
<li>CUDA Core 是为通用计算设计，而 Tensor Core 是为特定类型的计算（主要是深度学习中的矩阵运算）优化。</li>
<li>在 NVIDIA 的某些 GPU 架构中，例如 Volta、Turing 和 Ampere，CUDA Core 和 Tensor Core 共同存在。它们可以根据计算任务的性质协同工作，提高整体的计算效率。</li>
<li>在执行深度学习任务时，Tensor Core 可以显著加速计算过程，相较于仅使用 CUDA Core，能实现更快的训练和推理速度。</li>
<li>RT core 用于光线追踪</li>
<li>芯片手册中有 cuda core 算力和 tensor core 算力</li>
<li>利用 tensor core 才能达到最大算力</li>
</ol>
<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#application-compatibility">application-compatibility</a></li>
<li><code>-arch=sm_70</code> is a shorthand for <code>-arch=compute_70 -code=compute_70,sm_70</code> (which is the same as <code>-gencode arch=compute_70,code=\&quot;compute_70,sm_70\&quot;</code>)</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-gpus">Your GPU Compute Capability</a> 包含各种 gpu arch</li>
</ol>
<h2 id="cuda-samples"><a href="#cuda-samples" class="headerlink" title="cuda samples"></a><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples">cuda samples</a></h2><ol>
<li>可以全部 sample 一起编译</li>
<li><code>make SMS=&quot;86&quot;</code>选择 arch</li>
<li><code>make dbg=1</code> debug 编译</li>
<li><code>Samples/1_Utilities/bandwidthTest</code> 可以查看 host &lt;-&gt; memory 之间传输速度</li>
<li>(good)<code>Samples/1_Utilities/deviceQuery</code> 可以查看设备信息, 包含 arch 信息, 多少 sm，每个 sm 多少 cuda core</li>
<li>11.6 之后代码放在 github 上</li>
<li><a target="_blank" rel="noopener" href="https://cuda-tutorial.readthedocs.io/en/latest/tutorials/tutorial01/">hello world</a></li>
<li><code>/usr/local/cuda-11.4/samples</code> tree -L 2</li>
<li><code>/usr/local/cuda-10.2/samples/0_Simple/vectorAdd</code></li>
<li><code>nvprof ./vectorAdd</code> 查看 kenerl 耗时</li>
</ol>
<h2 id="CUDALibrarySamples"><a href="#CUDALibrarySamples" class="headerlink" title="CUDALibrarySamples"></a><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples">CUDALibrarySamples</a></h2><ol>
<li>cublas</li>
<li>cutlass</li>
<li>npp</li>
</ol>
<h3 id="cuda-info"><a href="#cuda-info" class="headerlink" title="cuda info"></a>cuda info</h3><ol>
<li><a target="_blank" rel="noopener" href="https://linuxconfig.org/how-to-get-cuda-cores-count-on-linux">查看 cuda core</a><br><code>cd /usr/local/cuda-11.4/samples/1_Utilities/deviceQuery &amp;&amp; make &amp;&amp; ./deviceQuery</code></li>
<li>bandwith test<br><code>cd /usr/local/cuda-11.4/samples/1_Utilities/bandwidthTest &amp;&amp; make &amp;&amp; ./bandwidthTest</code></li>
</ol>
<h2 id="NVIDIA-Developer-Tools"><a href="#NVIDIA-Developer-Tools" class="headerlink" title="NVIDIA Developer Tools"></a><a target="_blank" rel="noopener" href="https://developer.nvidia.com/tools-overview">NVIDIA Developer Tools</a></h2><ol>
<li>各工具关系<br><img src="https://i.ibb.co/2qN87rv/QVJcq2r-QQ3.png" alt="tools"></li>
</ol>
<h3 id="nsight-system"><a href="#nsight-system" class="headerlink" title="nsight system"></a>nsight system</h3><ol>
<li>profiling 可以简单地分为粗粒度和细粒度。粗粒度主要是判断瓶颈是不是在 GPU 上，具体又是哪个 kernel，典型代表就是 nsight system 工具，会显示出整个程序的 timeline。可以从 timeline 上直接清晰明了地看到瓶颈是在 CPU 还是 GPU，如果是 GPU，那又是在 GPU 的哪个 kernel 上。</li>
<li>如果是 timeline 中 GPU kernel 的占比很小，CPU 占比很大，那说明瓶颈在 CPU 侧，需要注意是不是数据读取花了太多时间。如果 GPU kernel 的占比很大，说明瓶颈在 GPU 侧，需要重点花精力去优化 GPU kernel 实现。还有一种情况是，如果数据一直放在 GPU 上，但是 kernel 的时间占比不是特别多，那可能是因为 kernel 本身不太耗时，可能只运行了 4us。但 kernel lauch 就花了 6us。这个时间就要想着采用 kernel fusion 的方式，尽可能地在一个 kernel 里面多干点活。</li>
<li>点击时注意竖线上的小三角号, 表示关联</li>
<li>从结果分析看多个 stream 下 kernel 可以同时运行<ul>
<li>all stream 或者 kernels 显示不出所有的 kernel 运行，起始位置被其他 kernel 覆盖的检测不出来</li>
<li>all stream 显示不出的 kernel 可能在被隐藏的 stream 里，鼠标放到 kernel 上能显示出在第几个 stream</li>
</ul>
</li>
<li>打开文件注意生成 log 时的错误</li>
<li>gui 可以远程 profiling， 将 nsys 安装到 target 机器, 类似 compute<ul>
<li><code>~/.local/share/nsight_systems/nsys</code>安装路径</li>
</ul>
</li>
<li>nsys profile 类似 perf record 来记录信息</li>
<li>nsys stats 类似 perf stats 来查看统计信息<ul>
<li><code>nsys stats report1.nsys-rep</code></li>
<li><code>nsys stats --report cuda_gpu_trace report1.nsys-rep</code></li>
</ul>
</li>
<li>gui summary 里可以看 log 具体执行命令</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html#cuda-trace">跟踪 cuda</a><ul>
<li><code>--trace=cuda</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html#gpu-metrics">可以收集 gpu-metrics</a><ul>
<li>Is my GPU idle?</li>
<li>Is my GPU full? Enough kernel grids size and streams? Are my SMs and warp slots full?</li>
<li>Am I using TensorCores?</li>
<li>Is my instruction rate high?</li>
<li>Am I possibly blocked on IO, or number of warps, etc</li>
</ul>
</li>
<li>分析系统性能</li>
<li><code>nvprof</code> 旧版本</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html">user guide</a></li>
<li>NsightSystems-2023.2.1.122-3259852.msi 安装包</li>
<li>Nsight_Systems_User_Guide_2023.2.1.122-3259852.pdf 文档</li>
<li>鼠标放到 kernel 上有 kernel 详细信息，<ul>
<li>包括执行时间</li>
<li>latency：launch latency, 与执行时间不一样，latency 是 api 调用到 kernel 开始执行时间<ul>
<li><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/nsys-timeline-end-start-is-not-the-same-as-latency/238043">NSys Timeline: End - Start is not the same as latency</a></li>
<li>CUDA kernel launch latency could be defined as the time range from the beginning of the launch API call to the beginning of the kernel execution.</li>
<li>执行的是 <code>cudaStreamSynchronize</code>, 没执行这个函数之前，stream 中的 kernel 不会 launch</li>
</ul>
</li>
<li>gird, block 设置;(注意，同一个 stream 下相同函数调用可能设置不一样导致时间不同)</li>
<li>一个线程用多少 register</li>
<li>理论 occupancy, 打开 gpu metrics 可以看对应的实际 occupancy</li>
<li>注意各种颜色</li>
</ul>
</li>
<li>可以在 thread 上看到 <code>cpu call stack</code><ul>
<li>每个线程对应行分层的最后一层 <code>sampling point</code></li>
<li>gpu 空闲时看 CPU 采样点 可以知道 CPU 在干啥</li>
<li>是否可以生成火焰图？</li>
</ul>
</li>
<li>timeline 上点击 stream 下的 tensorrt node， 可以显示对应的 kernel 执行和 cuda api 调用时间点, 注意竖线上的小三角号</li>
<li>tensorrt 多个维度来看<ul>
<li>thread</li>
<li>stream</li>
<li>cuda</li>
</ul>
</li>
<li>左上角 timeline view 可以选择 analysis summary，有各种总结</li>
<li>左侧右键选<code>show in events view</code>， 可以看具体时间, 可以在 all 上操作，看所有 event 运行时间</li>
<li>右键 reset room 显示全部</li>
<li><code>shift + mouseleftdoubleclick</code> timeline 可以找到对应 event 在 event view 位置</li>
<li><code>ctrl + mouseleftdoubleclick</code> timeline 可以 fit to screen</li>
<li><code>backspace</code> timeline 可以 undo room</li>
<li><code>ctrl + mouseleftdoubleclick</code> 可以找到 event view 对应的 timeline 位置</li>
<li><code>sudo nsys profile &lt;app&gt;</code></li>
<li><code>nsys stats report1.nsys-rep</code> 输出各种 report</li>
<li>可以看 cpu 执行情况， tensort 可以看详细算子耗时，也有对应 cuda 执行情况</li>
<li>analysis summary 中有各个线程的 cpu 利用率总结</li>
<li>可以关注 cpu 空闲的地方，为什么会空闲(同步数据？)</li>
<li>可以缩小看颜色占比，关注占比大的模块</li>
<li>cudaMemcpy 会阻塞 cpu 执行， 可以多注意 cudaMemcpy 影响</li>
<li>cudaStreamSynchronize 是 CUDA API 中的一个函数，用于等待指定的 CUDA 流上的所有 CUDA 核函数执行完毕。当 CUDA 核函数被执行时，它们会被添加到一个 CUDA 流中，这些核函数的执行可能是异步的，也可能是同步的，具体取决于如何在代码中调用它们。当我们调用 cudaStreamSynchronize 时，它将会阻塞当前 CPU 线程，直到指定的流上的所有核函数都执行完毕。</li>
</ol>
<h3 id="nsight-compute"><a href="#nsight-compute" class="headerlink" title="nsight compute"></a>nsight compute</h3><ol>
<li>有开销 <a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#overhead">overhead</a></li>
<li><code>metrics</code> 是指性能指标，这些指标用于衡量 CUDA 应用程序的性能和行为。性能指标可以包括各种硬件级别的统计数据，如内存访问效率、计算操作的执行时间、流处理器（SM）的利用率、寄存器使用情况、分支效率等等。</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/nvidia-development-tools-solutions-err_nvgpuctrperm-permission-issue-performance-counters">permission 问题</a><ul>
<li>可以增加临时权限</li>
</ul>
</li>
<li>分析 kernel 性能, 可以选 kernel</li>
<li>NVIDIA Nsight Compute is an interactive kernel profiler for CUDA applications. It provides detailed performance metrics and API debugging via a user interface and command line tool. In addition, its baseline feature allows users to compare results within the tool. NVIDIA Nsight Compute provides a customizable and data-driven user interface and metric collection and can be extended with analysis scripts for post-processing results.</li>
<li>需要 windows 客户端通过 connect 将 ncu 送到开发环境<ul>
<li>可以通过 activity 复制命令到板端执行</li>
<li>metrics 可以选择 Sets 和 rules</li>
</ul>
</li>
<li>profile -&gt; metrics details<ul>
<li>点击统计界面某个 metrics 可以看 metrics 详细信息</li>
</ul>
</li>
<li><code>ncu --replay-mode application --set full  ./preprocess</code> 详细信息显示到命令行<ul>
<li>Duration 为 kernel 执行时间</li>
</ul>
</li>
<li><code>ncu -k matrixMul --print-summary per-gpu ./test</code> 查看某个 kernel 信息</li>
<li><code>/tmp/var/target/linux-desktop-glibc_2_11_3-x64/ncu --config-file off --export &quot;/tmp/var/test&quot; --force-overwrite --section-folder /tmp/var/sections --set full ./test</code></li>
<li><code>ncu --set full -f --export nsight_compute ./test</code></li>
<li><code>docker run -itd -v /mnt:/mnt -p 30022:22 --user root --gpus all --name=Ubuntu20.04-CUDA-admin --shm-size 2g --cap-add=SYS_ADMIN nvidia/cuda:11.4.3-cudnn8-devel-ubuntu20.04</code> 尽量使用官方 docker<ul>
<li>需要 <code>--gpus all --cap-add=SYS_ADMIN</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/index.html">nsight-compute docs</a><ul>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/ProfilingGuide/index.html">ProfilingGuide</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/NsightCompute/index.html">user manual</a></li>
</ul>
</li>
<li>左上角可以显示：<ul>
<li>session: gpu cpu 等信息</li>
<li>detailed：overview, compute, memory 等</li>
<li>source: 汇编代码及耗时</li>
<li>summary: 耗时，compute and memory throughput; 底下有优化建议</li>
</ul>
</li>
<li><code>ncu --set roofline</code>可以测量详细 roofline</li>
<li><code>ncu --metrics smsp__inst_executed.sum ./matrixMul</code> 打印 metrics</li>
<li><code>--set roofline</code>能看到 tensor core roofline; 例如运行<code>cuda-samples/Samples/3_CUDA_Features/cudaTensorCoreGemm</code></li>
</ol>
<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><ol>
<li>The application returned an error code (9).<ul>
<li><code>ncu --replay-mode &lt;application/kernel&gt;</code> 加参数； 见<a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/nsight-profiling-crashes-with-error-code-9/230094/5">link</a></li>
<li>可以使用<code>–replay-mode application</code>切换到应用程序重播。 这避免了内存存储需要重放。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#replay">replay</a><ul>
<li>kernels might need to be replayed one or more times, since not all metrics can be collected in a single pass</li>
<li>the number of metrics originating from hardware (HW) performance counters that the GPU can collect at the same time is limited.</li>
<li>kernal replay 只重跑 kernel, application replay 重跑应用</li>
</ul>
</li>
</ol>
<h4 id="metrics"><a href="#metrics" class="headerlink" title="metrics"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-guide">metrics</a></h4><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-reference">metrics-reference</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2019.5/NsightComputeCli/index.html#nvprof-metric-comparison">nvprof-metric-comparison</a></li>
<li><code>ncu --devices 0 --query-metrics &gt;my_metrics.txt</code> 查看 metrics</li>
</ol>
<h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><ol>
<li>每项下面会有建议</li>
<li>overview<ul>
<li>roofline</li>
</ul>
</li>
<li>comupte<ul>
<li>IPC</li>
<li>指令执行占比</li>
</ul>
</li>
<li>memory<ul>
<li>可以选择看 transfer size 和 throughput</li>
<li>要提升 cache 命中率</li>
<li>多用 shared memory(可作为中间结果)</li>
<li>多种 memory<ul>
<li>global</li>
<li>local: 线程私有的。local memory 不是物理空间，而是 global memory 的一部分，所以延时较大。</li>
<li>texture: 只读?</li>
<li>surface</li>
<li>load global stroe shared</li>
<li>shared</li>
</ul>
</li>
</ul>
</li>
<li>scheduler statistics<ul>
<li>Issued Warp Per Scheduler: 平均每个 cycle 发射的 warp 数</li>
<li>On cycles with no eligible warps, the issue slot is skipped and no instruction is issued. Having many skipped issue slots indicates poor latency hiding.</li>
<li>Out of the maximum of 12 warps per scheduler(Ampere 1 个 SM 有 4 个 scheduler), this kernel allocates an average of 2.00 active warps per scheduler, but only an average of 0.07 warps were eligible(合格的) per cycle.</li>
<li>可以看出平局每个 sm 有几个 warps; 参考可以看 Theoretical Occupancy 是多少，有可能受 regitster 和 shared memory 等限制</li>
<li>Eligible warps are the subset of active warps that are ready to issue their next instruction.</li>
</ul>
</li>
<li>warp state</li>
<li>instructions</li>
<li>launch</li>
<li>cocupancy<ul>
<li>Occupancy is the ratio of the number of active warps per multiprocessor to the maximum number of possible active warps.</li>
<li>可以看出理论占用率及不能到 100%的原因</li>
<li>一个 warp 中用太多 register 和 shared memory 会影响 Occupancy， Occupancy 会影响 scheduler， 进而会影响延迟隐藏</li>
<li>Occupancy 是 CUDA 编程中一个重要的性能指标,它表示 GPU 中 Streaming Multiprocessor (SM)上的处理单元被运用的比例。</li>
<li>右上角点开 table，可以可视化</li>
</ul>
</li>
</ol>
<h3 id="nsgiht-graphics"><a href="#nsgiht-graphics" class="headerlink" title="nsgiht graphics"></a>nsgiht graphics</h3><h2 id="cuda-debug"><a href="#cuda-debug" class="headerlink" title="cuda-debug"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-visual-studio-code-edition/cuda-debugger/index.html">cuda-debug</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cutlass/tree/main/examples/02_dump_reg_shmem">02_dump_reg_shmem</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-gdb/index.html#compiling-the-application">compiling 要求</a><ul>
<li><code>nvcc -g -G foo.cu -o foo</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=NVIDIA.nsight-vscode-edition">vs code plugin: nsight-vscode-edition</a></li>
<li>shared memory(L1 cache?) dump<ul>
<li>申请 shared memory 变量，存中间结果， shared memory 对 block 全局可见。</li>
<li>可以申请多于 L1 cache 大小的存储，系统会自动调度</li>
</ul>
</li>
<li>传递主存指针到 kernel，用于 dump</li>
<li>print<ul>
<li><code>if(threadIdx.x == 0) printf...</code> 条件打印</li>
<li>cudaDeviceReset(); 不打印可以加</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/nsight-visual-studio-code-edition">nsight-visual-studio-code-edition</a></li>
<li>cuda-gdb</li>
<li>cuda-memcheck</li>
</ol>
<h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-zone">cuda 相关开发</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/gpu-accelerated-libraries">gpu-accelerated-libraries</a></li>
</ol>
<h2 id="build-1"><a href="#build-1" class="headerlink" title="build"></a>build</h2><h3 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h3><ol>
<li><a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/video/gputechconf/gtc/2019/presentation/s9444-build-systems-exploring-modern-cmake-cuda-v2.pdf">build-systems-exploring-modern-cmake-cuda-v2.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/building-cuda-applications-cmake/">building-cuda-applications-cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples/blob/master/cuBLAS/Level-3/gemm/CMakeLists.txt">CUDALibrarySamples</a></li>
<li>basic sample</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="comment"># project(my_cuda_project LANGUAGES CXX CUDA)</span></span><br><span class="line"><span class="keyword">project</span>(my_cuda_project)</span><br><span class="line"><span class="keyword">enable_language</span>(CUDA) <span class="comment"># 需要enable language</span></span><br><span class="line"><span class="keyword">add_executable</span>(preprocess kernel.cu preprocess.cpp )</span><br><span class="line"><span class="keyword">find_package</span>(CUDA REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(preprocess <span class="variable">$&#123;CUDA_cudart_LIBRARY&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><ol>
<li>混合编译, 注意-lcudart 顺序</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvcc -O3 -c kernel.cu -o kernel.o</span><br><span class="line">g++ -L /usr/local/cuda/targets/x86_64-linux/lib/ preprocess.cpp kernel.o -o preprocess -lcuda -lcudart &amp;&amp; ./preprocess</span><br></pre></td></tr></table></figure>

<h2 id="unified-memory"><a href="#unified-memory" class="headerlink" title="unified memory"></a>unified memory</h2><ol>
<li>不明白原理时不推荐使用</li>
<li>优缺点<ul>
<li>优点<ul>
<li>简化代码编写和内存管理：cudaMallocManaged 可以简化 CPU 和 GPU 之间数据传递的代码，无需手动管理内存迁移。</li>
</ul>
</li>
<li>缺点<ul>
<li>可能降低性能：在某些情况下，统一内存可能会降低性能，例如在数据访问模式为稀疏的情况下。</li>
<li>可能增加内存占用：统一内存可能会增加内存占用，因为它需要在 CPU 和 GPU 内存中都保留一份数据副本。</li>
</ul>
</li>
</ul>
</li>
<li><code>cudaMalloc -&gt; cudaMallocManaged(&amp;x, N*sizeof(float));</code></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/21990899/23011500">使用 cudaMallocManaged 情况</a><ul>
<li>You are working on a Jetson device.</li>
</ul>
</li>
<li>runtime 负责 copy</li>
<li>unified memory cpu 访问时需要同一个线程。不同线程会 bus error。</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/unified-memory-cuda-beginners/">Unified Memory for CUDA Beginners</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/maximizing-unified-memory-performance-cuda/">Maximizing Unified Memory Performance in CUDA</a></li>
</ol>
<h2 id="design"><a href="#design" class="headerlink" title="design"></a>design</h2><ol>
<li>lidar prprocess; 三重 for, 最外层作为 x, 一个线程执行一个最里面 for 的内容，</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TransposeDim</span><span class="params">(<span class="type">int</span> kmax_num_point_pillar,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> kmax_num_point,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> kdim,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> voxel_num, <span class="type">float</span> *voxel_data, <span class="type">int8_t</span> *features_s8)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> kWC = kmax_num_point_pillar * kdim;</span><br><span class="line">  <span class="type">int</span> kHW = kmax_num_point * kmax_num_point_pillar;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; kdim; ++c)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">0</span>; w &lt; kmax_num_point_pillar; ++w)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">0</span>; h &lt; voxel_num; ++h)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="type">int</span> old_index = h * kWC + w * kdim + c;</span><br><span class="line">        <span class="type">int</span> new_index = c * kHW + w * kmax_num_point + h;</span><br><span class="line">        <span class="type">float</span> features_tmp = <span class="built_in">round</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(voxel_data[old_index]));</span><br><span class="line">        features_tmp = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(features_tmp, <span class="number">-128.f</span>), <span class="number">127.f</span>);</span><br><span class="line">        features_s8[new_index] = <span class="built_in">static_cast</span>&lt;<span class="type">int8_t</span>&gt;(features_tmp);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">TransposeDim5Kernel</span><span class="params">(<span class="type">int</span> kmax_num_point_pillar,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> kmax_num_point,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> kdim,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> voxel_num,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">float</span> *voxel_data,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int8_t</span> *features_s8)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> c = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">  <span class="type">int</span> w = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">  <span class="type">int</span> h = blockIdx.z * blockDim.z + threadIdx.z;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (c &lt; kdim &amp;&amp; w &lt; kmax_num_point_pillar &amp;&amp; h &lt; voxel_num)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">int</span> kWC = kmax_num_point_pillar * kdim;</span><br><span class="line">    <span class="type">int</span> kHW = kmax_num_point * kmax_num_point_pillar;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> old_index = h * kWC + w * kdim + c;</span><br><span class="line">    <span class="type">int</span> new_index = c * kHW + w * kmax_num_point + h;</span><br><span class="line">    <span class="type">float</span> features_tmp = <span class="built_in">round</span>(voxel_data[old_index]);</span><br><span class="line"></span><br><span class="line">    features_tmp = <span class="built_in">fmaxf</span>(<span class="built_in">fminf</span>(features_tmp, <span class="number">127.f</span>), <span class="number">-128.f</span>);</span><br><span class="line"></span><br><span class="line">    features_s8[new_index] = <span class="built_in">static_cast</span>&lt;<span class="type">int8_t</span>&gt;(features_tmp);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">dim3 <span class="title">blockSize</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>, <span class="number">32</span>)</span></span>;</span><br><span class="line"><span class="function">dim3 <span class="title">gridSize</span><span class="params">((kdim + blockSize.x - <span class="number">1</span>) / blockSize.x,</span></span></span><br><span class="line"><span class="params"><span class="function">                (kmax_num_point_pillar + blockSize.y - <span class="number">1</span>) / blockSize.y,</span></span></span><br><span class="line"><span class="params"><span class="function">                (voxel_num + blockSize.z - <span class="number">1</span>) / blockSize.z)</span></span>;</span><br><span class="line"></span><br><span class="line">TransposeDim5Kernel&lt;&lt;&lt;gridSize, blockSize&gt;&gt;&gt;(kmax_num_point_pillar,</span><br><span class="line">                                               kmax_num_point,</span><br><span class="line">                                               kdim,</span><br><span class="line">                                               voxel_num,</span><br><span class="line">                                               d_voxel_data,</span><br><span class="line">                                               d_features_s8);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/03/Doxygen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/03/Doxygen/" class="post-title-link" itemprop="url">Doxygen</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-03 03:58:22" itemprop="dateCreated datePublished" datetime="2022-03-03T03:58:22+08:00">2022-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-29 11:23:43" itemprop="dateModified" datetime="2023-11-29T11:23:43+08:00">2023-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/03/Doxygen/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/03/Doxygen/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li>markdown 添加 [toc] 为 html 生成目录</li>
<li>参考 opencv</li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/57979732">multi projects</a></li>
<li>可以用 cmake 生成 doxygen 配置 <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/blob/17234f82d025e3bbfbf611089637e5aa2038e7b8/doc/Doxyfile.in">link</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/doxygen/doxygen/tree/master/templates">templates</a></li>
</ol>
<h2 id="theme"><a href="#theme" class="headerlink" title="theme"></a>theme</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/jothepro/doxygen-awesome-css">doxygen-awesome-css</a></li>
<li><a target="_blank" rel="noopener" href="https://jothepro.github.io/doxygen-awesome-css/index.html">效果</a></li>
</ol>
<h2 id="doxygen-config"><a href="#doxygen-config" class="headerlink" title="doxygen config"></a>doxygen config</h2><ol>
<li><code>sudo apt install doxygen</code></li>
<li><code>doxygen -g &lt;config-name&gt;</code> 产生配置文件，默认为 Doxyfile <code>-s</code> 生成不带注释的配置文件</li>
<li><code>doxygen &lt;config-name&gt;</code> 生成文档</li>
<li>UML 生成 svg 图片<ul>
<li><code>DOT_IMAGE_FORMAT       = svg(png)</code></li>
<li><code>INTERACTIVE_SVG        = YES</code></li>
</ul>
</li>
<li>生成 UML, 需要修改配置文件, 以下改为 YES</li>
</ol>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RECURSIVE</span><br><span class="line">HAVE<span class="emphasis">_DOT</span></span><br><span class="line"><span class="emphasis">UML_LOOK</span></span><br><span class="line"><span class="emphasis">EXTRACT_</span>ALL</span><br></pre></td></tr></table></figure>

<ol>
<li><code>INLINE_SOURCES</code>标签。如果设置为 YES，可以将源代码直接包含到文档中。</li>
<li><code>OUTPUT_LANGUAGE</code> &#x3D; 改为 Chinese</li>
<li><code>HTML_TIMESTAMP</code>标签设置为 YES，则每个生成的 HTML 页面的页脚将包含生成页面的日期和时间。将此设置为“是”有助于显示上次运行 doxygen 的时间，从而显示文档是否最新。</li>
<li><code>GENERATE_TREEVIEW</code> 标签用于指定是否应生成树状索引结构以显示分层信息。</li>
<li><code>PROJECT_NAME</code></li>
<li><code>PROJECT_NUMBER</code></li>
<li><code>PROJECT_LOGO</code> 首页左侧图标</li>
<li><code>EXTRACT_STATIC</code> 如果设置为 YES，一个文件的所有静态成员都将包含在文档中。</li>
<li><code>EXTRACT_PRIVATE</code> 如果设置为 YES，一个类的所有私有成员都将包含在文档中。</li>
<li><code>IMAGE_PATH</code> 修复 markdown 生成网页时 doc 出错问题</li>
<li><code>USE_MDFILE_AS_MAINPAGE = ./README.md</code> 主页</li>
<li><code>HTML_OUTPUT = doc_html</code></li>
<li><code>LATEX_OUTPUT = doc_latex</code></li>
<li><code>INPUT</code> 标签是输入的源码文件的目录, 空格分开 例如： <code>INPUT = README.md include/pg</code></li>
<li>输出 color <a target="_blank" rel="noopener" href="https://github.com/jothepro/doxygen-awesome-css/blob/main/docs/customization.md#doxygen-generator">link</a></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTML_COLORSTYLE_HUE    = 209</span><br><span class="line">HTML_COLORSTYLE_SAT    = 255</span><br><span class="line">HTML_COLORSTYLE_GAMMA  = 113</span><br></pre></td></tr></table></figure>

<h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><ol>
<li><code>sudo apt-get install texlive-full texlive-latex-base</code> <a target="_blank" rel="noopener" href="https://tex.stackexchange.com/a/481681">link</a></li>
<li><code>cd latex &amp;&amp; make</code></li>
<li><code>doxygen -w latex header.tex footer.tex doxygen.sty</code> 先生成默认配置，修改 doxygen.config 指定<code>LATEX_HEADER = header.tex</code> <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/16222657">link</a></li>
<li>修改 refman.tex 来改变 pdf 生成</li>
<li><code>sed -i &quot;s/Doxygen/xx xx/&quot; refman.tex</code>修改制作者名字</li>
<li>中文问题 <code>\begin&#123;CJK&#125;&#123;UTF8&#125;</code> 换成 <code>\begin&#123;CJK&#125;&#123;gbsn&#125;</code> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyl910/archive/2013/06/02/doxygen_pdf_chinese.html">link</a></li>
<li>空页问题： <code>COMPACT_LATEX</code> to YES</li>
<li>换页问题： <code>\doxysection</code> 之前加 <code>\newpage</code></li>
<li>refman.tex 处理</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;/fancyfoot/d&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;/fancyhead/d&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\cfoot&#123;\\thepage&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\rhead&#123;&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\lhead&#123;&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/doxysection/i\\\newpage&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;s/Doxygen 1.8.17/PhiGent Robotics/&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;s/&#123;min&#125;/&#123;gbsn&#125;/&quot;</span> latex/refman.tex</span><br></pre></td></tr></table></figure>

<ol>
<li><code>\pagestyle&#123;fancyplain&#125;</code> 删除之后页眉页脚不再有横杠 <code>\pagestyle&#123;plain&#125;</code></li>
</ol>
<h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><ol>
<li>不要在有 build 的目录下</li>
<li>如果想生成详细的 UML 图，需要设置<code>EXTRACT_STATIC</code> <code>EXTRACT_PRIVATE</code>为 YES</li>
</ol>
<h2 id="文档解析"><a href="#文档解析" class="headerlink" title="文档解析"></a>文档解析</h2><ol>
<li>Class Hierarchy 可以查看类层级关系</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://fossies.org/dox/all.html">fossies doxygen lists</a></li>
<li><a target="_blank" rel="noopener" href="https://www.doxygen.nl/manual/starting.html">getting start</a></li>
<li><a target="_blank" rel="noopener" href="https://www.guyuehome.com/35640">参数详解</a></li>
<li><a target="_blank" rel="noopener" href="https://doxygen.nl/projects.html">使用 doxygen 的项目</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/metropolis/deepstream/sdk-api/index.html">deepstream doxygen</a></li>
<li><a target="_blank" rel="noopener" href="https://google.github.io/ion/base_2logging_8h.html">ion</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.x/d9/df8/tutorial_root.html">opencv tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/blob/17234f82d025e3bbfbf611089637e5aa2038e7b8/doc/Doxyfile.in">opencv config</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/doxygen/doxygen/tree/master/templates">templates</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/02/Nvidia-NPP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/02/Nvidia-NPP/" class="post-title-link" itemprop="url">Nvidia-NPP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-02 11:30:48" itemprop="dateCreated datePublished" datetime="2022-03-02T11:30:48+08:00">2022-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-09 19:56:16" itemprop="dateModified" datetime="2023-10-09T19:56:16+08:00">2023-10-09</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/02/Nvidia-NPP/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/02/Nvidia-NPP/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><ol>
<li>need <code>sudo</code> to run exe</li>
<li><code>export CUDACXX=/usr/local/cuda/bin/nvcc</code> when build cuda</li>
<li>CMakeLists.txt: <code>CUDA_ADD_EXECUTABLE(resize resize.cpp)</code></li>
</ol>
<h2 id="yuyv-2-rgb"><a href="#yuyv-2-rgb" class="headerlink" title="yuyv 2 rgb"></a>yuyv 2 rgb</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/71473363">link</a> nvcc 替换成 g++也可用</li>
</ol>
<h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ol>
<li>install path: <code>/usr/local/cuda-xxx/</code></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi_conventions_lb.html">函数名称中简写的意义</a></li>
<li></li>
</ol>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot; <span class="keyword">if</span> the image <span class="keyword">is</span> a <span class="number">4</span> channel image this indicates the result alpha channel <span class="keyword">is</span> <span class="keyword">not</span> affected <span class="keyword">by</span> the primitive.</span><br><span class="line">&quot;Cn&quot; the image consists <span class="keyword">of</span> n channel packed pixels, <span class="keyword">where</span> n can be <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> <span class="keyword">or</span> <span class="number">4.</span></span><br><span class="line">&quot;Pn&quot; the image consists <span class="keyword">of</span> n separate image planes, <span class="keyword">where</span> n can be <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> <span class="keyword">or</span> <span class="number">4.</span></span><br><span class="line">&quot;C&quot; (<span class="keyword">following</span> the channel information) indicates that the primitive <span class="keyword">only</span> operates <span class="keyword">on</span> one <span class="keyword">of</span> the color channels, the &quot;channel-of-interest&quot;. <span class="keyword">All</span> other output channels are <span class="keyword">not</span> affected <span class="keyword">by</span> the primitive.</span><br><span class="line">&quot;I&quot; indicates that the primitive works &quot;in-place&quot;. <span class="keyword">In</span> this <span class="keyword">case</span> the image-data pointer <span class="keyword">is</span> usually named pSrcDst <span class="keyword">to</span> indicate that the image data serves <span class="keyword">as</span> source <span class="keyword">and</span> destination at the same <span class="type">time</span>.</span><br><span class="line">&quot;M&quot; indicates &quot;masked operation&quot;. These <span class="keyword">types</span> <span class="keyword">of</span> primitives have an additional &quot;mask image&quot; <span class="keyword">as</span> <span class="keyword">as</span> <span class="keyword">input</span>. <span class="keyword">Each</span> pixel <span class="keyword">in</span> the destination image corresponds <span class="keyword">to</span> a pixel <span class="keyword">in</span> the mask image. <span class="keyword">Only</span> pixels <span class="keyword">with</span> a corresponding non-zero mask pixel are being processed.</span><br><span class="line">&quot;R&quot; indicates the primitive operates <span class="keyword">only</span> <span class="keyword">on</span> a rectangular &quot;region-of-interest&quot; <span class="keyword">or</span> &quot;ROI&quot;. <span class="keyword">All</span> ROI primitives take an additional <span class="keyword">input</span> parameter <span class="keyword">of</span> <span class="keyword">type</span> NppiSize, which specifies the width <span class="keyword">and</span> height <span class="keyword">of</span> the rectangular region that the primitive should process. <span class="keyword">For</span> details <span class="keyword">on</span> how primitives operate <span class="keyword">on</span> ROIs see: Region-<span class="keyword">of</span>-Interest (ROI).</span><br><span class="line">&quot;Sfs&quot; indicates the result <span class="keyword">values</span> are processed <span class="keyword">by</span> fixed scaling <span class="keyword">and</span> saturation <span class="keyword">before</span> they<span class="string">&#x27;re written out.</span></span><br></pre></td></tr></table></figure>

<ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi__support__functions_8h_source.html">image malloc functions</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi__geometry__transforms_8h_source.html">resize function</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/tree/master/Common/UtilNPP">npp utils</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/group__image__color__model__conversion.html">cvtcolor</a></li>
</ol>
<h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples.git">NVIDIA-CUDALibrarySamples</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15357586/3790330">simple sample</a></li>
<li><a target="_blank" rel="noopener" href="https://sourcegraph.com/github.com/PacktPublishing/Learn-CUDA-Programming/-/blob/Chapter08/08_cuda_libs_and_other_languages/05_npp/imageFilter.cpp">malloc sample</a></li>
</ol>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/index.html">main page</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/02/05/image_process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/05/image_process/" class="post-title-link" itemprop="url">Image Process</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-05 20:05:33" itemprop="dateCreated datePublished" datetime="2022-02-05T20:05:33+08:00">2022-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/02/05/image_process/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/02/05/image_process/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ol>
<li>7yuv 可以直接显示二进制格式图片 图片命名为 xxxx_960_576.yuv, 可以直接打开不用再输入尺寸</li>
</ol>
<h2 id="视差图与深度图"><a href="#视差图与深度图" class="headerlink" title="视差图与深度图"></a>视差图与深度图</h2><h3 id="视差图"><a href="#视差图" class="headerlink" title="视差图"></a>视差图</h3><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ppdyhappy/article/details/113618409">原理</a></li>
</ol>
<h3 id="深度图"><a href="#深度图" class="headerlink" title="深度图"></a>深度图</h3><h3 id="视差图转深度图"><a href="#视差图转深度图" class="headerlink" title="视差图转深度图"></a>视差图转深度图</h3><ol>
<li>公式: <code>depth[i] = f * b / disp[i]; </code> f 为焦距，b 为基线</li>
<li><a target="_blank" rel="noopener" href="https://blog.nowcoder.net/n/947d9e8e6e3d41aa95d25e2daa9d14f6?from=nowcoder_improve">视差转深度</a></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> fx = <span class="number">6.9972691554787775e+02</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> baseline = <span class="number">1</span> / <span class="number">4.9899299400374328</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">  Mat img = <span class="built_in">imread</span>(<span class="string">&quot;disparity.png&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  cout &lt;&lt; img.<span class="built_in">type</span>() &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;fx: &quot;</span> &lt;&lt; fx &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;baseline: &quot;</span> &lt;&lt; baseline &lt;&lt; endl;</span><br><span class="line">  <span class="function">Mat <span class="title">depth</span><span class="params">(img.rows, img.cols, CV_32F)</span></span>;  <span class="comment">//深度图</span></span><br><span class="line">  cout &lt;&lt; depth.<span class="built_in">type</span>() &lt;&lt; endl;</span><br><span class="line">  <span class="comment">//视差图转深度图</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; depth.rows; row++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; depth.cols; col++) &#123;</span><br><span class="line">      <span class="type">float</span> d = img.<span class="built_in">ptr</span>&lt;uchar&gt;(row)[col];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (d == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      depth.<span class="built_in">ptr</span>&lt;<span class="type">float</span>&gt;(row)[col] = fx * baseline / d;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">imwrite</span>(<span class="string">&quot;depth.png&quot;</span>, depth);</span><br><span class="line">  <span class="comment">// Mat depth_8u1 = depth.clone();</span></span><br><span class="line">  Mat depth_8u1;</span><br><span class="line">  depth.<span class="built_in">convertTo</span>(depth_8u1, CV_8U);</span><br><span class="line">  Mat color_mat;</span><br><span class="line">  <span class="built_in">applyColorMap</span>(depth_8u1, color_mat, COLORMAP_TURBO);</span><br><span class="line">  <span class="built_in">imwrite</span>(<span class="string">&quot;color_depth.png&quot;</span>, color_mat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="opencv-函数"><a href="#opencv-函数" class="headerlink" title="opencv 函数"></a>opencv 函数</h2><ol>
<li><code>.convert</code>类型转换 <code>depth.convertTo(depth_8u1, CV_8U);</code></li>
<li><code>applyColorMap</code> 灰度图转彩色(深度彩色输出) <code>applyColorMap(depth_8u1, color_mat, COLORMAP_TURBO);</code></li>
<li>获取 cv::Mat 矩阵元素 <code> mat.ptr&lt;float&gt;(row)[col] = camera_f * camera_b / d;</code></li>
</ol>
<h2 id="vector-to-rgb-jpg"><a href="#vector-to-rgb-jpg" class="headerlink" title="vector to rgb jpg"></a>vector to rgb jpg</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="built_in">char</span>&gt; source<span class="constructor">_out(<span class="params">w</span> <span class="operator">*</span> <span class="params">h</span> <span class="operator">*</span> 3)</span></span><br><span class="line">cv::Mat img(h, w, CV_8UC3);</span><br><span class="line"><span class="keyword">for</span> (unsigned <span class="built_in">int</span> row_ind = <span class="number">0</span>; row_ind &lt; h; ++row_ind) &#123;</span><br><span class="line">  <span class="keyword">for</span> (unsigned <span class="built_in">int</span> col_ind = <span class="number">0</span>; col_ind &lt; w; ++col_ind) &#123;</span><br><span class="line">    img.at&lt;cv::Vec3b&gt;(row_ind, col_ind) =</span><br><span class="line">        cv::<span class="constructor">Vec3b(<span class="params">source_out</span>[(<span class="params">row_ind</span> <span class="operator">*</span> <span class="params">w</span> + <span class="params">col_ind</span>)</span><span class="operator"> * </span><span class="number">3</span> + <span class="number">2</span>],</span><br><span class="line">                  source_out<span class="literal">[(<span class="identifier">row_ind</span> <span class="operator">*</span> <span class="identifier">w</span> + <span class="identifier">col_ind</span>) <span class="operator">*</span> <span class="number">3</span> + <span class="number">1</span>]</span>,</span><br><span class="line">                  source_out<span class="literal">[(<span class="identifier">row_ind</span> <span class="operator">*</span> <span class="identifier">w</span> + <span class="identifier">col_ind</span>) <span class="operator">*</span> <span class="number">3</span> + <span class="number">0</span>]</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">cv::imwrite(<span class="string">&quot;output.jpg&quot;</span>, img);</span><br></pre></td></tr></table></figure>

<h2 id="opencv-多张图片同事显示"><a href="#opencv-多张图片同事显示" class="headerlink" title="opencv 多张图片同事显示"></a>opencv 多张图片同事显示</h2><ol>
<li><a target="_blank" rel="noopener" href="https://python.iitter.com/other/302393.html">OpenCV 一个窗口同时显示多张图片</a></li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> cv::Mat <span class="title">concat_images</span><span class="params">(std::vector&lt;cv::Mat&gt; imgs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line">  <span class="type">const</span> <span class="type">int</span> MAX_PIXEL = <span class="number">540</span>;</span><br><span class="line">  <span class="type">int</span> imgs_num = imgs.<span class="built_in">size</span>();</span><br><span class="line">  <span class="keyword">auto</span> sqrt_value = std::<span class="built_in">sqrt</span>(imgs_num);</span><br><span class="line">  Size first_img_size = imgs[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">  <span class="type">int</span> max_pixel = std::<span class="built_in">max</span>(first_img_size.height, first_img_size.width);</span><br><span class="line">  <span class="type">double</span> prop = max_pixel &lt; MAX_PIXEL ? (<span class="type">double</span>)max_pixel / (<span class="type">double</span>)MAX_PIXEL</span><br><span class="line">                                      : (<span class="type">double</span>)MAX_PIXEL / (<span class="type">double</span>)max_pixel;</span><br><span class="line">  <span class="function">Size <span class="title">std_size</span><span class="params">(first_img_size.width * prop, first_img_size.height * prop)</span></span>;</span><br><span class="line">  <span class="built_in">VLOG</span>(<span class="number">1</span>) &lt;&lt; <span class="string">&quot;std size: &quot;</span> &lt;&lt; std_size;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> img_cols = (sqrt_value - (<span class="type">int</span>)sqrt_value == <span class="number">0.0</span>)</span><br><span class="line">                     ? std::<span class="built_in">floor</span>(sqrt_value)</span><br><span class="line">                     : std::<span class="built_in">floor</span>(sqrt_value) + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">VLOG</span>(<span class="number">1</span>) &lt;&lt; <span class="string">&quot;img_cols:  &quot;</span> &lt;&lt; img_cols;</span><br><span class="line">  Mat tmp_img;</span><br><span class="line">  <span class="function">Point2i <span class="title">location</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">  <span class="function">Mat <span class="title">result</span><span class="params">(std_size.height * ((imgs_num - <span class="number">1</span>) / img_cols + <span class="number">1</span>),</span></span></span><br><span class="line"><span class="params"><span class="function">             std_size.width * img_cols, imgs[<span class="number">0</span>].type())</span></span>;</span><br><span class="line">  <span class="built_in">VLOG</span>(<span class="number">1</span>) &lt;&lt; <span class="string">&quot;concat image size: &quot;</span> &lt;&lt; result.<span class="built_in">size</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; imgs_num; i++) &#123;</span><br><span class="line">    location.x = (i % img_cols) * std_size.width;</span><br><span class="line">    location.y = (i / img_cols) * std_size.height;</span><br><span class="line">    <span class="built_in">resize</span>(imgs[i], tmp_img, std_size, prop, prop, INTER_LINEAR);</span><br><span class="line">    tmp_img.<span class="built_in">copyTo</span>(<span class="built_in">result</span>(<span class="built_in">Rect</span>(location, std_size)));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="双线性-resize"><a href="#双线性-resize" class="headerlink" title="双线性 resize"></a>双线性 resize</h2><ol>
<li><a target="_blank" rel="noopener" href="https://excalidraw.com/#json=eOxeValvEDgQU1IrMOjU_,arZv-AnyFoupAOXfEKY1-w">示意图</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freesion.com/article/6921829775/">双线性插值算法（C++实现）</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/10/05/resume/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/05/resume/" class="post-title-link" itemprop="url">resume</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-05 12:24:06" itemprop="dateCreated datePublished" datetime="2021-10-05T12:24:06+08:00">2021-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/10/05/resume/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/10/05/resume/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>146</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://rxresu.me/">rxresu.me</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AmruthPillai/Reactive-Resume">Reactive-Resume</a> 填写内容，自动生成简历</li>
<li><a target="_blank" rel="noopener" href="https://github.com/resumejob/awesome-resume">简历用语</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/xriley/Orbit-Theme">Orbit-Theme</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/posquit0/Awesome-CV">Awesome-CV</a> CV: Curriculum Vitae 个人简历</li>
<li><a target="_blank" rel="noopener" href="https://www.overleaf.com/latex/templates/awesome-cv/dfnvtnhzhhbm">overleaf awesome-cv template</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jankapunkt/latexcv/tree/master/sidebar">latexcv</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dyweb/awesome-resume-for-chinese">awesome-resume-for-chinese</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/09/13/Plugin-System/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/13/Plugin-System/" class="post-title-link" itemprop="url">plugins</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-13 22:17:40" itemprop="dateCreated datePublished" datetime="2021-09-13T22:17:40+08:00">2021-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/13/Plugin-System/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/13/Plugin-System/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>351</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><ol>
<li>emacs man dlopen有参考例子</li>
<li>用作插件：插件技术最大特点是更新插件无需编译主程序，设计良好的系统可以做到在线升级，只更新插件（补丁）</li>
<li>使用dlopen时链接发生在runtime, 不需要知道函数声明， 而-l链接发生在compile期，需要知道函数声明</li>
<li>libc.so.6 GNU标准c库，含有getchar,system等函数</li>
</ol>
<h2 id="VVAS-and-DeepStream"><a href="#VVAS-and-DeepStream" class="headerlink" title="VVAS and DeepStream"></a>VVAS and DeepStream</h2><ol>
<li>use gstreamer</li>
</ol>
<h2 id="VART-and-TensorRT"><a href="#VART-and-TensorRT" class="headerlink" title="VART and TensorRT"></a>VART and TensorRT</h2><ol>
<li>use dlopen</li>
</ol>
<h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/rhcad/x3py/wiki">x3</a></li>
</ol>
<h2 id="famous-projects"><a href="#famous-projects" class="headerlink" title="famous projects"></a>famous projects</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/eb8442dba3c9e85ffb77e0d870d2e29adcb0a4aa/plugin/common/cudaDriverWrapper.cpp#L28">TensorRT</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/tensorflow/tensorflow/blob/96493ef750a69c5ab71a1744b282c0c6770df234/tensorflow/core/platform/default/load_library.cc#L27">Tensorflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pytorch/pytorch/blob/f23f21dafebae49c9670e2e695344edd01867b0c/torch/csrc/deploy/loader.cpp#L373">pytorch</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/tools/lib/traceevent/event-plugin.c#L461">linux</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/FFmpeg/FFmpeg/blob/989febfbd0c986e9e3e0f269a6b22778bf79147b/libavcodec/omx.c#L115">FFmpeg</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/blob/c3ac834526c66840835737f03ed1b4d8f711534e/modules/core/src/gl_core_3_1.cpp#L62">opencv</a></li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://hackaday.com/2018/07/12/its-all-in-the-libs-building-a-plugin-system-using-dynamic-loading/">BUILDING A PLUGIN SYSTEM USING DYNAMIC LOADING</a></li>
<li>TensorRT <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/eb8442dba3c9e85ffb77e0d870d2e29adcb0a4aa/samples/common/common.h#L930">link1</a> <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/TensorRT/blob/eb8442dba3c9e85ffb77e0d870d2e29adcb0a4aa/samples/trtexec/trtexec.cpp#L145">trtexec</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/08/22/Programming-Paradigm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/22/Programming-Paradigm/" class="post-title-link" itemprop="url">Programming-Paradigm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-22 08:23:46" itemprop="dateCreated datePublished" datetime="2021-08-22T08:23:46+08:00">2021-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/PLT/" itemprop="url" rel="index"><span itemprop="name">PLT</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/22/Programming-Paradigm/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/22/Programming-Paradigm/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ol>
<li>编程范式的实际含义：限制和规范程序员的能力。</li>
<li>每个编程范式的目的都是设置限制，这些编程范式主要告诉我们不能做什么，而不是可以做什么。</li>
<li>语法，features和范式的关系？语言的语义和句法决定了语言的features? features决定了语言的编程范式？</li>
<li>限制：<ul>
<li>结构化编程：对程序控制权的直接转移进行了限制和规范， 限制goto语句， 因为if, while等包装了goto</li>
<li>面向对象编程：对程序控制权的间接访问进行了限制和规范， 限制函数指针, 因为多态包装了函数指针。</li>
<li>函数式编程：对程序中的赋值进行了限制和规范， 限制赋值语句，因为包装了变量</li>
</ul>
</li>
<li><code>关系： 多态是跨越架构边界的手段，函数式编程时我们规范和限制数据存放位置和访问权限的手段，结构化编程则是个模块的算法实现基础。这和软件架构的三大关注重点不谋而合：功能性，组件独立性，数据管理</code></li>
<li>多态归根结底不过就是函数指针的一种应用。</li>
</ol>
<h2 id="Procedural-Structured-programming-面向过程-结构化编程"><a href="#Procedural-Structured-programming-面向过程-结构化编程" class="headerlink" title="Procedural&#x2F;Structured programming 面向过程&#x2F;结构化编程"></a>Procedural&#x2F;Structured programming 面向过程&#x2F;结构化编程</h2><ol>
<li>结构化程序设计方法SP(Structured Programming)的着眼点是“面向过程”。　　</li>
<li>它采用子程序、块结构、for循环以及while循环等结构，来取代传统的 goto。goto语句的某些用法会导致某个模块无法被递归拆分成更小的，可证明的单元，会导致无法采用分解法来将大型问题进一步拆分成更小的，可证明的部分。</li>
<li>可以用<code>顺序结构</code>，<code>分支结构</code>和<code>循环结构</code>这三种结构构造出任何程序。</li>
<li>科学和数学： 数学是要将可证明的结论证明，科学则是要将可证明的结论证伪。科学理论和定律特点：它们可以被证伪，但没有办法证明。</li>
<li>软件开发像是一门科学研究学科：可通过无法证伪来证明软件的正确性。测试的作用。</li>
<li>结构化编程最有价值的地方在于它赋予我们创造可证伪程序单元的能力。</li>
<li>无论在哪一个层面上，从最小的函数到最大的组件，软件开发过程都和科学研究非常类似，他们都是由证伪驱动的。软件架构师选哟定义可以方便地进行证伪的模块,组件以及服务。</li>
<li></li>
</ol>
<h2 id="Object-Oriented-Programming-面向对象编程"><a href="#Object-Oriented-Programming-面向对象编程" class="headerlink" title="Object Oriented Programming 面向对象编程"></a>Object Oriented Programming 面向对象编程</h2><p>1.面向对象编程就是以多态为手段来对源代码中的依赖关系进行控制的能力，这种能力让软件架构师可以构建出某种插件式架构，让高层策略性组件与底层是线性组件相分离，底层组件可以编译成插件，实现独立于高层组件的开发和部署。<br>2.<code>依赖反转</code>： 通过接口，多态来使<code>源代码上的依赖关系方向</code>与<code>控制流方向</code>相反。 中间加了接口，只有被控制端的源代码依赖关系方向反转。 面向接口编程就是利用了依赖反转来使得模块分离。<br>3.依赖反转可用来打破组件间循环依赖。</p>
<h2 id="Functional-Programming-函数式编程"><a href="#Functional-Programming-函数式编程" class="headerlink" title="Functional Programming 函数式编程"></a>Functional Programming 函数式编程</h2><ol>
<li>最大特点是不可变性——某个符号所对应的值永远不变，从理论上讲，函数式编程语言应该是没有赋值语句的。</li>
<li>如果由足够大的存储量和处理能力，应用程序就可以用完全不可变的，纯函数式的方式来编程。</li>
<li>一个架构设计良好的应用程序应该将状态可修改的部分和不需要修改的部分隔离成单独的组件，然后用合适的机制来保护可变量。可变状态组件的逻辑越少越好。</li>
<li>好处：<ul>
<li>没有可变状态，函数就是引用透明(referential transparency)的和没有有副作用(no side effect)</li>
<li>可以解决并发竞争，死锁等问题</li>
<li>代码容易进行推理，不容易出错。</li>
<li>由于函数式语言是面向数学的抽象，更接近人的语言，而不是机器语言，代码会比较简洁，也更容被理解。</li>
</ul>
</li>
<li>面向数学的抽象，将计算描述为一种表达式求值，一句话，函数式程序就是一个表达式。</li>
<li>函数式编程中的函数不是指计算机中的函数，而是指数学中的函数，即自变量的映射。也就是说一个函数的值仅仅取决于函数参数的值。</li>
<li>函数式编程语言中的变量不是命令式编程语言中的变量（存储状态的单元），而是代数中的变量，即一个值的名称。变量的值是不可变的。命令式编程中的”x &#x3D; x + 1”（赋值运算），拿给程序员看说是对的，拿给数学家看，却被认为这个等式为假。</li>
</ol>
<h2 id="Imperative-programming-指令式编程"><a href="#Imperative-programming-指令式编程" class="headerlink" title="Imperative programming 指令式编程"></a>Imperative programming 指令式编程</h2><ol>
<li>面向计算机硬件的抽象<ul>
<li>变量： 存储单元</li>
<li>赋值语句： 获取，存储指令</li>
<li>表达式： 内存引用和算数运算</li>
<li>控制语句： 跳转指令</li>
</ul>
</li>
<li>冯诺依曼机的指令序列。</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li>&lt;&lt;架构整洁之道&gt;&gt;</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/08/16/Awesome-Books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/16/Awesome-Books/" class="post-title-link" itemprop="url">Awesome Books</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-16 22:39:38" itemprop="dateCreated datePublished" datetime="2021-08-16T22:39:38+08:00">2021-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-20 15:37:37" itemprop="dateModified" datetime="2023-06-20T15:37:37+08:00">2023-06-20</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/16/Awesome-Books/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/16/Awesome-Books/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>358</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Awesome-Books"><a href="#Awesome-Books" class="headerlink" title="Awesome Books"></a>Awesome Books</h2><ol>
<li><a target="_blank" rel="noopener" href="https://hansimov.gitbook.io/csapp/publish-info/publisher-words">深入理解计算机系统 Computer Systems:A Programmer’s Perspective Computer Systems:A Programmer’s Perspective CSAPP</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/sarabander/sicp-pdf">计算机程序的构造和解释 Structure and Interpretation of Computer Programs SICP</a></li>
<li>计算机体系结构 量化研究方法</li>
<li>计算机组成与设计 硬件软件接口</li>
<li>重构</li>
<li>架构整洁之道</li>
<li>代码整洁之道</li>
<li>设计模式</li>
<li>编译原理</li>
<li>软件建模与设计</li>
<li>C++ Primer</li>
<li><a target="_blank" rel="noopener" href="https://github.com/qiangmzsx/Software-Engineering-at-Google">Software-Engineering-at-Google 中文版本</a></li>
<li><a target="_blank" rel="noopener" href="https://abseil.io/resources/swe-book">Software Engineering at Google</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hmemcpy/milewski-ctfp-pdf">Category Theory for Programmers</a></li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cs-books/influential-cs-books">cs-books&#x2F;influential-cs-books</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2021/07/28/Cmake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/28/Cmake/" class="post-title-link" itemprop="url">Modern Cmake</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-28 08:56:09" itemprop="dateCreated datePublished" datetime="2021-07-28T08:56:09+08:00">2021-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-22 14:49:41" itemprop="dateModified" datetime="2024-01-22T14:49:41+08:00">2024-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/Cmake/" itemprop="url" rel="index"><span itemprop="name">Cmake</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/07/28/Cmake/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/07/28/Cmake/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>18 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="code-generate"><a href="#code-generate" class="headerlink" title="code generate"></a>code generate</h2><ol>
<li>vitis ai library overview generate test_performance…. <a target="_blank" rel="noopener" href="https://github.com/Xilinx/Vitis-AI/blob/v2.5/src/Vitis-AI-Library/overview/cmake/XilinxTest.cmake#L346">link</a></li>
</ol>
<h2 id="FetchContent"><a href="#FetchContent" class="headerlink" title="FetchContent"></a>FetchContent</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line">FetchContent_Declare(backward</span><br><span class="line">    GIT_REPOSITORY https://github.com/bombela/backward-cpp</span><br><span class="line">    GIT_TAG master  <span class="comment"># or a version tag, such as v1.6</span></span><br><span class="line">    SYSTEM          <span class="comment"># optional, the Backward include directory will be treated as system directory</span></span><br><span class="line">)</span><br><span class="line">FetchContent_MakeAvailable(backward)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(mytarget PUBLIC Backward::Interface)</span><br></pre></td></tr></table></figure>

<h2 id="版本升级"><a href="#版本升级" class="headerlink" title="版本升级"></a>版本升级</h2><ol>
<li>下载 sh 脚本，本地升级。<a target="_blank" rel="noopener" href="https://github.com/Kitware/CMake/releases">link</a></li>
<li><code>wget -c https://cmake.org/files/v3.28/cmake-3.28.1-linux-x86_64.sh &amp;&amp; chmod +x cmake-3.28.1-linux-x86_64.sh &amp;&amp; ./cmake-3.28.1-linux-x86_64.sh</code></li>
<li><code>wget -c https://cmake.org/files/v3.28/cmake-3.28.1-linux-aarch64.sh &amp;&amp; chmod +x cmake-3.28.1-linux-aarch64.sh &amp;&amp; ./cmake-3.28.1-linux-aarch64.sh</code></li>
</ol>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ol>
<li><code>CMAKE_SOURCE_DIR</code>: project</li>
<li><code>CMAKE_CURRENT_SOURCE_DIR</code> 当前 CMakeLists.txt 所在目录</li>
<li><code>CMAKE_BINARY_DIR</code>: 编译目录</li>
<li><code>CMAKE_CURRENT_BINARY_DIR</code>: 指向当前正在处理的 CMakeLists.txt 文件对应的构建目录。</li>
</ol>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><ol>
<li>makefile 传参</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SRC_DIR ?= /src</span><br><span class="line">BUILD_DIR ?= /build</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">make SRC_DIR=/tmp/src BUILD_DIR=/tmp/build</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>target_compile_definitions</code> 导出定义，供下游使用，<code>add_definitions</code>不会被导出</li>
<li><code>-DCMAKE_TOOLCHAIN_FILE=path/to/toolchain-clang.cmake</code> 设置 toolchain</li>
<li><code>-DCMAKE_BUILD_TYPE=RelWithDebInfo</code> release 模式编译，带 debug info</li>
<li><code>-DCMAKE_VERBOSE_MAKEFILE=ON</code> 显示详细信息</li>
<li><code>-DCMAKE_FIND_DEBUG_MODE=ON</code></li>
<li><code>cmake -S . -B build --trace-source=CMakeLists.txt</code> trace CMakeLists.txt</li>
<li><code>cmake -S . -B build --debug-find</code> trace find</li>
<li>osqp</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Debug&quot;</span>)                                                                                                                                                                                                                             <span class="keyword">set</span>(OSQP_ENABLE_DEBUG <span class="keyword">ON</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_VERBOSE_MAKEFILE <span class="keyword">ON</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li>(good)打印所有变量</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get_cmake_property</span>(_variableNames VARIABLES)</span><br><span class="line"><span class="keyword">foreach</span> (_variableName <span class="variable">$&#123;_variableNames&#125;</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li><code>-DCMAKE_CXX_FLAGS=&quot;-g&quot;</code> cmake 编译选项添加 debug info； release 模式也适用</li>
<li>参考官方写 CMakeLists.txt: <a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/cmake">cmake</a> <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv">opencv</a></li>
<li><code>Call stack</code>: 看出问题的顺序</li>
<li>CMake 3.13 now allows the target_link_libraries() command to be called from any directory to add link dependencies and link interface libraries to targets created in other directories.</li>
<li>cmake 2.8 3.1 对 string(REGEX MATCH “lib.*.so$” LIB ${LIB}) 处理是不同的， 2.8 需要加<code>\\.</code></li>
<li>get_filename_component(LIB ${LIB} NAME_WE) 获取文件名，无后缀</li>
<li>参考 opencv 等库的 CMakeLists.txt</li>
<li>对外 include 里如果包含，需要 PUBLIC 传递出去，如果只在实现里用则用 PRIVATE</li>
<li><code>RUNTIME_DEPENDENCIES</code> 3.21 之后可以安装依赖库</li>
<li><code>#cmakedefine USE_MYMATH</code> 条件编译能看到定义的配置</li>
<li>增量编译：是在源程序已经完成第一次编译的基础上再次编译时采取的一种增量性编译技术。只重新编译必须的部分，即通过依赖分析，只编译修改过的部分及其影响的路径。</li>
<li>debug CMakeLists.txt <code>cmake -S . -B build --trace-source=CMakeLists.txt</code></li>
<li>处理依赖关系时区别名，例如导入 gflags.so <code>add_library(gflags SHARED IMPORTED GLOBAL) add_library(gflags::gflags ALIAS gflags)</code>来区别 libgflags.so</li>
<li>注意区分<code>add_library(gflags SHARED IMPORTED GLOBAL)</code>和<code>libgflags.so</code>的区别，前者是 target, 后者是 so。为了区分两者， 可以使用<code>add_library(gflags SHARED IMPORTED GLOBAL) add_library(gflags::gflags ALIAS gflags)</code> target::target 来区分。</li>
<li><code>cmake</code> + <code>ninja</code> + <code>clang</code> 组合加速编译</li>
<li>bazel、GYP、CMake 和 Meson 是文件生成器(build system generator)， make, ninja 是构建系统。</li>
<li><code>cmake ..</code>: configure the project and generate a native build system</li>
<li>cmake 修改编译选项时需要删除 build 目录下的 <code>CMakeCache.txt</code> 否则编译选项不 work, 或者重新<code>cmake ..</code> or run script <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/42922588">link</a></li>
<li><strong>加速编译</strong>： <code>configure the project and generate a native build system</code>后直接执行<code>make -C $BUILD_DIR -j4</code> or <code>cmake --build $&#123;BUILD_DIR&#125;</code>，不用每次都重新构建编译系统</li>
<li>[CMake] Debug build compiles and links, but Release build fails to link?</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (CMAKE_BUILD_TYPE <span class="keyword">MATCHES</span> Release)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_SHARED_LINKER_FLAGS <span class="string">&quot;-s -Wl,--version-script=$&#123;PROJECT_SOURCE_DIR&#125;/symbol.lst&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li>-DCMAKE_BUILD_TYPE&#x3D;Debug: <code>-fPIC -O2 -Wall</code></li>
<li>-DCMAKE_BUILD_TYPE&#x3D;Release: <code>-fPIC -O2 -DNDEBUG</code></li>
<li><code>enable_testing()</code> 需要在第一级 CMakeLists.txt 里，否则<code>make test</code>不生效</li>
<li>make test 中程序 pwd 路径为 build 目录程序所在路径。</li>
<li><code>Testing/Temporary/LastTest.log</code> 为<code>make test</code>结果</li>
<li><code>set(CMAKE_VERBOSE_MAKEFILE on)</code> make 时显示详细信息，等效为<code>make VERBOSE=1</code></li>
<li>set(CMAKE_C_COMPILER &#x2F;opt&#x2F;gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu&#x2F;bin&#x2F;aarch64-linux-gnu-gcc)， set(CMAKE_CXX_COMPILER &#x2F;opt&#x2F;gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu&#x2F;bin&#x2F;aarch64-linux-gnu-g++) 要在 project 前， 会根据编译器选择环境， 无这条则会选择宿主机， 地平线 demo 问题。</li>
<li>option 和 c++里的 definition 是不一样的 definition 需要 add_definitions()来添加</li>
</ol>
<h2 id="functions"><a href="#functions" class="headerlink" title="functions"></a>functions</h2><h3 id="add-test"><a href="#add-test" class="headerlink" title="add test"></a>add test</h3><h3 id="cpm-add-lib"><a href="#cpm-add-lib" class="headerlink" title="cpm add lib"></a>cpm add lib</h3><h2 id="cmake-变量"><a href="#cmake-变量" class="headerlink" title="cmake 变量"></a>cmake 变量</h2><h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><h2 id="cmake-component"><a href="#cmake-component" class="headerlink" title="cmake component"></a>cmake component</h2><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/cpm-cmake/CPM.cmake">CPM.cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">FetchContent</a></li>
<li>CPM.cmake 封装了 FetchContent</li>
<li>导入已经编译好的库</li>
<li>导入三方库参考 cmake export 出的 cmake file。参见 cpp_sandbox&#x2F;cmake&#x2F;export; 查看生成的 cmake 文件，主要两个步骤<ul>
<li>add_library(xxx::xxx STATIC IMPORTED) 导入库</li>
<li>set_target_properties 设置 include 和 link 依赖</li>
</ul>
</li>
<li>参考 vitis ai 导入 xrt</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(gflags_ADDED)</span><br><span class="line">  <span class="keyword">add_library</span>(gflags INTERFACE IMPORTED GLOBAL) <span class="comment">## global导入， 解决cpm local scope include_directories不工作问题</span></span><br><span class="line">  <span class="keyword">add_library</span>(gflags::gflags ALIAS gflags)</span><br><span class="line">  <span class="keyword">set_target_properties</span>(</span><br><span class="line">    gflags PROPERTIES IMPORTED_LOCATION <span class="string">&quot;$&#123;gflags_SOURCE_DIR&#125;/lib/libgflags.so&quot;</span>)</span><br><span class="line">  <span class="keyword">target_include_directories</span>(gflags INTERFACE <span class="string">&quot;$&#123;gflags_SOURCE_DIR&#125;/include&quot;</span>)</span><br><span class="line">  <span class="comment"># target_link_directories(gflags INTERFACE &quot;$&#123;gflags_SOURCE_DIR&#125;/lib&quot;)</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h2 id="cpack"><a href="#cpack" class="headerlink" title="cpack"></a>cpack</h2><h3 id="build-完之后-make-package"><a href="#build-完之后-make-package" class="headerlink" title="build 完之后 make package"></a>build 完之后 make package</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CPACK_GENERATOR <span class="string">&quot;TGZ&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_FILE_NAME <span class="string">&quot;cpack-test&quot;</span>)                                                                                                                                                                           <span class="keyword">include</span>(CPack)</span><br></pre></td></tr></table></figure>

<h2 id="color"><a href="#color" class="headerlink" title="color"></a>color</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/36233927">cmake 自带打印颜色</a> <code>cmake -E cmake_echo_color --green &quot;&gt;&gt;&gt;&gt;&gt; Download doxygen&quot;</code></li>
<li>put make function in .bashrc</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">make</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">  pathpat=<span class="string">&quot;(/[^/]*)+:[0-9]+&quot;</span></span><br><span class="line">  ccred=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;31m&quot;</span>)</span><br><span class="line">  ccyellow=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;33m&quot;</span>)</span><br><span class="line">  ccend=$(<span class="built_in">echo</span> -e <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line">  make <span class="string">&quot;<span class="variable">$@</span>&quot;</span> 2&gt;&amp;1 | sed -E -e <span class="string">&quot;/[Ee]rror[: ]/ s%<span class="variable">$pathpat</span>%<span class="variable">$ccred</span>&amp;<span class="variable">$ccend</span>%g&quot;</span> -e <span class="string">&quot;/[Ww]arning[: ]/ s%<span class="variable">$pathpat</span>%<span class="variable">$ccyellow</span>&amp;<span class="variable">$ccend</span>%g&quot;</span></span><br><span class="line">  <span class="built_in">return</span> <span class="variable">$&#123;PIPESTATUS[0]&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ol>
<li>内置函数获取名字</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span>(REGEX MATCH <span class="string">&quot;lib.*\.so$&quot;</span> LIB <span class="variable">$&#123;LIB&#125;</span>)</span><br><span class="line"><span class="keyword">if</span>(LIB)</span><br><span class="line">    <span class="keyword">get_filename_component</span>(LIB <span class="variable">$&#123;LIB&#125;</span> NAME_WE)</span><br><span class="line">    <span class="keyword">string</span>(REPLACE <span class="string">&quot;lib&quot;</span> <span class="string">&quot;&quot;</span> LIB <span class="string">&quot;$&#123;LIB&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>.  获取库列表名字</span><br><span class="line"></span><br><span class="line">```cmake</span><br><span class="line"><span class="keyword">execute_process</span>(</span><br><span class="line">  <span class="keyword">COMMAND</span> ls</span><br><span class="line">  <span class="keyword">COMMAND</span> sh -c <span class="string">&quot;awk &#x27;/.so\$|.a\$/&#123;print \$0&#125;&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">COMMAND</span> sh -c <span class="string">&quot;awk -F &#x27;.&#x27; &#x27;&#123;print substr($1,4)&#125;&#x27;&quot;</span></span><br><span class="line">  WORKING_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span></span><br><span class="line">  OUTPUT_VARIABLE LIBS</span><br><span class="line">  OUTPUT_STRIP_TRAILING_WHITESPACE)</span><br><span class="line"><span class="keyword">message</span>(STATUS, <span class="string">&quot;LIBS=$&#123;LIBS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot;\n&quot;</span> <span class="string">&quot;;&quot;</span> LIBS <span class="string">&quot;$&#123;LIBS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">list</span>(LENGTH LIBS len)</span><br><span class="line"><span class="keyword">message</span>(STATUS, <span class="string">&quot;len=\&quot;$&#123;len&#125;\&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot; &quot;</span> <span class="string">&quot;;&quot;</span> SEXY_LIST <span class="variable">$&#123;LIBS&#125;</span>)</span><br><span class="line"><span class="keyword">foreach</span>(LIB <span class="variable">$&#123;LIBS&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS, <span class="string">&quot;LIB=\&quot;$&#123;LIB&#125;\&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>&#96;include(CMakePrintHelpers) cmake_print_variables(MY_VARIABLE)” 打印信息</p>
</li>
<li><p><code>-DCMAKE_EXPORT_COMPILE_COMMANDS=ON</code> 代码补全使用</p>
</li>
<li><p><code>cmake -LA</code> after build in build dir:list a set of available options in the cmake</p>
</li>
<li><p>如果 CMAKE_BUILD_TYPE 的值为”Debug”就采用 debug 模式编译；如果 CMAKE_BUILD_TYPE 的值为”Release”就采用 release 模式编译；如果 CMAKE_BUILD_TYPE 的值为空，默认采用 release 模式</p>
</li>
<li><p>debug release set</p>
</li>
<li><p>CMakeLists.txt</p>
</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword">SET</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Release&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>build script</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> Release</span><br><span class="line"><span class="built_in">cd</span> Release</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<ol>
<li><code>set(CMAKE_CXX_COMPILER &quot;g++&quot;)</code> 选择编译器</li>
<li>查看 target properties</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get all propreties that cmake supports</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_PROPERTY_LIST)</span><br><span class="line">    <span class="keyword">execute_process</span>(<span class="keyword">COMMAND</span> cmake --help-property-<span class="keyword">list</span> OUTPUT_VARIABLE CMAKE_PROPERTY_LIST)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert command output into a CMake list</span></span><br><span class="line">    <span class="keyword">string</span>(REGEX REPLACE <span class="string">&quot;;&quot;</span> <span class="string">&quot;\\\\;&quot;</span> CMAKE_PROPERTY_LIST <span class="string">&quot;$&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">string</span>(REGEX REPLACE <span class="string">&quot;\n&quot;</span> <span class="string">&quot;;&quot;</span> CMAKE_PROPERTY_LIST <span class="string">&quot;$&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(print_properties)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;CMAKE_PROPERTY_LIST = $&#123;CMAKE_PROPERTY_LIST&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>(print_target_properties <span class="keyword">target</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">TARGET</span> <span class="variable">$&#123;target&#125;</span>)</span><br><span class="line">      <span class="keyword">message</span>(STATUS <span class="string">&quot;There is no target named &#x27;$&#123;target&#125;&#x27;&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span>()</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(property <span class="variable">$&#123;CMAKE_PROPERTY_LIST&#125;</span>)</span><br><span class="line">        <span class="keyword">string</span>(REPLACE <span class="string">&quot;&lt;CONFIG&gt;&quot;</span> <span class="string">&quot;$&#123;CMAKE_BUILD_TYPE&#125;&quot;</span> property <span class="variable">$&#123;property&#125;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Fix https://stackoverflow.com/questions/32197663/how-can-i-remove-the-the-location-property-may-not-be-read-from-target-error-i</span></span><br><span class="line">        <span class="keyword">if</span>(property <span class="keyword">STREQUAL</span> <span class="string">&quot;LOCATION&quot;</span> <span class="keyword">OR</span> property <span class="keyword">MATCHES</span> <span class="string">&quot;^LOCATION_&quot;</span> <span class="keyword">OR</span> property <span class="keyword">MATCHES</span> <span class="string">&quot;_LOCATION$&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span>()</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">get_property</span>(was_set <span class="keyword">TARGET</span> <span class="variable">$&#123;target&#125;</span> PROPERTY <span class="variable">$&#123;property&#125;</span> <span class="keyword">SET</span>)</span><br><span class="line">        <span class="keyword">if</span>(was_set)</span><br><span class="line">            <span class="keyword">get_target_property</span>(value <span class="variable">$&#123;target&#125;</span> <span class="variable">$&#123;property&#125;</span>)</span><br><span class="line">            <span class="keyword">message</span>(<span class="string">&quot;$&#123;target&#125; $&#123;property&#125; = $&#123;value&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">endif</span>()</span><br><span class="line">    <span class="keyword">endforeach</span>()</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">print_target_properties(xxx)</span><br></pre></td></tr></table></figure>

<ol>
<li>查看 cmake property</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get_cmake_property</span><span class="params">(_variableNames VARIABLES)</span></span></span><br><span class="line">foreach (_variableName $&#123;_variableNames&#125;)</span><br><span class="line">    <span class="built_in">message</span>(STATUS <span class="string">&quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li>查看 include_director</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(dirs DIRECTORY $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; PROPERTY INCLUDE_DIRECTORIES)</span></span></span><br><span class="line"><span class="function"><span class="title">foreach</span><span class="params">(dir $&#123;dirs&#125;)</span></span></span><br><span class="line">  <span class="built_in">message</span>(STATUS <span class="string">&quot;include dir=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(dirs DIRECTORY $&#123;CMAKE_CURRENT_SOURCE_DIR&#125; PROPERTY LINK_DIRECTORIES)</span></span></span><br><span class="line"><span class="function"><span class="title">foreach</span><span class="params">(dir $&#123;dirs&#125;)</span></span></span><br><span class="line">  <span class="built_in">message</span>(STATUS <span class="string">&quot;link dir=&#x27;$&#123;dir&#125;&#x27;&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">endforeach</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>ctest -N</code> 查看 test 列表</li>
<li>target_compile_definitions(full_flow PRIVATE “-DGIT_INFO&#x3D;&quot;${GIT_BRANCH}-${GIT_COMMIT_HASH}&quot;“) 代替 add_definitions(-DGIT_INFO)</li>
<li>add_subdirectory(protobuf) 添加子文件夹，子文件夹下 CmakeLists.txt 管理相应文件夹。</li>
<li>cmake_minimum_required(VERSION 3.8） 版本要求</li>
<li>project(HELLO) 定义工程名</li>
<li>message(STATUS, ““） 打印消息</li>
<li>aux_source_directory(. DIR_SRCS) 查找指定目录下的所有源文件并将结果存入变量名</li>
<li>add_excutable(hello, ${DIR_SRCS}) 定义了工程生成的可执行程序文件名，源文件为 DIR_SRCS 变量中定义的源文件列表</li>
<li>add_library(libname [SHARED | STATIC | MODULE] source_files) 定义了库文件名 静态库，动态库不能重名</li>
<li>add_library(hello_static STATIC ${LIBHELLO_SRC}) set_target_properties(hello_static PROPERTIES OUTPUT_NAME “hello”) 有 libhello.so 的情况下生成 libhello.a</li>
<li><code>CMAKE_INSTALL_PREFIX</code> 变量类似于 configure 脚本的 – prefix,常见的使用方法看 <code>cmake -DCMAKE_INSTALL_PREFIX=/usr .</code></li>
<li><code>make install PREFIX=your_installation_directory</code></li>
<li>install(TARGETS name [ARCHIVE|LIBRARY|RUNTIME] [DESTINATION <dir>] …) 安装库和可执行程序</li>
<li>install(FILES include&#x2F;quicksort.hpp DESTINATION include) 安装头文件</li>
<li>include_directories(&#x2F;usr&#x2F;include&#x2F;hello) 添加头文件搜索路径</li>
<li>link_directories(dir1 dir2…) 添加链接库路径</li>
<li>官网不推荐使用 link_directoris，而是推荐使用 find_package 和 find_library 寻找共享库的绝对路径，再传给 target_link_libraries 使用</li>
<li>find_library(LIBQUICKSORT_PATH quicksort .&#x2F;lib)</li>
<li>find_path(GLOG_INCLUDE_DIR glog&#x2F;logging.h PATHS ${GLOG_ROOT_DIR}) 先查找路径再查找库 find_library(GLOG_LIBRARY glog PATHS ${GLOG_ROOT_DIR} PATH_SUFFIXES lib lib64)</li>
<li>target_link_libraries(main hello) 为可执行程序添加 libhello.so 链接库</li>
<li>add_definitions(“-DNDEBUG” “-O3”) 向编译器添加编译选项</li>
<li>set(CMAKE_CXX_FLAGS “$(CMAKE_CXX_FLAGS) -std&#x3D;c++11”) 设置 C++编译选项 等价于 add_definitons(“-std&#x3D;c++11)</li>
<li>option 选项，让你可以根据选项值进行条件编译 option(DEBUG “Debug mode.” OFF)</li>
<li>cmake –help-module FindProtobuf ；cmake –help-module FindThreads 查看模块的 cmake 用法</li>
<li>list</li>
<li>file</li>
<li>string</li>
<li>foreach</li>
<li>if 用法</li>
</ol>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">option</span>(<span class="variable">DEBUG</span> <span class="string">&quot;Debug mode.&quot;</span> <span class="variable">OFF</span>)</span></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="variable">DEBUG</span>)</span></span><br><span class="line">    <span class="function"><span class="title">message</span>(<span class="variable">STATUS</span> <span class="string">&quot;Use Debug mode&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="title">else</span>()</span></span><br><span class="line">    <span class="function"><span class="title">message</span>(<span class="variable">STATUS</span> <span class="string">&quot;Don&#x27;t use Debug mode&quot;</span>)</span></span><br><span class="line"><span class="variable"><span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><ol>
<li>CMake is not a build system. It’s the build system generator.</li>
<li>add_subdirectory 最好只有一层，避免嵌套，只添加顶层文件夹</li>
</ol>
<h2 id="Target-and-Property"><a href="#Target-and-Property" class="headerlink" title="Target and Property"></a>Target and Property</h2><ol>
<li>现代化的 CMake 是围绕 Target 和 Property 来定义的，并且竭力避免出现变量 variable 的定义。Variable 横行是典型 CMake2.8 时期的风格。现代版的 CMake 更像是在遵循 OOP 的规则，通过 target 来约束 link、compile 等相关属性的作用域。</li>
</ol>
<h3 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h3><ol>
<li>如果把一个 Target 想象成一个对象（Object），会发现两者的组织方式非常相似：</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">构造函数：</span><br><span class="line">add_executable</span><br><span class="line">add_library</span><br><span class="line">成员函数：</span><br><span class="line"><span class="function"><span class="title">get_target_property</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">set_target_properties</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">get_property</span><span class="params">(TARGET)</span></span></span><br><span class="line"><span class="function"><span class="title">set_property</span><span class="params">(TARGET)</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_definitions</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_features</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_compile_options</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_include_directories</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_link_libraries</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">target_sources</span><span class="params">()</span></span></span><br><span class="line">成员变量</span><br><span class="line">Target properties（太多）</span><br></pre></td></tr></table></figure>

<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><ol>
<li>target_xxx 命令 PRIVATE&#x2F;PUBLIC…后为 property，例如</li>
</ol>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target_source(MyEXE PRIVATE <span class="string">&quot;main.cpp&quot;</span>)  ## main.cpp为source属性</span><br><span class="line">target_link_library(MyEXE PRIVATE Poco::Net Poco::Util) ## Poco:Net Poco::Util为link属性</span><br><span class="line">target_compile_definition(MyEXE PRIVATE std_cxx_14) ## std_cxx_14为编译属性</span><br></pre></td></tr></table></figure>

<h2 id="Build-Requirements-and-Usage-Requirements"><a href="#Build-Requirements-and-Usage-Requirements" class="headerlink" title="Build-Requirements and Usage-Requirements"></a>Build-Requirements and Usage-Requirements</h2><ol>
<li><code>Build-Requirements</code>： 包含了所有构建 Target 必须的材料。如源代码，include 路径，预编译命令，链接依赖，编译&#x2F;链接选项，编译&#x2F;链接特性等。</li>
<li><code>Usage-Requirements</code>：包含了所有使用 Target 必须的材料。如源代码，include 路径，预编译命令，链接依赖，编译&#x2F;链接选项，编译&#x2F;链接特性等。这些往往是当另一个 Target 需要使用当前 target 时，必须包含的依赖</li>
</ol>
<h2 id="PRIVATE-INTERFACE-PUBLIC"><a href="#PRIVATE-INTERFACE-PUBLIC" class="headerlink" title="PRIVATE&#x2F;INTERFACE&#x2F;PUBLIC"></a>PRIVATE&#x2F;INTERFACE&#x2F;PUBLIC</h2><ol>
<li>没有指定 PUBLIC 或 PRIVATE 关键字时,CMake 会把这个链接库的属性默认设置为 PRIVATE。</li>
<li>定义了<code>Target属性</code>的传递范围。</li>
<li><code>PRIVATE</code>: 表示 Target 的属性只定义在当前 Target 中，任何依赖当前 Target 的 Target 不共享 PRIVATE 关键字下定义的属性。</li>
<li><code>INTERFACE</code>：表示 Target 的属性不适用于其自身，而只适用于依赖其的 Target。</li>
<li><code>PUBLIC</code>：表示 Target 的属性既是 build-requirements 也是 usage-requirements。凡是依赖。凡是依赖于当前 Target 的 Target 都会共享本属性。</li>
</ol>
<h2 id="Modern-Cmake-Using-Steps"><a href="#Modern-Cmake-Using-Steps" class="headerlink" title="Modern Cmake Using Steps"></a>Modern Cmake Using Steps</h2><ol>
<li>Always create targets with no sources first.</li>
<li>Use <code>target...</code> commands to add build-&#x2F;usage-requirements</li>
<li>Use <code>IMPORTED</code> targets for external libraires. But, prefer <code>find_package</code> or <code>EXPORTED</code> targets ro creating them yourself.</li>
</ol>
<h2 id="3-13-之默认生成绝对路径"><a href="#3-13-之默认生成绝对路径" class="headerlink" title="3.13 之默认生成绝对路径"></a>3.13 之默认生成绝对路径</h2><ol>
<li>3.13 之前</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_library( MyTarget SHARED )</span><br><span class="line">target_sources ( MyTarget</span><br><span class="line">    <span class="keyword">PRIVATE</span>    src/A.cpp</span><br><span class="line">               src/B.cpp</span><br><span class="line">               headers/B.hpp</span><br><span class="line">    <span class="keyword">PUBLIC</span>     $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;<span class="regexp">/headers/</span>A.hpp</span><br><span class="line">    <span class="keyword">INTERFACE</span>  $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;<span class="regexp">/headers/</span>C.hpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>3.13 之后生成绝对路径</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add_library( MyTarget SHARED )</span><br><span class="line">target_sources ( MyTarget</span><br><span class="line">    PRIVATE    <span class="attribute">src</span>/<span class="selector-tag">A</span><span class="selector-class">.cpp</span></span><br><span class="line">               <span class="attribute">src</span>/<span class="selector-tag">B</span><span class="selector-class">.cpp</span></span><br><span class="line">               headers/<span class="selector-tag">B</span><span class="selector-class">.hpp</span></span><br><span class="line">    PUBLIC     headers/<span class="selector-tag">A</span><span class="selector-class">.hpp</span></span><br><span class="line">    INTERFACE  headers/C<span class="selector-class">.hpp</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h2><ol>
<li>top level CMakeLists.txt begining:</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>( VERSION <span class="number">3.15</span>...<span class="number">3.17</span> )</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>( CMAKE_PROJECT_INCLUDE_BEFORE</span><br><span class="line">     <span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/common-project-info.in&quot;</span> )</span><br><span class="line"><span class="comment"># include( &quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/common-project-include.in&quot; )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span> (MyRootProject</span><br><span class="line">    VERSION <span class="variable">$&#123;project_version&#125;</span></span><br><span class="line">    DESCRIPTION <span class="variable">$&#123;project_description&#125;</span></span><br><span class="line">    HOMEPAGE_URL <span class="variable">$&#123;project_homepage&#125;</span></span><br><span class="line">    LANGUAGES C CXX )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># common-project-info.in</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> ( project_version 1.2.3 )</span><br><span class="line"><span class="built_in">set</span> ( project_description <span class="string">&quot;test....&quot;</span> )</span><br><span class="line"><span class="built_in">set</span> ( project_homepage <span class="string">&quot;https://www....&quot;</span> )</span><br></pre></td></tr></table></figure>

<h2 id="find-package"><a href="#find-package" class="headerlink" title="find_package"></a><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/658727351">find_package</a></h2><ol>
<li><p><code>find_package(xxx REQUIRED HINTS /usr/local/lib)</code></p>
</li>
<li><p><code>export CMAKE_PREFIX_PATH=/usr/lib/x86_64-linux-gnu:/usr/local/lib/x86_64-linux-gnu</code> or <code>set(CMAKE_FIND_ROOT_PATH /usr/lib/x86_64-linux-gnu /usr/local/lib/x86_64-linux-gnu)</code>设置查找路径</p>
</li>
<li><p>find_package 采用两种模式搜索库：The “better” way(Config 模式) to do things is to have an installed package provide its own details to CMake; <a target="_blank" rel="noopener" href="https://hsf-training.github.io/hsf-training-cmake-webpage/09-findingpackages/index.html#findpackage">link</a></p>
<ul>
<li><code>Module模式</code>：搜索 CMAKE_MODULE_PATH 指定路径下的 FindXXX.cmake 文件，执行该文件从而找到 XXX 库。其中，具体查找库并给 XXX_INCLUDE_DIRS 和 XXX_LIBRARIES 两个变量赋值的操作由 FindXXX.cmake 模块完成。</li>
<li><code>Config模式</code>：搜索 XXX_DIR 指定路径下的 XXXConfig.cmake 文件，执行该文件从而找到 XXX 库。其中具体查找库并给 XXX_INCLUDE_DIRS 和 XXX_LIBRARIES 两个变量赋值的操作由 XXXConfig.cmake 模块完成</li>
</ul>
</li>
<li><p>两种模式看起来似乎差不多，不过 cmake 默认采取 Module 模式，如果 Module 模式未找到库，才会采取 Config 模式。如果 XXX_DIR 路径下找不到 XXXConfig.cmake 文件，则会找&#x2F;usr&#x2F;local&#x2F;lib&#x2F;cmake&#x2F;XXX&#x2F;中的 XXXConfig.cmake 文件。总之，Config 模式是一个备选策略。通常，库安装时会拷贝一份 XXXConfig.cmake 到系统目录中，因此在没有显式指定搜索路径时也可以顺利找到。</p>
</li>
</ol>
<h2 id="find-path-and-include"><a href="#find-path-and-include" class="headerlink" title="find_path and include"></a>find_path and include</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find_path</span>(XRT_INCLUDE_DIRS</span><br><span class="line">    NAMES xrt<span class="selector-class">.h</span></span><br><span class="line">    PATH_SUFFIXES xrt</span><br><span class="line">    )</span><br><span class="line"><span class="function"><span class="title">message</span><span class="params">(<span class="string">&quot;config types: $&#123;XRT_INCLUDE_DIRS&#125;&quot;</span>)</span></span></span><br></pre></td></tr></table></figure>

<h2 id="pkg-config"><a href="#pkg-config" class="headerlink" title="pkg-config"></a>pkg-config</h2><ol>
<li>如果 find_package 找不到库，如果系统中有库的.pc 配置文件，可以使用 pkg-config 替代。</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(glog QUIET)</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">NOT</span> glog_FOUND)</span><br><span class="line">    <span class="keyword">find_package</span>(PkgConfig)</span><br><span class="line">    pkg_search_module(PKG_GLOG REQUIRED IMPORTED_TARGET GLOBAL libglog)</span><br><span class="line">    <span class="keyword">add_library</span>(glog::glog ALIAS PkgConfig::PKG_GLOG)</span><br><span class="line"><span class="keyword">endif</span>(<span class="keyword">NOT</span> glog_found)</span><br></pre></td></tr></table></figure>

<h2 id="组件变量"><a href="#组件变量" class="headerlink" title="组件变量"></a>组件变量</h2><h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li>例子 1：最基础例子</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">cmake_minimum_required</span><span class="params">(VERSION <span class="number">3.8</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">project</span><span class="params">(QUICKSORT)</span></span></span><br><span class="line"><span class="function"><span class="title">aux_source_directory</span><span class="params">(. DIR_SRCS)</span></span></span><br><span class="line"><span class="function"><span class="title">add_definitions</span><span class="params">(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">set</span><span class="params">(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(quicksort $&#123;DIR_SRCS&#125;)</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>例子 2： 使用静态库并安装</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort DESTINATION lib)  <span class="comment">#安装静态库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort)</span><br><span class="line"></span><br><span class="line"><span class="comment">#install program</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS main RUNTIME DESTINATION bin)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 3 只使用动态库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add shared liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort SHARED</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="keyword">include</span>/quicksort.hpp DESTINATION <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 4 安装静态库和动态库</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="built_in">project</span>(QUICKSORT)</span><br><span class="line"><span class="selector-id">#aux_source_directory</span>( DIR_SRCS)</span><br><span class="line"><span class="selector-id">#add</span> shared liabrary</span><br><span class="line"><span class="built_in">add_library</span>(quicksort SHARED</span><br><span class="line">    include/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="selector-id">#add</span> static liabrary</span><br><span class="line"><span class="built_in">add_library</span>(quicksort_static STATIC</span><br><span class="line">    include/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="built_in">set_target_properties</span>(quicksort_static PROPERTIES OUTPUT_NAME &quot;quicksort&quot;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">SET_TARGET_PROPERTIES</span>(quicksort PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="built_in">SET_TARGET_PROPERTIES</span>(quicksort_static PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="built_in">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="built_in">install</span>(TARGETS quicksort_static ARCHIVE DESTINATION lib)</span><br><span class="line"><span class="built_in">install</span>(FILES include/quicksort.hpp DESTINATION include)</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#add</span> target</span><br><span class="line"><span class="built_in">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="built_in">add_definitions</span>(&quot;-DNDEBUG&quot; &quot;-O3&quot; &quot;-std=c++<span class="number">11</span>&quot;)</span><br><span class="line"><span class="selector-id">#set</span>(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++<span class="number">11</span>&quot;)</span><br><span class="line"><span class="built_in">add_executable</span>(main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#link</span> library</span><br><span class="line"><span class="built_in">include_directories</span>(include)</span><br><span class="line"><span class="built_in">target_link_libraries</span>(main quicksort)</span><br><span class="line"></span><br><span class="line"># 参考 https://www.cnblogs.com/zhoug2020/p/<span class="number">5904206</span>.html</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 5 添加 glog 库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="keyword">project</span>(QUICKSORT)</span><br><span class="line"><span class="comment">#aux_source_directory( DIR_SRCS)</span></span><br><span class="line"><span class="comment">#add shared liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort SHARED</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="comment">#add static liabrary</span></span><br><span class="line"><span class="keyword">add_library</span>(quicksort_static STATIC</span><br><span class="line">    <span class="keyword">include</span>/quicksort.hpp</span><br><span class="line">    src/quicksort.cpp)</span><br><span class="line"><span class="keyword">set_target_properties</span>(quicksort_static PROPERTIES OUTPUT_NAME <span class="string">&quot;quicksort&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(quicksort PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="keyword">SET_TARGET_PROPERTIES</span>(quicksort_static PROPERTIES CLEAN_DIRECT_OUTPUT <span class="number">1</span>)</span><br><span class="line"><span class="keyword">install</span>(TARGETS quicksort LIBRARY DESTINATION lib)</span><br><span class="line"><span class="comment">#install(TARGETS quicksort_static ARCHIVE DESTINATION lib)</span></span><br><span class="line"><span class="keyword">install</span>(FILES <span class="keyword">include</span>/quicksort.hpp DESTINATION <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add target</span></span><br><span class="line"><span class="keyword">set</span>(SRC_LIST src/main.cpp)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="string">&quot;-DNDEBUG&quot;</span> <span class="string">&quot;-O3&quot;</span> <span class="string">&quot;-std=c++11&quot;</span>)</span><br><span class="line"><span class="comment">#set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;)</span></span><br><span class="line"><span class="keyword">add_executable</span>(main <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#link library</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span> /home/jiaxiyang/workspace/glog/lib/<span class="keyword">include</span>) <span class="comment">#添加glog include目录</span></span><br><span class="line"><span class="keyword">link_directories</span>(/home/jiaxiyang/workspace/glog/lib/lib) <span class="comment">#添加glog库安装路径</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(main quicksort glog)</span><br><span class="line"><span class="keyword">install</span>(TARGETS main RUNTIME DESTINATION bin)</span><br></pre></td></tr></table></figure>

<ol>
<li>例子 6 链接自己编译的库</li>
</ol>
<figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.8)</span><br><span class="line">project(QUICKSORT)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">SET_TARGET_PROPERTIES</span><span class="params">(<span class="variable">quicksort</span> <span class="variable">PROPERTIES</span> <span class="variable">CLEAN_DIRECT_OUTPUT</span> 1)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">SET_TARGET_PROPERTIES</span><span class="params">(<span class="variable">quicksort_static</span> <span class="variable">PROPERTIES</span> <span class="variable">CLEAN_DIRECT_OUTPUT</span> 1)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">TARGETS</span> <span class="variable">quicksort</span> <span class="variable">LIBRARY</span> <span class="variable">DESTINATION</span> <span class="variable">lib</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">TARGETS</span> <span class="variable">quicksort_static</span> <span class="variable">ARCHIVE</span> <span class="variable">DESTINATION</span> <span class="variable">lib</span>)</span></span></span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">install</span><span class="params">(<span class="variable">FILES</span> <span class="variable">include</span>/<span class="variable">quicksort</span>.<span class="variable">hpp</span> <span class="variable">DESTINATION</span> <span class="variable">include</span>)</span></span></span><br><span class="line"></span><br><span class="line">#add target</span><br><span class="line">set(SRC_LIST src/main.cpp)</span><br><span class="line">add_definitions(&quot;-DNDEBUG&quot; &quot;-O3&quot; &quot;-std=c++11&quot;)</span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">set</span><span class="params">(<span class="variable">CMAKE_CXX_FLAGS</span> <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;</span>)</span></span></span><br><span class="line">add_executable(main $&#123;SRC_LIST&#125;)</span><br><span class="line"></span><br><span class="line">#link library</span><br><span class="line">include_directories(/home/jiaxiyang/workspace/algorithm/quicksort1/include /home/jiaxiyang/workspace/glog/lib/include) #添加glog include目录</span><br><span class="line">link_directories(/home/jiaxiyang/workspace/glog/lib/lib) #添加glog库安装路径</span><br><span class="line"><span class="function"><span class="keyword">#</span><span class="title">link_directories</span><span class="params">(/<span class="variable">home</span>/<span class="variable">jiaxiyang</span>/<span class="variable">workspace</span>/<span class="variable">algorithm</span>/<span class="variable">quicksort1</span>/<span class="variable">lib</span>)</span></span> #添加glog库安装路径   如果没有find_library，出现在add_executable后面会出错 建议用find_library</span><br><span class="line">find_library(LIBQUICKSORT_PATH quicksort ./lib)</span><br><span class="line">MESSAGE(STATUS $&#123;LIBQUICKSORT_PATH&#125; &quot; found&quot;)</span><br><span class="line"></span><br><span class="line">target_link_libraries(main $&#123;LIBQUICKSORT_PATH&#125; glog)</span><br><span class="line">install(TARGETS main RUNTIME DESTINATION bin)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://hsf-training.github.io/hsf-training-cmake-webpage/">More Modern CMake</a></li>
<li><a target="_blank" rel="noopener" href="https://bazel.build/reference?hl=zh-cn">参考文档: 构建百科全书， 测试百科全书，命令行参考文档，查询参考文档</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">Cmake Tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://discourse.cmake.org/">Cmake Forum</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jiaxiyang/documents/blob/master/pcmake.pdf">Professional CMake pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html">Cmake Buildsystem</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1">Effective Modern Cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">Effective Modern Cmake video</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=y9kSr5enrSk">Deniz Bahadir 2019</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=y7ndUhdQuU8">Deniz Bahadir 2018 traditional and modern camke</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Bagira80/More-Modern-CMake">Beniz Bahadir PPT</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/76975231">OO Cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://ukabuer.me/blog/more-modern-cmake">Cmake Concept</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贾夕阳"
      src="/images/coder2.jpg">
  <p class="site-author-name" itemprop="name">贾夕阳</p>
  <div class="site-description" itemprop="description">深度学习/自动驾驶/C++/性能优化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">174</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaxiyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaxiyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2024/02/03/flashattention/" title="2024&#x2F;02&#x2F;03&#x2F;flashattention&#x2F;">flashattention</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/26/cutlass/" title="2024&#x2F;01&#x2F;26&#x2F;cutlass&#x2F;">cutlass</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/25/OpenCL/" title="2024&#x2F;01&#x2F;25&#x2F;OpenCL&#x2F;">OpenCL</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/14/Efficient-LLM/" title="2024&#x2F;01&#x2F;14&#x2F;Efficient-LLM&#x2F;">Efficient-LLM</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/11/blas/" title="2024&#x2F;01&#x2F;11&#x2F;blas&#x2F;">blas</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贾夕阳</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">459k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:58</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/26/2020 14:52:10");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://jiaxiyang.github.io/page/14/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'g32ipLmEye1u5l6wBGRJt03S-gzGzoHsz',
      appKey     : 'zHgLkAICsZUl9Mf8LfdoVigP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>





 
</body>
</html>

