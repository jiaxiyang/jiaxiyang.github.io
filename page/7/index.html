<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiaxiyang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiyang">
<meta property="og:url" content="https://jiaxiyang.github.io/page/7/index.html">
<meta property="og:site_name" content="Xiyang">
<meta property="og:description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="贾夕阳">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jiaxiyang.github.io/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiyang</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGS6S6YFJ6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WGS6S6YFJ6');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiyang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Think twice, code once!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">196</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">44</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiaxiyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/11/10/nvidia/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/10/nvidia/" class="post-title-link" itemprop="url">nvidia</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-10 11:45:20" itemprop="dateCreated datePublished" datetime="2023-11-10T11:45:20+08:00">2023-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-25 10:41:25" itemprop="dateModified" datetime="2024-01-25T10:41:25+08:00">2024-01-25</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/11/10/nvidia/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/11/10/nvidia/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li><a target="_blank" rel="noopener" href="https://epochai.org/blog/trends-in-machine-learning-hardware">trends-in-machine-learning-hardware</a></li>
<li><code>export CUDA_VISIBLE_DEVICES=0,1</code>强制使用哪几个 GPU 上</li>
<li>sdk manager 图像界面安装各种工具</li>
<li>fp32 -&gt; fp16(int8)是否加速要看芯片手册</li>
<li>芯片手册中有 cuda core 算力和 tensor core 算力 <a target="_blank" rel="noopener" href="https://www.nvidia.com/content/PDF/nvidia-ampere-ga-102-gpu-architecture-whitepaper-v2.pdf">link</a><ul>
<li>3090 的 cuda core int32 算力是 fp21 的一半</li>
<li>3090 的 cuda core fp32 和 fp16 算力一样</li>
<li>3090 的 fp32 cuda core 和 tensor core 算力一样</li>
<li>3090 的 tensor core fp16 算力是 fp32 的 2 倍或 4 倍</li>
<li>3070 一样的现象</li>
</ul>
</li>
</ol>
<h2 id="查看-GPU-info"><a href="#查看-GPU-info" class="headerlink" title="查看 GPU info"></a>查看 GPU info</h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/nvidia/cuda-samples">cuda-sample</a> 见 cuda.md</p>
<ul>
<li><code>cd /usr/local/cuda-12/samples/1_Utilities/deviceQuery &amp;&amp; make &amp;&amp; ./deviceQuery</code> 查看 gpu 详细信息,<ul>
<li>arch: 3080， 3090 是 sm_86, orin 是 sm_87</li>
<li>sm num</li>
<li>cuda core num &#x2F; per sm</li>
<li>Maximum number of threads per block</li>
<li>Maximum number of threads per multiprocessor</li>
<li>Max dimension size of a thread block (x,y,z)</li>
<li>Max dimension size of a grid size (x,y,z)</li>
</ul>
</li>
</ul>
</li>
<li><p>通过对比 sm 个数等信息可以估算大致性能差距</p>
</li>
<li><p>查看 driver 版本 <code>cat /proc/driver/nvidia/version</code></p>
</li>
</ol>
<h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><ol>
<li><code>nvitop</code></li>
<li><code>nvtop</code> 有风险</li>
<li><a target="_blank" rel="noopener" href="https://github.com/wookayin/gpustat">gpustat</a><ul>
<li>不要用源码装：否则 NVML 版本不匹配</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/michaelcjl/p/16657548.html">nvidia-smi 命令参数含义</a></li>
<li><code>nvidia-smi</code> 可以看出每个 GPU 的显存总量和使用量 还可以看到 cuda 版本</li>
<li><code>nvidia-smi -L</code>列出 GPU 列表, 查看 GPU 先开显卡型号</li>
<li><code>nvidia-smi -l 1</code> 会每秒更新一次显示信息。<code>watch -n 1 nvidia-smi</code> 类似 top</li>
<li><code>nvidia-smi -q</code> 查看 GPU 信息</li>
<li><code>free -h</code> 看内存，注意服务器上内存和显存不一样, 不共享; PCIe 接在服务器上。 服务器市场的需求与集成设备（如 Jetson 系列）不同。服务器用户通常需要高度定制化的解决方案，可以独立升级和优化各个组件，而集成设备则更注重成本效益和空间效率。</li>
<li>加速器：不包含 arm</li>
</ol>
<h2 id="edge"><a href="#edge" class="headerlink" title="edge"></a>edge</h2><ol>
<li>SOC: 包含 arm</li>
<li>NVIDIA Jetson 系列设备，包括像 Jetson Nano、Jetson TX1&#x2F;TX2、Jetson Xavier、 Jetson Orin 等，使用的是 NVIDIA 的 <code>Tegra</code> 架构。在这种架构中，CPU 和 GPU 确实共享内存，这被称为<code>统一内存（Unified Memory）或共享内存</code>。</li>
<li>统一内存的优缺点：<a target="_blank" rel="noopener" href="https://chat.openai.com/c/c4285778-9988-4bba-80b2-0ae08689af88">link</a><ul>
<li>优点：简化编程模型， 提高效率</li>
<li>缺点：内存访问延迟，带宽限制，复杂的内存管理</li>
</ul>
</li>
<li>tegra 是 SOC 架构</li>
<li><code>jtop</code> <a target="_blank" rel="noopener" href="https://github.com/rbonghi/jetson_stats">jetson_stats</a> jetson-stats is a package for monitoring and control your NVIDIA Jetson [Orin, Xavier, Nano, TX] series.</li>
<li><code>jetson_release</code></li>
</ol>
<h2 id="指标"><a href="#指标" class="headerlink" title="指标"></a>指标</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.techpowerup.com/gpu-specs/">gpu specs</a></li>
</ol>
<h3 id="performance"><a href="#performance" class="headerlink" title="performance"></a>performance</h3><ol>
<li><code>FLOPS = 2 x freqs * cores</code> fma 有 2 个 flop， f32 性能 cores 就是 f32 cuda core number</li>
</ol>
<h3 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h3><ol>
<li><code>B/s = bps * width / 8</code></li>
</ol>
<h3 id="pcie"><a href="#pcie" class="headerlink" title="pcie"></a>pcie</h3><h2 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h2><ol>
<li>性能参数：产品 -&gt; 规格</li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.cn/autonomous-machines/embedded-systems/">边缘计算产品</a> 查看模组对比， 可以看到各个芯片的参数<ul>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/embedded/develop/roadmap">jetson roadmap</a></li>
</ul>
</li>
<li>数据中心： A, H, L, V 系列<ul>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.cn/data-center/h100/">H100 性能参数</a> 游戏：RTX, GTX</li>
<li>RTX: Ray Tracing eXtreme</li>
<li>GTX: Graphics Processor protoType eXtreme</li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.cn/geforce/graphics-cards/compare/?section=compare-specs">GeForce 显卡比较</a></li>
<li>在 NVIDIA 的 GeForce 系列显卡中，Ti 是一个特殊的标识，用来表示某个型号的改进或升级版。从本意来讲，TI 属于’Titanium’的缩写，和太空金属’钛’是一个意思，在显卡中他代表着更高级版本。</li>
</ul>
</li>
</ol>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><ol>
<li>搜 white paper 看细节</li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/en-us/design-visualization/ampere-architecture/">ampere-architecture 官方架构详细介绍</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/en-us/data-center/technologies/hopper-architecture/">hopper-architecture</a><ul>
<li>下方的白皮书</li>
<li>手册中有芯片 cuda core 算力和 tensor core 算力</li>
<li>利用 tensor core 才能达到最大算力</li>
<li>int32 不一定有 float32 算力高，因为 float32 计算单元更多</li>
<li>多关注 SM 架构<br><img src="https://i.ibb.co/2c186WT/g-LTQhd-K40g.png" alt="sm"></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-hw-model">Hardware Model</a><ul>
<li>对 sm 介绍比较好</li>
</ul>
</li>
<li>可以从架构图上看出一个 SM 有多少个 cuda core</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#gpu-feature-list">cuda-compiler-driver-nvcc gpu-feature-list</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/kunhe0512/article/details/126247243">https://blog.csdn.net/kunhe0512/article/details/126247243</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/394352476">NVIDIA GPU 架构梳理</a></li>
<li>天梯图</li>
<li>架构演进</li>
<li>tegra 是 SOC 架构, tesla 是 GPU 架构</li>
<li>NVIDIA GeForce RTX 3090 使用的是 NVIDIA 的 Ampere 架构 sm_86</li>
<li>NVIDIA Jetson Orin 是基于 NVIDIA 的 Ampere 架构的高性能 AI 计算平台</li>
<li>CUDA_ARCHS 是指定 CUDA 代码编译目标 NVIDIA GPU 架构的编译标志。</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/631850036">为各种 NVIDIA 架构匹配 CUDA arch 和 CUDA gencode</a></li>
<li>架构历史</li>
<li><a target="_blank" rel="noopener" href="https://www.baseten.co/blog/understanding-nvidias-datacenter-gpu-line/">understanding-nvidias-datacenter-gpu-line</a><br><img src="https://i.ibb.co/hZVxQFd/ZEI0-D9zw-C5.png" alt="历史"></li>
</ol>
<h2 id="JetPack"><a href="#JetPack" class="headerlink" title="JetPack"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/jetson/jetpack/introduction/index.html">JetPack</a></h2><ol>
<li>NVIDIA JetPack SDK is the most comprehensive solution for building AI applications. JetPack SDK provides a full development environment for hardware-accelerated AI-at-the-edge development.JetPack SDK includes Jetson Linux Driver Package with bootloader, Linux kernel, Ubuntu desktop environment, and a complete set of libraries for acceleration of GPU computing, multimedia, graphics, and computer vision. It also includes samples, documentation, and developer tools for both host computer and developer kit, and supports higher level SDKs such as DeepStream for streaming video analytics, Isaac for robotics and Riva for conversational AI.</li>
</ol>
<h2 id="vpi"><a href="#vpi" class="headerlink" title="vpi"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/vpi/algorithms.html">vpi</a></h2><ol>
<li>支持多种硬件做前处理, 如 resize, convert color, remap (VIC 都支持，可以释放 GPU 资源)</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/11/05/package-manager/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/05/package-manager/" class="post-title-link" itemprop="url">package manager</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-05 11:01:42" itemprop="dateCreated datePublished" datetime="2023-11-05T11:01:42+08:00">2023-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-06 11:10:28" itemprop="dateModified" datetime="2023-12-06T11:10:28+08:00">2023-12-06</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/11/05/package-manager/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/11/05/package-manager/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>694</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><h3 id="CPM"><a href="#CPM" class="headerlink" title="CPM"></a><a target="_blank" rel="noopener" href="https://github.com/cpm-cmake/CPM.cmake">CPM</a></h3><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="virtual-environments"><a href="#virtual-environments" class="headerlink" title="virtual-environments"></a><a target="_blank" rel="noopener" href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/">virtual-environments</a></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-venv</span><br><span class="line">python3 -m venv .venv</span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate</span><br><span class="line">deactivate</span><br><span class="line">pip install pip -U -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line">python3 -m pip install --upgrade pip</span><br><span class="line">python3 -m pip install <span class="string">&#x27;requests==2.18.4&#x27;</span></span><br><span class="line">python3 -m pip install <span class="string">&#x27;requests&gt;=2.0.0,&lt;3.0.0&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="miniconda-选择对应-python-版本-install-时可以选路径"><a href="#miniconda-选择对应-python-版本-install-时可以选路径" class="headerlink" title="miniconda 选择对应 python 版本, install 时可以选路径"></a><a target="_blank" rel="noopener" href="https://docs.conda.io/en/latest/miniconda.html#linux-installers">miniconda</a> 选择对应 python 版本, install 时可以选路径</h3><h3 id="anaconda"><a href="#anaconda" class="headerlink" title="anaconda"></a><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">anaconda</a></h3><h3 id="mamba"><a href="#mamba" class="headerlink" title="mamba"></a><a target="_blank" rel="noopener" href="https://github.com/mamba-org/mamba">mamba</a></h3><h2 id="rust"><a href="#rust" class="headerlink" title="rust"></a>rust</h2><h3 id="cargo"><a href="#cargo" class="headerlink" title="cargo"></a>cargo</h3><h2 id="multi"><a href="#multi" class="headerlink" title="multi"></a>multi</h2><h3 id="pixi"><a href="#pixi" class="headerlink" title="pixi"></a><a target="_blank" rel="noopener" href="https://github.com/prefix-dev/pixi">pixi</a></h3><ol>
<li>pixi is a cross-platform, multi-language package manager and workflow tool built on the foundation of the conda ecosystem. It provides developers with an exceptional experience similar to popular package managers like cargo or yarn, but for any language.</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/11/03/pixi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/11/03/pixi/" class="post-title-link" itemprop="url">pixi</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-11-03 15:02:45" itemprop="dateCreated datePublished" datetime="2023-11-03T15:02:45+08:00">2023-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-22 14:50:13" itemprop="dateModified" datetime="2023-11-22T14:50:13+08:00">2023-11-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/11/03/pixi/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/11/03/pixi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li>不同工程可以用软连接共享.pixi 文件夹</li>
<li>cfonts 使得 task 更清楚</li>
<li><code>curl -fsSL https://pixi.sh/install.sh | bash</code> install</li>
<li>工程目录下<code>.pixi</code>包含各种环境依赖</li>
<li>pixi is a cross-platform, multi-language package manager and workflow tool built on the foundation of the conda ecosystem. It provides developers with an exceptional experience similar to popular package managers like cargo or yarn, but for any language.</li>
<li>Supports multiple languages including Python, C++, and R using Conda packages.</li>
<li>可用于 github actions, 只需要配置 pixi，不用手动安装各种环境</li>
<li>参考写 task <a target="_blank" rel="noopener" href="https://github.com/prefix-dev/pixi/blob/main/examples/cpp-sdl/pixi.toml">example</a></li>
<li>如果下载不了 package， 可以删除~&#x2F;.cache&#x2F;rattler&#x2F;cache&#x2F;repodata 试试</li>
<li>执行命令在 repo 下都行</li>
<li><code>pixi global install &lt;cmake&gt;</code>在机器上安装 cmake; 安装到<del>&#x2F;.pixi&#x2F;bin， 需要需改.zshrc &#96;export PATH&#x3D;</del>&#x2F;.pixi&#x2F;bin:$PATH&#96;</li>
<li><code>pixi shell</code>中可以用 pixi 安装的最新命令</li>
<li><code>pixi add gxx clangxx</code> install g++ and clang++； ++符号不允许</li>
<li>下载的时候 VPN 设置为 global， 用 rule 可能识别为本地， 下载出问题</li>
<li>python 需要先安装 pip</li>
</ol>
<h2 id="command"><a href="#command" class="headerlink" title="command"></a><a target="_blank" rel="noopener" href="https://prefix.dev/docs/pixi/cli">command</a></h2><ol>
<li><code>pixi init &lt;name&gt;</code> 初始化工程, 添加 pixi.toml 和 gitignore 信息</li>
<li><code>pixi add cmake ninja opencv glog</code>添加依赖库</li>
<li><code>pixi add &quot;clang-tools&lt;=15.0.0,&gt;13.0&quot;</code></li>
<li><code>pixi run &lt;task&gt;</code> run task</li>
<li><code>pixi search glog</code> search package</li>
<li><code>pixi info</code> 查看各种信息， cache 位置：~&#x2F;.cache&#x2F;rattler&#x2F;, task list</li>
<li><code>pixi global list</code> list global package</li>
<li><code>pixi shell</code> 进入 pixi shell， 执行&#x2F;tmp&#x2F;pixi_env_xxx.sh 脚本设置环境变量， 可以在配置文件 activate 脚本中使用</li>
</ol>
<h2 id="config"><a href="#config" class="headerlink" title="config"></a><a target="_blank" rel="noopener" href="https://prefix.dev/docs/pixi/configuration">config</a></h2><ol>
<li>pixi shell 可以查看环境变量</li>
<li>channels &#x3D; [“conda-forge”, “robostack”, “bioconda”, “nvidia”, “pytorch”]; 设置源 <a target="_blank" rel="noopener" href="https://prefix.dev/channels">link</a></li>
<li>env set, 可以设置 LD_LIBRARY_PATH</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">activation</span>]</span><br><span class="line"><span class="string">scripts</span> <span class="string">=</span> [<span class="string">&quot;env_setup.sh&quot;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><ol>
<li><code>PIXI_PACKAGE_ROOT</code> repo 目录</li>
<li><code>CONDA_PREFIX</code> pixi env 目录 ${PIXI_PACKAGE_ROOT}&#x2F;.pixi&#x2F;env</li>
<li><code>PIXI_PACKAGE_PLATFORMS</code> platform 类型</li>
<li><code>PATH</code> 只有 PATH, 没有 LD_LIBRARY_PATH, 需要自己在配置文件 activate 脚本里设置</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">export</span> <span class="string">LD_LIBRARY_PATH=$&#123;CONDA_PREFIX&#125;/lib</span>  <span class="comment"># for run app</span></span><br><span class="line"><span class="string">export</span> <span class="string">CMAKE_PREFIX_PATH=$&#123;CONDA_PREFIX&#125;/lib</span>  <span class="comment"># for cmake find_package</span></span><br><span class="line"><span class="string">export</span> <span class="string">PKG_CONFIG_PATH=$&#123;CONDA_PREFIX&#125;/share/pkgconfig:$&#123;CONDA_PREFIX&#125;/lib/pkgconfig</span>  <span class="comment"># for pkg-config</span></span><br></pre></td></tr></table></figure>

<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/prefix-dev/pixi">pixi</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/prefix-dev/pixi/blob/main/docs/FAQ.md">What is the difference with conda, mamba, poetry, pip</a></li>
<li><a target="_blank" rel="noopener" href="https://www.rerun.io/docs/howto/arrow-cpp-install">cpp using example</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/cpp-example-opencv-eigen/blob/main/pixi.toml">rerun cpp-example-opencv-eigen pixi example</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/16/IREE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/16/IREE/" class="post-title-link" itemprop="url">IREE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-16 19:36:13 / 修改时间：19:36:45" itemprop="dateCreated datePublished" datetime="2023-10-16T19:36:13+08:00">2023-10-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/IR/" itemprop="url" rel="index"><span itemprop="name">IR</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/16/IREE/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/16/IREE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.iree.dev/">iree</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/16/SPIR-V/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/16/SPIR-V/" class="post-title-link" itemprop="url">SPIR-V</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-16 19:28:26 / 修改时间：19:37:28" itemprop="dateCreated datePublished" datetime="2023-10-16T19:28:26+08:00">2023-10-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/IR/" itemprop="url" rel="index"><span itemprop="name">IR</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/16/SPIR-V/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/16/SPIR-V/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.khronos.org/spir/">spir</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/12/MLIR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/12/MLIR/" class="post-title-link" itemprop="url">MLIR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-12 15:31:23" itemprop="dateCreated datePublished" datetime="2023-10-12T15:31:23+08:00">2023-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-12-16 17:13:52" itemprop="dateModified" datetime="2025-12-16T17:13:52+08:00">2025-12-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/IR/" itemprop="url" rel="index"><span itemprop="name">IR</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/12/MLIR/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/12/MLIR/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="transform-conversion-translation"><a href="#transform-conversion-translation" class="headerlink" title="transform conversion translation"></a>transform conversion translation</h2><ol>
<li>transform: dialect内转换</li>
<li>conversion: dialect之间转换</li>
<li>tranlation: MLIR 和外部格式之间的转换</li>
</ol>
<h3 id="DialectConversion"><a href="#DialectConversion" class="headerlink" title="DialectConversion"></a><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/DialectConversion/">DialectConversion</a></h3><ol>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/3453025905">郑思泽</a></p>
</li>
<li><p>dialect之间转化的时候才会用到typeconverter, 相同dialect type不变</p>
</li>
<li><p>在tollvm时可以在matchandwrite函数中通过typeconverter拿到要转换的结果，和转换的结果做比对</p>
</li>
<li><p>每个pass typeconverter 会转换所有满足要求的type</p>
<ul>
<li>to llvm时第一个pass typeconvert会先加unrealized_conversion_cast from type to llvm_struct, 后面真正lowering op的时候会pack到llvm_struct, 再添加unrealized_conversion_cast from llvm_struct to type, 最终消除unrealized_conversion_cast</li>
</ul>
</li>
<li><p>convertOpResultTypes(…)只改变输出type(sample: block level to thread level, remove tensor encoding) 主要完成两件事：</p>
<ul>
<li>调用 TypeConverter::convertType 把结果类型从非法的转换为合法的</li>
<li>收集转换后的结果类型，供新 op 使用</li>
</ul>
</li>
<li><p>RewritePattern: 一般 IR 的局部优化 &#x2F; 重写； 不涉及类型转换， 不需要typeconverter; 主要目的：替换一个 op → 另一个等价 op</p>
</li>
<li><p>ConversionPattern：类型转换场景（type conversion）, 专门用于类型转换, 需要 TypeConverter, 主要目的：替换不合法类型 → 合法类型的 op</p>
<ul>
<li>ConversionPattern; 转换所有op, 可以配合convertOpResultTypes（）一起使用, struct ConvertAllOpResultsPattern : public mlir::ConversionPatternstruct ConvertAllOpResultsPattern : public mlir::ConversionPattern</li>
<li>子类 OpConversionPattern；转换一种op; sample: struct ConvertMyAdd : public OpConversionPattern<MyAddOp></li>
</ul>
</li>
<li><p>typeconverter.isLegal(op); 需要转换的类型不合法</p>
<ul>
<li>判断某个类型是否合法（能否通过 type converter 转换）:typeConverter.isLegal(type);</li>
<li>判断某个 op 的 operands&#x2F;results&#x2F;region param 类型都合法: typeConverter.isLegal(op);</li>
<li>配合target使用, 需要转换的标记为不合法，不用单独写判断逻辑; 在 ConversionTarget 中使用 isLegal(op) 的最大好处是：✅ 让合法性判断自动化、类型驱动、覆盖全面;<ul>
<li>不用列举所有非法 op，只要类型非法，op 就非法; </li>
<li>自动遍历 op 的 operand&#x2F;result&#x2F;region param;</li>
<li>合法性逻辑与类型转换保持一致，避免重复维护；</li>
<li>只要你更新 TypeConverter，合法性判断逻辑自动变化; </li>
<li>能对整个 dialect 应用统一规则，而不是逐个 op 列表维护</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">addDynamicallyLegalDialect</span>&lt;triton::TritonDialect, tensor::TensorDialect,</span><br><span class="line">                           triton::gpu::TritonGPUDialect,</span><br><span class="line">                           arith::ArithDialect, math::MathDialect&gt;(</span><br><span class="line">    [&amp;](Operation *op) -&gt; std::optional&lt;<span class="type">bool</span>&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> converter.<span class="built_in">isLegal</span>(op);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ops"><a href="#ops" class="headerlink" title="ops"></a>ops</h2><ol>
<li>zext	Zero extension	无符号扩展，高位补0</li>
<li>sext	Sign extension	有符号扩展，高位补符号位</li>
<li>trunc	Truncate	截断高位</li>
</ol>
<h2 id="call-intrinsic"><a href="#call-intrinsic" class="headerlink" title="call intrinsic"></a>call intrinsic</h2><ol>
<li>使用</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mlir::<span class="function">LLVM::CallIntrinsicOp</span></span><br><span class="line"><span class="function"><span class="title">callLLVMIntrinsic</span><span class="params">(mlir::OpBuilder &amp;rewriter, mlir::Location loc,</span></span></span><br><span class="line"><span class="params"><span class="function">                  mlir::TypeRange returnType, llvm::StringRef intrinsicName,</span></span></span><br><span class="line"><span class="params"><span class="function">                  llvm::SmallVector&lt;mlir::Value&gt; operands, <span class="type">bool</span> usePoison)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (usePoison)</span><br><span class="line">    operands.<span class="built_in">insert</span>(operands.<span class="built_in">begin</span>(),</span><br><span class="line">                    rewriter.<span class="built_in">create</span>&lt;mlir::LLVM::PoisonOp&gt;(loc, returnType));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rewriter.<span class="built_in">create</span>&lt;mlir::LLVM::CallIntrinsicOp&gt;(</span><br><span class="line">      loc, returnType, rewriter.<span class="built_in">getStringAttr</span>(intrinsicName), operands,</span><br><span class="line">      mlir::LLVM::<span class="built_in">FastmathFlagsAttr</span>());</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>
<ol>
<li>vector返回需要poisonOp占位，PoisonOp 创建一个“未定义但确定非法使用会导致未定义行为”的值，常用于初始化向量或寄存器值，告诉编译器“这个值现在还没初始化”。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mlir::Value poison = rewriter.<span class="built_in">create</span>&lt;mlir::LLVM::PoisonOp&gt;(loc, gatherResVecType);</span><br></pre></td></tr></table></figure>


<h2 id="builder-and-rewriter"><a href="#builder-and-rewriter" class="headerlink" title="builder and rewriter"></a>builder and rewriter</h2><ol>
<li>builder 和 rewriter 都用于构建和修改 IR（中间表示），但它们的用途和设计目标不同。</li>
<li>OpBuilder 适用于构建新的 IR，但不会管理旧 IR。<ul>
<li>builder.setInsertionPointToEnd(&amp;block); 需要指定insert节点</li>
</ul>
</li>
<li>PatternRewriter 适用于修改 IR，可以删除、替换和优化现有操作，在 MLIR Pass 变换中更常用。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Operation *op = <span class="built_in">getOperation</span>();</span><br><span class="line"><span class="function">OpBuilder <span class="title">builder</span><span class="params">(op-&gt;getContext())</span></span>;</span><br><span class="line"><span class="function">IRRewriter <span class="title">rewriter</span><span class="params">(builder)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h2><ol>
<li>blocklayout (tb级别)</li>
<li>threadlayout (thread级别)</li>
<li>ir也分block和thread level的</li>
</ol>
<h2 id="dialects"><a href="#dialects" class="headerlink" title="dialects"></a><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Dialects/">dialects</a></h2><ol>
<li>注意op和oprand的区别, Oprand和type的区别</li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/getting_started/Faq/#what-is-the-difference-between-the-tensor-and-vector-types">What is the difference between the Tensor and Vector types? ¶</a><ul>
<li>Tensors accept an optional “encoding” attribute, vector don’t at the moment.</li>
<li>The set of allowed element types is different: the Tensor type isn’t limited while Vector is limited to float and integer types.</li>
<li>You can have a memref (a buffer in memory) containing Vectors but you can’t have a memref of a tensor type.</li>
</ul>
</li>
</ol>
<h3 id="tensor"><a href="#tensor" class="headerlink" title="tensor"></a>tensor</h3><ol>
<li>注意tensor dialect, tensor type(oprand type), tensor op区别</li>
<li><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/51c91095ab5b1f8f0d65e6fbd551e8b991866b3f/mlir/include/mlir/IR/BuiltinTypes.h#L55">tensor type</a></li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Dialects/TensorOps/">tensor dialect</a></li>
<li>tensor type是一种builtin type， 不是tensor dialect中定义的</li>
<li>Tensor Dialect 提供了一组针对 张量操作 的通用抽象，例如 切片（slice）、拼接（concatenate）、广播（broadcast）等。</li>
</ol>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><ol>
<li>当前上游的多级中间表示（MLIR，Multi-Level Intermediate Representation）中的向量方言（Vector Dialect）采用的是定长向量表示。</li>
<li>注意type和dialect区别</li>
<li><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/f71b83b3593588c56fd4ab3e1347ad9c7bec624f/mlir/include/mlir/IR/BuiltinTypes.td#L1241">vector定义</a><ul>
<li>用llvm tablegen 生成</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Dialects/Vector/">vector dialect</a></li>
</ol>
<h2 id="AsmPrinter"><a href="#AsmPrinter" class="headerlink" title="AsmPrinter"></a>AsmPrinter</h2><ol>
<li>AsmPrinter 是 MLIR（Multi-Level Intermediate Representation）中的一个 IR 序列化（Serialization）工具，用于将 MLIR 操作（Operation）、类型（Type）、属性（Attribute） 等以 可读的文本格式（assembly format） 输出。它主要用于 调试、代码生成和 IR 可视化。</li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/DefiningDialects/Assembly/">别名 Customizing Assembly Behavior</a><ul>
<li>If multiple types&#x2F;attributes have the same alias from getAlias, a number is appended to the alias to avoid conflicts.</li>
</ul>
</li>
<li>generic assembly format<ul>
<li>is the one shown when breaking down toy.transpose at the beginning of this chapter.</li>
</ul>
</li>
<li>custom assembly format<ul>
<li>either declaratively or imperatively via C++. Defining a custom assembly format allows for tailoring the generated IR into something a bit more readable by removing a lot of the fluff that is required by the generic format.</li>
</ul>
</li>
</ol>
<h2 id="attributes-and-types"><a href="#attributes-and-types" class="headerlink" title="attributes and types"></a><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/DefiningDialects/AttributesAndTypes/">attributes and types</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/DefiningDialects/Assembly/">别名</a></li>
<li>允许方言为属性(Attribute)和类型(Type)定义别名标识符,在打印文本形式的 IR 时使用<ul>
<li>使用OpAsmDialectInterface方法 AliasResult getAlias(Attribute attr, raw_ostream &amp;os) </li>
<li>AliasResult getAlias(Type type, raw_ostream &amp;os)</li>
</ul>
</li>
<li>tablegen生成的类通过get()创建对象</li>
<li>注意: 给op加参数和给tensor加属性不一样</li>
<li>cuda通过给tensor加layout属性来确定线程处理的数据</li>
<li>set： <code>op-&gt;setAttr(&quot;tts.target&quot;, StringAttr::get(op-&gt;getContext(), &quot;TILE&quot;));</code></li>
<li>tablegen op定义的时候直接带属性</li>
<li>RankedTensorType<ul>
<li>tenosr带的属性影响整个op的验证：tt.load只改变输出tensor的属性，会报错，ptr指向的数据类型和输出数据类型的attr需要一致； tt.addi输入输出tensor的encoding(attr)需要一致, layout变换需要加转换op, 如triton::gpu::ConvertLayoutOp</li>
<li>static get(ArrayRef<int64_t> shape, Type elementType, Attribute encoding &#x3D; {}); 创建对象时设置属性,见 <ul>
<li><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/f71b83b3593588c56fd4ab3e1347ad9c7bec624f/mlir/include/mlir/IR/BuiltinTypes.td#L1241">vector定义</a></li>
</ul>
</li>
<li>getEncoding() 获取属性</li>
<li>一旦创建后，tensor的属性就是不可变的(immutable)</li>
<li>如果需要修改属性，需要创建一个新的tensor类型</li>
</ul>
</li>
<li>VectorType<ul>
<li>没有类似的属性获取方法,它更关注向量的形状、元素类型和可扩展性</li>
<li>static VectorType get(ArrayRef<int64_t> shape, Type elementType, ArrayRef<bool> scalableDims &#x3D; {});<ul>
<li>scalableDims参数用于指定向量类型中哪些维度是可伸缩的（scalable）</li>
<li>可伸缩向量（Scalable Vector）是一种其大小在运行时才能确定的向量类型, </li>
<li>VectorType::get({2, 4}, elementType, {false, true}); &#x2F;&#x2F;创建一个2x[4]的向量，其中第二维是可伸缩的</li>
<li>可伸缩向量主要用于支持SIMD（单指令多数据）等向量化操作, 这种设计使MLIR能够更好地支持现代处理器的向量化特性，特别是那些支持可变长度向量处理的架构</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="translate"><a href="#translate" class="headerlink" title="translate"></a>translate</h2><ol>
<li><code>mlir-translate --mlir-to-llvmir lowered_example.mlir &gt; output.ll</code> mlir to llir</li>
</ol>
<h2 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h2><ol>
<li>lsp server</li>
<li>tablegen lsp server</li>
<li>mlir-opt</li>
</ol>
<h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><ol>
<li>add_mlir_tool默认不编译, 需要手动指定<ul>
<li>ninja -t targets &amp;&amp; ninja xxx</li>
<li>make help &amp;&amp; make xxx</li>
</ul>
</li>
</ol>
<h2 id="mlir-tutorial"><a href="#mlir-tutorial" class="headerlink" title="mlir-tutorial"></a><a target="_blank" rel="noopener" href="https://github.com/KEKE046/mlir-tutorial">mlir-tutorial</a></h2><ol>
<li>ex3 - ex7不能同时运行， CMakeLists.txt只能选一个</li>
<li>需要单独指定编译ninja toy-opt(target)</li>
</ol>
<h2 id="MLIR基本构成"><a href="#MLIR基本构成" class="headerlink" title="MLIR基本构成"></a>MLIR基本构成</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/KEKE046/mlir-tutorial/blob/main/README.md#41-op-%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">Operation</a> <ul>
<li>用户定义的 arith.addi 等等 Op，本质上都是 Operation 的指针。但与 Operation* 不同的是，AddIOp 定义了 Operation 里储存的数据的解释方式。如 AddOp，自己是一个 Operation 的指针，也定义了一个函数 getLhs 用来返回第一个值，当作 lhs。</li>
</ul>
</li>
<li>Operations can also have custom parser, printer, builder, verifier, constant folder, or canonicalizer.</li>
<li>Operation类用于对所有操作进行一般建模。它是“不透明的”，因为它不描述特定操作或操作类型的属性。相反， Operation类为操作实例提供通用 API。另一方面，每个特定类型的操作都由Op派生类表示。   </li>
<li>Type &#x2F; Attribute: MLIR 的 Type 和 Attribute 与 Op 类似。Type 是到 TypeStorage 的指针，Attribute 也是到 AttributeStorage 的指针。</li>
<li>Value 要么来自于 Operation 的 Result 要么来自于 BlockArgument<ul>
<li>op管理result value， result可以作为其他op的input（引用), 类似模型推理时的tensor管理</li>
</ul>
</li>
<li>Value有owner:<ul>
<li>tt.dot的输入oprand owner是tt.load, gdb打印显示  owner &#x3D; 0x0000000032661040 “tt.load”, tt.dot的输出Value owner是tt.dot op</li>
</ul>
</li>
<li>Result：这个 Op 生成的新 Value</li>
<li>Operand：这个 Op 接受的操作数, 每个 Operation 的 Operand 都是到 Value 的指针</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/451061340">MLIR入门理解2-背景及演进</a><ul>
<li>MLIR提供的解决方案是Dialect和DialectConversion。Dialect用来抽象opset，DialectConversion用来做转换。</li>
<li>接着为了增加对Dialect和Operation的标准化和功能扩展，MLIR增加了Constraint, Interface, Trait，方便对Operation进行限制和扩展。</li>
</ul>
</li>
<li>每个 op（操作） 都有两类非常重要的机制：verifier 和 builder。它们的作用分别是 校验操作的合法性 和 简化操作的构造。</li>
</ol>
<h3 id="IR-Verifier"><a href="#IR-Verifier" class="headerlink" title="IR Verifier"></a>IR Verifier</h3><ol>
<li>Verifier 是用来检查一个操作实例是否满足该操作的语义约束。它会在 IR 构建或变换后运行，用来确保这个操作合法、内部一致，而不是 “乱七八糟的” IR。</li>
<li>在没有注册 dialect&#x2F;operation 之前，MLIR 结构上会接受任意字符串作为操作名，可以 round-trip（解析 + 打印）未定义操作。但是这种 IR 可能是语义上不合法的（比如参数数量错误、返回类型不对等），Verifier 就是负责捕捉这类问题的机制。</li>
<li>当你定义一个 operation（比如 toy.constant）时，可以：<br>✔ 自动根据 Operation Definition Specification（ODS） 生成结构层面的约束检查<br>✔ 或者自己定义一个更复杂的 verify 方法来执行额外的检查 let hasVerifier &#x3D; 1;</li>
</ol>
<h3 id="builder"><a href="#builder" class="headerlink" title="builder"></a>builder</h3><ol>
<li>Builder 提供一种 简洁、安全 的方式来创建这个 operation。</li>
<li>一个 helper，让你通过抽象参数就能生成合法的操作实例</li>
<li>可直接用于编译器前端、Pass、Dialect 创建代码等</li>
<li>构造 MLIR operation 要指定：操作名称，输入 operands等参数， 如果手动组装，会异常繁琐，而且容易出错。builder 自动帮你填充 OperationState 的内容</li>
</ol>
<h3 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h3><h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><ol>
<li>Interface 是一种“基于 trait 的多态机制”，允许 dialect 中的 op&#x2F;type 实现一组统一的行为接口，而不需要相互依赖。</li>
<li>Interface 定义只定义：接口名字，namesapce, 接口有哪些方法，不关心谁来实现<ul>
<li>不关心 op 是谁; 只关心：是不是实现了接口</li>
</ul>
</li>
<li>op 在pass里使用interface<ul>
<li>直接op.func()调用</li>
<li><code>if (auto shapeOp = dyn_cast&lt;ShapeInferenceOpInterface&gt;(op))</code></li>
</ul>
</li>
<li>注意traits和interface的区别<ul>
<li>interface有多态，有方法</li>
<li>DeclareOpInterfaceMethods<CastOpInterface> 可以把interface转换为trait</li>
</ul>
</li>
</ol>
<h3 id="Trait"><a href="#Trait" class="headerlink" title="Trait"></a>Trait</h3><ol>
<li>Trait 是给 Op &#x2F; Type &#x2F; Attribute 打的“静态标签”，用于表达“这个东西满足某种结构或语义约束”，但不提供行为函数。</li>
<li>它本质是 编译期&#x2F;结构级别的约束与标记机制。</li>
<li>在 MLIR 里，你经常需要表达：这个 op 没有副作用;这个 op 只有一个结果;这个 op 是 terminator;这个 op 结果类型和输入类型一致;这个 op 是 elementwise 的;<ul>
<li>这些都是： “事实 &#x2F; 性质”，不是“行为算法”</li>
</ul>
</li>
<li>Trait影响verifier, conconiacalization, folding</li>
</ol>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><ol>
<li>不好实现的先站位，从高层网低层次转， 抽象级别要对应，一次处理一小步</li>
<li>核心在于transform</li>
<li>上层的IR是一种抽象，不用具体实现，只需要规定输入输出类型，前后Op能匹配上就行</li>
<li>每一行都是op, 在lower到llvm ir需要具体实现，上层的op不需要具体实现，只要后面能lower到低级别的op</li>
</ol>
<h2 id="dialect-conversion"><a href="#dialect-conversion" class="headerlink" title="dialect conversion"></a>dialect conversion</h2><ol>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/DialectConversion/">docs&#x2F;DialectConversion</a></li>
<li>不合法才转换</li>
<li>类型转换的时候，如果op输入输出类型变换，可以在定义op输入输出时允许多种类型</li>
</ol>
<h2 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h2><ol>
<li>ConversionTarget里合法的不会在做matchandrewrite, 需要标记为非法才做matchandrewrite</li>
<li>注意op和pass的区别；op可以为load, store, convert_tile_to_vector; pass用来转换的，将其他op转换，注意：convert_tile_to_vector是op，不是pass</li>
<li>写pass时如果输入输出类型改变，插入转换op，后面再融合; 方便pass对op处理(使用unrealized_convertion_cast)<ul>
<li>A –t–&gt; B   &#x3D;&#x3D;&#x3D;&#x3D;&gt;  A1 –t1-&gt; convert_t1_to_t –t-&gt; convert_t_to_t2 –t2-&gt; B2</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1YTGfJq-ccuVPH50r8ERnCrC977-4uzly/view">Tutorial: Create an MLIR pass for triton</a></li>
<li>区分op和op pass; op是一种表示，pass是对op的处理(conversion or optimization); conversion指的是从其他op转换为当前op；当前op转换为其他op由后续的op处理</li>
<li>op tablegen需要指定name, input, output及其类型</li>
<li>Trasnform(optimize) <a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_76434200/article/details/136205302">link</a><ul>
<li>in dialect</li>
<li>Transform 通常指的是在 同一 dialect 内对程序进行优化或转换。这个过程目的是通过简化、优化或改进表达式来提升程序的性能或质量，通常是通过应用特定的优化规则来消除冗余、合并操作、简化控制流等。</li>
<li>写pass不需要像conversion需要ilegal一些op才能转换</li>
<li>可以用于添加属性之类的操作</li>
</ul>
</li>
<li>Conversion<ul>
<li>between dialect</li>
<li>Conversion 指的是将一个 Dialect 中的 IR 转换为另一个 Dialect 的 IR。这种转换通常涉及对同一程序的不同表示的转换，目的是为了适应不同的执行环境或优化策略。转换通常发生在不同的 Dialect 之间，或者从高层次的抽象操作到底层硬件相关的操作。</li>
<li>NOTE: 注意op convertion(一种transform) 和 type convertion(只改变op输入输出类型)之间的区别</li>
</ul>
</li>
<li>translation<ul>
<li>other ir -&gt; mlir -&gt; other ir</li>
<li>Translation 是指将 从其他 IR 转换到 MLIR 或从 MLIR 转换到其他 IR 的过程。它允许将一种编译表示（IR）转化为另一种表示。翻译通常发生在不同编译体系结构或编译链的之间，可以涉及从一种中间表示到另一种表示的转换，或者从源代码到中间表示的转换。</li>
</ul>
</li>
<li>CSE（Common Subexpression Elimination） <ul>
<li>是一种常见的优化 Pass，中文称为公共子表达式消除。</li>
<li>CSE 的主要目的是识别并消除 IR（中间表示）中重复的子表达式，从而减少冗余计算，提升运行效率。</li>
</ul>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = x + y;</span><br><span class="line"><span class="type">int</span> b = x + y;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cse</span></span><br><span class="line"><span class="type">int</span> temp = x + y;</span><br><span class="line"><span class="type">int</span> a = temp;</span><br><span class="line"><span class="type">int</span> b = temp;</span><br></pre></td></tr></table></figure>
<h2 id="Canonicalize"><a href="#Canonicalize" class="headerlink" title="Canonicalize"></a><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Canonicalization/">Canonicalize</a></h2><ol>
<li>Canonicalizer 知道清理死操作；然而，MLIR 保守地假设操作可能会产生副作用。我们可以通过向TransposeOp添加新特征Pure来解决此问题 <a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Tutorials/Toy/Ch-3/">link</a></li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Canonicalization/#defining-canonicalizations">两种方法</a></li>
<li>可以做类型转换消除优化</li>
<li>是一个标准的优化 Pass，用于对中间表示 (IR) 进行规范化（Canonicalization）。它的主要目的是通过应用一系列模式匹配和重写规则，简化 IR，去掉冗余操作，提升后续优化和代码生成的效率。</li>
<li>其主要作用是清理冗余、提升 IR 的可优化性和一致性，(不能有side effect)</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// op.td里op添加</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">hasCanonicalizeMethod</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// op.cpp中完成canonicalize函数</span></span><br><span class="line">LogicalResult ConvertTensorToTileOp::<span class="title function_ invoke__">canonicalize</span>(ConvertTensorToTileOp op,</span><br><span class="line">                                                  PatternRewriter &amp;rewriter) &#123;</span><br><span class="line">  <span class="comment">// patterns and rewrites go here.</span></span><br><span class="line">  Value input = op.<span class="title function_ invoke__">getOperand</span>();</span><br><span class="line">  auto tileToTensorOp =</span><br><span class="line">      input.getDefiningOp&lt;ConvertTileToTensorOp&gt;();</span><br><span class="line">  <span class="title function_ invoke__">if</span> (!tileToTensorOp)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">failure</span>();</span><br><span class="line"></span><br><span class="line">  rewriter.<span class="title function_ invoke__">replaceOp</span>(op, tileToTensorOp.<span class="title function_ invoke__">getOperand</span>());</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">success</span>();</span><br><span class="line">  <span class="comment">// return failure();</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// 先replace， 再modify， 在erase《</span></span><br><span class="line"></span><br><span class="line">  * Pattern  : <span class="symbol">&#x27;tts</span>.convert_tensor_to_tile <span class="punctuation">-&gt;</span> ()&#x27; &#123;</span><br><span class="line">Trying to <span class="keyword">match</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    ** Replace : <span class="symbol">&#x27;tts</span>.convert_tensor_to_tile&#x27;(<span class="number">0x6a3fc50</span>)</span><br><span class="line">    ** Modified: <span class="symbol">&#x27;tts</span>.tile_dot&#x27;(<span class="number">0x8590110</span>)</span><br><span class="line">    ** Erase   : <span class="symbol">&#x27;tts</span>.convert_tensor_to_tile&#x27;(<span class="number">0x6a3fc50</span>)</span><br><span class="line"><span class="string">&quot;&quot;</span> result <span class="number">1</span></span><br><span class="line">  &#125; <span class="punctuation">-&gt;</span> success : pattern applied successfully</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mlir-opt"><a href="#mlir-opt" class="headerlink" title="mlir-opt"></a>mlir-opt</h2><ol>
<li><code>mlir-opt input.mlir -canonicalize -o output.mlir</code></li>
<li><code>-debug</code> 选项，可以打印 Pass 的详细执行过程</li>
<li><code>-verify-each</code> 验证每个 Pass 运行后 IR 是否有效</li>
</ol>
<h2 id="IR表示"><a href="#IR表示" class="headerlink" title="IR表示"></a>IR表示</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/BobHuang/p/18249482">从零开始教你写一个MLIR Pass</a></li>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/Tutorials/UnderstandingTheIRStructure/">UnderstandingTheIRStructure</a></li>
<li><a target="_blank" rel="noopener" href="https://llvm.org/devmtg/2020-09/slides/MLIR_Tutorial.pdf">MLIR_Tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/KEKE046/mlir-tutorial?tab=readme-ov-file#5-mlir-%E7%9A%84%E5%9B%BE%E7%BB%93%E6%9E%84">mlir-tutorial</a></li>
</ol>
<h2 id="match-and-rewrite"><a href="#match-and-rewrite" class="headerlink" title="match and rewrite"></a>match and rewrite</h2><ol>
<li>(good)<a target="_blank" rel="noopener" href="https://mlir.llvm.org/docs/PatternRewriter/#debug-names-and-labels">debug</a><br>1  </li>
<li>内部参数不要直接使用<code>Value lhs = op.getOperand(0);</code> 获取的是转化之前的value， <ul>
<li><code>auto lhs = adaptor.getOperands()[0];</code></li>
<li><code>auto lhs = rewriter.getRemappedValue(op.getOperand(0));</code></li>
<li>op 是 TileDotNoaccOp 的实例，它代表 MLIR 中的原始操作（原始 IR）。在转换过程中，op 仍然保持着 MLIR 中定义的 TileDotNoaccOp 操作的结构，并可以直接访问它的操作数、属性等。</li>
<li>adaptor 是 OpAdaptor 类型，它用于适配 MLIR 转换过程中的操作数（operands）。<ul>
<li>在 MLIR 低级转换（如从 Triton 低级 IR 到 LLVM IR）时，操作数可能已经经过类型转换或其他调整，而 adaptor 允许获取转换后的操作数。</li>
<li>adaptor.getOperands() 通常用于获取转换后的操作数，而不是 op.getOperands()</li>
</ul>
</li>
<li>在实际编写重写模式时，通常会同时使用 op 和 adaptor，前者用于获取操作的上下文信息，后者用于访问已转换的操作数和属性。</li>
</ul>
</li>
<li>Canonicalizer 知道清理死操作；然而，MLIR 保守地假设操作可能会产生副作用。我们可以通过向TransposeOp添加新特征Pure来解决此问题</li>
<li>当你使用 rewriter.replace 替换一个操作时，原操作会被标记为 “无效” 或 “已被替换”，但在实际的 MLIR IR 中，它的内存依然存在，直到清理阶段（如垃圾回收或优化 passes 的清理过程）才会被真正删除。</li>
<li><code>Value newvalue = rewriter.create&lt;AddOp&gt;(loc, input0, input1);</code> rewriter.create 是 MLIR 中 PatternRewriter 类提供的方法，用于创建新的操作（Operation）。</li>
<li><code>void replaceOp(Operation *op, ValueRange newValues);</code> rewriter.replace将op的结果用new value替换, 作用是将一个旧的操作及其结果用新的值替换，同时自动更新使用这些结果的其他操作，确保 IR 的一致性。</li>
</ol>
<h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li><p>populateXXXPatterns()	是一种注册&#x2F;收集多个 rewrite pattern 的函数，将 pattern 添加到 pattern list 中</p>
<ul>
<li>用于标准 dialect lowering， patterns.add用于自己的dialect lowering</li>
<li>可用于to LLVM dialect</li>
<li>RewritePattern	是一个具体的转换规则（转换逻辑 + 匹配条件），用来定义“怎么把 A 转换成 B”</li>
<li>pass可以一次执行所有收集到的pattern;也可以只执行一个或多个</li>
<li>populate…只是收集的作用, 在一个pass里执行多个pattern; 一个pass执行的好处是能控制转换顺序；多个pass</li>
<li>lib&#x2F;Conversion&#x2F;TritonToTritonGPU&#x2F;TritonToTritonGPUPass.cpp poplate了所有op，按顺序改变op输出type; 输入是adaptor.getOperands()，因为按顺序，表明输入之前已经转换为输出type了<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">RewritePatternSet <span class="title">patterns</span><span class="params">(ctx)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 标准 dialect lowering</span></span><br><span class="line"><span class="built_in">populateArithToLLVMConversionPatterns</span>(converter, patterns);</span><br><span class="line"><span class="built_in">populateFuncToLLVMConversionPatterns</span>(converter, patterns);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 自己的 dialect lowering</span></span><br><span class="line">patterns.<span class="built_in">add</span>&lt;</span><br><span class="line">  LowerMyDialectOp1,</span><br><span class="line">  LowerMyDialectOp2</span><br><span class="line">&gt;(ctx);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>MLIR 是一个强有力的代表，但它也有非目标。我们不尝试支持低级机器代码生成算法（例如寄存器分配和指令调度）。它们更适合较低级别的优化器（例如 LLVM）。此外，我们不希望 MLIR 成为最终用户自己编写内核的源语言（类似于 CUDA C++）。另一方面，MLIR 为表示任何此类 DSL 并将其集成到生态系统中提供了支柱。</p>
</li>
<li><p>在 MLIR（多级中间表示）中，ODS 是 “Operation Definition Specification” 的缩写。ODS 是一种用于定义操作（operation）、类型（type）、属性（attribute）等的 DSL（领域特定语言）。它通过一种声明式的方式来描述这些元素，并生成相应的 C++ 代码，从而简化了编写和维护 MLIR 操作的过程。</p>
</li>
<li><p>MLIR 即 Multi-Level Intermediate Representation，多级的中间表示。</p>
</li>
<li><p>mlir 只是个编译器框架，本身并没有什么完整功能。所以可以参考一些基于 MLIR 做的开源项目。</p>
</li>
<li><p>MLIR 能够很好地桥接高层 DSL 和底层编译器（如 LLVM）。</p>
</li>
<li><p>we do not intend MLIR to be a source language that end-users would themselves write kernels in (analogous to CUDA C++). On the other hand, MLIR provides the backbone for representing any such DSL and integrating it in the ecosystem.</p>
</li>
<li><p><code>!</code> 在 MLIR 中，自定义类型通常由特定的方言定义，并使用 <code>!</code> 符号进行引用</p>
</li>
<li><p><code>#</code> 符号用于表示自定义属性或符号。这些属性或符号通常由特定的方言（Dialect）定义，用于描述复杂的数据结构、布局和操作。通过使用自定义属性，可以在编译过程中对特定的硬件架构和优化需求进行精确的描述和操作。</p>
</li>
</ol>
<h2 id="tablegen"><a href="#tablegen" class="headerlink" title="tablegen"></a>tablegen</h2><ol>
<li><code>assemblyFormat</code>注意有格式要求</li>
<li>使用mlir-tablegen，还有llvm-tablegen等其他tablegen</li>
<li>class和def<ul>
<li>class 关键字用于定义可继承的类，而 def 关键字用于实例化具体的对象。</li>
<li>在 TableGen 中，def 语句创建的是一个 具体实例，而 class 语句定义的是 可继承的模板。通常，def 不能被继承，因为 def 本质上是一个实例，而不是一个类。</li>
</ul>
</li>
<li><code>.td</code> 文件的名称来源是 “Table Definition” 的简称。这个命名反映了它的主要用途：定义表格式的数据结构，以支持代码生成和编译器相关的元信息处理。</li>
<li>ODS(Operation Definition Specification) 模块用于定义operation<ul>
<li>每个 op（操作） 都有两类非常重要的机制：verifier 和 builder。它们的作用分别是 校验操作的合法性 和 简化操作的构造。</li>
</ul>
</li>
<li>DRR(Declarative Rewriting Rule) 模块用于实现两个dialect之间的conversion</li>
<li>.td文件定义dialect, op<ul>
<li>.h中需要include生成的.h.inc</li>
<li>.cpp中需要include生成的.cpp.inc</li>
</ul>
</li>
</ol>
<h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><ol>
<li><a target="_blank" rel="noopener" href="https://mlir.llvm.org/getting_started/Debugging/#miscellaneous-tips">debug tips</a><ul>
<li>For printf debugging, instead of using llvm::errs(), one can emit diagnostics. For example, using <code>op.emitWarning() &lt;&lt; &quot;HERE: &quot; &lt;&lt; myVariable</code>; instead of llvm::errs() &lt;&lt; “HERE: “ &lt;&lt; myVariable &lt;&lt; “\n”;. This prints nicely with colors, shows the op (and its location) for free,</li>
</ul>
</li>
<li>(good) lldb有问题调试，没问题直接命令行脚本执行更快</li>
<li>vscode inlay hints可以方便看类型, 解决auto类型问题</li>
<li>lldb<ul>
<li><code>~/.lldbinit</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gdbinit/lldbinit">lldbinit</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/pytorch/pytorch/blob/main/.lldbinit">pytorch .lldbinit</a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">command script import /data/liudonghui/llvm-project-86b69c3/llvm/utils/lldbDataFormatters.py</span><br><span class="line">command script import /data/liudonghui/llvm-project-86b69c3/mlir/utils/lldb-scripts/mlirDataFormatters.py</span><br><span class="line">#  &quot;command script import lldb.formatters.cpp.libcxx&quot;,</span><br><span class="line">settings set target.prefer-dynamic-value run-target</span><br><span class="line">settings set target.display-runtime-support-values true</span><br><span class="line"></span><br><span class="line"># command script import  ~/lldbinit.py</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">codelldb</a> 调试加速<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/data/xiyang/miniconda3/envs/siorigin_triton_test/bin/python&quot;</span><span class="punctuation">,</span></span><br><span class="line">     </span><br><span class="line">        <span class="string">&quot;command script import /data/liudonghui/llvm-project-86b69c3/llvm/utils/lldbDataFormatters.py&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;command script import /data/liudonghui/llvm-project-86b69c3/mlir/utils/lldb-scripts/mlirDataFormatters.py&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vadimcn/codelldb/issues/574#issuecomment-1279891501">lldb pretty print</a></li>
<li>lldb debug command:<ul>
<li><code>command script import /data/xiyang/llvm-project-86b69c3/llvm/utils/lldbDataFormatters.py</code></li>
<li><code>call op.dump()</code></li>
<li><code>type lookup xxx</code></li>
</ul>
</li>
<li><code>(*src).dump()</code> ref的时候需要先取值</li>
<li>vscode lldb debug 调试可以把 c++: on throw勾选去掉， </li>
<li>(very good) <code>-exec pt xxx</code> 打印type<ul>
<li>可以查看成员函数和变量，然后调用或者打印</li>
</ul>
</li>
<li>dump(): 支持module, op, type, value的打印<ul>
<li>str(mod) python更全面</li>
</ul>
</li>
<li>打印op; vscode debug console: <code>-exec call op.dump()</code> 没有输出再调用<code>-exec call fflush(stderr)</code>， 输出在terminal里<ul>
<li>改launch.json <code>&quot;terminal&quot;: &quot;console&quot;,</code> 在debug console输出</li>
<li>可以在terminal里按enter, 让多次输出之间有空行，方便查看</li>
<li>可以在watch里调用函数</li>
</ul>
</li>
<li>op-&gt;dump()：直接输出到 llvm::errs()，适合快速调试。<ul>
<li>python代码也可以</li>
</ul>
</li>
<li>op-&gt;print(llvm::errs())：需要提供一个输出流，可以更灵活地控制输出目标（如文件或标准输出）。</li>
<li>pattern-&gt;getDebugName()</li>
<li>打印pass name: vscode中：<code>-exec call pass.getName()</code></li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Pass &amp;pass : pm.<span class="built_in">getPasses</span>())</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">failed</span>(<span class="built_in">run</span>(&amp;pass, op, am, verifyPasses, parentInitGeneration)))</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">failure</span>();</span><br></pre></td></tr></table></figure>
<ol>
<li><a target="_blank" rel="noopener" href="https://lists.llvm.org/pipermail/llvm-dev/2016-May/100365.html">gdb llvm mlir pretty print</a></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /data/xiyang/llvm-project-86b69c3/mlir/utils/gdb-scripts/prettyprinters.py</span><br><span class="line">source /data/xiyang/llvm-project-86b69c3/llvm/utils/gdb-scripts/prettyprinters.py</span><br></pre></td></tr></table></figure>
<ol>
<li>gdb 里直接<code>source .gdbinit</code> and then try again the <code>info pretty-print</code>. 可以看看pretty-print信息</li>
</ol>
<h2 id="CRTP"><a href="#CRTP" class="headerlink" title="CRTP"></a>CRTP</h2><ol>
<li><a target="_blank" rel="noopener" href="https://chatgpt.com/share/677b7d82-9e7c-8004-a823-244513e3e974">chatgpt</a></li>
<li>CRTP 的全称是 Curiously Recurring Template Pattern，翻译为“奇异递归模板模式”。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Derived&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">impl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base&lt;Derived&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">impl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 派生类实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>CRTP 是 C++ 中非常强大的设计模式，虽然对初学者稍显复杂，但在性能关键场景和库开发中极具价值。</li>
<li>CRTP 是一种模板模式，其中一个类将自己作为模板参数传递给它的基类。<br>看起来有些“奇怪”，但它非常强大，尤其在以下场景中：<ul>
<li>静态多态：在编译时实现类似于动态多态的行为。</li>
<li>代码复用：通过基类模板实现通用功能。</li>
<li>编译期优化：避免运行时的虚函数调用开销。</li>
</ul>
</li>
<li>静态多态: 编译期确定类型，无需虚函数调用。更高效，适合性能敏感场景。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Derived&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">drawImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape&lt;Circle&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Circle\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> : <span class="keyword">public</span> Shape&lt;Square&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Square\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Circle c;</span><br><span class="line">    c.<span class="built_in">draw</span>(); <span class="comment">// 输出：Drawing Circle</span></span><br><span class="line"></span><br><span class="line">    Square s;</span><br><span class="line">    s.<span class="built_in">draw</span>(); <span class="comment">// 输出：Drawing Square</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/10/Mojo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/10/Mojo/" class="post-title-link" itemprop="url">Mojo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-10 15:55:50" itemprop="dateCreated datePublished" datetime="2023-10-10T15:55:50+08:00">2023-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-19 11:21:16" itemprop="dateModified" datetime="2023-10-19T11:21:16+08:00">2023-10-19</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/10/Mojo/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/10/Mojo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>70</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU5ODY2MTk3Nw==&mid=2247492618&idx=1&sn=a20f4828b9ab3e3cee3fedfd906e0eb2&chksm=fe426a3cc935e32a8312ce9efbb4f2640787508d3e811579bbffe918685cdb07a8bd8e3ffc4b&scene=132&exptype=timeline_recommend_article_extendread_samebiz#wechat_redirect">LLVM 之父 Chris Lattner：我的 AI 基础设施软件构建理念</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&mid=2247597850&idx=1&sn=679ccdcaf76e8b6ab97ca42687769da1">未来的人工智能语言，是 Rust 还是 Mojo ？</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/modularml/mojo">github mojo</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/08/rerun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/08/rerun/" class="post-title-link" itemprop="url">rerun</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-08 15:12:52" itemprop="dateCreated datePublished" datetime="2023-10-08T15:12:52+08:00">2023-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-11 16:26:47" itemprop="dateModified" datetime="2024-01-11T16:26:47+08:00">2024-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tools/Debug/" itemprop="url" rel="index"><span itemprop="name">Debug</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/08/rerun/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/08/rerun/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li><a target="_blank" rel="noopener" href="https://foxglove.dev/">foxglove 支持 ros</a> <a target="_blank" rel="noopener" href="https://docs.ros.org/en/foxy/How-To-Guides/Visualizing-ROS-2-Data-With-Foxglove-Studio.html">Visualizing-ROS-2-Data-With-Foxglove-Studio</a></li>
<li>日志重放工具 log-replay tools <a target="_blank" rel="noopener" href="https://www.rerun.io/blog/rosbag">link</a></li>
<li>观察工具 <a target="_blank" rel="noopener" href="https://www.rerun.io/blog#what-is-a-seeingtool">what-is-a-seeingtool</a></li>
<li><a target="_blank" rel="noopener" href="https://vimeo.com/97903574">Seeing Spaces 它是 Figma、Webflow、Our World in Data 等许多项目的灵感来源</a></li>
<li>类似 rosbag</li>
<li>rerun 可以纪录每帧对应的 latency，fps, 画图，平均值？方便分析哪一帧耗时</li>
<li>不链接 viewer 也不保存，相当于不操作？方便开启和关闭 log</li>
<li>使用 rerun 实时或回放监测的数据</li>
<li><code>rr.set_time_sequence(&quot;frame_nr&quot;, x) # frame_nr为横坐标</code> 横坐标可以选择按帧或时间显示</li>
<li>测试程序可以关闭 viewer(init spawn false)， 将结果记录到 rrd 文件里（rr.save), 使用 online demo 回放</li>
<li>可以显示 log 和文档 <a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun/tree/main/examples/python/detect_and_track_objects">link</a></li>
<li><code>pip install rerun-sdk &amp;&amp; python3 -m rerun_demo</code>安装并运行 demo</li>
<li><code>python3 -m rerun</code>启动客户端</li>
<li><code>python3 -m rerun --web-viewer</code>启动 web, <code>http://&#123;ip&#125;:9090/</code> to open webserver</li>
<li><code>python3 -m rerun --web-viewer --web-viewer-port 5900</code> wsl docker</li>
<li><code>python3 -m rerun --web-viewer --web-viewer-port 5900 --save test.rrd</code> 保存接收到的 log, save 时不能打开 web</li>
<li><a target="_blank" rel="noopener" href="https://www.rerun.io/docs/reference/sdk-operating-modes">4 sdk-operating-modes</a> Connnect: Connects to a remote Rerun Viewer and streams all the data via TCP.</li>
<li>good: docker web live data<ul>
<li><code>python3 -m rerun --web-viewer --web-viewer-port 5900 --ws-server-port 6080</code> 注意–web-viewer-port 是打开 viewer 的端口， –ws-server-port 是用于连接 server 端口</li>
<li><code>examples/python/clock/main.py --connect --addr=127.0.0.1:9876</code> example 用到的代码<code>rr.connect(127.0.0.1:9876)</code>; 注意 viewer 默认监听的是 9876, –port 才能修改，注意和–web-viewer-port 的区别</li>
<li><code>http://localhost:10087/?url=ws://localhost:10089</code> (in docker -p10087:5900 -p10089:6080) or <code>http://10.31.2.47:9090/?url=ws://10.31.2.47:9877</code> 注意两个 localhost 和端口号都要替换</li>
</ul>
</li>
<li>测试是否收到数据<ul>
<li><code>python3 -m rerun --web-viewer --web-viewer-port 5900  --test-receive</code></li>
<li><code>examples/python/clock/main.py --connect --addr=127.0.0.1:9876</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun/blob/0a2a594b1f9527e91400a0b1d2dbb4943080f385/rerun_py/README.md?plain=1#L50">connect sample</a></li>
<li>多次链接有多次数据</li>
<li>python connect code</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rerun <span class="keyword">as</span> rr  <span class="comment"># <span class="doctag">NOTE:</span> `rerun`, not `rerun-sdk`!</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">rr.init(<span class="string">&quot;rerun_example_my_data&quot;</span>, spawn=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">rr.connect(<span class="string">&quot;192.168.1.3:9876&quot;</span>)</span><br><span class="line"></span><br><span class="line">positions = np.zeros((<span class="number">10</span>, <span class="number">3</span>))</span><br><span class="line">positions[:,<span class="number">0</span>] = np.linspace(-<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line">colors = np.zeros((<span class="number">10</span>,<span class="number">3</span>), dtype=np.uint8)</span><br><span class="line">colors[:,<span class="number">0</span>] = np.linspace(<span class="number">0</span>,<span class="number">255</span>,<span class="number">10</span>)</span><br><span class="line">rr.log(<span class="string">&quot;my_points&quot;</span>,rr.Points3D(positions, colors=colors, radii=<span class="number">0.5</span>))</span><br></pre></td></tr></table></figure>

<h2 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/cpp-example-opencv-eigen">cpp-example-opencv-eigen</a><ul>
<li><code>pixi run example</code></li>
</ul>
</li>
<li>测试程序可去掉<code>rec.spawn</code>, 添加<ul>
<li><code>rec.save(&quot;test.rrd&quot;);</code> 保存结果到 test.rrd</li>
<li><code>rec.connect(&quot;127.0.0.1:9876&quot;);</code> 连接本地的 viewer, 本地的 viewer(in docker -p10087:5900 -p10089:6080) <code>python3 -m rerun --web-viewer --web-viewer-port 5900 --ws-server-port 6080</code>; 本地浏览器<code>http://localhost:10087/?url=ws://localhost:10089</code></li>
</ul>
</li>
</ol>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><ol>
<li><code>export RERUN=off</code>环境变量控制是否输出 log</li>
<li><code>rerun --help</code>可以查看环境变量</li>
</ol>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.rerun.io/docs/getting-started/troubleshooting">troubleshooting</a></li>
</ol>
<h2 id="logging"><a href="#logging" class="headerlink" title="logging"></a><a target="_blank" rel="noopener" href="https://www.rerun.io/docs/reference/types/archetypes/text_log#textlogintegration">logging</a></h2><ol>
<li>code</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import rerun as rr</span><br><span class="line">import logging</span><br><span class="line"></span><br><span class="line">def <span class="selector-tag">main</span>() -&gt; <span class="attribute">None</span>:</span><br><span class="line">    rr.<span class="built_in">init</span>(<span class="string">&quot;rerun_example_my_data&quot;</span>, spawn=False)</span><br><span class="line">    rr.<span class="built_in">save</span>(<span class="string">&quot;recording.rrd&quot;</span>)</span><br><span class="line">    rr.<span class="built_in">set_time_sequence</span>(<span class="string">&quot;frame&quot;</span>, <span class="number">0</span>)</span><br><span class="line">    logging.<span class="built_in">getLogger</span>().<span class="built_in">addHandler</span>(rr.<span class="built_in">LoggingHandler</span>(<span class="string">&quot;logs/handler&quot;</span>))</span><br><span class="line">    logging.<span class="built_in">getLogger</span>().<span class="built_in">setLevel</span>(-<span class="number">1</span>)</span><br><span class="line">    logging.<span class="built_in">info</span>(<span class="string">&quot;This INFO log got added through the standard logging interface&quot;</span>)</span><br><span class="line">    rr.<span class="built_in">set_time_sequence</span>(<span class="string">&quot;frame&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    logging.<span class="built_in">info</span>(<span class="string">&quot;Test logging&quot;</span>)</span><br><span class="line"></span><br><span class="line">if __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">main</span>()</span><br></pre></td></tr></table></figure>

<h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li>只记录数据不显示, 用于回放 w</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rerun <span class="keyword">as</span> rr</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> cos, sin, tau</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_trig</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># Log a time series</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">int</span>(tau * <span class="number">2</span> * <span class="number">100.0</span>)):</span><br><span class="line">        rr.set_time_sequence(<span class="string">&quot;frame_nr&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">        sin_of_t = sin(<span class="built_in">float</span>(t) / <span class="number">100.0</span>)</span><br><span class="line">        rr.log(<span class="string">&quot;trig/sin&quot;</span>, rr.TimeSeriesScalar(sin_of_t, label=<span class="string">&quot;sin(0.01t)&quot;</span>, color=[<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">        cos_of_t = cos(<span class="built_in">float</span>(t) / <span class="number">100.0</span>)</span><br><span class="line">        rr.log(<span class="string">&quot;trig/cos&quot;</span>, rr.TimeSeriesScalar(cos_of_t, label=<span class="string">&quot;cos(0.01t)&quot;</span>, color=[<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_linear</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">        rr.set_time_sequence(<span class="string">&quot;frame_nr&quot;</span>, x) <span class="comment"># frame_nr为横坐标</span></span><br><span class="line">        y = x</span><br><span class="line">        rr.log(<span class="string">&quot;linear/x&quot;</span>, rr.TimeSeriesScalar(y, label=<span class="string">&quot;y=x&quot;</span>, color=[<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    rr.init(<span class="string">&quot;rerun_example_my_data&quot;</span>, spawn=<span class="literal">False</span>) <span class="comment"># spawn设置为False表示只记录数据， 不使用viewer显示</span></span><br><span class="line">    rr.save(<span class="string">&quot;recording.rrd&quot;</span>) <span class="comment"># 保存为rrd</span></span><br><span class="line">    log_trig()</span><br><span class="line">    log_linear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>cool</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rerun <span class="keyword">as</span> rr</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">rr.init(<span class="string">&quot;rerun_example_my_data&quot;</span>, spawn=<span class="literal">False</span>)</span><br><span class="line">rr.save(<span class="string">&quot;recording.rrd&quot;</span>)</span><br><span class="line"></span><br><span class="line">SIZE = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">pos_grid = np.meshgrid(*[np.linspace(-<span class="number">10</span>, <span class="number">10</span>, SIZE)]*<span class="number">3</span>)</span><br><span class="line">positions = np.vstack([d.reshape(-<span class="number">1</span>) <span class="keyword">for</span> d <span class="keyword">in</span> pos_grid]).T</span><br><span class="line"></span><br><span class="line">col_grid = np.meshgrid(*[np.linspace(<span class="number">0</span>, <span class="number">255</span>, SIZE)]*<span class="number">3</span>)</span><br><span class="line">colors = np.vstack([c.reshape(-<span class="number">1</span>) <span class="keyword">for</span> c <span class="keyword">in</span> col_grid]).astype(np.uint8).T</span><br><span class="line"></span><br><span class="line">rr.log(</span><br><span class="line">            <span class="string">&quot;my_points&quot;</span>,</span><br><span class="line">                rr.Points3D(positions, colors=colors, radii=<span class="number">0.5</span>)</span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun/tree/latest/examples/python/plots">plots</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun/tree/main/examples/python/live_depth_sensor">live-depth-sensor</a></li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://discord.com/invite/PXtCgFBSmH">rerun discord 在线信息 </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun">rerun-io&#x2F;rerun</a></li>
<li><a target="_blank" rel="noopener" href="https://www.rerun.io/docs">docs 示意图</a></li>
<li><a target="_blank" rel="noopener" href="https://app.rerun.io/">online demo</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/rerun-io/rerun/milestones">rerun&#x2F;milestones</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/10/07/GPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/07/GPU/" class="post-title-link" itemprop="url">GPU</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-07 17:38:05 / 修改时间：17:39:22" itemprop="dateCreated datePublished" datetime="2023-10-07T17:38:05+08:00">2023-10-07</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/10/07/GPU/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/10/07/GPU/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>449</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="DLA-Deep-Learning-Accelerator-。"><a href="#DLA-Deep-Learning-Accelerator-。" class="headerlink" title="DLA (Deep Learning Accelerator)。"></a>DLA (Deep Learning Accelerator)。</h2><ol>
<li>NVIDIA DLA 是一个专门设计的硬件加速器，用于加速深度学习推断在边缘设备上的性能。DLA 被设计为与 NVIDIA 的 Jetson 平台（例如 Jetson AGX Xavier、Jetson Xavier NX 等）一同工作，这些平台主要用于嵌入式和边缘计算应用。</li>
<li><code>专为推断优化</code>：与训练深度学习模型的 GPU 不同，DLA 专门针对推断进行了优化，使其能够在功耗有限的边缘设备上高效运行。</li>
<li><code>集成与Jetson平台</code>：DLA 被集成到了某些 NVIDIA Jetson 模块中，提供了与 GPU 和 CPU 协同工作的能力，以实现多任务处理。</li>
<li><code>低功耗</code>：DLA 的设计重点是在保持低功耗的同时实现高效的推断处理，这对于需要长时间运行但电源有限的嵌入式应用非常重要。</li>
<li><code>支持多种网络</code>：DLA 支持多种流行的深度学习模型和框架，使开发者能够灵活地部署各种应用。</li>
<li><code>TensorRT兼容</code>：NVIDIA 的 TensorRT 是一个用于优化深度学习模型的推断的 SDK，它可以与 DLA 结合，进一步提高推断速度和效率。</li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2023/09/21/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/21/test/" class="post-title-link" itemprop="url">test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-21 16:05:15" itemprop="dateCreated datePublished" datetime="2023-09-21T16:05:15+08:00">2023-09-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-07-19 16:02:15" itemprop="dateModified" datetime="2024-07-19T16:02:15+08:00">2024-07-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Test/" itemprop="url" rel="index"><span itemprop="name">Test</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2023/09/21/test/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/21/test/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Fuzz-test"><a href="#Fuzz-test" class="headerlink" title="Fuzz test"></a>Fuzz test</h2><ol>
<li>模糊测试（fuzz testing, fuzzing）是一种软件测试技术。 其核心思想是将自动或半自动生成的随机数据输入到一个程序中，并监视程序异常，如崩溃，断言（assertion）失败，以发现可能的程序错误，比如内存泄漏。 模糊测试常常用于检测软件或计算机系统的安全漏洞。</li>
<li><a target="_blank" rel="noopener" href="https://llvm.org/docs/LibFuzzer.html">LibFuzzer</a> <a target="_blank" rel="noopener" href="https://github.com/google/fuzzing/blob/master/tutorial/libFuzzerTutorial.md">libFuzzerTutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/google/oss-fuzz">oss-fuzz</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/google/clusterfuzz">clusterfuzz</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AFLplusplus/AFLplusplus">AFL++</a></li>
</ol>
<h2 id="代码覆盖率检查"><a href="#代码覆盖率检查" class="headerlink" title="代码覆盖率检查"></a>代码覆盖率检查</h2><h3 id="gcovr"><a href="#gcovr" class="headerlink" title="gcovr"></a><a target="_blank" rel="noopener" href="https://github.com/gcovr/gcovr">gcovr</a></h3><ol>
<li>可以用来查看 repo 中函数个数</li>
<li><a target="_blank" rel="noopener" href="https://gcovr.com/en/stable/">doc</a></li>
<li><code>-DCMAKE_CXX_FLAGS=&quot;--coverage -g -O0&quot;</code> 需要 O0, 否则代码对不上</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/iamkun2005/p/16502967.html">交叉编译</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/vaughnhuang/p/16224069.html">link</a><ul>
<li><code>export GCOV_PREFIX_STRIP=9</code></li>
<li><code>export GCOV_PREFIX=$PWD</code></li>
<li>运行程序，生成对应的.gcno, 将该目录拷贝回主机并覆盖同级目录（即 .gcda 文件与同名 .gcno 文件应该在同一目录）</li>
<li><code>mkdir out &amp;&amp; gcovr --html-nested out/coverage.html</code> html-nested 表示生成的报告是有层级的</li>
<li><code>gcovr --decisions --txt</code></li>
<li><code>-f samples -e build</code> -f 包含， -e 排除</li>
</ul>
</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/09/21/test/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贾夕阳"
      src="/images/coder2.jpg">
  <p class="site-author-name" itemprop="name">贾夕阳</p>
  <div class="site-description" itemprop="description">深度学习/自动驾驶/C++/性能优化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">196</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaxiyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaxiyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2025/12/29/claude-code/" title="2025&#x2F;12&#x2F;29&#x2F;claude-code&#x2F;">Claude Code</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/08/20/AI-coding/" title="2025&#x2F;08&#x2F;20&#x2F;AI-coding&#x2F;">AI coding</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/04/28/Architecture/" title="2025&#x2F;04&#x2F;28&#x2F;Architecture&#x2F;">Computer Architecture</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/04/18/pytest/" title="2025&#x2F;04&#x2F;18&#x2F;pytest&#x2F;">pytest</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2025/01/18/cursor/" title="2025&#x2F;01&#x2F;18&#x2F;cursor&#x2F;">cursor</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贾夕阳</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">625k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">9:29</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/26/2020 14:52:10");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://jiaxiyang.github.io/page/7/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'g32ipLmEye1u5l6wBGRJt03S-gzGzoHsz',
      appKey     : 'zHgLkAICsZUl9Mf8LfdoVigP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>





 
</body>
</html>

