<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiaxiyang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiyang">
<meta property="og:url" content="https://jiaxiyang.github.io/page/20/index.html">
<meta property="og:site_name" content="Xiyang">
<meta property="og:description" content="深度学习&#x2F;自动驾驶&#x2F;C++&#x2F;性能优化">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="贾夕阳">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jiaxiyang.github.io/page/20/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiyang</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGS6S6YFJ6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WGS6S6YFJ6');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiyang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Think twice, code once!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">173</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">44</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiaxiyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/26/yaml/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/26/yaml/" class="post-title-link" itemprop="url">yaml</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-26 04:00:17" itemprop="dateCreated datePublished" datetime="2022-03-26T04:00:17+08:00">2022-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-27 11:36:34" itemprop="dateModified" datetime="2023-06-27T11:36:34+08:00">2023-06-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/26/yaml/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/26/yaml/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="opencv-对数"><a href="#opencv-对数" class="headerlink" title="opencv 对数"></a>opencv 对数</h2><ol>
<li>python</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">`cv2.FileStorage(<span class="string">&quot;output.yml&quot;</span>, cv2.FILE_STORAGE_WRITE).write(<span class="string">&quot;mat&quot;</span>, mat)`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fs = cv2.FileStorage(<span class="string">&quot;predict_benz_trajectory_v2_crop.yml&quot;</span>, cv2.FILE_STORAGE_WRITE)</span><br><span class="line">fs.write(<span class="string">&quot;Q&quot;</span>, Q.astype(np.float32))</span><br><span class="line">fs.write(<span class="string">&quot;traj_out_wid&quot;</span>, traj_out_wid)</span><br><span class="line">fs.release()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>C++</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::FileStorage <span class="title">ymlfile</span><span class="params">(<span class="string">&quot;predict_benz_trajectory_v2_crop.yml&quot;</span>,                                                                                                                                                                                                                          cv::FileStorage::READ)</span></span>;</span><br><span class="line"><span class="keyword">if</span>(!fs.<span class="built_in">isOpened</span>())&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Cannot open config file!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">cv::Mat disparity;</span><br><span class="line">ymlfile[<span class="string">&quot;disparity&quot;</span>] &gt;&gt; disparity;</span><br><span class="line"><span class="type">float</span> traj_wid = (<span class="type">float</span>)ymlfile[<span class="string">&quot;ground_traj_wid&quot;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  cv::Mat Q_mat;</span><br><span class="line">  cv::FileNode node = ymlfile[<span class="string">&quot;Q&quot;</span>];</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Key not found in yaml file&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="built_in">type</span>() == cv::FileNode::MAP &amp;&amp; node.<span class="built_in">size</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    node &gt;&gt; Q_mat;</span><br><span class="line">    <span class="keyword">if</span> (Q_mat.<span class="built_in">type</span>() == CV_64F) &#123;</span><br><span class="line">      Q_mat.<span class="built_in">convertTo</span>(Q_mat, CV_32F);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Node is not an opencv mat  or is empty&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>numpy and vector</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">np_array = np.array(<span class="string">[[1, 2, 3], [4, 5, 6]]</span>, dtype=<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">fs = cv2.FileStorage(<span class="string">&#x27;output.xml&#x27;</span>, cv2.FileStorage_WRITE)</span><br><span class="line">fs.<span class="built_in">write</span>(<span class="string">&#x27;my_array&#x27;</span>, np_array)</span><br><span class="line">fs.release()</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">float</span>&gt; vec;</span><br><span class="line">vec.<span class="built_in">assign</span>((<span class="type">float</span>*)mat.datastart, (<span class="type">float</span>*)mat.dataend);</span><br></pre></td></tr></table></figure>

<h3 id="读写"><a href="#读写" class="headerlink" title="读写"></a>读写</h3><ol>
<li>yaml-cpp</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/learning_tortosie/article/details/97815514">opencv cv::FileStorage</a></li>
</ol>
<h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/jbeder/yaml-cpp">github</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jbeder/yaml-cpp/wiki/Tutorial">tutorial</a></li>
</ol>
<h3 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;yaml-cpp/yaml.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  YAML::Node config = YAML::<span class="built_in">LoadFile</span>(<span class="string">&quot;config.yaml&quot;</span>);</span><br><span class="line"></span><br><span class="line">  std::vector&lt;<span class="type">double</span>&gt; intrinsic;</span><br><span class="line">  <span class="keyword">if</span> (config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;intrinsic&quot;</span>]) &#123;</span><br><span class="line">    intrinsic = config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;intrinsic&quot;</span>].as&lt;std::vector&lt;<span class="type">double</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0u</span>; i &lt; intrinsic.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      std::cout &lt;&lt; intrinsic[i] &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::vector&lt;<span class="type">double</span>&gt; cam2ego_R;</span><br><span class="line">  <span class="keyword">if</span> (config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_R&quot;</span>]) &#123;</span><br><span class="line">    cam2ego_R = config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_R&quot;</span>].as&lt;std::vector&lt;<span class="type">double</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0u</span>; i &lt; cam2ego_R.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      std::cout &lt;&lt; cam2ego_R[i] &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::vector&lt;<span class="type">double</span>&gt; <span class="type">cam2ego_t</span>;</span><br><span class="line">  <span class="keyword">if</span> (config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_t&quot;</span>]) &#123;</span><br><span class="line">    <span class="type">cam2ego_t</span> = config[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_t&quot;</span>].as&lt;std::vector&lt;<span class="type">double</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0u</span>; i &lt; <span class="type">cam2ego_t</span>.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      std::cout &lt;&lt; <span class="type">cam2ego_t</span>[i] &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">std::ofstream <span class="title">fout</span><span class="params">(<span class="string">&quot;./out.yaml&quot;</span>)</span></span>;</span><br><span class="line">  fout &lt;&lt; config;</span><br><span class="line"></span><br><span class="line">  YAML::Node test;</span><br><span class="line">  <span class="comment">// test[&quot;camera&quot;][&quot;intrinsic&quot;].push_back(v);</span></span><br><span class="line">  <span class="comment">// note: push_back and = are not same</span></span><br><span class="line">  test[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;intrinsic&quot;</span>] = intrinsic;</span><br><span class="line">  test[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_R&quot;</span>] = cam2ego_R;</span><br><span class="line">  test[<span class="string">&quot;camera&quot;</span>][<span class="string">&quot;cam2ego_t&quot;</span>] = <span class="type">cam2ego_t</span>;</span><br><span class="line">  <span class="function">std::ofstream <span class="title">fout1</span><span class="params">(<span class="string">&quot;./test.yaml&quot;</span>)</span></span>;</span><br><span class="line">  fout1 &lt;&lt; test;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">camera:</span></span><br><span class="line">  <span class="attr">intrinsic:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1888.7618313608834</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">968.83548164132105</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1896.5639945248038</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">547.4612962459845</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">cam2ego_R:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.034896920649101944</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.015135626613007833</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.99927629698862219</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">-0.99939075949347744</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.0010902662284327418</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.034884404167777945</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">-0.00056147988681672133</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">-0.99988485586850695</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0.015164452300128389</span></span><br><span class="line">  <span class="attr">cam2ego_t:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1.84679730821996</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">-0.089090448031248784</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1.3980633087528846</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/18/samba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/18/samba/" class="post-title-link" itemprop="url">samba</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-18 01:43:12" itemprop="dateCreated datePublished" datetime="2022-03-18T01:43:12+08:00">2022-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-28 13:13:37" itemprop="dateModified" datetime="2023-09-28T13:13:37+08:00">2023-09-28</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/18/samba/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/18/samba/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>481</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install samba</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line">[share]</span><br><span class="line">     path = /home/jiaxiyang/share</span><br><span class="line">     available = <span class="built_in">yes</span></span><br><span class="line">     valid <span class="built_in">users</span> = jiaxiyang</span><br><span class="line">     <span class="built_in">read</span> only = no</span><br><span class="line">     browsable = <span class="built_in">yes</span></span><br><span class="line">     public = <span class="built_in">yes</span></span><br><span class="line">     writable = <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h2 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbpasswd -<span class="selector-tag">a</span> jiaxiyang</span><br></pre></td></tr></table></figure>

<h2 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h2><h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d/samba restart</span><br><span class="line">sudo <span class="regexp">/etc/i</span>nit.d/smbd restart</span><br></pre></td></tr></table></figure>

<h3 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="params">system</span>ctl start smb.service</span><br><span class="line">sudo <span class="params">system</span>ctl restart smb</span><br></pre></td></tr></table></figure>

<h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><h3 id="ubuntu-1"><a href="#ubuntu-1" class="headerlink" title="ubuntu"></a>ubuntu</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount.cifs <span class="regexp">//</span><span class="number">10.10</span>.<span class="number">0.61</span><span class="regexp">/jiaxiyang/</span> samba_16 -o user=jiaxiyang</span><br></pre></td></tr></table></figure>

<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">映射网络驱动器</span><br><span class="line">\\ipaddr\share</span><br><span class="line"><span class="symbol">NOTE: </span>share is [share] in smb.conf</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/10/Cuda/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/10/Cuda/" class="post-title-link" itemprop="url">Cuda</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-10 02:17:38" itemprop="dateCreated datePublished" datetime="2022-03-10T02:17:38+08:00">2022-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-28 17:47:32" itemprop="dateModified" datetime="2024-01-28T17:47:32+08:00">2024-01-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Cuda/" itemprop="url" rel="index"><span itemprop="name">Cuda</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/10/Cuda/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/10/Cuda/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ol>
<li><code>GPU通过计算而不是深度缓存层次结构来隐藏访存延迟</code></li>
<li>并发的 warp 切换没有开销，因为每个 warp 都分配了硬件资源<ul>
<li>不需要上下文切换</li>
<li>以空间换时间</li>
</ul>
</li>
<li>gpu sram 带宽为什么比主存大很多：<ul>
<li>并行，多个 SM 访问 shared memory， 如有 80 个 sm，每个 sm4 个 partition， 每个 shared memory 有 32 个 bank， 等效位宽为：<code>80*4*32*8 = 81920</code>, hbm 位宽为 8192， 带宽为 1.5TB&#x2F;s, sram 为 19TB&#x2F;s</li>
<li>shared memory 带宽：<code>2(?) * freq * 32(banks) * 8/8 *4(sm partion) * 80(sm num)</code></li>
</ul>
</li>
<li><code>kernel融合主要是使用sram来减少对显存的访问，注意不是device和host数据搬移</code></li>
<li>kernel 在编译的时候需要明确 block grid size 吗？不需要， 这些参数通常在运行时通过 CUDA 内核启动语法指定，这提供了更高的灵活性和动态调整的可能性。</li>
<li>nvcc 在翻译单元的顶部隐式包含了 cuda_runtime.h 。</li>
<li>核函数 K（kernel function）就是指 K(x, y) &#x3D; ，其中 x 和 y 是 n 维的输入值，f(·) 是从 n 维到 m 维的映射（通常而言，m&gt;&gt;n）。是 x 和 y 的内积（inner product），严格来说 应该叫欧式空间的标准内积，也就是很多人常说的点积（dot product）。</li>
<li><code>sudo update-alternatives --display cuda</code>显示系统 cuda 版本</li>
<li><code>export PATH=/usr/local/cuda/bin/:$&#123;PATH&#125;</code>找不到 nvcc 可能需要 export PATH</li>
<li><code>sudo apt install -y nvidia-cuda-toolkit</code> 安装 cuda 工具链, 不能乱用，需要和系统 cuda 匹配</li>
<li>在 CUDA 中，你会以类似于 C&#x2F;C++函数的形式来表达想要在 GPU 上运行的计算，这个函数被称为 kernel。</li>
<li>GPU 函数耗时统计不能只记录一次的，GPU 可能做一些准备工作，教训： nppiResize_8u_C3R 不管大小第一次运行耗时都很大 The cuda context is lazily initialized</li>
<li><code>autotuning</code> 搜索 kernel grid 划分参数(结果不变)，找性能最优</li>
<li>L1 和 shared memory 共享一块存储 可动态分配比例; 可用比例见<a target="_blank" rel="noopener" href="https://www.nvidia.com/content/PDF/nvidia-ampere-ga-102-gpu-architecture-whitepaper-v2.pdf">link</a></li>
<li>warp 调度:延时隐藏 只执行 warp 一部分 当 warp 需要等待时 先执行其他 warp</li>
<li>shared memory 和 register 是 SM 中的稀缺资源.</li>
<li>warp 执行类似 simd</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-hw-model">Hardware Model</a><ul>
<li>对 sm 介绍比较好</li>
<li>Each SM is partitioned into four processing blocks, called SM sub partitions.</li>
<li>一个 SM 又可以由若干个 SMP（SM Partition）组成</li>
<li>A warp is allocated to a sub partition and resides on the sub partition from launch to completion. warp 被分配给子分区，并且从启动到完成都驻留在子分区上。</li>
</ul>
</li>
<li><code>FMA (Fused Multiply Add)</code>: z&#x3D;a*x+y …z,x,y are vectors or scalars</li>
<li><code>4FMA (Quad FMA)</code>: z&#x3D;A*x+z …A is a FP32 matrix; x,z are vectors</li>
<li><code>WMMA: Warp-level Matrix Mulitply and Accumulate (Tensor Core)</code>: Z&#x3D;AB+C …A,B are FP16 matrices; Z,C are FP32</li>
</ol>
<h2 id="bank-conflict"><a href="#bank-conflict" class="headerlink" title="bank conflict"></a>bank conflict</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/3842483/23011500">概念</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bank    |      1      |      2      |      3      |     ...     |      16     |</span><br><span class="line">Address |  0  1  2  3 |  4  5  6  7 |  8  9 10 11 |     ...     | 60 61 62 63 |</span><br><span class="line">Address | 64 65 66 67 | 68 69 70 71 | 72 73 74 75 |     ...     |     ...     |</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol>
<li>Each bank has a bandwidth of 32 bits per clock cycle</li>
<li>shared memory 一次不冲突只能读 32x4B， 看一次读取的数据量，多于 32x4B 需要读取多次 n&#x2F;(32x4)，只要在 n&#x2F;(32x4) 次内读完就是最高效的。</li>
<li>使用 float4 类型访存，用向量化的 LDG.128 和 STG.128 指令一次读 4 个元素，以减少指令数</li>
<li>thread tile 时如果 TM 是 8，一个 warp 需要读 32*8 个 TM 的数(shared memory 上)，至少需要 8 次(如果有 32 个 bank)<ul>
<li>如果一个线程一次处理 8 个连续的数，一个 warp 一次只有 4 个线程不 bank 冲突，<ul>
<li>如果一个线程 1 次读 1 个数，一个 warp 一次只读 4 个数， 需要 64 次读完，</li>
<li>如果一个线程一次读 4 个数，一个 warp 一次读 16 个数， 需要读 16 次，</li>
<li>如果一个线程一次读 8 个数，一个 warp 一次读 32 个数，需要读 8 次（最优），但不存在一次读 8 个数的指令。</li>
</ul>
</li>
<li>如果一个线程一次操作 4 个连续的数(处理两个在空间上属于同一 bank 的数)， 那么一个 warp 一次有 8 个线程 bank 不冲突， 一次操作 4*8 个数， 需要 8 次能读完。与 bank 不冲突等效。</li>
</ul>
</li>
</ol>
<h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ol>
<li><code>__restrict__</code> 用于限定指针,表示该指针是唯一访问目标内存的途径。可以避免出现不同指针引用同一内存区域的情况,编译器可以更自由地进行优化。这意味着编译器可以假设这个指针没有别名（alias），即没有其他指针指向相同的内存位置。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">myKernel</span><span class="params">(<span class="type">float</span>* __restrict__ ptrA, <span class="type">float</span>* __restrict__ ptrB, <span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 内核代码，假设 ptrA 和 ptrB 指向不重叠的内存区域</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="occupancy-设计"><a href="#occupancy-设计" class="headerlink" title="occupancy 设计"></a>occupancy 设计</h2><ol>
<li>(重要) <code>最理想的情况下为 sm max threads 个 thread 都分配资源，占用率 100%， 但受限于 Max warps or max blocks per SM, registers per SM, shared memory per SM, register, 占用率可能不到 100%</code></li>
<li>想得到令人满意的 GPU 性能<code>关键是找到合适的group size与资源的平衡点</code></li>
<li><code>--ptxas-options=-v</code> or <code>-Xptxas -v</code> or <code>--resource-usage</code> 加上编译选项， 显示 register， shared memory 使用<ul>
<li><code>nvcc  -Xptxas=&quot;-v&quot; --ptxas-options=-v -O3 -o my_sgemm my_sgemm.cu -lcublas  2&gt;&amp;1 | c++filt</code> demangle</li>
</ul>
</li>
<li>nishgt compute 里 occupancy 有详细显示</li>
<li><a target="_blank" rel="noopener" href="https://xmartlabs.github.io/cuda-calculator/">cuda-calculator</a> 填入数值，计算 occupancy</li>
<li>注意 shared memory 是动态配置的，可以尝试改变 shared memory 大小来提升性能</li>
</ol>
<h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><ol>
<li>stream 主要为了隐藏 host device 之间数据搬移的延迟，不是内存和计算</li>
<li>CUDA 流表示一个 GPU 操作队列，该队列中的操作将以添加到流中的先后顺序而依次执行。</li>
<li>stream 作用：在 Stream 的帮助下，CUDA 程序可以有效地将内存读取和数值运算并行，从而提升数据的吞吐量。 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/51402722">link</a><br>由于 GPU 和 CPU 不能直接读取对方的内存，CUDA 程序一般会有一下三个步骤：1）将数据从 CPU 内存转移到 GPU 内存，2）GPU 进行运算并将结果保存在 GPU 内存，3）将结果从 GPU 内存拷贝到 CPU 内存。</li>
<li>cuda7 可以开启每个线程有一个默认 stream, 之前每个设备有一个 stream <a target="_blank" rel="noopener" href="https://developer.nvidia.com/zh-cn/blog/gpu-pro-tip-cuda-7-streams-simplify-concurrency/">gpu-pro-tip-cuda-7-streams-simplify-concurrency&#x2F;</a><ul>
<li><code>nvcc --default-stream per-thread ./pthread_test.cu -o pthreads_per_thread</code>需要加编译选项</li>
</ul>
</li>
</ol>
<h2 id="cuda-grammer"><a href="#cuda-grammer" class="headerlink" title="cuda grammer"></a>cuda grammer</h2><ol>
<li>所有的 kernel 函数返回类型都是 void</li>
<li><code>&lt;&lt;&lt; M , T &gt;&gt;&gt;</code> Which indicate that a kernel launches with a grid of M thread blocks. Each thread block has T parallel threads.</li>
<li><code>vectorAdd&lt;&lt;&lt;blocksPerGrid, threadsPerBlock&gt;&gt;&gt;</code></li>
<li>可以认为 M, T 对应图片的 H, W; 一个 thread 对应一个像素点；一个 block 对应一行，一个 grid 对应一张图片</li>
<li><code>int tid = blockIdx.x * blockDim.x + threadIdx.x; =&gt; int index = h * W + w;</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/blob/master/Common/helper_cuda.h#L595">checkCudaErrors</a> helper_cuda.h</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(T result, <span class="type">char</span> <span class="type">const</span> *<span class="type">const</span> func, <span class="type">const</span> <span class="type">char</span> *<span class="type">const</span> file,</span></span></span><br><span class="line"><span class="params"><span class="function">           <span class="type">int</span> <span class="type">const</span> line)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;CUDA error at %s:%d code=%d(%s) \&quot;%s\&quot; \n&quot;</span>, file, line,</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt;(result), _cudaGetErrorEnum(result), func);</span><br><span class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will output the proper CUDA error strings in the event</span></span><br><span class="line"><span class="comment">// that a CUDA host call returns an error</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> checkCudaErrors(val) check((val), #val, __FILE__, __LINE__)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>cutil.h NVIDIA 公司在 CUDA5 之后便不再使用 cutil.h <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/blob/master/Samples/2_Concepts_and_Techniques/EGLSync_CUDAEvent_Interop/EGLSync_CUDAEvent_Interop.cu#L83">CUDA_SAFE_CALL </a></li>
<li><a target="_blank" rel="noopener" href="https://bohipat.wordpress.com/2014/07/11/replacing-cutil-in-cuda-5-0/">replacing-cutil-in-cuda-5-0</a></li>
</ol>
<h2 id="tensor-core-program"><a href="#tensor-core-program" class="headerlink" title="tensor core program"></a>tensor core program</h2><ol>
<li><code>--set roofline</code>能看到 tensor core roofline; 例如运行<code>cuda-samples/Samples/3_CUDA_Features/cudaTensorCoreGemm</code></li>
<li>cuda-samples&#x2F;Samples&#x2F;3_CUDA_Features 包含多个 tensor core 实例</li>
<li><code>Samples/3_CUDA_Features/cudaTensorCoreGemm</code>比<code>Samples/0_Introduction/matrixMul</code> 计算性能高很多<ul>
<li>cudaTensorCoreGemm 测试的是 fp16 性能</li>
</ul>
</li>
<li>cublas 满足特定条件才会使用 tensor core <a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cublas/index.html#tensor-core-usage">link</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html#requirements-tc">Tensor Core Requirements</a></li>
</ol>
<h3 id="tenosr-core-和-cuda-core"><a href="#tenosr-core-和-cuda-core" class="headerlink" title="tenosr core 和 cuda core"></a>tenosr core 和 cuda core</h3><ol>
<li>CUDA Core 是为通用计算设计，而 Tensor Core 是为特定类型的计算（主要是深度学习中的矩阵运算）优化。</li>
<li>在 NVIDIA 的某些 GPU 架构中，例如 Volta、Turing 和 Ampere，CUDA Core 和 Tensor Core 共同存在。它们可以根据计算任务的性质协同工作，提高整体的计算效率。</li>
<li>在执行深度学习任务时，Tensor Core 可以显著加速计算过程，相较于仅使用 CUDA Core，能实现更快的训练和推理速度。</li>
<li>RT core 用于光线追踪</li>
<li>芯片手册中有 cuda core 算力和 tensor core 算力</li>
<li>利用 tensor core 才能达到最大算力</li>
</ol>
<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#application-compatibility">application-compatibility</a></li>
<li><code>-arch=sm_70</code> is a shorthand for <code>-arch=compute_70 -code=compute_70,sm_70</code> (which is the same as <code>-gencode arch=compute_70,code=\&quot;compute_70,sm_70\&quot;</code>)</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-gpus">Your GPU Compute Capability</a> 包含各种 gpu arch</li>
</ol>
<h2 id="cuda-samples"><a href="#cuda-samples" class="headerlink" title="cuda samples"></a><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples">cuda samples</a></h2><ol>
<li>可以全部 sample 一起编译</li>
<li><code>make SMS=&quot;86&quot;</code>选择 arch</li>
<li><code>make dbg=1</code> debug 编译</li>
<li><code>Samples/1_Utilities/bandwidthTest</code> 可以查看 host &lt;-&gt; memory 之间传输速度</li>
<li>(good)<code>Samples/1_Utilities/deviceQuery</code> 可以查看设备信息, 包含 arch 信息, 多少 sm，每个 sm 多少 cuda core</li>
<li>11.6 之后代码放在 github 上</li>
<li><a target="_blank" rel="noopener" href="https://cuda-tutorial.readthedocs.io/en/latest/tutorials/tutorial01/">hello world</a></li>
<li><code>/usr/local/cuda-11.4/samples</code> tree -L 2</li>
<li><code>/usr/local/cuda-10.2/samples/0_Simple/vectorAdd</code></li>
<li><code>nvprof ./vectorAdd</code> 查看 kenerl 耗时</li>
</ol>
<h2 id="CUDALibrarySamples"><a href="#CUDALibrarySamples" class="headerlink" title="CUDALibrarySamples"></a><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples">CUDALibrarySamples</a></h2><ol>
<li>cublas</li>
<li>cutlass</li>
<li>npp</li>
</ol>
<h3 id="cuda-info"><a href="#cuda-info" class="headerlink" title="cuda info"></a>cuda info</h3><ol>
<li><a target="_blank" rel="noopener" href="https://linuxconfig.org/how-to-get-cuda-cores-count-on-linux">查看 cuda core</a><br><code>cd /usr/local/cuda-11.4/samples/1_Utilities/deviceQuery &amp;&amp; make &amp;&amp; ./deviceQuery</code></li>
<li>bandwith test<br><code>cd /usr/local/cuda-11.4/samples/1_Utilities/bandwidthTest &amp;&amp; make &amp;&amp; ./bandwidthTest</code></li>
</ol>
<h2 id="NVIDIA-Developer-Tools"><a href="#NVIDIA-Developer-Tools" class="headerlink" title="NVIDIA Developer Tools"></a><a target="_blank" rel="noopener" href="https://developer.nvidia.com/tools-overview">NVIDIA Developer Tools</a></h2><ol>
<li>各工具关系<br><img src="https://i.ibb.co/2qN87rv/QVJcq2r-QQ3.png" alt="tools"></li>
</ol>
<h3 id="nsight-system"><a href="#nsight-system" class="headerlink" title="nsight system"></a>nsight system</h3><ol>
<li>点击时注意竖线上的小三角号, 表示关联</li>
<li>从结果分析看多个 stream 下 kernel 可以同时运行<ul>
<li>all stream 或者 kernels 显示不出所有的 kernel 运行，起始位置被其他 kernel 覆盖的检测不出来</li>
<li>all stream 显示不出的 kernel 可能在被隐藏的 stream 里，鼠标放到 kernel 上能显示出在第几个 stream</li>
</ul>
</li>
<li>打开文件注意生成 log 时的错误</li>
<li>gui 可以远程 profiling， 将 nsys 安装到 target 机器, 类似 compute<ul>
<li><code>~/.local/share/nsight_systems/nsys</code>安装路径</li>
</ul>
</li>
<li>nsys profile 类似 perf record 来记录信息</li>
<li>nsys stats 类似 perf stats 来查看统计信息<ul>
<li><code>nsys stats report1.nsys-rep</code></li>
<li><code>nsys stats --report cuda_gpu_trace report1.nsys-rep</code></li>
</ul>
</li>
<li>gui summary 里可以看 log 具体执行命令</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html#cuda-trace">跟踪 cuda</a><ul>
<li><code>--trace=cuda</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html#gpu-metrics">可以收集 gpu-metrics</a><ul>
<li>Is my GPU idle?</li>
<li>Is my GPU full? Enough kernel grids size and streams? Are my SMs and warp slots full?</li>
<li>Am I using TensorCores?</li>
<li>Is my instruction rate high?</li>
<li>Am I possibly blocked on IO, or number of warps, etc</li>
</ul>
</li>
<li>分析系统性能</li>
<li><code>nvprof</code> 旧版本</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-systems/UserGuide/index.html">user guide</a></li>
<li>NsightSystems-2023.2.1.122-3259852.msi 安装包</li>
<li>Nsight_Systems_User_Guide_2023.2.1.122-3259852.pdf 文档</li>
<li>鼠标放到 kernel 上有 kernel 详细信息，<ul>
<li>包括执行时间</li>
<li>latency：launch latency, 与执行时间不一样，latency 是 api 调用到 kernel 开始执行时间<ul>
<li><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/nsys-timeline-end-start-is-not-the-same-as-latency/238043">NSys Timeline: End - Start is not the same as latency</a></li>
<li>CUDA kernel launch latency could be defined as the time range from the beginning of the launch API call to the beginning of the kernel execution.</li>
</ul>
</li>
<li>gird, block 设置;(注意，同一个 stream 下相同函数调用可能设置不一样导致时间不同)</li>
<li>一个线程用多少 register</li>
<li>理论 occupancy, 打开 gpu metrics 可以看对应的实际 occupancy</li>
<li>注意各种颜色</li>
</ul>
</li>
<li>可以在 thread 上看到 <code>cpu call stack</code><ul>
<li>每个线程对应行分层的最后一层 <code>sampling point</code></li>
<li>gpu 空闲时看 CPU 采样点 可以知道 CPU 在干啥</li>
<li>是否可以生成火焰图？</li>
</ul>
</li>
<li>timeline 上点击 stream 下的 tensorrt node， 可以显示对应的 kernel 执行和 cuda api 调用时间点, 注意竖线上的小三角号</li>
<li>tensorrt 多个维度来看<ul>
<li>thread</li>
<li>stream</li>
<li>cuda</li>
</ul>
</li>
<li>左上角 timeline view 可以选择 analysis summary，有各种总结</li>
<li>左侧右键选<code>show in events view</code>， 可以看具体时间, 可以在 all 上操作，看所有 event 运行时间</li>
<li>右键 reset room 显示全部</li>
<li><code>shift + mouseleftdoubleclick</code> timeline 可以找到对应 event 在 event view 位置</li>
<li><code>ctrl + mouseleftdoubleclick</code> timeline 可以 fit to screen</li>
<li><code>backspace</code> timeline 可以 undo room</li>
<li><code>ctrl + mouseleftdoubleclick</code> 可以找到 event view 对应的 timeline 位置</li>
<li><code>sudo nsys profile &lt;app&gt;</code></li>
<li><code>nsys stats report1.nsys-rep</code> 输出各种 report</li>
<li>可以看 cpu 执行情况， tensort 可以看详细算子耗时，也有对应 cuda 执行情况</li>
<li>analysis summary 中有各个线程的 cpu 利用率总结</li>
<li>可以关注 cpu 空闲的地方，为什么会空闲(同步数据？)</li>
<li>可以缩小看颜色占比，关注占比大的模块</li>
<li>cudaMemcpy 会阻塞 cpu 执行， 可以多注意 cudaMemcpy 影响</li>
<li>cudaStreamSynchronize 是 CUDA API 中的一个函数，用于等待指定的 CUDA 流上的所有 CUDA 核函数执行完毕。当 CUDA 核函数被执行时，它们会被添加到一个 CUDA 流中，这些核函数的执行可能是异步的，也可能是同步的，具体取决于如何在代码中调用它们。当我们调用 cudaStreamSynchronize 时，它将会阻塞当前 CPU 线程，直到指定的流上的所有核函数都执行完毕。</li>
</ol>
<h3 id="nsight-compute"><a href="#nsight-compute" class="headerlink" title="nsight compute"></a>nsight compute</h3><ol>
<li>有开销 <a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#overhead">overhead</a></li>
<li><code>metrics</code> 是指性能指标，这些指标用于衡量 CUDA 应用程序的性能和行为。性能指标可以包括各种硬件级别的统计数据，如内存访问效率、计算操作的执行时间、流处理器（SM）的利用率、寄存器使用情况、分支效率等等。</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/nvidia-development-tools-solutions-err_nvgpuctrperm-permission-issue-performance-counters">permission 问题</a><ul>
<li>可以增加临时权限</li>
</ul>
</li>
<li>分析 kernel 性能, 可以选 kernel</li>
<li>NVIDIA Nsight Compute is an interactive kernel profiler for CUDA applications. It provides detailed performance metrics and API debugging via a user interface and command line tool. In addition, its baseline feature allows users to compare results within the tool. NVIDIA Nsight Compute provides a customizable and data-driven user interface and metric collection and can be extended with analysis scripts for post-processing results.</li>
<li>需要 windows 客户端通过 connect 将 ncu 送到开发环境<ul>
<li>可以通过 activity 复制命令到板端执行</li>
<li>metrics 可以选择 Sets 和 rules</li>
</ul>
</li>
<li>profile -&gt; metrics details<ul>
<li>点击统计界面某个 metrics 可以看 metrics 详细信息</li>
</ul>
</li>
<li><code>ncu --replay-mode application --set full  ./preprocess</code> 详细信息显示到命令行<ul>
<li>Duration 为 kernel 执行时间</li>
</ul>
</li>
<li><code>ncu -k matrixMul --print-summary per-gpu ./test</code> 查看某个 kernel 信息</li>
<li><code>/tmp/var/target/linux-desktop-glibc_2_11_3-x64/ncu --config-file off --export &quot;/tmp/var/test&quot; --force-overwrite --section-folder /tmp/var/sections --set full ./test</code></li>
<li><code>ncu --set full -f --export nsight_compute ./test</code></li>
<li><code>docker run -itd -v /mnt:/mnt -p 30022:22 --user root --gpus all --name=Ubuntu20.04-CUDA-admin --shm-size 2g --cap-add=SYS_ADMIN nvidia/cuda:11.4.3-cudnn8-devel-ubuntu20.04</code> 尽量使用官方 docker<ul>
<li>需要 <code>--gpus all --cap-add=SYS_ADMIN</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/index.html">nsight-compute docs</a><ul>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/ProfilingGuide/index.html">ProfilingGuide</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/NsightCompute/index.html">user manual</a></li>
</ul>
</li>
<li>左上角可以显示：<ul>
<li>session: gpu cpu 等信息</li>
<li>detailed：overview, compute, memory 等</li>
<li>source: 汇编代码及耗时</li>
<li>summary: 耗时，compute and memory throughput; 底下有优化建议</li>
</ul>
</li>
<li><code>ncu --set roofline</code>可以测量详细 roofline</li>
<li><code>ncu --metrics smsp__inst_executed.sum ./matrixMul</code> 打印 metrics</li>
<li><code>--set roofline</code>能看到 tensor core roofline; 例如运行<code>cuda-samples/Samples/3_CUDA_Features/cudaTensorCoreGemm</code></li>
</ol>
<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><ol>
<li>The application returned an error code (9).<ul>
<li><code>ncu --replay-mode &lt;application/kernel&gt;</code> 加参数； 见<a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/nsight-profiling-crashes-with-error-code-9/230094/5">link</a></li>
<li>可以使用<code>–replay-mode application</code>切换到应用程序重播。 这避免了内存存储需要重放。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#replay">replay</a><ul>
<li>kernels might need to be replayed one or more times, since not all metrics can be collected in a single pass</li>
<li>the number of metrics originating from hardware (HW) performance counters that the GPU can collect at the same time is limited.</li>
<li>kernal replay 只重跑 kernel, application replay 重跑应用</li>
</ul>
</li>
</ol>
<h4 id="metrics"><a href="#metrics" class="headerlink" title="metrics"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-guide">metrics</a></h4><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2023.3/ProfilingGuide/index.html#metrics-reference">metrics-reference</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/2019.5/NsightComputeCli/index.html#nvprof-metric-comparison">nvprof-metric-comparison</a></li>
<li><code>ncu --devices 0 --query-metrics &gt;my_metrics.txt</code> 查看 metrics</li>
</ol>
<h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><ol>
<li>每项下面会有建议</li>
<li>overview<ul>
<li>roofline</li>
</ul>
</li>
<li>comupte<ul>
<li>IPC</li>
<li>指令执行占比</li>
</ul>
</li>
<li>memory<ul>
<li>可以选择看 transfer size 和 throughput</li>
<li>要提升 cache 命中率</li>
<li>多用 shared memory(可作为中间结果)</li>
<li>多种 memory<ul>
<li>global</li>
<li>local: 线程私有的。local memory 不是物理空间，而是 global memory 的一部分，所以延时较大。</li>
<li>texture: 只读?</li>
<li>surface</li>
<li>load global stroe shared</li>
<li>shared</li>
</ul>
</li>
</ul>
</li>
<li>scheduler statistics<ul>
<li>Issued Warp Per Scheduler: 平均每个 cycle 发射的 warp 数</li>
<li>On cycles with no eligible warps, the issue slot is skipped and no instruction is issued. Having many skipped issue slots indicates poor latency hiding.</li>
<li>Out of the maximum of 12 warps per scheduler(Ampere 1 个 SM 有 4 个 scheduler), this kernel allocates an average of 2.00 active warps per scheduler, but only an average of 0.07 warps were eligible(合格的) per cycle.</li>
<li>可以看出平局每个 sm 有几个 warps; 参考可以看 Theoretical Occupancy 是多少，有可能受 regitster 和 shared memory 等限制</li>
<li>Eligible warps are the subset of active warps that are ready to issue their next instruction.</li>
</ul>
</li>
<li>warp state</li>
<li>instructions</li>
<li>launch</li>
<li>cocupancy<ul>
<li>Occupancy is the ratio of the number of active warps per multiprocessor to the maximum number of possible active warps.</li>
<li>可以看出理论占用率及不能到 100%的原因</li>
<li>一个 warp 中用太多 register 和 shared memory 会影响 Occupancy， Occupancy 会影响 scheduler， 进而会影响延迟隐藏</li>
<li>Occupancy 是 CUDA 编程中一个重要的性能指标,它表示 GPU 中 Streaming Multiprocessor (SM)上的处理单元被运用的比例。</li>
<li>右上角点开 table，可以可视化</li>
</ul>
</li>
</ol>
<h3 id="nsgiht-graphics"><a href="#nsgiht-graphics" class="headerlink" title="nsgiht graphics"></a>nsgiht graphics</h3><h2 id="cuda-debug"><a href="#cuda-debug" class="headerlink" title="cuda-debug"></a><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-visual-studio-code-edition/cuda-debugger/index.html">cuda-debug</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cutlass/tree/main/examples/02_dump_reg_shmem">02_dump_reg_shmem</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-gdb/index.html#compiling-the-application">compiling 要求</a><ul>
<li><code>nvcc -g -G foo.cu -o foo</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=NVIDIA.nsight-vscode-edition">vs code plugin: nsight-vscode-edition</a></li>
<li>shared memory(L1 cache?) dump<ul>
<li>申请 shared memory 变量，存中间结果， shared memory 对 block 全局可见。</li>
<li>可以申请多于 L1 cache 大小的存储，系统会自动调度</li>
</ul>
</li>
<li>传递主存指针到 kernel，用于 dump</li>
<li>print<ul>
<li><code>if(threadIdx.x == 0) printf...</code> 条件打印</li>
<li>cudaDeviceReset(); 不打印可以加</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/nsight-visual-studio-code-edition">nsight-visual-studio-code-edition</a></li>
<li>cuda-gdb</li>
<li>cuda-memcheck</li>
</ol>
<h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-zone">cuda 相关开发</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/gpu-accelerated-libraries">gpu-accelerated-libraries</a></li>
</ol>
<h2 id="build-1"><a href="#build-1" class="headerlink" title="build"></a>build</h2><h3 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h3><ol>
<li><a target="_blank" rel="noopener" href="https://developer.download.nvidia.com/video/gputechconf/gtc/2019/presentation/s9444-build-systems-exploring-modern-cmake-cuda-v2.pdf">build-systems-exploring-modern-cmake-cuda-v2.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/building-cuda-applications-cmake/">building-cuda-applications-cmake</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples/blob/master/cuBLAS/Level-3/gemm/CMakeLists.txt">CUDALibrarySamples</a></li>
<li>basic sample</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.8</span>)</span><br><span class="line"><span class="comment"># project(my_cuda_project LANGUAGES CXX CUDA)</span></span><br><span class="line"><span class="keyword">project</span>(my_cuda_project)</span><br><span class="line"><span class="keyword">enable_language</span>(CUDA) <span class="comment"># 需要enable language</span></span><br><span class="line"><span class="keyword">add_executable</span>(preprocess kernel.cu preprocess.cpp )</span><br><span class="line"><span class="keyword">find_package</span>(CUDA REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(preprocess <span class="variable">$&#123;CUDA_cudart_LIBRARY&#125;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h3><ol>
<li>混合编译, 注意-lcudart 顺序</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvcc -O3 -c kernel.cu -o kernel.o</span><br><span class="line">g++ -L /usr/local/cuda/targets/x86_64-linux/lib/ preprocess.cpp kernel.o -o preprocess -lcuda -lcudart &amp;&amp; ./preprocess</span><br></pre></td></tr></table></figure>

<h2 id="unified-memory"><a href="#unified-memory" class="headerlink" title="unified memory"></a>unified memory</h2><ol>
<li>不明白原理时不推荐使用</li>
<li>优缺点<ul>
<li>优点<ul>
<li>简化代码编写和内存管理：cudaMallocManaged 可以简化 CPU 和 GPU 之间数据传递的代码，无需手动管理内存迁移。</li>
</ul>
</li>
<li>缺点<ul>
<li>可能降低性能：在某些情况下，统一内存可能会降低性能，例如在数据访问模式为稀疏的情况下。</li>
<li>可能增加内存占用：统一内存可能会增加内存占用，因为它需要在 CPU 和 GPU 内存中都保留一份数据副本。</li>
</ul>
</li>
</ul>
</li>
<li><code>cudaMalloc -&gt; cudaMallocManaged(&amp;x, N*sizeof(float));</code></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/21990899/23011500">使用 cudaMallocManaged 情况</a><ul>
<li>You are working on a Jetson device.</li>
</ul>
</li>
<li>runtime 负责 copy</li>
<li>unified memory cpu 访问时需要同一个线程。不同线程会 bus error。</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/unified-memory-cuda-beginners/">Unified Memory for CUDA Beginners</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/maximizing-unified-memory-performance-cuda/">Maximizing Unified Memory Performance in CUDA</a></li>
</ol>
<h2 id="design"><a href="#design" class="headerlink" title="design"></a>design</h2><ol>
<li>lidar prprocess; 三重 for, 最外层作为 x, 一个线程执行一个最里面 for 的内容，</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TransposeDim</span><span class="params">(<span class="type">int</span> kmax_num_point_pillar,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> kmax_num_point,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> kdim,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">int</span> voxel_num, <span class="type">float</span> *voxel_data, <span class="type">int8_t</span> *features_s8)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> kWC = kmax_num_point_pillar * kdim;</span><br><span class="line">  <span class="type">int</span> kHW = kmax_num_point * kmax_num_point_pillar;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; kdim; ++c)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> w = <span class="number">0</span>; w &lt; kmax_num_point_pillar; ++w)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> h = <span class="number">0</span>; h &lt; voxel_num; ++h)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="type">int</span> old_index = h * kWC + w * kdim + c;</span><br><span class="line">        <span class="type">int</span> new_index = c * kHW + w * kmax_num_point + h;</span><br><span class="line">        <span class="type">float</span> features_tmp = <span class="built_in">round</span>(<span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(voxel_data[old_index]));</span><br><span class="line">        features_tmp = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(features_tmp, <span class="number">-128.f</span>), <span class="number">127.f</span>);</span><br><span class="line">        features_s8[new_index] = <span class="built_in">static_cast</span>&lt;<span class="type">int8_t</span>&gt;(features_tmp);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">TransposeDim5Kernel</span><span class="params">(<span class="type">int</span> kmax_num_point_pillar,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> kmax_num_point,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> kdim,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int</span> voxel_num,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">float</span> *voxel_data,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">int8_t</span> *features_s8)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> c = blockIdx.x * blockDim.x + threadIdx.x;</span><br><span class="line">  <span class="type">int</span> w = blockIdx.y * blockDim.y + threadIdx.y;</span><br><span class="line">  <span class="type">int</span> h = blockIdx.z * blockDim.z + threadIdx.z;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (c &lt; kdim &amp;&amp; w &lt; kmax_num_point_pillar &amp;&amp; h &lt; voxel_num)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">int</span> kWC = kmax_num_point_pillar * kdim;</span><br><span class="line">    <span class="type">int</span> kHW = kmax_num_point * kmax_num_point_pillar;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> old_index = h * kWC + w * kdim + c;</span><br><span class="line">    <span class="type">int</span> new_index = c * kHW + w * kmax_num_point + h;</span><br><span class="line">    <span class="type">float</span> features_tmp = <span class="built_in">round</span>(voxel_data[old_index]);</span><br><span class="line"></span><br><span class="line">    features_tmp = <span class="built_in">fmaxf</span>(<span class="built_in">fminf</span>(features_tmp, <span class="number">127.f</span>), <span class="number">-128.f</span>);</span><br><span class="line"></span><br><span class="line">    features_s8[new_index] = <span class="built_in">static_cast</span>&lt;<span class="type">int8_t</span>&gt;(features_tmp);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">dim3 <span class="title">blockSize</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>, <span class="number">32</span>)</span></span>;</span><br><span class="line"><span class="function">dim3 <span class="title">gridSize</span><span class="params">((kdim + blockSize.x - <span class="number">1</span>) / blockSize.x,</span></span></span><br><span class="line"><span class="params"><span class="function">                (kmax_num_point_pillar + blockSize.y - <span class="number">1</span>) / blockSize.y,</span></span></span><br><span class="line"><span class="params"><span class="function">                (voxel_num + blockSize.z - <span class="number">1</span>) / blockSize.z)</span></span>;</span><br><span class="line"></span><br><span class="line">TransposeDim5Kernel&lt;&lt;&lt;gridSize, blockSize&gt;&gt;&gt;(kmax_num_point_pillar,</span><br><span class="line">                                               kmax_num_point,</span><br><span class="line">                                               kdim,</span><br><span class="line">                                               voxel_num,</span><br><span class="line">                                               d_voxel_data,</span><br><span class="line">                                               d_features_s8);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/03/Doxygen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/03/Doxygen/" class="post-title-link" itemprop="url">Doxygen</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-03 03:58:22" itemprop="dateCreated datePublished" datetime="2022-03-03T03:58:22+08:00">2022-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-11-29 11:23:43" itemprop="dateModified" datetime="2023-11-29T11:23:43+08:00">2023-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/03/Doxygen/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/03/Doxygen/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="base"><a href="#base" class="headerlink" title="base"></a>base</h2><ol>
<li>markdown 添加 [toc] 为 html 生成目录</li>
<li>参考 opencv</li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/57979732">multi projects</a></li>
<li>可以用 cmake 生成 doxygen 配置 <a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/blob/17234f82d025e3bbfbf611089637e5aa2038e7b8/doc/Doxyfile.in">link</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/doxygen/doxygen/tree/master/templates">templates</a></li>
</ol>
<h2 id="theme"><a href="#theme" class="headerlink" title="theme"></a>theme</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/jothepro/doxygen-awesome-css">doxygen-awesome-css</a></li>
<li><a target="_blank" rel="noopener" href="https://jothepro.github.io/doxygen-awesome-css/index.html">效果</a></li>
</ol>
<h2 id="doxygen-config"><a href="#doxygen-config" class="headerlink" title="doxygen config"></a>doxygen config</h2><ol>
<li><code>sudo apt install doxygen</code></li>
<li><code>doxygen -g &lt;config-name&gt;</code> 产生配置文件，默认为 Doxyfile <code>-s</code> 生成不带注释的配置文件</li>
<li><code>doxygen &lt;config-name&gt;</code> 生成文档</li>
<li>UML 生成 svg 图片<ul>
<li><code>DOT_IMAGE_FORMAT       = svg(png)</code></li>
<li><code>INTERACTIVE_SVG        = YES</code></li>
</ul>
</li>
<li>生成 UML, 需要修改配置文件, 以下改为 YES</li>
</ol>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RECURSIVE</span><br><span class="line">HAVE<span class="emphasis">_DOT</span></span><br><span class="line"><span class="emphasis">UML_LOOK</span></span><br><span class="line"><span class="emphasis">EXTRACT_</span>ALL</span><br></pre></td></tr></table></figure>

<ol>
<li><code>INLINE_SOURCES</code>标签。如果设置为 YES，可以将源代码直接包含到文档中。</li>
<li><code>OUTPUT_LANGUAGE</code> &#x3D; 改为 Chinese</li>
<li><code>HTML_TIMESTAMP</code>标签设置为 YES，则每个生成的 HTML 页面的页脚将包含生成页面的日期和时间。将此设置为“是”有助于显示上次运行 doxygen 的时间，从而显示文档是否最新。</li>
<li><code>GENERATE_TREEVIEW</code> 标签用于指定是否应生成树状索引结构以显示分层信息。</li>
<li><code>PROJECT_NAME</code></li>
<li><code>PROJECT_NUMBER</code></li>
<li><code>PROJECT_LOGO</code> 首页左侧图标</li>
<li><code>EXTRACT_STATIC</code> 如果设置为 YES，一个文件的所有静态成员都将包含在文档中。</li>
<li><code>EXTRACT_PRIVATE</code> 如果设置为 YES，一个类的所有私有成员都将包含在文档中。</li>
<li><code>IMAGE_PATH</code> 修复 markdown 生成网页时 doc 出错问题</li>
<li><code>USE_MDFILE_AS_MAINPAGE = ./README.md</code> 主页</li>
<li><code>HTML_OUTPUT = doc_html</code></li>
<li><code>LATEX_OUTPUT = doc_latex</code></li>
<li><code>INPUT</code> 标签是输入的源码文件的目录, 空格分开 例如： <code>INPUT = README.md include/pg</code></li>
<li>输出 color <a target="_blank" rel="noopener" href="https://github.com/jothepro/doxygen-awesome-css/blob/main/docs/customization.md#doxygen-generator">link</a></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTML_COLORSTYLE_HUE    = 209</span><br><span class="line">HTML_COLORSTYLE_SAT    = 255</span><br><span class="line">HTML_COLORSTYLE_GAMMA  = 113</span><br></pre></td></tr></table></figure>

<h2 id="pdf"><a href="#pdf" class="headerlink" title="pdf"></a>pdf</h2><ol>
<li><code>sudo apt-get install texlive-full texlive-latex-base</code> <a target="_blank" rel="noopener" href="https://tex.stackexchange.com/a/481681">link</a></li>
<li><code>cd latex &amp;&amp; make</code></li>
<li><code>doxygen -w latex header.tex footer.tex doxygen.sty</code> 先生成默认配置，修改 doxygen.config 指定<code>LATEX_HEADER = header.tex</code> <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/16222657">link</a></li>
<li>修改 refman.tex 来改变 pdf 生成</li>
<li><code>sed -i &quot;s/Doxygen/xx xx/&quot; refman.tex</code>修改制作者名字</li>
<li>中文问题 <code>\begin&#123;CJK&#125;&#123;UTF8&#125;</code> 换成 <code>\begin&#123;CJK&#125;&#123;gbsn&#125;</code> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyl910/archive/2013/06/02/doxygen_pdf_chinese.html">link</a></li>
<li>空页问题： <code>COMPACT_LATEX</code> to YES</li>
<li>换页问题： <code>\doxysection</code> 之前加 <code>\newpage</code></li>
<li>refman.tex 处理</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;/fancyfoot/d&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;/fancyhead/d&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\cfoot&#123;\\thepage&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\rhead&#123;&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/&#123;fancyplain&#125;/a\\\lhead&#123;&#125;&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&#x27;/doxysection/i\\\newpage&#x27;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;s/Doxygen 1.8.17/PhiGent Robotics/&quot;</span> latex/refman.tex</span><br><span class="line">sed -i <span class="string">&quot;s/&#123;min&#125;/&#123;gbsn&#125;/&quot;</span> latex/refman.tex</span><br></pre></td></tr></table></figure>

<ol>
<li><code>\pagestyle&#123;fancyplain&#125;</code> 删除之后页眉页脚不再有横杠 <code>\pagestyle&#123;plain&#125;</code></li>
</ol>
<h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><ol>
<li>不要在有 build 的目录下</li>
<li>如果想生成详细的 UML 图，需要设置<code>EXTRACT_STATIC</code> <code>EXTRACT_PRIVATE</code>为 YES</li>
</ol>
<h2 id="文档解析"><a href="#文档解析" class="headerlink" title="文档解析"></a>文档解析</h2><ol>
<li>Class Hierarchy 可以查看类层级关系</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://fossies.org/dox/all.html">fossies doxygen lists</a></li>
<li><a target="_blank" rel="noopener" href="https://www.doxygen.nl/manual/starting.html">getting start</a></li>
<li><a target="_blank" rel="noopener" href="https://www.guyuehome.com/35640">参数详解</a></li>
<li><a target="_blank" rel="noopener" href="https://doxygen.nl/projects.html">使用 doxygen 的项目</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/metropolis/deepstream/sdk-api/index.html">deepstream doxygen</a></li>
<li><a target="_blank" rel="noopener" href="https://google.github.io/ion/base_2logging_8h.html">ion</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.opencv.org/4.x/d9/df8/tutorial_root.html">opencv tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/opencv/opencv/blob/17234f82d025e3bbfbf611089637e5aa2038e7b8/doc/Doxyfile.in">opencv config</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/doxygen/doxygen/tree/master/templates">templates</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/03/UML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/03/UML/" class="post-title-link" itemprop="url">UML</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-03 02:32:22" itemprop="dateCreated datePublished" datetime="2022-03-03T02:32:22+08:00">2022-03-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-07 13:50:16" itemprop="dateModified" datetime="2023-10-07T13:50:16+08:00">2023-10-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/03/UML/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/03/UML/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="UML-介绍"><a href="#UML-介绍" class="headerlink" title="UML 介绍"></a>UML 介绍</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.visual-paradigm.com/cn/guide/uml-unified-modeling-language/what-is-uml/">历史</a></li>
<li>图表可大致分为结构性图表和行为性图表两种。结构性图表显示了系统在不同抽象层次和实现层次上的静态结构以及它们之间的相互关系。结构性图表中的元素表示系统中具意义的概念，可能包括抽象的、现实的和實作的概念。</li>
<li>结构性图表有七种类型：<ul>
<li>类图 (Class Diagram)</li>
<li>组件图 (Component Diagram)</li>
<li>部署图 (Deployment Diagram)</li>
<li>对象图 (Object Diagram)-</li>
<li>包图 (Package Diagram)</li>
<li>复合结构图 (Composite Structure Diagram)</li>
<li>轮廓图 (Profile Diagram)</li>
</ul>
</li>
<li>行为性图表显示了系统中对象的动态行为 ，可用以表达系统随时间的变化。行为性图表有七种类型：<ul>
<li>用例图 (Use Case Diagram)</li>
<li>活动图 (Activity Diagram)</li>
<li>状态机图 (State Machine Diagram)</li>
<li>序列图 (Sequence Diagram)</li>
<li>通訊圖 (Communication Diagram)</li>
<li>交互概述图 (Interaction Overview Diagram)</li>
<li>时间图 (Timing Diagram)</li>
</ul>
</li>
</ol>
<h2 id="图种类"><a href="#图种类" class="headerlink" title="图种类"></a>图种类</h2><ol>
<li>class diagram 类图</li>
<li>sequence diagram 时序图</li>
<li>flow chart 流程图</li>
</ol>
<h3 id="class-diagram"><a href="#class-diagram" class="headerlink" title="class diagram"></a>class diagram</h3><h3 id="sequence-diagram"><a href="#sequence-diagram" class="headerlink" title="sequence diagram"></a><a target="_blank" rel="noopener" href="https://www.woshipm.com/ucd/607593.html">sequence diagram</a></h3><h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><p><img src="https://pica.zhimg.com/v2-941a070601f399d992125ef31261637e_1440w.jpg?source=172ae18b" alt="关系"></p>
<!-- prettier-ignore -->
<table>
<thead>
<tr>
<th align="left">名字</th>
<th align="left">图形</th>
<th align="left">说明</th>
<th align="left">其他</th>
</tr>
</thead>
<tbody><tr>
<td align="left">实现关系</td>
<td align="left">空心三角和虚线组成的箭头</td>
<td align="left">实现类指向接口</td>
<td align="left">类似 rust trait</td>
</tr>
<tr>
<td align="left">泛化关系</td>
<td align="left">空心三角和实线组成的箭头</td>
<td align="left">从子类指向父类</td>
<td align="left">“is a”</td>
</tr>
<tr>
<td align="left">关联关系</td>
<td align="left">带箭头的实线</td>
<td align="left">指向被关联的对象</td>
<td align="left">一个对象含有另一个对象的引用</td>
</tr>
<tr>
<td align="left">依赖关系</td>
<td align="left">带虚线的箭头</td>
<td align="left">使用方指向被使用方</td>
<td align="left">“use a”, 弱关联关系,<br>构造器或方法中的局部变量、方法或构造器的参数、方法的返回值</td>
</tr>
<tr>
<td align="left">聚合关系</td>
<td align="left">空心菱形加实线箭头</td>
<td align="left">空心菱形在整体一方，箭头指向部分一方</td>
<td align="left">“has a”, 具有各自的生命周期</td>
</tr>
<tr>
<td align="left">组合关系</td>
<td align="left">实心菱形加实线箭头</td>
<td align="left">实心菱形在整体一方，箭头指向部分一方</td>
<td align="left">“contains a” 强聚合, 作为整体的对象负责部分的对象的生命周期</td>
</tr>
</tbody></table>
<!-- prettier-ignore -->
<h2 id="mermaid"><a href="#mermaid" class="headerlink" title="mermaid"></a>mermaid</h2><h2 id="mermaid-1"><a href="#mermaid-1" class="headerlink" title="mermaid"></a><a target="_blank" rel="noopener" href="https://github.com/mermaid-js/mermaid">mermaid</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://mermaid.live/">在线 server</a></li>
<li><a target="_blank" rel="noopener" href="https://jojozhuang.github.io/tutorial/mermaid-cheat-sheet/">cheat sheet</a></li>
<li>markdown 支持</li>
<li>theme <code>%%&#123;init: &#123;&#39;theme&#39;: &#39;base&#39;, &#39;themeVariables&#39;: &#123; &#39;primaryColor&#39;: &#39;#ffcccc&#39;, &#39;edgeLabelBackground&#39;:&#39;#ffffee&#39;, &#39;tertiaryColor&#39;: &#39;#fff0f0&#39;, &#39;fontFamily&#39;: &#39;verdana&#39;&#125;&#125;&#125;%%</code></li>
<li><a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/#/theming">theming</a></li>
<li>可以用 graph 画关系图<a target="_blank" rel="noopener" href="https://github.com/bitcoin/bitcoin/blob/master/doc/design/libraries.md#L36">bitcoin sample</a></li>
<li>gatte 图也好用</li>
<li>github 用 chrome 插件<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/markdown-diagrams/pmoglnmodacnbbofbgcagndelmgaclel">markdown-diagrams</a>可以生成图片, 密集图片截屏效果不好</li>
<li><code>%%&#123;init: &#123;&#39;securityLevel&#39;: &#39;loose&#39;, &#39;theme&#39;:&#39;base&#39;&#125;&#125;%%</code> 设置主题</li>
<li><code>%%&#123;init:&#123;&quot;themeVariables&quot;: &#123; &quot;fontSize&quot;: &quot;30px&quot; &#125;&#125;&#125;%%</code> 设置字体大小</li>
<li><code>%%&#123;init:&#123;&#39;theme&#39;:&#39;neutral&#39;, &quot;themeVariables&quot;: &#123; &quot;fontSize&quot;: &quot;20px&quot; &#125;&#125;&#125;%%</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mermaid-js/mermaid/issues/3033">字体设置只支持几种图，其他不支持</a></li>
<li>sequence</li>
</ol>
<pre><code class="highlight mermaid">&#123;% mermaid sequenceDiagram %&#125;
Alice-&gt;&gt;John: Hello John, how are you?
loop Healthcheck
    John-&gt;&gt;John: Fight against hypochondria
end
Note right of John: Rational thoughts!
John--&gt;&gt;Alice: Great!
John-&gt;&gt;Bob: How about you?
Bob--&gt;&gt;John: Jolly good!
&#123;% endmermaid %&#125;</code></pre>

<ol>
<li>flow chart 支持 <a target="_blank" rel="noopener" href="https://fontawesome.com/icons">fontawesome</a></li>
</ol>
<pre><code class="highlight mermaid">classDiagram
    user ..&gt; image
    image ..&gt; MediaProc
    MediaProc &lt;|-- ImgProcImpl
    ImgProcImpl ..&gt; ImageFrame : 代理
    ImageFrame &lt;|-- ImageFrameImpl
    ImageFrameImpl &lt;|-- BpuImageFrame

    class MediaProc&#123;
      &lt;&lt;interface&gt;&gt;
      +Crop()
      +Resize()
      +CvtColor()
      +Decode()
      +Encode()
    &#125;

    class ImgProcImpl&#123;
      +Crop()
      +Resize()
      +CvtColor()
      +Decode()
      +Encode()
    &#125;

    class ImageFrame&#123;
      &lt;&lt;interface&gt;&gt;
      +Crop()
      +Resize()
      +CvtColor()
    &#125;

    class ImageFrameImpl&#123;
      +Crop()
      +Resize()
      +CvtColor()
    &#125;

    class BpuImageFrame&#123;
      +Crop()
      +Resize()
      +CvtColor()
    &#125;
</code></pre>

<ol>
<li>samples<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tiangolo/fastapi/blob/master/docs/en/docs/tutorial/dependencies/dependencies-with-yield.md#dependencies-with-yield-and-httpexception">fastapi</a></li>
<li><a target="_blank" rel="noopener" href="https://mermaid.live/edit#pako:eNqdVFFr01AU_iuX-6QYW9vabuvDQLoNYVKGKYIaH26Tk-ZCkhtvbqe1FMQndZsOhogwNycMBWHTFwU39M_YrG_-BW9605rNZk7zkNDvnPud85379XSxySzAVRzC3Tb4JsxR0uLEM3wkn4BwQU0aEF-gmkvBF3_iOvBl4ArnYArEW81zxXJZQ8VScfg6r4J1JgBx2nIEYnZCV0X9w4f9dyuoUVtC0fOd6MmKSlbhi7Ozir6q36yrADEFXSaSKd2PSpLZCavMvnCltnjiRLpTCyYSnSw7Jknlp2nAt04ql6Jj9X_TLQUrvUcHG9Hr7Z-Hq_311ejlZzWP_sHXow8rjWv64PtW9Gx3cnMJgK6C67J_mE4CqHMaqoG8TJua8piWhBahM3_fdIjfGkPD5DnmQwbn_8AZlzBx0hnij3VaG35rNHCA6wGYGlqgPg0dsDI4ToUzrvxsIz5eOEPoZPck_5tyOe0fF-yhfUYtSmsg5Q1lldg_Q-dELz5Ga3s_Dt8Mvm1kyJur6yja3h3svx3sf4k-PTpF18Ta0eZa_-lO_9V7RZLL5TKG8LtQbPKtzbMNY1iTxQZVYW1Ut7-3Gj1eT7EavjoxerCGPeAeoZZcaN04ZmDhgAcGlpeKbcYhFAbWUpEbhFPSdCGMU7qKLs70xQLxqNuJ4dujKgZuUA9CVId76DrziJ9wqZjO2twceoXaaIkzA6vYHS1Nq9MHSTuFQiBUTs_we7J30hZM7_gmrgreBg23A0sOKVnIuGoTNxyj8xYVjI9BlxEL5M8uFp0gXuctGgpJaTLfpq0Yb3NXwo4QQVjN5-NwrkWF027mTOblQ2o5cqc7yzOVfKVYmSbFElSmSqRcKllmszAzbRcvF2xr6lKhSHCvp2G5-m8xNuqq9ws-JjhZ">三次握手 config 中有中文支持</a></li>
</ul>
</li>
</ol>
<h2 id="plantuml"><a href="#plantuml" class="headerlink" title="plantuml"></a><a target="_blank" rel="noopener" href="https://github.com/plantuml/plantuml">plantuml</a></h2><ol>
<li><p><a target="_blank" rel="noopener" href="http://www.plantuml.com/plantuml/uml/">在线 server</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/plantuml/plantuml-server">本地 plantuml-server</a></p>
<ul>
<li><code>docker run -d -p 10093:8080 plantuml/plantuml-server:jetty</code></li>
<li><code>docker run -d -p 10093:8080 -e THE_ENV_VARIABLE=THE_ENV_VALUE plantuml/plantuml-server:jetty</code></li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://plantuml.com/zh/guide">pdf guide</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://plantuml.com/zh/class-diagram">class</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://plantuml.com/zh/sequence-diagram">时序图</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/iluwatar/java-design-patterns">java-design-patterns</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/iluwatar/java-design-patterns/blob/master/factory-method/etc/factory-method.urm.puml">puml config file demo</a></p>
</li>
<li><p>markdown gitlab github 不支持， 用<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/markdown-diagrams/pmoglnmodacnbbofbgcagndelmgaclel">markdown-diagrams</a>来支持浏览器显示</p>
</li>
<li><p>test plantuml</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">object Object01</span><br><span class="line">object Object02</span><br><span class="line">object Object03</span><br><span class="line">object Object04</span><br><span class="line">object Object05</span><br><span class="line">object Object06</span><br><span class="line">object Object07</span><br><span class="line">object Object08</span><br><span class="line"></span><br><span class="line">Object01 &lt;|-- Object02</span><br><span class="line">Object03 *-- Object04</span><br><span class="line">Object05 o-- &quot;4&quot; Object06</span><br><span class="line">Object07 .. Object08 : some labels</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>

<h2 id="dot-language"><a href="#dot-language" class="headerlink" title="dot language"></a><a target="_blank" rel="noopener" href="https://graphviz.org/doc/info/lang.html">dot language</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://gitlab.com/graphviz/graphviz/-/tree/main/cmd/dot">dot 命令源码</a></li>
<li><code>sudo apt-get install graphviz</code></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/DOT%E8%AF%AD%E8%A8%80">维基介绍</a></li>
<li><a target="_blank" rel="noopener" href="https://itopic.org/graphviz.html">属性</a></li>
<li><a target="_blank" rel="noopener" href="http://www.graphviz.org/gallery/">samples</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zywvvd.com/notes/tools/graphviz/graphviz/">Graphviz 使用教程</a></li>
<li>sample</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">digraph test123 &#123;</span><br><span class="line">        pack=8</span><br><span class="line">        subgraph cluster0 &#123;</span><br><span class="line">          packmode=array</span><br><span class="line">          x y x0 y0 x1</span><br><span class="line">          subgraph cluster1 &#123;</span><br><span class="line">            m n</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        b [shape=box];</span><br><span class="line">        c [label=&quot;helloenworld&quot;,color=blue,fontsize=24,</span><br><span class="line">             fontname=&quot;Palatino-Italic&quot;,fontcolor=red,style=filled];</span><br><span class="line">        a -&gt; z</span><br><span class="line">        x -&gt; z</span><br><span class="line">        a -&gt; b -&gt; c;</span><br><span class="line">        a -&gt; &#123;x y&#125;;</span><br><span class="line">        edge [style=dashed,color=red];</span><br><span class="line">        b -&gt; x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="doxygen-生成-UML"><a href="#doxygen-生成-UML" class="headerlink" title="doxygen 生成 UML"></a>doxygen 生成 UML</h2><h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shindo/p/5579191.html">关系</a></li>
<li><a target="_blank" rel="noopener" href="https://www.51fusa.com/client/information/informationdetail/id/1561.html">基于 SOME&#x2F;IP 的 AP AUTOSAR 实战</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904039902085134">适合程序员的 UML 绘图工具</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/03/02/Nvidia-NPP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/02/Nvidia-NPP/" class="post-title-link" itemprop="url">Nvidia-NPP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-02 11:30:48" itemprop="dateCreated datePublished" datetime="2022-03-02T11:30:48+08:00">2022-03-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-09 19:56:16" itemprop="dateModified" datetime="2023-10-09T19:56:16+08:00">2023-10-09</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/03/02/Nvidia-NPP/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/03/02/Nvidia-NPP/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><ol>
<li>need <code>sudo</code> to run exe</li>
<li><code>export CUDACXX=/usr/local/cuda/bin/nvcc</code> when build cuda</li>
<li>CMakeLists.txt: <code>CUDA_ADD_EXECUTABLE(resize resize.cpp)</code></li>
</ol>
<h2 id="yuyv-2-rgb"><a href="#yuyv-2-rgb" class="headerlink" title="yuyv 2 rgb"></a>yuyv 2 rgb</h2><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/71473363">link</a> nvcc 替换成 g++也可用</li>
</ol>
<h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><ol>
<li>install path: <code>/usr/local/cuda-xxx/</code></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi_conventions_lb.html">函数名称中简写的意义</a></li>
<li></li>
</ol>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot; <span class="keyword">if</span> the image <span class="keyword">is</span> a <span class="number">4</span> channel image this indicates the result alpha channel <span class="keyword">is</span> <span class="keyword">not</span> affected <span class="keyword">by</span> the primitive.</span><br><span class="line">&quot;Cn&quot; the image consists <span class="keyword">of</span> n channel packed pixels, <span class="keyword">where</span> n can be <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> <span class="keyword">or</span> <span class="number">4.</span></span><br><span class="line">&quot;Pn&quot; the image consists <span class="keyword">of</span> n separate image planes, <span class="keyword">where</span> n can be <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> <span class="keyword">or</span> <span class="number">4.</span></span><br><span class="line">&quot;C&quot; (<span class="keyword">following</span> the channel information) indicates that the primitive <span class="keyword">only</span> operates <span class="keyword">on</span> one <span class="keyword">of</span> the color channels, the &quot;channel-of-interest&quot;. <span class="keyword">All</span> other output channels are <span class="keyword">not</span> affected <span class="keyword">by</span> the primitive.</span><br><span class="line">&quot;I&quot; indicates that the primitive works &quot;in-place&quot;. <span class="keyword">In</span> this <span class="keyword">case</span> the image-data pointer <span class="keyword">is</span> usually named pSrcDst <span class="keyword">to</span> indicate that the image data serves <span class="keyword">as</span> source <span class="keyword">and</span> destination at the same <span class="type">time</span>.</span><br><span class="line">&quot;M&quot; indicates &quot;masked operation&quot;. These <span class="keyword">types</span> <span class="keyword">of</span> primitives have an additional &quot;mask image&quot; <span class="keyword">as</span> <span class="keyword">as</span> <span class="keyword">input</span>. <span class="keyword">Each</span> pixel <span class="keyword">in</span> the destination image corresponds <span class="keyword">to</span> a pixel <span class="keyword">in</span> the mask image. <span class="keyword">Only</span> pixels <span class="keyword">with</span> a corresponding non-zero mask pixel are being processed.</span><br><span class="line">&quot;R&quot; indicates the primitive operates <span class="keyword">only</span> <span class="keyword">on</span> a rectangular &quot;region-of-interest&quot; <span class="keyword">or</span> &quot;ROI&quot;. <span class="keyword">All</span> ROI primitives take an additional <span class="keyword">input</span> parameter <span class="keyword">of</span> <span class="keyword">type</span> NppiSize, which specifies the width <span class="keyword">and</span> height <span class="keyword">of</span> the rectangular region that the primitive should process. <span class="keyword">For</span> details <span class="keyword">on</span> how primitives operate <span class="keyword">on</span> ROIs see: Region-<span class="keyword">of</span>-Interest (ROI).</span><br><span class="line">&quot;Sfs&quot; indicates the result <span class="keyword">values</span> are processed <span class="keyword">by</span> fixed scaling <span class="keyword">and</span> saturation <span class="keyword">before</span> they<span class="string">&#x27;re written out.</span></span><br></pre></td></tr></table></figure>

<ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi__support__functions_8h_source.html">image malloc functions</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/nppi__geometry__transforms_8h_source.html">resize function</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/cuda-samples/tree/master/Common/UtilNPP">npp utils</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/group__image__color__model__conversion.html">cvtcolor</a></li>
</ol>
<h2 id="samples"><a href="#samples" class="headerlink" title="samples"></a>samples</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/CUDALibrarySamples.git">NVIDIA-CUDALibrarySamples</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15357586/3790330">simple sample</a></li>
<li><a target="_blank" rel="noopener" href="https://sourcegraph.com/github.com/PacktPublishing/Learn-CUDA-Programming/-/blob/Chapter08/08_cuda_libs_and_other_languages/05_npp/imageFilter.cpp">malloc sample</a></li>
</ol>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/npp/index.html">main page</a></li>
</ol>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贾夕阳"
      src="/images/coder2.jpg">
  <p class="site-author-name" itemprop="name">贾夕阳</p>
  <div class="site-description" itemprop="description">深度学习/自动驾驶/C++/性能优化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">173</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaxiyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaxiyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/26/cutlass/" title="2024&#x2F;01&#x2F;26&#x2F;cutlass&#x2F;">cutlass</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/25/OpenCL/" title="2024&#x2F;01&#x2F;25&#x2F;OpenCL&#x2F;">OpenCL</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/14/Efficient-LLM/" title="2024&#x2F;01&#x2F;14&#x2F;Efficient-LLM&#x2F;">Efficient-LLM</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/11/blas/" title="2024&#x2F;01&#x2F;11&#x2F;blas&#x2F;">blas</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/01/10/llama-cpp/" title="2024&#x2F;01&#x2F;10&#x2F;llama-cpp&#x2F;">llama.cpp</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贾夕阳</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">447k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:46</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/26/2020 14:52:10");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://jiaxiyang.github.io/page/20/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'g32ipLmEye1u5l6wBGRJt03S-gzGzoHsz',
      appKey     : 'zHgLkAICsZUl9Mf8LfdoVigP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>





 
</body>
</html>

