<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiaxiyang.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="NOTE c++23 支持 stack trace basic_stacktrace backward-cpp cpptrace boost stack trace   没 link 报undefined reference to, link 但没 found target was not found 二进制依赖时， 需要先 find_package(glog REQUIRED), 否则 op P">
<meta property="og:type" content="article">
<meta property="og:title" content="Debug">
<meta property="og:url" content="https://jiaxiyang.github.io/2022/02/03/Cpp-debug/index.html">
<meta property="og:site_name" content="Xiyang">
<meta property="og:description" content="NOTE c++23 支持 stack trace basic_stacktrace backward-cpp cpptrace boost stack trace   没 link 报undefined reference to, link 但没 found target was not found 二进制依赖时， 需要先 find_package(glog REQUIRED), 否则 op P">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-03T09:02:35.000Z">
<meta property="article:modified_time" content="2023-12-08T09:52:19.351Z">
<meta property="article:author" content="贾夕阳">
<meta property="article:tag" content="Debug">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jiaxiyang.github.io/2022/02/03/Cpp-debug/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Debug | Xiyang</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WGS6S6YFJ6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WGS6S6YFJ6');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiyang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Think twice, code once!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">158</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">44</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">55</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/jiaxiyang" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiaxiyang.github.io/2022/02/03/Cpp-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/coder2.jpg">
      <meta itemprop="name" content="贾夕阳">
      <meta itemprop="description" content="深度学习/自动驾驶/C++/性能优化">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiyang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Debug
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-03 17:02:35" itemprop="dateCreated datePublished" datetime="2022-02-03T17:02:35+08:00">2022-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-08 17:52:19" itemprop="dateModified" datetime="2023-12-08T17:52:19+08:00">2023-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/Cpp/" itemprop="url" rel="index"><span itemprop="name">Cpp</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/02/03/Cpp-debug/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/02/03/Cpp-debug/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE"></a>NOTE</h2><ol>
<li>c++23 支持 stack trace <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/utility/basic_stacktrace">basic_stacktrace</a><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bombela/backward-cpp">backward-cpp</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jeremy-rifkin/cpptrace">cpptrace</a></li>
<li><a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_80_0/doc/html/stacktrace/getting_started.html">boost stack trace</a></li>
</ul>
</li>
<li>没 link 报<code>undefined reference to</code>, link 但没 found <code>target was not found</code></li>
<li>二进制依赖时， 需要先 find_package(glog REQUIRED), 否则<ul>
<li>op PRIVATE 依赖 glog: undefined reference to 错误, 未传递出 glog 依赖 （静态链接的可以 PRIVATE 依赖)</li>
<li>op PUBLIC 依赖 glog: target was not found 错误, 传递出 glog 依赖</li>
</ul>
</li>
<li><code>gcc/g++  --verbose</code>显示编译过程</li>
<li>strip 是一个在 Unix-like 操作系统中用于删除或剥离目标文件或对象文件的符号信息的工具。<ul>
<li>删除符号表信息：符号表包含了源代码中的函数和变量的名称。</li>
<li>删除调试信息：debug section 被删除</li>
</ul>
</li>
<li>function tracing 只需要 symbols，不需要 debug symbols（gcc -g）。strip 之后不能跟踪</li>
<li>动态符号（.dynsym）vs. 局部符号（.symtab）， .symtab 包含.dynsym; 可以用命令 strip 来手动去掉局部符号表， strip 前后用<code>readelf -s ./test</code>看, strip 只去除了.symtab</li>
<li>strip 之后 gdb 不能使用 function 名字加断点</li>
<li>debug info 作用：<ul>
<li>将内存地址映射到具体某行源代码</li>
<li>调用栈展开（stack unwinding）</li>
</ul>
</li>
<li>在 C++中，如果函数有指定返回类型，但在实际代码中没有返回值或者在所有路径上都没有返回值，那么它的行为是未定义的（Undefined Behavior）。根据 C++标准，未定义的行为可能导致任何结果，包括程序崩溃、生成错误的结果或者在某些情况下看起来像是“正常工作”。</li>
<li><code>addr2line</code>其功能是将函数地址解析成文件名或行号的工具。 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1974629">addr2line debug</a></li>
<li>查看 debug 模式：gdb <code>l</code> and <code>info source</code></li>
<li><code>-DCMAKE_BUILD_TYPE=RelWithDebInfo</code> release 模式编译，带 debug info</li>
<li><code>-DCMAKE_CXX_FLAGS=&quot;-g&quot;</code> cmake 编译选项添加 debug info； release 模式也适用</li>
<li>gcc 选项顺序很重要，如果两个选项冲突，则以后一个为准。可以用<code>-O3 -fno-inline-functions</code>既使用-O3 的功能又关闭函数内嵌功能。</li>
</ol>
<span id="more"></span>

<ol>
<li>踩内存就指访问了不应该访问的内存地址</li>
<li>火焰图可以看调用关系</li>
<li>multidefination 可能是在头文件中定义了函数，多个文件 include 函数, 导致多重定义</li>
<li>segmantation fault 和 bus error 均是内存地址访问导致的问题，<ul>
<li>segmantation fault 是写了只读区域或访问了不能访问区域</li>
<li>bus error 是访问地址未对齐</li>
</ul>
</li>
<li><code>调试要用 debug 模式，性能测试用 release</code></li>
<li>crash 排查:<ul>
<li>引用空指针</li>
<li>使用未初始化的内存</li>
<li>释放后使用，也就是使用悬垂指针</li>
<li>缓冲区溢出，比如数组越界</li>
<li>非法释放已经释放过的或者未分配的指针</li>
</ul>
</li>
<li>static 变量编译顺序，sample: dmlc 注册后处理函数时，如果注册分布在不同文件，需要先声明全局 static 变量后才能 register。 声明文件要在注册文件前执行。解决方法：专门找一个文件，先声明，后注册。</li>
<li>debug 是编译 -DCMAKE_BUILD_TYPE&#x3D;Debug， 否则 gdb 显示信息不全</li>
<li>export LD_LIBRARY_PATH&#x3D;xxxx:xxxx:xxx:$LD_LIBRARY_PATH, $LD_LIBRARY_PATH 放后面，否则容易链接到其他版本库</li>
<li>因为 assert 是一种 debug 工具，而 release 不是 debug，所以不启用。</li>
<li><code>NDEBUG</code> 这个编译宏可以控制是否启用 assert，如果定义了就不会执行</li>
<li>debug 模式 assert 会出错， release 无问题，因为 assert 不起作用 <a target="_blank" rel="noopener" href="https://murphypei.github.io/blog/2020/01/assert-debug-release">link</a></li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">  <span class="type">int</span> status = <span class="built_in">do_something</span> ();</span><br><span class="line">  <span class="built_in">assert</span> (status == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要写成这样</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i)</span><br><span class="line">  <span class="built_in">assert</span> (<span class="built_in">do_something</span> () == <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="未定义的行为"><a href="#未定义的行为" class="headerlink" title="未定义的行为"></a>未定义的行为</h2><ol>
<li>行为<ul>
<li>在函数中遗漏返回语句（如果函数声明了返回类型）</li>
<li>读取或写入非法的内存地址</li>
<li>整数除以零</li>
<li>整数溢出</li>
<li>对 null 指针进行解引用</li>
<li>对已经释放的内存进行操作</li>
</ul>
</li>
<li>结果<ul>
<li>程序崩溃</li>
<li>程序正常运行，但生成错误的结果</li>
<li>程序看似正常运行，但在后台有潜在的错误或安全问题</li>
<li>在不同的编译器、不同的平台或不同的编译器优化级别下，有不同的行为</li>
</ul>
</li>
</ol>
<h2 id="debug-和-releae-模式行为不一致"><a href="#debug-和-releae-模式行为不一致" class="headerlink" title="debug 和 releae 模式行为不一致"></a>debug 和 releae 模式行为不一致</h2><p>C++在 Debug 和 Release 模式下运行不一致，可能由多种原因造成。以下是一些常见的原因：</p>
<ol>
<li><strong>未初始化的变量</strong>：在 Debug 模式下，一些编译器会自动初始化变量（如将指针设置为 null 或整数设置为零），但在 Release 模式下，编译器通常不会这么做。如果你的代码依赖于这些自动初始化的行为，那么在 Release 模式下可能会出现问题。</li>
<li><strong>内存越界访问</strong>：Debug 模式通常包含额外的内存检查，例如检测数组越界访问。然而，Release 模式为了提高性能，通常不包含这些检查。如果你的代码中存在内存越界访问，可能在 Debug 模式下不会出现问题，但在 Release 模式下会导致各种未定义行为。</li>
<li><strong>断言（assert）语句</strong>：断言在 Debug 模式下是启用的，可以帮助找出不满足预期条件的情况。但在 Release 模式下，为了提高性能，通常会禁用断言。因此，一些在 Debug 模式下由于断言而被发现的问题，在 Release 模式下可能会被忽视。</li>
<li><strong>优化</strong>：Release 模式通常会开启更多的编译优化。这些优化有时可能会暴露出在 Debug 模式下不会出现的问题，特别是当代码包含未定义行为或者对于优化的假设不正确时。</li>
<li><strong>多线程竞态条件</strong>：在 Debug 模式下，线程的调度和执行速度可能与 Release 模式有所不同。如果代码中存在依赖于特定线程执行顺序的竞态条件，这种条件在 Debug 模式下可能永远不会出现，但在 Release 模式下就可能出现。<br>要解决这种问题，首先需要确定问题出现的具体位置。然后，检查是否存在上述问题，如未初始化的变量、内存越界、断言、错误的编译优化假设或多线程竞态条件等。使用静态代码分析工具、动态内存检查工具或者并发问题检查工具等也可以帮助找出问题的原因。</li>
</ol>
<h2 id="对数"><a href="#对数" class="headerlink" title="对数"></a>对数</h2><ol>
<li>opencv yml 文件</li>
<li>dump to file</li>
<li>gdbserver + gdb + vscode</li>
<li>gdb script to dump binary + tools(转为 float， 对比数值) 工具一键获取</li>
<li>自动比对功能， <a target="_blank" rel="noopener" href="https://github.com/Xilinx/Vitis-AI/blob/29c76cb5c29eaebb31c553572bbad56228b27c17/src/vai_runtime/vart/dpu-runner/src/dpu_runner_base_imp.cpp#L457">ref</a></li>
</ol>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><h3 id="链接错误"><a href="#链接错误" class="headerlink" title="链接错误"></a>链接错误</h3><ol>
<li><a target="_blank" rel="noopener" href="https://murphypei.github.io/blog/2019/06/link-sort">C++ 链接库顺序导致的符号未定义问题</a></li>
<li><code>nm -C _.a/_.so</code> 查看库里符号 <code>-C</code> Decode low-level symbol names into user-level names</li>
<li>链接顺序： 从右到左</li>
</ol>
<h3 id="bus-error"><a href="#bus-error" class="headerlink" title="bus error"></a><code>bus error</code></h3><ol>
<li><p>Bus errors are rare nowadays on x86 and occur when your processor cannot even attempt the memory access requested, typically:</p>
<ul>
<li>using a processor instruction with an address that does not satisfy its alignment requirements. such as: 0x000000003, 4Bytes 对齐</li>
</ul>
</li>
<li><p>A bus error is trying to access memory that <code>can&#39;t possibly be there</code>. You’ve used an address that’s meaningless to the system, or the wrong kind of address for that operation.</p>
</li>
<li><p>x86 机器不设置就不会 bus_error <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/8412760">link</a></p>
</li>
</ol>
<h3 id="segmentation-fault"><a href="#segmentation-fault" class="headerlink" title="segmentation fault"></a><code>segmentation fault</code></h3><ol>
<li>Segmentation faults occur when accessing memory which does not belong to your process. They are very common and are typically the result of:<ul>
<li>using a pointer to something that was deallocated.</li>
<li>using an uninitialized hence bogus pointer.</li>
<li>using a null pointer.</li>
<li>overflowing a buffer.</li>
</ul>
</li>
<li>A segfault is accessing memory that you’re <code>not allowed to access</code>. It’s read-only, you don’t have permission, etc…</li>
<li>主要与指针相关值相关, 未初始化，初始化为 nullptr</li>
</ol>
<h3 id="file-leak-Too-many-open-files"><a href="#file-leak-Too-many-open-files" class="headerlink" title="file leak: Too many open files"></a>file leak: <code>Too many open files</code></h3><ol>
<li>file leak, not close</li>
<li><code>watch cat /proc/sys/fs/file-nr</code> get the current number of open files</li>
<li>find open files limit per process: <code>ulimit -n</code></li>
<li>count all opened files by all processes: <code>lsof | wc -l</code></li>
<li>get maximum allowed number of open files: <code>cat /proc/sys/fs/file-max</code></li>
<li><code>lsof -u xiyang.jia | wc -l</code> or <code>lsof | wc -l</code> to see how many files are open.</li>
<li>Please note that <code>lsof | wc -l</code> sums up a lot of duplicated entries (forked processes can share file handles etc).<br>That number could be much higher than the limit set in <code>/proc/sys/fs/file-max</code>.<br>To get the current number of open files from the Linux kernel’s point of view, do this:<br><code>cat /proc/sys/fs/file-nr</code><br>Example: This server has 40096 out of max 65536 open files, although lsof reports a much larger number:</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat <span class="regexp">/proc/</span>sys<span class="regexp">/fs/</span><span class="keyword">file</span>-max</span><br><span class="line"><span class="number">65536</span></span><br><span class="line"># cat <span class="regexp">/proc/</span>sys<span class="regexp">/fs/</span><span class="keyword">file</span>-nr</span><br><span class="line"><span class="number">40096</span>   <span class="number">0</span>       <span class="number">65536</span></span><br><span class="line"># lsof | wc -l</span><br><span class="line"><span class="number">521504</span></span><br></pre></td></tr></table></figure>

<h2 id="libs"><a href="#libs" class="headerlink" title="libs"></a>libs</h2><h3 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> fp = <span class="built_in">fopen</span>(<span class="string">&quot;/sys/class/gpio/gpio3/value&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!fp) &#123;</span><br><span class="line">  <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">&quot;strerror(errno)=&quot;</span> &lt;&lt; <span class="built_in">strerror</span>(errno);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li>NOTE: errno is key word, should not use be a variable</li>
<li>errno is a preprocessor macro used for error indication</li>
</ol>
<h3 id="errno-command"><a href="#errno-command" class="headerlink" title="errno command"></a>errno command</h3><ol>
<li><code>sudo apt install errno</code></li>
<li>errno -l</li>
</ol>
<h2 id="info"><a href="#info" class="headerlink" title="info"></a>info</h2><ol>
<li><code>cat /proc/xxxx/status</code> 查看进程信息</li>
</ol>
<h2 id="crash-命令"><a href="#crash-命令" class="headerlink" title="crash 命令"></a>crash 命令</h2><h2 id="lldb"><a href="#lldb" class="headerlink" title="lldb"></a><a target="_blank" rel="noopener" href="https://lldb.llvm.org/">lldb</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://lldb.llvm.org/use/map.html">GDB to LLDB command map</a></li>
</ol>
<h2 id="GDB-使用"><a href="#GDB-使用" class="headerlink" title="GDB 使用"></a><a target="_blank" rel="noopener" href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/">GDB 使用</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/break-on-entry.html">100 个小技巧</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hellogcc/100-gdb-tips">100-gdb-tips</a></li>
<li><a target="_blank" rel="noopener" href="https://johnysswlab.com/gdb-a-quick-guide-to-make-your-debugging-easier/">gdb-a-quick-guide-to-make-your-debugging-easier</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/336922639">原理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yanbinghu.com/2019/04/20/41283.html">入门指南</a></li>
</ol>
<h3 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h3><ol>
<li><code>(good) generate-core-file or gcore</code> 让被调试的进程产生 core dump 文件，记录现在进程的状态，以供以后分析; <code>gdb &lt;program&gt; &lt;core_file&gt;</code> or <code>gdb &lt;porgam&gt; =&gt; core &lt;core_file&gt;</code></li>
<li><code>gcore $(pidof processname)</code> 命令行直接执行产生 coredump <code>-a</code>产生更详细信息</li>
<li><code>directory dir</code> 设置源文件查找路径(类似 include，设置到最后一级, 适合找单一文件, 或者把所有文件放到一个文件夹里)</li>
<li><code>(good) set substitute-path /from /to</code> 映射源码位置， <code>show substitute-path</code>查看映射表,<code>info sources</code>查看源码路径 <code>info source</code>查看 Compilation directory</li>
<li><code>(good) info proc all</code> 查看当前进程各种信息，包括 pid， 调试的命令, 是否 coredump, threads nums 等</li>
<li><code>set step-mode on</code>默认情况下，gdb 不会进入不带调试信息的函数。可以执行<code>set step-mode on</code>命令，这样 gdb 就不会跳过没有调试信息的函数, 可以使用调试汇编程序的办法去调试函数</li>
<li><code>info functions add</code> 列出 add 函数</li>
<li>dump binary memory max_scores_dump.bin max_scores_vec.data() max_scores_vec.data()+max_scores_vec.size() 保存内存内容到文件, 可以配合脚本 dump 文件</li>
<li>show env and show path 查看环境变量和 path</li>
<li>gdb 调试时打不上断点，要使用 LD_PRELOAD 先加载动态库，找不到文件所在动态库，使用 speedscope</li>
<li>sharedlibrary libxxx.so 加载库 libxxx.so</li>
<li>help or help xxx 查看帮助</li>
<li><code>set logging file xxx; set trace-commands on;set logging on</code> 保存 log</li>
<li><code>start</code> 自动停止到 main</li>
<li>until or u 函数里运行到第几行， 比打断点再运行效率高很多</li>
<li>i b, i s, i w</li>
<li>i locals or i lo 打印局部变量(i 不能打印单独变量)</li>
<li>bt full or i s full 显示各个函数的局部变量值</li>
<li>p xx 打印单个变量</li>
<li><code>x/40i 0x400000</code> <code>disassemble 0x4004e9,0x40050c</code> 查看.text 反汇编内容， i 表示 instruction。<code>info files</code>查看.text 地址</li>
<li>x [&#x2F;Nuf ] expr: examine memory at address expr; 打印内存</li>
<li>x&#x2F;12wf &amp;test[0]: 打印 test 开始 12 个 float 内存</li>
<li>x&#x2F;16gf Q.data 打印 double</li>
<li>x&#x2F;12bx 打印二进制, 方便对数</li>
<li>x&#x2F;12bu 打印二进制, 8 位无符号</li>
<li>display expr: show value of expr each time program stops</li>
<li>set print pretty on 打印 class， 一个变量一行</li>
<li>i functions</li>
<li><code>frame</code> 查看当前运行堆栈, 包含运行哪一行, bt 之后可以回溯栈上变量</li>
<li><code>up n or down n</code> 命令向上或向下选择函数堆栈帧，其中 n 是层数</li>
<li>c-x a 可以快速看哪一行，再按一遍</li>
<li>bt 可以显示运行到哪一行, l -1 或 l +1 显示当前行前后代码, l function</li>
<li>b Foo::Foo 构造函数打断点</li>
<li>b *0x1111 地址打断点</li>
<li>save breakpoints test.bk &amp;&amp; source test.bk 保存和加载断点</li>
<li>在程序入口处打断点, 先 readelf -h xxx 读入口地址，然后 b * 设置断点 <a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/break-on-entry.html">link</a>, 火焰图也可以看调用关系</li>
<li><code>info files</code> 获取各 section 地址</li>
<li>info files 获取入口地址，b *地址或 b _start</li>
<li><code>info proc mappings</code> 查看进程的内存映射信息, 配合 info files 使用</li>
<li>info sources 获取源码路径, 可用于 debug 具体使用到的头文件， 如 json 使用系统默认，未使用 cpm 依赖的<ul>
<li>gcc -H 编译选项可以列出来用到的头文件 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/60570938">link</a></li>
</ul>
</li>
<li>(good)<code>i source</code> 列出<code>当前文件</code>各种信息，包括编译选项，路径等</li>
<li>b _start 然后 ni 看指令执行</li>
<li>shell ls 或 !ls 在 gdb 中执行 shell 命令</li>
<li>whatis xxx 打印变量类型，</li>
<li>ptype xxx or pt xxx 打印详细信息，xxx 可以是变量也可以是类型名</li>
<li>ptype + p sizeof() 查看类型占内存大小</li>
<li>p object 直接打印对象，可以看出具体内存分配</li>
<li>gdb -x gdb-script.txt –args .&#x2F;my_program<br>or (gdb) source gdb-script.txt 执行命令集合</li>
<li>脚本里#号是注释</li>
<li>set var x &#x3D; value 程序运行可设置变量值</li>
</ol>
<h3 id="图形化"><a href="#图形化" class="headerlink" title="图形化"></a>图形化</h3><ol>
<li><code>(good)gdb -tui program</code>，或者运行 gdb 过程中使用<code>C-x a</code>组合键, 使用图形界面输出历史会不好查看</li>
<li><code>layout split or c-x 2</code> 如果既想显示源代码，又想显示汇编代码</li>
<li><code>layout asm</code>显示汇编</li>
<li><code>layout regs</code>显示寄存器</li>
<li>winheight src -5 调整窗口</li>
</ol>
<h3 id="shoart-key"><a href="#shoart-key" class="headerlink" title="shoart key"></a><a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/TUI-Keys.html">shoart key</a></h3><ol>
<li>C-x s <a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/TUI-Single-Key-Mode.html#TUI-Single-Key-Mode">single mode</a></li>
<li>C-x o Change the active window.</li>
<li>c-n c-p next&#x2F;previous history</li>
</ol>
<h3 id="base"><a href="#base" class="headerlink" title="base"></a>base</h3><ol>
<li>show endian 查看大小端</li>
<li>特别是当你在构建环境(build 目录)下调试程序的时候，可以直接运行 make：</li>
<li>set var a &#x3D; 1 改变变量值</li>
<li>p func2::b 打印 func2 函数中变量 b 值</li>
<li>p ‘static-1.c’::var 打印文件中的变量</li>
<li>i files 查看程序 elf 信息</li>
<li>print sizeof(Type) 打印变量或类型占用内存 size</li>
<li>.gdbinit gdb 配置文件</li>
<li>编译要加 -g <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/74897601">link</a></li>
<li>readelf -S xxx|grep debug 查看有没有 debug 段</li>
<li>file xxx 查看有没有 stripped (编译不能加 -s), 也可以看到有没有 debug</li>
<li>-fkeep-inline-functions 调试内联，编译的程序会变大很多</li>
<li>set logging file log.txt, set logging on, set logging overwrite on 记录执行 log</li>
<li>gdb -q 启动时不显示版本等信息</li>
<li>gdb –args xxx … &amp;&amp; r 或 gdb xxx &amp;&amp; set args … &amp;&amp; r 或 gdb xxx &amp;&amp; r …</li>
<li>show env xxx 显示环境变量</li>
<li>bt 或 i s(info stack) 显示程序栈 backtrace</li>
<li>l 或 l + 向下显示源码， l - 向上显示源码，l 1,100 打印 1 到 100 行， l xxx:10 显示文件 xxx 第 10 行, l funciton 显示函数，</li>
<li>bt 可以显示运行到哪一行, l -1 或 l +1 显示当前行前后代码</li>
<li>step&#x2F;finish 进入&#x2F;返回函数 <a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/finish-and-return.html">link</a></li>
<li>tb 如果想让断点只生效一次，可以使用“tbreak”命令</li>
<li>source script 执行脚本中的命令</li>
<li>p&#x2F;x c 十六进制打印</li>
<li>d 删除所有断点</li>
<li>watch expr</li>
<li>set print array-indexes on 打印数组下标</li>
<li>i args 显示函数参数</li>
<li>i locals 打印局部变量</li>
<li>i sharedlibrary 显示共享链接库</li>
<li>whatis xxx 打印变量类型， ptype xxx 打印详细信息，</li>
<li>set history filename ~&#x2F;.gdb_history， set history save on 保存历史</li>
<li>shell ls 或 !ls 在 gdb 中执行 shell 命令</li>
<li>可以直接执行 cd 和 pwd</li>
<li>远程调试：</li>
<li>emacs gdb-many-window, gdb 多窗口调试</li>
</ol>
<h3 id="汇编调试"><a href="#汇编调试" class="headerlink" title="汇编调试"></a><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/patch-program.html">汇编调试</a></h3><ol>
<li>trick: <code>layout split</code> &#x3D;&gt; <code>layout regs</code> &#x3D;&gt; <code>info files</code> &#x3D;&gt; <code>b *start_adress</code> &#x3D;&gt; <code>ni</code> 一步一步查看寄存器</li>
<li><code>ni</code> 下一条汇编指令</li>
<li><code>si</code> step by machine instructions rather than source lines</li>
<li><code>disassemble</code> 显示汇编</li>
<li><code>disassemble /m main</code> 将函数代码和汇编指令映射起来</li>
<li><code>disassemble /r main</code> 添加 16 进制信息</li>
<li><code>disassemble /mr main</code></li>
<li><code>set disassemble-next-line on</code> 显示下一条汇编</li>
<li><code>display /3i $pc</code> 显示 pc 对应的后 3 条汇编指令, 一直显示<code>d display</code>删除</li>
<li><code>i line 13</code> 显示汇编地址</li>
<li><code>disassemble 0x4004e9,0x40050c</code>根据地址显示汇编</li>
<li><code>disassemble [Start],[End]</code></li>
<li><code>disassemble [Function],+[Length]</code> 配合<code>info functions</code>使用</li>
<li><code>disassemble [Address],+[Length]</code></li>
<li><code>b *main+12</code>函数偏移来打断点</li>
<li><code>p $pc</code>显示 PC 值</li>
<li><code>set var $pc=0x11111</code>设置 PC 值 or <code>jump line or jump *address</code></li>
<li><code>set write on</code> and <code>disassemble /mr drawing</code> and <code>set variable *(short*)0x400651=0x0ceb</code> 修改二进制</li>
<li><code>info registers </code> or <code>info all-registers</code> all 也显示向量寄存器</li>
</ol>
<h3 id="gdbinit"><a href="#gdbinit" class="headerlink" title="~&#x2F;.gdbinit"></a><a target="_blank" rel="noopener" href="https://github.com/gdbinit/Gdbinit/blob/master/gdbinit">~&#x2F;.gdbinit</a></h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存历史命令</span></span><br><span class="line"><span class="built_in">set</span> history filename ~/.gdb_history</span><br><span class="line"><span class="built_in">set</span> history save on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出时不显示提示信息</span></span><br><span class="line"><span class="built_in">set</span> confirm off</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照派生类型打印对象</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> object on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印数组的索引下标</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> array-indexes on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每行打印一个结构体成员</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br></pre></td></tr></table></figure>

<h3 id="funcutions"><a href="#funcutions" class="headerlink" title="funcutions"></a>funcutions</h3><ol>
<li>gcc 自带 python stdlib 支持: 非常有用</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line">sys.path.insert(<span class="number">0</span>, glob.glob(<span class="string">&#x27;/usr/share/gcc/python&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">from</span> libstdcxx.v6.printers <span class="keyword">import</span> register_libstdcxx_printers</span><br><span class="line">register_libstdcxx_printers (<span class="literal">None</span>)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<ol>
<li><a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/print-STL-container.html">打印 c++容器</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/25499805">print vector</a></li>
</ol>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><ol>
<li>gdb attach [pid], 如果卡死另外一个窗口打开</li>
<li>info threads</li>
<li>thread <thread id> 查看出问题 thread</li>
<li>bt</li>
<li>thread apply all bt 打印所有线程信息</li>
<li>thread apply 1-2 bt 打印线程 1-2 堆栈信息</li>
</ol>
<h3 id="gdbserver"><a href="#gdbserver" class="headerlink" title="gdbserver"></a>gdbserver</h3><ol>
<li><code>gdbserver --multi  :2000 ./test1</code>可以多次运行程序</li>
<li><code>gdbserver --once  :2000 ./test1</code> 运行一次就退出</li>
<li><code>gdbserver --attach  :2000 &lt;pid&gt;</code> 运行一次就退出</li>
<li>why? 编译信息和路径都在 host 端，板端源码路径会有问题, 比如只读系统</li>
<li>on client: <code>gdbserver :8000 ./test &lt;args&gt;</code></li>
<li>on host: <code>gdb: target remote &lt;ip&gt;:8000</code></li>
<li>c 开始，不能用 s</li>
<li>跨平台使用 gdb-multiarch， 或找相同 aarch 开开发机， cgdb 无 gdb-mutltiarch</li>
<li>host 有源码就行, target 端不需要源码</li>
<li>detach 断开链接</li>
<li>jump _start 重新执行</li>
<li>First, you need to have a copy of the program you want to debugput onto the target system. The program can be stripped to savespace if needed, as gdbserver doesn’t care about symbols. All symbol handling is taken care of by the GDB running on the host system.</li>
</ol>
<h2 id="gdbgui"><a href="#gdbgui" class="headerlink" title="gdbgui"></a><a target="_blank" rel="noopener" href="https://github.com/cs01/gdbgui">gdbgui</a></h2><ol>
<li>可以绘图： expression， 记录历史值</li>
<li>memory view</li>
<li><code>sudo pip install gdbgui</code></li>
<li><code>gdbgui -g gdb-multiarch</code> 使用 gdbserver</li>
<li><code>--port</code>可能不好使</li>
<li>vnc 下调试用, 不是很流程</li>
<li><code>gdbgui --port 8080 --gdb-cmd=&quot;gdb -x gdbcmds.txt&quot;</code></li>
</ol>
<h2 id="seer"><a href="#seer" class="headerlink" title="seer"></a><a target="_blank" rel="noopener" href="https://github.com/epasveer/seer">seer</a></h2><h2 id="gdb-dashboard"><a href="#gdb-dashboard" class="headerlink" title="gdb-dashboard"></a><a target="_blank" rel="noopener" href="https://github.com/cyrus-and/gdb-dashboard">gdb-dashboard</a></h2><ol>
<li><code>wget -P ~ https://git.io/.gdbinit</code> 只需要配置文件</li>
<li><code>help dashboard</code></li>
<li><code>dashboard xxx</code> 可以选择打开和关闭 item 显示</li>
<li><code>dashboard</code> 到 dashboard</li>
<li><code>dashboard -layout !assembly breakpoints !expressions !history !memory !registers source stack threads variables</code></li>
<li>竖屏显示会非常有用</li>
</ol>
<h2 id="rr"><a href="#rr" class="headerlink" title="rr"></a><a target="_blank" rel="noopener" href="https://github.com/rr-debugger/rr">rr</a></h2><ol>
<li>gdb 回放</li>
</ol>
<h2 id="vscode-C-调试"><a href="#vscode-C-调试" class="headerlink" title="vscode C++调试"></a>vscode C++调试</h2><ol>
<li>打不上断点，看下 info sharedlibrary 是否加载， Syms Read 是否为 yes, 注意配置文件中的 cwd 路径, 要与 board 板子上库的相对位置路径一致</li>
<li><a target="_blank" rel="noopener" href="https://excalidraw.com/#json=5TP0xwb0oD-C3RgVJIvjW,YzWZI8S8UEP_-nFMxL-rxA">vscode gdb gdbserver 关系</a></li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/cpp/launch-json-reference#_sourcefilemap">source file map</a> 用于 gdbserver, 指定源码位置</li>
<li>安装 c&#x2F;c++插件</li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/cpp/config-linux">教程</a> 生成 task.json（编译) 和 lauch.json (执行)</li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/editor/debugging">debug 教程</a></li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/getstarted/settings">settings 配置</a></li>
<li>.vscode 配置文件下可以改 build 和执行 exe</li>
<li>cmake 工程使用：命令来编译， lauch.json 配置执行环境</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014552102/article/details/122793256">VsCode + gdb + gdbserver 远程调试 C++程序</a><ul>
<li>其中”program”是要被调试的程序在 vmware 中的路径 程序要和板子上一致</li>
<li>“cmd”是要被调试的程序在 vmware 中的目录</li>
<li>“miDebuggerPath” 是我们刚刚编译出来的 aarch64-buildroot-linux-gnu-gdb 在 vmware 中的路径</li>
<li>“miDebuggerServerAddress”对应我们刚刚在板子上执行的 gdbserver 指令</li>
</ul>
</li>
<li>注意不同 arch 要用 gdb-multiarch</li>
<li>C-S-d 快速 debug</li>
<li>debug console 中可以输入命令：<code>-exec info registers</code></li>
<li>gcc c++ stl 支持： <code>/usr/share/gcc/python/libstdcxx</code>, 需配置.gdbinit</li>
<li>debug 点到变量上就会有值输出</li>
<li>可以选择 stack，看改 stack 各变量值</li>
<li>terminal 下使用 tmux，否则容易断开</li>
<li>可以配置 compile_commands.json</li>
<li>配置快捷键，左手单独操作</li>
<li><code>open disassembly view</code>打开汇编窗口</li>
<li>选中字符 然后 add to watch</li>
<li>debug variables 如果嵌套比较深，可以用<code>-exec print xxx</code>来看结果</li>
<li><code>Debug: start without debugging</code> debug 模式不进入断点，直接运行</li>
<li><code>Debug: run to cursor</code> 运行到当前 cursor</li>
<li><code>Debug: add logpoint</code>研究一下</li>
<li><code>compile_commands.json</code> 可以精准跳转，能帮助定位编译中的问题，如：json 头文件找错地方， 多重 include<ul>
<li>也可以先编译一个 debug 程序 gdb info sources 看具体用到了哪个路径下的文件。</li>
</ul>
</li>
<li>通过命令行 <code>-exec p xxx</code> 来完全显示变量</li>
<li>先打开 log， 然后执行命令，关闭 log， 搜索 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/41965636">link</a></li>
</ol>
<h3 id="debug-console"><a href="#debug-console" class="headerlink" title="debug console"></a>debug console</h3><ol>
<li>可以输入 gdb 命令，加<code>-exec</code></li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/editor/debugging">intro</a></li>
<li>可以进行算术运算</li>
<li>可以直接输入变量名</li>
</ol>
<h2 id="emacs-gdb-使用"><a href="#emacs-gdb-使用" class="headerlink" title="emacs gdb 使用"></a>emacs gdb 使用</h2><ol>
<li>emacs gdb-many-window, gdb 多窗口调试</li>
<li>M-x gdb-many-windows and then gdb</li>
<li>If the variable gdb-many-windows is nil (the default), M-x gdb normally displays only the GUD interaction buffer.</li>
<li>NOTE: -g and not -O3(优化会跳过某些代码)</li>
<li>gdb reload file: <code>file build/test</code> 不用重新加载， r 时自动重新加载。</li>
</ol>
<h2 id="cgdb"><a href="#cgdb" class="headerlink" title="cgdb"></a><a target="_blank" rel="noopener" href="https://github.com/cgdb/cgdb.git">cgdb</a></h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://cgdb.github.io/docs/CGDB-Mode.html#CGDB-Mode">快捷键</a></p>
</li>
<li><p>esc 源码 i gdb commond</p>
</li>
<li><p><code>esc s</code> scroll mode in the GDB mode.</p>
</li>
<li><p>o open the file dialog. debug 编译用到的所有源码，可用于定位头文件路径问题, 与<code>info sources</code>列出的文件相同，不过每行一个文件，更方便看</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://cgdb.github.io/">web</a></p>
</li>
<li><p>两个窗口，一个显示源码，一个显示 gdb 信息.</p>
</li>
<li><ul>
<li><ul>
<li>调整窗口</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h2><ol>
<li>strace - trace system calls and signals</li>
<li><code>strace -f -e file perf report 2&gt;&amp;1 | grep tips.txt</code> 可用于定位问题</li>
<li><code>strace -p $pid</code> 跟踪正在运行的进程</li>
</ol>
<h2 id="Sanitizers"><a href="#Sanitizers" class="headerlink" title="Sanitizers"></a><a target="_blank" rel="noopener" href="https://github.com/google/sanitizers">Sanitizers</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/ThreadSanitizer.html">ThreadSanitizer</a><ul>
<li>出错了会有两个线程信息，看信息对应的源码可以看到 data race 位置</li>
<li><a target="_blank" rel="noopener" href="https://github.com/google/sanitizers/wiki/ThreadSanitizerDetectableBugs">bug 类型</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/google/sanitizers/wiki/ThreadSanitizerReportFormat">输出信息说明</a></li>
</ul>
</li>
<li>To enable continue-after-error, compile with <code>-fsanitize-recover=address</code> and then run your code with <code>ASAN_OPTIONS=halt_on_error=0</code>. <a target="_blank" rel="noopener" href="https://github.com/google/sanitizers/wiki/AddressSanitizer#faq">link</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.redhat.com/blog/2021/05/05/memory-error-checking-in-c-and-c-comparing-sanitizers-and-valgrind">Memory error checking in C and C++: Comparing Sanitizers and Valgrind</a></li>
<li>sanitizer 消毒剂</li>
<li>tools<ul>
<li>AddressSanitizer (detects addressability issues) and LeakSanitizer (detects memory leaks)</li>
<li>ThreadSanitizer (detects data races and deadlocks) for C++ and Go</li>
<li>MemorySanitizer (detects use of uninitialized memory)</li>
<li>HWASAN, or Hardware-assisted AddressSanitizer, a newer variant of AddressSanitizer that consumes much less memory</li>
<li>UBSan, or UndefinedBehaviorSanitizer</li>
</ul>
</li>
<li><code>-fsanitize=thread</code> 多线程数据竞争编译之后运行会报警告 <a target="_blank" rel="noopener" href="https://github.com/jiaxiyang/cpp_sandbox/blob/d2e077877f1a3dae47215540429b679bcf032c54/concurrency/atomic/atomic1.cpp">sample</a></li>
<li><code>-DCMAKE_CXX_FLAGS=&quot;-fsanitize=address(thread) -g -lasan(-static-libasan)&quot;</code> cmake 编译选项, 加了-lasan 就不需要 LD_PRELOAD</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">LD_PRELOAD</span>=libasan.so</span><br></pre></td></tr></table></figure>

<ol>
<li>cmake address</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(WITH_COMPILER_ASAN)</span><br><span class="line">    <span class="keyword">add_compile_options</span>(-fsanitize=address)</span><br><span class="line">    <span class="keyword">link_libraries</span>(asan)</span><br><span class="line"><span class="keyword">endif</span>(WITH_COMPILER_ASAN)</span><br></pre></td></tr></table></figure>

<h2 id="core-dump"><a href="#core-dump" class="headerlink" title="core dump"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e38a3f1cf7f7">core dump</a></h2><ol>
<li><code>(good) generate-core-file or gcore</code> 让被调试的进程产生 core dump 文件，记录现在进程的状态，以供以后分析; <code>gdb &lt;program&gt; &lt;core_file&gt;</code> or <code>gdb &lt;porgam&gt; =&gt; core &lt;core_file&gt;</code></li>
<li>当程序意外终止时，系统将进程的地址空间内容及终止时的一些信息转存到 core 文件里。</li>
<li><code>file core.xxx</code>: ELF 64-bit LSB core file</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">ulimit</span> -c unlimited</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">ulimit</span> -a</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/core_uses_pid</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;/tmp/core_%t_%p&#x27;</span> &gt; /proc/sys/kernel/core_patter</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">gdb ./build/heimdallr-app /tmp/core_1643444420_1426</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">bt</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">info frame</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">p symbol</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多线程</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">info threads</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">thread apply all bt</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Valgrind"><a href="#Valgrind" class="headerlink" title="Valgrind"></a><a target="_blank" rel="noopener" href="http://senlinzhan.github.io/2017/12/31/valgrind/">Valgrind</a></h2><ol>
<li>Release 模式快很多</li>
<li><a target="_blank" rel="noopener" href="https://valgrind.org/docs/manual/faq.html">常见问题</a></li>
<li><a target="_blank" rel="noopener" href="https://valgrind.org/docs/manual/quick-start.html">quick start</a></li>
<li><a target="_blank" rel="noopener" href="https://valgrind.org/docs/manual/manual.html">manual</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42144707/article/details/117642613?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-117642613-blog-126759520.pc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-117642613-blog-126759520.pc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=1">内存泄漏解释</a></li>
<li><a target="_blank" rel="noopener" href="https://valgrind.org/docs/manual/mc-manual.html#mc-manual.errormsgs">错误解释</a></li>
<li><a target="_blank" rel="noopener" href="https://learnku.com/articles/46663">工具解释</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/jinzeyu_cn/article/details/45969877">DEBUG 神器 valgrind 之 memcheck 报告分析</a></li>
<li>编译程序时，需要加上-g 选项</li>
<li><code>sudo apt-get install libc6-dbg</code> # system libs should not stripped</li>
<li>编译加<code>-g</code>没有调试信息需要安装<code>valgrind-dbg</code></li>
<li><code>--num-callers=10</code>调整 stack size</li>
<li><code>LD_PRELOAD=xxxx.so or --keep-debuginfo=yes</code> 定位 so 中的内存泄漏 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/13136609">link</a></li>
</ol>
<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">% </span><span class="language-bash">wget ftp://sourceware.org/pub/valgrind/valgrind-3.13.0.tar.bz2</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">bzip2 -d valgrind-3.13.0.tar.bz2</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">tar -xf valgrind-3.13.0.tar</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">cd</span> valgrind-3.13.0</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">./configure &amp;&amp; make</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">sudo make install</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交叉编译: NOTE: 开发板上路径要与--prefix安装路径一致</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">export</span> CC=/opt/gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">export</span> CXX=/opt/gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-g++</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">export</span> LD=/opt/gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-ld</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">export</span> AR=/opt/gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-ar</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">export</span> CPP=/opt/gcc-linaro-6.5.0-2018.12-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-cpp</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash"><span class="built_in">cd</span> valgrind-3.13.0</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">./configure --host=aarch64-linux-gnu --target=aarch64-linux-gnu --prefix=/userdata/valgrind CFLAGS=-static</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">make -j8</span></span><br><span class="line"><span class="meta prompt_">% </span><span class="language-bash">sudo make install</span></span><br></pre></td></tr></table></figure>

<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><ol>
<li><code>valgrind --log-file=test_memcheck.log --tool=memcheck --leak-check=full ls</code> : no summary</li>
<li><code>valgrind --log-file=test_memcheck.log --leak-check=full ls</code> 只显示 submary</li>
<li><code>valgrind --log-file=test_memcheck.log --leak-check=full --show-leak-kinds=all ls</code> 显示详细内容</li>
</ol>
<h2 id="procrank"><a href="#procrank" class="headerlink" title="procrank"></a>procrank</h2><ol>
<li>VSS - Virtual Set Size 虚拟耗用内存（包含共享库占用的内存）</li>
<li>RSS - Resident Set Size 实际使用物理内存（包含共享库占用的内存）</li>
<li>PSS - Proportional Set Size 实际使用的物理内存（比例分配共享库占用的内存）</li>
<li>USS - Unique Set Size 进程独自占用的物理内存（不包含共享库占用的内存）</li>
</ol>
<h2 id="jeprof"><a href="#jeprof" class="headerlink" title="jeprof"></a><a target="_blank" rel="noopener" href="https://phantom9999.github.io/posts/361305b0.html">jeprof</a></h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.yuanguohuo.com/2019/01/02/jemalloc-heap-profiling/">jemalloc 的 heap profiling</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7041453881255018504">jemalloc 检查 c++服务内存泄漏</a></li>
<li>内存增长不一定是代码里 new 了没有 delete 造成内存泄漏，还可能是消费能力不足导致内存堆积</li>
<li>如果发现某数据结构内存增加，多在日志中打印其 size 看看</li>
</ol>
<h2 id="Static-application-security-testing-SAST-静态扫描工具"><a href="#Static-application-security-testing-SAST-静态扫描工具" class="headerlink" title="Static application security testing (SAST) 静态扫描工具"></a>Static application security testing (SAST) 静态扫描工具</h2><ol>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis#C,_C++">lists</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013377887/article/details/108651945">C++静态检查工具总结</a></li>
</ol>
<h3 id="lint"><a href="#lint" class="headerlink" title="lint"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/you_shou/article/details/51199293">lint</a></h3><ol>
<li>在计算机科学中，lint 是一种工具程序的名称，它用来标记源代码中，某些可疑的、不具结构性（可能造成 bug）的段落。它是一种静态程序分析工具，最早适用于 C 语言，在 UNIX 平台上开发出来。后来它成为通用术语，可用于描述在任何一种计算机程序语言中，用来标记源代码中有疑义段落的工具。</li>
<li>apt search lint 可以搜索各种 lint， 如 shellcheck， yamllint</li>
</ol>
<h3 id="clang-tidy-AST-静态检查工具"><a href="#clang-tidy-AST-静态检查工具" class="headerlink" title="clang-tidy AST 静态检查工具"></a><a target="_blank" rel="noopener" href="https://clang.llvm.org/extra/clang-tidy/">clang-tidy AST 静态检查工具</a></h3><ol>
<li>提供 run-clang-tidy 脚本用于实现对整个项目的文件做检查，用起来非常的方便。Runs clang-tidy over all files in a compilation database.</li>
<li><code>run-clang-tidy -quiet -use-color</code> 需要 compile_commands.json</li>
<li><code>run-clang-tidy -p build_path -header-filter=.*</code> 指定编译路径； build_path 下包含 compile_commands.json</li>
<li><code>clang-tidy test.cpp -checks=-*,clang-analyzer-*,-clang-analyzer-cplusplus*</code> will disable all default checks (-<em>) and enable all clang-analyzer-</em> checks except for clang-analyzer-cplusplus* ones.</li>
<li><code>clang-tidy -list-checks</code> 列出所有的 check</li>
<li><code>clang-tidy -checks=&quot;-*,misc-unused-using-decls&quot; path/to/simple.cc --</code> 找出 simple.cc 中所有没有用到的 using declarations. 后面的<code>--</code>表示这个文件不在 compilation database 里面，可以直接单独编 l 译；</li>
<li><code>clang-tidy -checks=&quot;-*,misc-unused-using-decls&quot; -fix path/to/simple.cc --</code>找出 simple.cc 中所有没有用到的 using declarations 并自动 fix(删除掉)</li>
<li><code>clang-tidy -checks=&quot;-*,misc-unused-using-decls&quot; path/to/project/a.cc</code> 找出 a.c 中没有用到的 using declarations. 这里需要 path&#x2F;to&#x2F;project&#x2F;compile_commands.json 存在</li>
<li><a target="_blank" rel="noopener" href="https://clang.llvm.org/extra/clang-tidy/checks/list.html">check list</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/main/.clang-tidy">.clang-tidy</a></li>
<li><code>clang-tidy --dump-config</code>查看当前配置</li>
</ol>
<h3 id="cppcheck"><a href="#cppcheck" class="headerlink" title="cppcheck"></a><a target="_blank" rel="noopener" href="https://github.com/danmar/cppcheck">cppcheck</a></h3><h3 id="cpplint"><a href="#cpplint" class="headerlink" title="cpplint"></a><a target="_blank" rel="noopener" href="https://github.com/cpplint/cpplint">cpplint</a></h3><ol>
<li>配置文件 CPPLINT.cfg</li>
<li>An open-source tool that checks for compliance with Google’s style guide for C++ coding.</li>
<li>它可以检测代码是否符合 Google 的编码规范，会把不符合规范的地方都指出来。</li>
<li><code>cpplint --recursive my_project_directory</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/marketplace/actions/clang-format-check">github clang-format-check</a></li>
</ol>
<h2 id="shared-ptr-调试"><a href="#shared-ptr-调试" class="headerlink" title="shared_ptr 调试"></a>shared_ptr 调试</h2><ol>
<li>注意析构顺序，变量没被析构，memory pool 就被析构了，导致内存泄漏</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> ...&#123;</span><br><span class="line">  std::shared_ptr&lt;hbSysMem&gt; output_mem_; <span class="comment">// 还未加到memory pool</span></span><br><span class="line">  pg::utils::MemoryPool&lt;hbSysMem&gt; mem_pool_; <span class="comment">//先析构了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>注意 deleter， 可能会被改变，如： memory pool 改变传进去的 deleter</li>
<li>use_count()打印引用次数</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/TartanLlama/minidbg">Writing a Linux Debugger</a></li>
</ol>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2023/10/08/rerun/" rel="bookmark">rerun</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>贾夕阳
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://jiaxiyang.github.io/2022/02/03/Cpp-debug/" title="Debug">https://jiaxiyang.github.io/2022/02/03/Cpp-debug/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Debug/" rel="tag"><i class="fa fa-tag"></i> Debug</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/29/Links/" rel="prev" title="Links">
      <i class="fa fa-chevron-left"></i> Links
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/05/image_process/" rel="next" title="Image Process">
      Image Process <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#NOTE"><span class="nav-number">1.</span> <span class="nav-text">NOTE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E8%A1%8C%E4%B8%BA"><span class="nav-number">2.</span> <span class="nav-text">未定义的行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debug-%E5%92%8C-releae-%E6%A8%A1%E5%BC%8F%E8%A1%8C%E4%B8%BA%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="nav-number">3.</span> <span class="nav-text">debug 和 releae 模式行为不一致</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%95%B0"><span class="nav-number">4.</span> <span class="nav-text">对数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="nav-number">5.</span> <span class="nav-text">常见错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF"><span class="nav-number">5.1.</span> <span class="nav-text">链接错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bus-error"><span class="nav-number">5.2.</span> <span class="nav-text">bus error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#segmentation-fault"><span class="nav-number">5.3.</span> <span class="nav-text">segmentation fault</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file-leak-Too-many-open-files"><span class="nav-number">5.4.</span> <span class="nav-text">file leak: Too many open files</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#libs"><span class="nav-number">6.</span> <span class="nav-text">libs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#errno"><span class="nav-number">6.1.</span> <span class="nav-text">errno</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#errno-command"><span class="nav-number">6.2.</span> <span class="nav-text">errno command</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#info"><span class="nav-number">7.</span> <span class="nav-text">info</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crash-%E5%91%BD%E4%BB%A4"><span class="nav-number">8.</span> <span class="nav-text">crash 命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lldb"><span class="nav-number">9.</span> <span class="nav-text">lldb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GDB-%E4%BD%BF%E7%94%A8"><span class="nav-number">10.</span> <span class="nav-text">GDB 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8"><span class="nav-number">10.1.</span> <span class="nav-text">常用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E5%BD%A2%E5%8C%96"><span class="nav-number">10.2.</span> <span class="nav-text">图形化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shoart-key"><span class="nav-number">10.3.</span> <span class="nav-text">shoart key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#base"><span class="nav-number">10.4.</span> <span class="nav-text">base</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%87%E7%BC%96%E8%B0%83%E8%AF%95"><span class="nav-number">10.5.</span> <span class="nav-text">汇编调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gdbinit"><span class="nav-number">10.6.</span> <span class="nav-text">~&#x2F;.gdbinit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#funcutions"><span class="nav-number">10.7.</span> <span class="nav-text">funcutions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">10.8.</span> <span class="nav-text">多线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gdbserver"><span class="nav-number">10.9.</span> <span class="nav-text">gdbserver</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdbgui"><span class="nav-number">11.</span> <span class="nav-text">gdbgui</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#seer"><span class="nav-number">12.</span> <span class="nav-text">seer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-dashboard"><span class="nav-number">13.</span> <span class="nav-text">gdb-dashboard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rr"><span class="nav-number">14.</span> <span class="nav-text">rr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vscode-C-%E8%B0%83%E8%AF%95"><span class="nav-number">15.</span> <span class="nav-text">vscode C++调试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-console"><span class="nav-number">15.1.</span> <span class="nav-text">debug console</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#emacs-gdb-%E4%BD%BF%E7%94%A8"><span class="nav-number">16.</span> <span class="nav-text">emacs gdb 使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cgdb"><span class="nav-number">17.</span> <span class="nav-text">cgdb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#strace"><span class="nav-number">18.</span> <span class="nav-text">strace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sanitizers"><span class="nav-number">19.</span> <span class="nav-text">Sanitizers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#core-dump"><span class="nav-number">20.</span> <span class="nav-text">core dump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Valgrind"><span class="nav-number">21.</span> <span class="nav-text">Valgrind</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install"><span class="nav-number">21.1.</span> <span class="nav-text">install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#command"><span class="nav-number">21.2.</span> <span class="nav-text">command</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#procrank"><span class="nav-number">22.</span> <span class="nav-text">procrank</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jeprof"><span class="nav-number">23.</span> <span class="nav-text">jeprof</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Static-application-security-testing-SAST-%E9%9D%99%E6%80%81%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7"><span class="nav-number">24.</span> <span class="nav-text">Static application security testing (SAST) 静态扫描工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lint"><span class="nav-number">24.1.</span> <span class="nav-text">lint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clang-tidy-AST-%E9%9D%99%E6%80%81%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7"><span class="nav-number">24.2.</span> <span class="nav-text">clang-tidy AST 静态检查工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cppcheck"><span class="nav-number">24.3.</span> <span class="nav-text">cppcheck</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cpplint"><span class="nav-number">24.4.</span> <span class="nav-text">cpplint</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shared-ptr-%E8%B0%83%E8%AF%95"><span class="nav-number">25.</span> <span class="nav-text">shared_ptr 调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#links"><span class="nav-number">26.</span> <span class="nav-text">links</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贾夕阳"
      src="/images/coder2.jpg">
  <p class="site-author-name" itemprop="name">贾夕阳</p>
  <div class="site-description" itemprop="description">深度学习/自动驾驶/C++/性能优化</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jiaxiyang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jiaxiyang" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/21/transformer/" title="2023&#x2F;11&#x2F;21&#x2F;transformer&#x2F;">transformer</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/21/LLM/" title="2023&#x2F;11&#x2F;21&#x2F;LLM&#x2F;">LLM</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/15/shareX/" title="2023&#x2F;11&#x2F;15&#x2F;shareX&#x2F;">shareX</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/10/nvidia/" title="2023&#x2F;11&#x2F;10&#x2F;nvidia&#x2F;">nvidia</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2023/11/05/package-manager/" title="2023&#x2F;11&#x2F;05&#x2F;package-manager&#x2F;">package manager</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贾夕阳</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">380k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:46</span>
</div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("06/26/2020 14:52:10");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : '[object Object]',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://jiaxiyang.github.io/2022/02/03/Cpp-debug/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'g32ipLmEye1u5l6wBGRJt03S-gzGzoHsz',
      appKey     : 'zHgLkAICsZUl9Mf8LfdoVigP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  

  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>





 
</body>
</html>

